angular.module("call-flows",[]).controller("CallFlowsController",["$scope","$timeout","$uibModal","$bootbox","$log",function(e,t,o,a,i){"use strict";e.callsByDay={data:[{y:"Sun",a:55},{y:"Mon",a:22},{y:"Tues",a:175},{y:"Wed",a:50},{y:"Thurs",a:75},{y:"Fri",a:150},{y:"Sat",a:75}],parseTime:!1,xkey:"y",ykeys:["a"],labels:["Calls"],xLabels:"day"},e.uniqueRepeatCallFlow={data:[{y:"Yellow Pages",a:100,b:11},{y:"Google",a:75,b:12},{y:"Bing",a:50,b:5}],xkey:"y",ykeys:["a","b"],labels:["Unique","Repeat"]},e.callsByCallFlow={data:[{y:"Sunday",a:100,b:90},{y:"Monday",a:75,b:65},{y:"Tuesday",a:50,b:40},{y:"Wednesday",a:75,b:65},{y:"Thursday",a:50,b:40},{y:"Friday",a:75,b:65},{y:"Saturday",a:50,b:90}],xkey:"y",ykeys:["a","b"],labels:["Yellow Pages","Google"]},e.totalUniqueRepeat={data:[{label:"Unique",value:125},{label:"Repeat",value:30}]},e.totalAnsweredMissed={data:[{label:"Answered",value:144},{label:"Missed",value:11}]},e.callsByDayByCallFlow={data:[{y:"Sun",a:100,b:90},{y:"Mon",a:75,b:65},{y:"Tues",a:50,b:40},{y:"Wed",a:75,b:65},{y:"Thurs",a:50,b:40},{y:"Fri",a:75,b:65},{y:"Sat",a:100,b:90}],parseTime:!1,xkey:"y",ykeys:["a","b"],labels:["Yellow Pages","Google"]},e.cfCharts=[{heading:"Calls By Day",source:e.callsByDay,type:"Line"},{heading:"Calls by Call Flow",source:e.callsByCallFlow,type:"Bar"},{heading:"Total Unique/Repeat",source:e.totalUniqueRepeat,type:"Donut"}],e.items=[{heading:"Unique/Repeat by Call Flow",source:e.uniqueRepeatCallFlow,type:"Bar",status:!1},{heading:"Total Unique/Repeat",source:e.totalUniqueRepeat,type:"Donut",status:!0},{heading:"Total Answered/Missed",source:e.totalAnsweredMissed,type:"Donut",status:!1},{heading:"Calls By Day",source:e.callsByDay,type:"Line",status:!0},{heading:"Calls by Call Flow",source:e.callsByCallFlow,type:"Bar",status:!0},{heading:"Calls by Day by Call Flow",source:e.callsByDayByCallFlow,type:"Area",status:!1}],e.selectedChart=null,e.open=function(t,a){o.open({templateUrl:"myModalContent.html",controller:function(e,t,o,i){e.items=o,e.cfCharts=i,e.selected={item:e.items[0].heading},e.setChart=function(o){var i=!1;$.each(e.cfCharts,function(t,a){a.heading==e.items[o].heading&&(i=!0)}),i?alert("That report is already being displayed"):($.each(e.items,function(t,o){o.heading==e.cfCharts[a].heading&&(e.items[t].status=!1)}),e.items[o].status=!0,e.cfCharts[a]=e.items[o],t.close(e.selected.item))},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}},size:t,resolve:{items:function(){return e.items},cfCharts:function(){return e.cfCharts}}}).result.then(function(t){e.selected=t},function(){i.info("Modal dismissed at: "+new Date)})}}]),angular.module("breadcrumb",["api-param","whitelabel","theme.navigation-controller"]).factory("BreadcrumbWebService",["$q","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i){"use strict";var r={getChildrenOUs:function(e){return t.defaults.useXDomain=!0,t.get(i.baseURL()+"/v1/orgUnit?org_unit_parent_id="+e,i.headerConfig())},getOUData:function(e){return t.defaults.useXDomain=!0,t.get(i.baseURL()+"/v1/orgUnit/"+e,i.headerConfig())},getOUDataInfo:function(e){return t.defaults.useXDomain=!0,t.get(i.baseURL()+"/v1/orgUnit/info/"+e,i.headerConfig())},updateUser:function(e){var o={method:"PUT",url:i.baseURL()+"/v1/user",headers:i.headerConfig().headers,data:e};return t(o)}};return a.level1OUs=[],a.bc_ous=[{id:a.highestOUId,name:a.highestOUName},{id:null,name:null},{id:null,name:null}],a.showLevel1=!1,a.showLevel2=!1,r.loadLevel1=function(e){a.showOUInput1=!1,a.showLevel1=!0,a.showLevel2=!1,this.getChildrenOUs(e).then(function(e){var t=e.data;for(var o in a.level2OUs=[],a.level3OUs=[],t.json)a.level2OUs.push({id:t.json[o].org_unit_id,name:t.json[o].org_unit_name})},function(e){console.log("err fetching children"),console.log(e)})},r.loadLevel2=function(e){a.showOUInput2=!1,a.showLevel2=!0,a.level3Parent=e,this.getChildrenOUs(e).then(function(e){var t=e.data;for(var o in a.level3OUs=[],t.json)a.level3OUs.push({id:t.json[o].org_unit_id,name:t.json[o].org_unit_name})},function(){console.log("err fetching children"),console.log(err)})},r}]).controller("BreadcrumbController",["$scope","BreadcrumbWebService","$rootScope","$routeParams","pinesNotifications","OrgUnitLocal","$location","OrgUnitWebService","$route","$window","DynamicCssInsertion","menuBarService",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.showBreadCrumb=!0;var p=["/profile","/acq-call-flows","/acq-call-flows4","/calls-details","/set-select-score","/set-score-card","/calls-callback","/call-overview","/settings-call-flow","/activity-group","/set-blacklist","/cfa-reports","/scheduled-plans","/access-denied","/support","/login","/login-admin","/sms-conversations"];e.$on("$locationChangeStart",function(t){e.showBreadCrumb=!_.contains(p,n.path()),"/set-schedule-builder"==n.path()&&n.search().id&&(e.showBreadCrumb=!1)}),e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},50)},$(window).scroll(function(){window.pageYOffset>200&&$(window).trigger("resize")}),e.loadLevel1=function(e){t.loadLevel1(e)},e.loadLevel2=function(e){t.loadLevel2(e)},o.$on("current-ou-updated",function(a,i){(void 0===o.level2OUs||o.level2OUs.length<1)&&i.level>1&&null!==i.billing_id&&void 0!==i.parent_id?t.getChildrenOUs(i.billing_id).then(function(t){var a=t.data;for(var r in o.level2OUs=[],a.json)o.level2OUs.push({id:a.json[r].org_unit_id,name:a.json[r].org_unit_name});e.setCurrentOU(i.id,i.level,e.doNothing,!0)},function(){console.log("err fetching children"),console.log(err)}):e.setCurrentOU(i.id,i.level,e.doNothing,!0)}),e.setCurrentOU=function(a,i,r,s){t.getOUDataInfo(a).success(function(t){if(o.white_label_active=c.sessionStorage.white_label_active=!1,!0===t.json[0].style.white_label_active&&(o.white_label_active=c.sessionStorage.white_label_active=!0),o.protect_caller_id=c.sessionStorage.protect_caller_id=t.json[0].protect_caller_id,t.json[0].style&&Object.keys(t.json[0].style).length>0?(o.chatURL=c.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",o.chatActive=c.sessionStorage.chatActive=t.json[0].style.chat_active,t.json[0].style.support_url||t.json[0].style.domain_name?o.supportURL=c.sessionStorage.supportURL=t.json[0].style.support_url:o.supportURL=c.sessionStorage.supportURL="https://knowledgebase.convirza.com",d.whiteLabelCSSInject(t.json[0].style.white_label_css,t.json[0].style.org_logo,t.json[0].style.org_logo,!1)):(o.chatURL=c.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",o.chatActive=c.sessionStorage.chatActive=!0,o.supportURL=c.sessionStorage.supportURL="https://knowledgebase.convirza.com",d.whiteLabelCSSInject(null,null,null,!1)),o.feedbackURL=c.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+window.sessionStorage.uservoiceSSO,o.currentOUId=c.sessionStorage.currentOUId=a,o.currentOUName=c.sessionStorage.currentOUName=t.json[0].org_unit_name,o.currentOULevel=c.sessionStorage.currentOULevel=i,o.bc_ous[i].id=a,o.bc_ous[i].name=t.json[0].org_unit_name,2===i)for(var r in e.level2OUs)e.level2OUs[r].id==t.json[0].org_unit_parent_id&&(o.bc_ous[1].id=t.json[0].org_unit_parent_id,o.bc_ous[1].name=e.level2OUs[r].name);else if(1===i)for(var p in o.showLevel2=!1,o.showLevel1=!0,o.levelOneOus)o.levelOneOus[p].id==t.json[0].org_unit_parent_id&&(o.bc_ous[0].id=t.json[0].org_unit_parent_id,o.bc_ous[0].name=o.levelOneOus[p].name);else for(var m in o.showLevel2=!1,o.showLevel1=!1,o.levelOneOus)o.levelOneOus[m].id==t.json[0].org_unit_parent_id&&(o.bc_ous[0].id=t.json[0].org_unit_parent_id,o.bc_ous[0].name=o.levelOneOus[m].name);for(var g=i;g<2;)g++,o.bc_ous[g].id=null,o.bc_ous[g].name=null;e.showBoxes=!1,o.currentOUId=a,o.currentOUName=t.json[0].org_unit_name,o.currentOULevel=i,c.sessionStorage.bc_ous=JSON.stringify(o.bc_ous),t.json[0].prompts&&t.json[0].prompts.length>0&&(o.prompts=t.json[0].prompts,c.sessionStorage.prompts=JSON.stringify(o.prompts)),t.json[0].whispers&&t.json[0].whispers.length>0&&(o.whispers=t.json[0].whispers,c.sessionStorage.whispers=JSON.stringify(o.whispers)),t.json[0].voicemails&&t.json[0].voicemails.length>0&&(o.voicemails=t.json[0].voicemails,c.sessionStorage.voicemails=JSON.stringify(o.voicemails)),localStorage.setItem("sessionStorageData",JSON.stringify(c.sessionStorage)),o.selectedOU={id:a,level:i},s||("/set-campaign-builder"==n.path()||"/set-legacy-campaign-builder"==n.path()?n.path("/set-campaign"):"/set-schedule-builder"==n.path()?n.url("/set-scheduled"):l.reload());var f=u.getMenuBar();_.each(f,function(e,o){"Settings"===e.label&&_.each(f[o].children,function(e,a){if("Customization"===e.label){var i=_.findLastIndex(f[o].children[a].children,{label:"Blacklist"});t.json[0].protect_caller_id?i>-1&&f[o].children[a].children.splice(i,1):-1===i&&f[o].children[a].children.push({label:"Blacklist",url:"#/set-blacklist"})}f[o].children[a].children=_.sortBy(f[o].children[a].children,function(e){return e.label})})}),o.download_audio_enabled=c.localStorage.download_audio_enabled=t.json[0].download_audio_enabled,e.handleDownloadAudioSetting(f,o.download_audio_enabled)}).error(function(e){console.log("err fetching Org"),console.log(e)}),r("done")},e.handleDownloadAudioSetting=function(e,t){var o=_.findIndex(e,{label:"Legacy Reports"});if(1==t)-1==o&&(e.splice(2,0,{label:"Legacy Reports",iconClasses:"fa fa-bar-chart-o",children:[{label:"Call Details",url:"#/calls-details?report=call_detail"},{label:"Group Activity",url:"#/activity-group?report=group_activity"},{label:"Tracking Number Settings",url:"#/settings-call-flow?report=callflow_setting"}]}),_.each(e,function(t,o){"Settings"===t.label&&e[o].children.splice(1,0,{label:"Legacy Scheduled Reports",url:"#/set-scheduled"})}));else if(-1!==o){e.splice(o,1);var a=-1;_.each(e,function(t,o){"Settings"===t.label&&(_.each(e[o].children,function(e,t){"Legacy Scheduled Reports"===e.label&&(a=t)}),-1!==a&&e[o].children.splice(a,1))})}u.setMenuBar(e)},e.setSelected=function(e,t){o.selectedOU={id:e,level:t},o.userOULevel},e.editOU=function(t,o){e.setCurrentOU(t,o,function(){n.path("/set-group"),e.showBoxes=!1})},e.doNothing=function(){},e.saveOU=function(t,o,a){var r=!1;if(1==a?r=e.newOUForm1.$valid:2==a&&(r=e.newOUForm2.$valid),r){var n={orgUnit:{org_unit_name:t,org_unit_parent_id:o,org_unit_status:"inactive"}};s.createOrgUnit(n).then(function(o){"error"!=o.data.status?(i.notify({title:"Company Details",text:n.orgUnit.org_unit_name+" created ",type:"success"}),1==a?(e.showOUInput1=!1,e.level2OUs.push({id:o.data.json.insertId,name:t})):2==a&&(e.showOUInput2=!1,e.level3OUs.push({id:o.data.json.insertId,name:t}))):i.notify({title:"Company Details",text:o.data.err,type:"error"})})}else i.notify({title:"Group Name",text:"Please provide a group name.",type:"error"})},e.saveOUEnter=function(t,o,a,i){13==i&&e.saveOU(t,o,a)},e.setFocus=function(e){var t=document.getElementById(e);setTimeout(function(){t.focus()},100)},"1"===o.currentOULevel&&null===o.bc_ous[1].id&&(o.bc_ous[1].id=o.currentOUId,o.bc_ous[1].name=o.currentOUName,t.loadLevel1(o.highestOUId)),"2"===o.currentOULevel&&"2"!==o.userOULevel&&(o.bc_ous[2].id=o.currentOUId,o.bc_ous[2].name=o.currentOUName,t.getOUData(o.currentOUId).success(function(a){a.json[0].org_unit_parent_id&&t.getOUData(a.json[0].org_unit_parent_id).success(function(i){o.bc_ous[1].id=i.json[0].org_unit_id,o.bc_ous[1].name=i.json[0].org_unit_name,t.loadLevel1(o.highestOUId),e.loadLevel2(a.json[0].org_unit_parent_id)})}))}]),angular.module("logout",[]).factory("LogoutService",["$q","$timeout","$http","$window","$cookies","$rootScope","pinesNotifications","$location",function(e,t,o,a,i,r,n,s){"use strict";var l={logoutAPI:function(e){var t={method:"POST",url:r.url+":"+r.port+"/login/logout",headers:{"content-type":"application/json"},data:e};return o(t)},logout:function(){var e={access_token:a.sessionStorage.token};l.logoutAPI(e).then(function(e){"success"===e.data.result?(delete a.sessionStorage.component,delete a.sessionStorage.token,delete a.sessionStorage.currentOUId,delete a.sessionStorage.currentOUName,delete a.sessionStorage.currentOULevel,delete a.sessionStorage.topLevelOUId,delete a.sessionStorage.userOULevel,delete a.sessionStorage.highestOUId,delete a.sessionStorage.highestOUName,delete a.sessionStorage.userId,delete a.sessionStorage.fullName,delete a.sessionStorage.userAccess,delete a.sessionStorage.timezone,delete a.sessionStorage.billingId,delete a.sessionStorage.protect_caller_id,delete a.sessionStorage.report_end_date,delete a.sessionStorage.report_start_date,delete a.sessionStorage.uservoiceSSO,delete a.sessionStorage.supportURL,delete a.sessionStorage.feedbackURL,delete a.sessionStorage.levelOneOus,delete a.sessionStorage.orglist,delete a.sessionStorage.reports,a.sessionStorage.clear(),delete r.component,delete r.currentOUId,delete r.currentOUName,delete r.currentOULevel,delete r.topLevelOUId,delete r.activeConversation,delete r.userOULevel,delete r.highestOUId,delete r.highestOUName,delete r.userId,delete r.fullName,delete r.timezone,delete r.userAccess,delete r.billingId,delete r.protect_caller_id,delete r.uservoiceSSO,delete r.supportURL,delete r.feedbackURL,delete r.levelOneOus,delete r.orglist,delete r.reports,delete r.bc_ous,delete r.supportToken,localStorage.clear(),i.remove("ct_token"),document.location=window.location.protocol+"//"+window.location.hostname):(console.log("failed to logout on backend"),n.notify({title:"Failed to logout",text:"An error occurred during the logout process: "+e.data.err,type:"error"}))})}};return l}]).controller("LogoutController",["$scope","$global","$http","$location","LogoutService","$window","$rootScope",function(e,t,o,a,i,r,n){"use strict";e.logOut=function(){e.$emit("logout"),i.logout()}}]),angular.module("theme.services",[]).service("$global",["$rootScope","EnquireService","$document",function(e,t,o){"use strict";this.settings={fixedHeader:!0,headerBarHidden:!0,leftbarCollapsed:!0,leftbarShown:!1,rightbarCollapsed:!1,fullscreen:!1,layoutHorizontal:!1,layoutHorizontalLargeIcons:!1,layoutBoxed:!1,showSearchCollapsed:!1};var a={default:"#ecf0f1",inverse:"#95a5a6",primary:"#3498db",success:"#2ecc71",warning:"#f1c40f",danger:"#e74c3c",info:"#1abcaf",brown:"#c0392b",indigo:"#9b59b6",orange:"#e67e22",midnightblue:"#34495e",sky:"#82c4e6",magenta:"#e73c68",purple:"#e044ab",green:"#16a085",grape:"#7a869c",toyo:"#556b8d",alizarin:"#e74c3c"};this.getBrandColor=function(e){return a[e]?a[e]:a.default},o.ready(function(){t.register("screen and (max-width: 767px)",{match:function(){e.$broadcast("globalStyles:maxWidth767",!0)},unmatch:function(){e.$broadcast("globalStyles:maxWidth767",!1)}})}),this.get=function(e){return this.settings[e]},this.set=function(t,o){this.settings[t]=o,e.$broadcast("globalStyles:changed",{key:t,value:this.settings[t]}),e.$broadcast("globalStyles:changed:"+t,this.settings[t])},this.values=function(){return this.settings}}]).factory("pinesNotifications",function(){"use strict";return{notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t}}}).factory("progressLoader",function(){"use strict";return{start:function(){$(document).skylo("start")},set:function(e){$(document).skylo("set",e)},end:function(){$(document).skylo("end")},get:function(){return $(document).skylo("get")},inch:function(e){$(document).skylo("show",function(){$(document).skylo("inch",e)})}}}).factory("EnquireService",["$window",function(e){"use strict";return e.enquire}]).factory("$bootbox",["$uibModal",function(e){"use strict";return void 0===$.fn.modal&&($.fn.modal=function(t){var o=this;if("hide"!=t){if("show"!=t){var a=e.open({template:$(this).find(".modal-content").html()});this.data("bs.modal",a),setTimeout(function(){$(".modal.ng-isolate-scope").remove(),$(o).css({opacity:1,display:"block"}).addClass("in")},100)}}else this.data("bs.modal")&&(this.data("bs.modal").close(),$(o).remove())}),bootbox}]).service("lazyLoad",["$q","$timeout",function(e,t){"use strict";var o=e.defer(),a=o.promise;this.load=function(i){return angular.forEach(i,function(o){var i,r,n;o.indexOf(".js")>-1&&(i=document,n=e.defer(),(r=i.createElement("script")).type="text/javascript",r.async=!1,r.onload=function(){t(function(){n.resolve()})},r.onerror=function(){t(function(){n.reject()})},a=a.then(function(){return r.src=o,i.getElementsByTagName("head")[0].appendChild(r),n.promise}))}),o.resolve(),a}}]).filter("safe_html",["$sce",function(e){"use strict";return function(t){return e.trustAsHtml(t)}}]),angular.module("theme.directives",[]).directive("disableAnimation",["$animate",function(e){"use strict";return{restrict:"A",link:function(t,o,a){a.$observe("disableAnimation",function(t){e.enabled(!t,o)})}}}]).directive("slideOut",function(){"use strict";return{restrict:"A",scope:{show:"=slideOut"},link:function(e,t,o){t.hide(),e.$watch("show",function(o,a){o!==a&&t.slideToggle({complete:function(){e.$apply()}})})}}}).directive("stickyNav",["$window",function(e){return{scope:{},restrict:"A",link:function(t,o){var a=angular.element(e),i=o[0].clientHeight,r=0;function n(){var t=o.siblings(".stickyNavClass")[0].getBoundingClientRect().top;!o.hasClass("controls-fixed")&&e.pageYOffset>r+i+30&&o.addClass("controls-fixed"),t<100&&o.removeClass("controls-fixed")}t.$watch(function(){return o[0].getBoundingClientRect().top+e.pageYOffset},function(e,t){e===t||o.hasClass("controls-fixed")||(r=e)}),a.bind("resize",function(){o.removeClass("controls-fixed"),r=o[0].getBoundingClientRect().top+e.pageYOffset,n()}),a.bind("scroll",n)}}}]).directive("slideOutNav",["$timeout",function(e){"use strict";return{restrict:"A",scope:{show:"=slideOutNav"},link:function(t,o,a){t.$watch("show",function(a,i){$("body").hasClass("collapse-leftbar")?!0===a?o.css("display","block"):o.css("display","none"):!0===a?o.slideDown({complete:function(){e(function(){t.$apply()})}}):!1===a&&o.slideUp({complete:function(){e(function(){t.$apply()})}})})}}}]).directive("panel",function(){"use strict";return{restrict:"E",transclude:!0,scope:{panelClass:"@",heading:"@",panelIcon:"@"},templateUrl:"templates/panel.html"}}).directive("pulsate",function(){"use strict";return{scope:{pulsate:"="},link:function(e,t,o){$(t).pulsate(e.pulsate)}}}).directive("prettyprint",function(){"use strict";return{restrict:"C",link:function(e,t,o){t.html(prettyPrintOne(t.html(),"",!0))}}}).directive("passwordVerify",function(){"use strict";return{require:"ngModel",scope:{passwordVerify:"="},link:function(e,t,o,a){e.$watch(function(){var t;return(e.passwordVerify||a.$viewValue)&&(t=e.passwordVerify+"_"+a.$viewValue),t},function(t){t&&a.$parsers.unshift(function(t){return e.passwordVerify!==t?void a.$setValidity("passwordVerify",!1):(a.$setValidity("passwordVerify",!0),t)})})}}}).directive("backgroundSwitcher",function(){"use strict";return{restrict:"EA",link:function(e,t,o){$(t).click(function(){$("body").css("background",$(t).css("background"))})}}}).directive("panelControls",[function(){"use strict";return{restrict:"E",require:"?^tabset",link:function(e,t,o,a){var i=$(t).closest(".panel");!1===i.hasClass(".ng-isolate-scope")&&$(t).appendTo(i.find(".options"))}}}]).directive("panelControlCollapse",function(){"use strict";return{restrict:"EAC",link:function(e,t,o){return t.bind("click",function(){$(t).toggleClass("fa-chevron-down fa-chevron-up"),$(t).closest(".panel").find(".panel-body").slideToggle({duration:200}),$(t).closest(".panel-heading").toggleClass("rounded-bottom"),setTimeout(function(){$(window).trigger("resize")},250)}),!1}}}).directive("icheck",["$timeout","$parse",function(e,t){"use strict";return{require:"?ngModel",link:function(t,o,a,i){return e(function(){var e,r=o.parent("label");return r.length&&r.addClass("icheck-label"),e=a.value,t.$watch(a.ngModel,function(e){$(o).iCheck("update")}),$(o).iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}).on("ifChanged",function(r){if("checkbox"===$(o).attr("type")&&a.ngModel&&t.$apply(function(){return i.$setViewValue(r.target.checked)}),"radio"===$(o).attr("type")&&a.ngModel)return t.$apply(function(){return i.$setViewValue(e)})})})}}}]).directive("knob",function(){"use strict";return{restrict:"EA",template:'<input class="dial" type="text"/>',scope:{options:"="},replace:!0,link:function(e,t,o){$(t).knob(e.options)}}}).directive("uiBsSlider",["$timeout",function(e){"use strict";return{link:function(t,o,a){e(function(){o.slider()})}}}]).directive("tileLarge",function(){"use strict";return{restrict:"E",scope:{item:"=data"},templateUrl:"templates/tile-large.html",replace:!0,transclude:!0}}).directive("tileMini",function(){"use strict";return{restrict:"E",scope:{item:"=data"},replace:!0,templateUrl:"templates/tile-mini.html"}}).directive("tile",function(){"use strict";return{restrict:"E",scope:{heading:"@",type:"@"},transclude:!0,templateUrl:"templates/tile-generic.html",link:function(e,t,o){var a=t.find("tile-heading");a.length&&a.appendTo(t.find(".tiles-heading"))},replace:!0}}).directive("jscrollpane",["$timeout",function(e){"use strict";return{restrict:"A",scope:{options:"=jscrollpane"},link:function(t,o,a){e(function(){-1!=navigator.appVersion.indexOf("Win")?o.jScrollPane($.extend({mouseWheelSpeed:20},t.options)):o.jScrollPane(t.options),o.on("click",".jspVerticalBar",function(e){e.preventDefault(),e.stopPropagation()}),o.bind("mousewheel",function(e){e.preventDefault()})})}}}]).directive("stickyScroll",function(){"use strict";return{restrict:"A",link:function(e,t,o){function a(){var e=parseInt(o.stickyScroll),a=$("header").height();if(a>e&&(e=a),!1===$("body").hasClass("static-header"))return t.css("top",e+"px");var i=$(window).scrollTop();t.offset().top;i<e?t.css("top",e-i+"px"):t.css("top","0px")}$(function(){$(window).scroll(a),a()})}}}).directive("uibRightbarRightPosition",function(){"use strict";return{restrict:"A",scope:{isFixedLayout:"=rightbarRightPosition"},link:function(e,t,o){e.$watch("isFixedLayout",function(e,t){e!=t&&setTimeout(function(){var e=$("#page-content"),t=$(window).width()-(e.offset().left+e.outerWidth());t<0&&(t=0),$("#page-rightbar").css("right",t)},100)})}}}).directive("fitHeight",["$window","$timeout","$location",function(e,t,o){"use strict";return{restrict:"A",scope:!0,link:function(e,o,a){e.docHeight=$(document).height();var i=function(e){var t=$("header").height();$("body").hasClass("layout-horizontal")&&(t+=112),e-t>o.outerHeight()?o.css("min-height",e-t+"px"):o.css("min-height",$(window).height()-t)};e.$watch("docHeight",function(e,t){i(e)}),$(window).on("resize",function(){i($(document).height())});var r=function(){e.docHeight=$(document).height(),t(r,1e3)};t(r,1e3)}}}]).directive("jscrollpaneOn",["$timeout",function(e){"use strict";return{restrict:"A",scope:{applyon:"=jscrollpaneOn"},link:function(t,o,a){t.$watch("applyon",function(t){if(!1!==t)e(function(){o.jScrollPane({autoReinitialise:!0})});else{var a=o.data("jsp");a&&a.destroy()}})}}}]).directive("backToTop",function(){"use strict";return{restrict:"AE",link:function(e,t){t.on("click",function(){$("html, body").animate({scrollTop:0},500)})}}}),angular.module("theme.form-components",[]).controller("FormComponentsController",["$scope","$http",function(e,t){"use strict";e.switchStatus=1,e.switchStatus2=1,e.switchStatus3=1,e.switchStatus4=1,e.switchStatus5=1,e.switchStatus6=1,t.get("assets/demo/call_actions.json").then(function(t){e.names=t.data}),e.getLocation=function(e){return t.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:e,sensor:!1}}).then(function(e){var t=[];return angular.forEach(e.data.results,function(e){t.push(e.formatted_address)}),t})},e.colorPicked="#fa4d4d",e.select2RemoteOptions={placeholder:"Search for a movie",minimumInputLength:3,width:"resolve",ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t,apikey:"8vzys3eka2s9hpvkh7wwzp7e"}},results:function(e,t){var o=10*t<e.total;return{results:e.movies,more:o}}},formatResult:function(e){var t="<table class='movie-result'><tr>";return void 0!==e.posters&&void 0!==e.posters.thumbnail&&(t+="<td class='movie-image'><img src='"+e.posters.thumbnail+"'/></td>"),t+="<td class='movie-info'><div class='movie-title'>"+e.title+"</div>",void 0!==e.critics_consensus?t+="<div class='movie-synopsis'>"+e.critics_consensus+"</div>":void 0!==e.synopsis&&(t+="<div class='movie-synopsis'>"+e.synopsis+"</div>"),t+="</td></tr></table>"},formatSelection:function(e){return e.title},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}},e.tagList=["tag1","tag2"],e.select2TaggingOptions={multiple:!0,simple_tags:!0,tags:["tag1","tag2","tag3","tag4"]},e.multiSelect1=[],e.multiSelect2=[]}]).controller("DatepickerDemoController",["$scope",function(e){"use strict";e.today=function(){e.dt=new Date},e.today(),e.clear=function(){e.dt=null},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:new Date},e.toggleMin(),e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.initDate=new Date("2016-15-20"),e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]}]).controller("DatepickerDemoController2",["$scope",function(e){"use strict";e.today=function(){e.dt=new Date},e.today(),e.clear=function(){e.dt=null},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:new Date},e.toggleMin(),e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.initDate=new Date("2016-15-20"),e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]}]).controller("TimepickerDemoCtrl",["$scope",function(e){"use strict";e.mytime=new Date,e.hstep=1,e.mstep=15,e.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.ismeridian=!0,e.toggleMode=function(){e.ismeridian=!e.ismeridian},e.update=function(){var t=new Date;t.setHours(14),t.setMinutes(0),e.mytime=t},e.changed=function(){console.log("Time changed to: "+e.mytime)},e.clear=function(){e.mytime=null}}]).controller("DateRangePickerDemo",["$scope",function(e){"use strict";e.updateDateRange=function(t){alert(e.drp_start),alert(e.drp_end)},e.drp_start=moment().subtract("days",1).format("MMMM D, YYYY"),e.drp_end=moment().add("days",31).format("MMMM D, YYYY"),e.drp_options={ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract("days",1),moment().subtract("days",1)],"Last 7 Days":[moment().subtract("days",6),moment()],"Last 30 Days":[moment().subtract("days",29),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},opens:"left",startDate:moment().subtract("days",29),endDate:moment()}}]),angular.module("theme.form-directives",["ngSanitize","ngCsv"]).directive("autosize",function(){"use strict";return{restrict:"AC",link:function(e,t,o){t.autosize({append:"\n"})}}}).directive("fullscreen",function(){"use strict";return{restrict:"AC",link:function(e,t,o){t.fseditor({maxHeight:500})}}}).directive("colorpicker",function(){"use strict";return{restrict:"AC",link:function(e,t,o){t.colorpicker()}}}).directive("daterangepicker",["$window",function(e){"use strict";return{restrict:"A",scope:{options:"=daterangepicker",start:"=dateBegin",end:"=dateEnd",onapplychange:"&"},link:function(e,t,o){t.daterangepicker(e.options,function(t,o){e.start&&(e.start=t.format("MMMM D, YYYY")),e.end&&(e.end=o.format("MMMM D, YYYY")),e.$apply(),e.onapplychange()})}}}]).directive("angularMultiselect",["$timeout","$parse",function(e,t){"use strict";return{restrict:"A",require:"ngModel",scope:{ngModel:"=",multiSelectoptions:"=",campaignUsersMapping:"="},link:function(t,o,a,i){var r,n="#"+a.id;o.multiSelect({afterSelect:function(e){if("campaign"===e[0].split("-")[0]){var o,a=[],i="<div class='disabled' id='users'>";_.each(t.campaignUsersMapping,function(t){t.campaignid==e[0].split("-")[1]&&(a=t.usersid.split(","),o=t.usersname.split(","),_.each(o,function(e){i+=e+" </br> "}),i+=" </div>")}),_.each(a,function(t){r=angular.element(n).children(),_.each(r,function(o,a){void 0!==o.value&&null!==o.value&&o.value===t&&angular.element(".ms-elem-selectable").eq(a).css("display","none"),void 0!==o.value&&null!==o.value&&o.value==e&&(angular.element(".ms-elem-selection").eq(a).children("#users").remove(),angular.element(".ms-elem-selection").eq(a).append(i))})})}},afterDeselect:function(e){if("campaign"===e[0].split("-")[0]){var o=[],a=[],i=[];_.each(t.ngModel,function(e){"campaign"===e.split("-")[0]?o.push(e.split("-")[1]):a.push({id:e})});var s=[],l=[];_.each(t.campaignUsersMapping,function(t){if(t.campaignid==e[0].split("-")[1]){var a=t.usersid.split(",");_.each(a,function(e){s.push({id:e})})}_.each(o,function(e){if(e==t.campaignid){var o=t.usersid.split(",");_.each(o,function(e){l.push({id:e})})}})}),_.each(s,function(e){_.findWhere(l,e)||_.findWhere(a,e)||i.push(e)}),_.each(i,function(e){r=angular.element(n).children(),_.each(r,function(t,o){void 0!==t.value&&null!==t.value&&t.value===e.id&&angular.element(".ms-elem-selectable").eq(o).css("display","block")})})}}}),_.each(t.multiSelectoptions,function(e){angular.element(n).multiSelect("addOption",{value:e.key,text:e.text,index:0})}),r=angular.element(n).children(),_.each(r,function(e,t){void 0!==e.value&&null!==e.value&&"campaign"===e.value.split("-")[0]&&(angular.element(".ms-elem-selectable").eq(t).css("font-weight","bold"),angular.element(".ms-elem-selection").eq(t).css("font-weight","bold"))}),e(function(){var e,o,a=[];_.each(t.ngModel,function(e){"campaign"===e.split("-")[0]&&a.push(e.split("-")[1])});var i=[];_.each(t.campaignUsersMapping,function(e){_.each(a,function(t){if(t==e.campaignid){var o=e.usersid.split(",");_.each(o,function(e){i.push({id:e})})}})}),_.each(i,function(e){r=angular.element(n).children(),_.each(r,function(t,o){void 0!==t.value&&null!==t.value&&t.value===e.id&&angular.element(".ms-elem-selectable").eq(o).css("display","none")})}),angular.element(n).multiSelect("select",t.ngModel),r=angular.element(n).children(),_.each(t.ngModel,function(a){"campaign"===a.split("-")[0]&&(e="<div class='disabled' id='users'>",_.each(t.campaignUsersMapping,function(t){t.campaignid==a.split("-")[1]&&(o=t.usersname.split(","),_.each(o,function(t){e+=t+" </br> "}),e+=" </div>",_.each(r,function(t,o){void 0!==t.value&&null!==t.value&&t.value==a&&(angular.element(".ms-elem-selection").eq(o).children("#users").remove(),angular.element(".ms-elem-selection").eq(o).append(e))}))}))})},0)}}}]).directive("multiselect",function(){"use strict";return{restrict:"A",link:function(e,t,o){t.multiSelect()}}}).directive("wizard",function(){"use strict";return{restrict:"A",scope:{options:"=wizard"},link:function(e,t,o){e.options?(t.stepy(e.options),!0===e.options.validate&&t.validate({errorClass:"help-block",validClass:"help-block",highlight:function(e,t,o){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e,t,o){$(e).closest(".form-group").removeClass("has-error")}})):t.stepy(),t.find(".stepy-navigator").wrapInner('<div class="pull-right"></div>')}}}).directive("checklength",["$parse","pinesNotifications",function(e,t){"use strict";return{restrict:"A",require:"ngModel",link:function(e,t,o,a){t.bind("blur, keyup",function(){if($(this).attr("required")){var e=t.val().replace(/[^0-9]+/g,"");e.length<parseInt(t.attr("checklength"))?a.$setValidity("phone",!1):parseInt(e)<1e9?a.$setValidity("phone",!1):(a.$setValidity("phone",!0),a.$setValidity("maxlength",!0))}else a.$setValidity("maxlength",!0)})}}}]).directive("checkDuplicate",["$parse","pinesNotifications","$rootScope","UserWebService",function(e,t,o,a){"use strict";return{restrict:"A",require:"ngModel",link:function(e,i,r,n){i.bind("keyup, blur",function(){e.isDupliNoPercentage=!1;var r=parseInt(i.attr("check-duplicate"));if(!1===o.is_migrated||"false"===o.is_migrated){for(var s=0;s<e.percentageRingtoNum.length;s++)if(""!==e.percentageRingtoNum[r].ringtonum&&void 0!==e.percentageRingtoNum[r].ringtonum){var l=parseInt(e.percentageRingtoNum[r].ringtonum.replace(/[^0-9]+/g,"")),c=parseInt(e.percentageRingtoNum[s].ringtonum.replace(/[^0-9]+/g,""));""!==e.percentageRingtoNum[r].ringtonum&&c===l&&r!==s&&(e.isDupliNoPercentage=!0)}else if(""===e.percentageRingtoNum[r].ringtonum||void 0===e.percentageRingtoNum[r].ringtonum&&(""===e.percentageRingtoNum[r].percentage||void 0===e.percentageRingtoNum[r].percentage)){var d=0;_.each(e.percentageRingtoNum,function(e){""!==e.percentage&&void 0!==e.percentage&&(d+=parseInt(e.percentage))}),100!==d||""===e.percentageRingtoNum[r].ringtonum&&void 0!==e.percentageRingtoNum[r].ringtonum||(e.numPer=r-1)}}else if(!0===o.is_migrated||"true"===o.is_migrated){var u=[],p=[],m=_.pluck(e.percentInfo,"ringToNum");_.each(m,function(e){void 0!==e&&""!==e&&p.push(a.unMaskData(e))});var g=function(e){var t={},o=[];for(var a in e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t)t[a]>=2&&o.push(a);return o}(p);_.each(g,function(e){""!==e&&void 0!==e&&u.push(e)}),u.length>0&&t.notify({title:"Percentage Call route",text:"Duplicate ring to number "+g.toString(),type:"error"})}e.isDupliNoPercentage?(n.$setValidity("maxlength",!1),i.hasClass("ng-invalid")||t.notify({title:"Tracking Number Details Form",text:"Duplicate ring to number "+e.percentageRingtoNum[r].ringtonum,type:"error"})):n.$setValidity("maxlength",!0)})}}}]).directive("clearinputmask",function(){"use strict";return{restrict:"A",link:function(e,t,o){t.bind("keydown keypress",function(o){0===t.val().length&&(e[t.attr("ng-model")]=void 0)})}}}).directive("maskinput",function(){"use strict";return{restrict:"A",link:function(e,t,o){var a,i=t.attr("data-inputmask");if(void 0!==i){var r=i.split(":");a=r[1].replace(/'/g,""),t.inputmask({mask:a,oncleared:function(){e.$data=" "}})}else{var n=t.attr("data-scopeinputmask");e.$watch(n,function(){void 0!==e[n]&&(a=e[n].split(":")[1].replace(/'/g,"")),t.inputmask({mask:a,oncleared:function(){e.$data=" "}})})}}}}).directive("numberOnly",function(){"use strict";return{restrict:"A",link:function(e,t,o){t.bind("keydown keypress",function(e){var t=e.keyCode;46!=t&&t>31&&(t<48||t>57)&&e.preventDefault()})}}}).directive("wysiwygCkeditor",function(){"use strict";return{restrict:"A",scope:{options:"=wysiwygCkeditor"},link:function(e,t,o){if(e.options&&!0===e.options.inline)return CKEDITOR.inline(o.id||o.name,e.options);CKEDITOR.replace(o.id||o.name,e.options)}}}).directive("validateUtfEight",["$compile",function(e){"use strict";return{restrict:"A",terminal:!0,priority:1e3,compile:function(t,o){return t.attr("ng-pattern","/^[\\x00-\\x7F]+$/"),t.removeAttr("validate-utf-eight"),{pre:function(e,t,o,a){},post:function(t,o,a,i){e(o)(t)}}}}}]).directive("validateBlurForza",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"="},link:function(t,o,a){var i=a.validateBlurForza.split(",").map(function(e){return e.trim()});i[0],i[1];o.bind("keyup, change",function(){o.closest("div").removeClass("has-error"),o.next().hasClass("editable-error")&&o.next().remove(),t.$apply(function(){o.hasFocus=!0})}),o.bind("blur",function(){var i="";o.val()&&(i=o.val().trim()),o.hasClass("ng-invalid")&&(i.length||angular.isUndefined(t.ngModel))&&(o.hasClass("ng-invalid-required")&&!o.hasClass("ng-invalid-number")||e.notify({title:a.validateBlurForza.split(",")[0].trim()+" Form",text:"'"+a.validateBlurForza.split(",")[1].trim()+"' field is invalid.",type:"error"}))})}}}]).directive("applyCss",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"="},link:function(e,t,o){console.log(t.hasClass("invalidTag")),t.hasClass("invalidTag")&&t.closest("li").addClass("invalidList")}}}]).directive("remainingText",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"="},link:function(e,t,o){t.siblings()}}}]).directive("removeErrorBlur",function(){"use strict";return{restrict:"A",link:function(e,t,o){t.bind("change, keyup",function(){t.closest("div").removeClass("has-error"),t.next().hasClass("editable-error")&&t.next().remove(),e.$apply(function(){t.hasFocus=!0})})}}}).directive("autoComplete",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"=",dtId:"=",uiItems:"=",addCallAction:"="},link:function(t,o,a){var i,r,n=[],s="",l=!1;o.autocomplete({source:function(a,c){if(t.addCallAction.callActionFormSubmitted[t.dtId]=!1,l=!1,angular.isUndefined(r)&&(r=angular.isUndefined(t.ngModel)?"":t.ngModel!=a.term?t.ngModel:""),0===r.length)n=Object.keys(t.uiItems.fields),s=a.term;else{s=(s=a.term.substring(0,o.caret("pos"))).substring(s.lastIndexOf(" "),o.caret("pos")).trim();var d=r.substring(0,o.caret("pos"));d=(d=r.length<o.caret("pos")?d.trim().replace(/ and/g," ."):d.substring(0,d.lastIndexOf(" ")).trim().replace(/ and/g," .")).replace(/ or/g," .");var u,p,m,g=[];if(_.each(d,function(e,t){"."===e&&g.push(f+1)}),0===g.length)u=0,p=r.length;else if(g[g.length-1]<o.caret("pos"))u=g[g.length-1],p=o.caret("pos");else for(var f=0;f<g.length;f++)g[f]<o.caret("pos")&&g[f+1]>o.caret("pos")&&(u=g[f],p=o.caret("pos"));m=0===d.substring(u,p).length?[]:d.substring(u,p).trim().split(/ \s*/),n=0===m.length?Object.keys(t.uiItems.fields):1===m.length?t.uiItems.operators[m[0].replace("_"," ")]:2===m.length?t.uiItems.enum[m[0].replace("_"," ")]:["and","or"]}n.length>0?(i=!1,_.each(n,function(e,t){e.indexOf(s)>-1&&(i=!0)})):i=!0,!1===i&&(e.notify({title:"Invalid",text:s+" is invalid.",type:"error"}),i=!0),c($.ui.autocomplete.filter(n,s))},select:function(e,t){if(i=!1,l=!0,0===r.length)r=t.item.value.replace(" ","_");else if(r.length>o.caret("pos")){var a=r.substring(0,o.caret("pos")),n=r.substring(o.caret("pos"),r.length);r=a.substring(0,a.lastIndexOf(" "))+" "+t.item.value.replace(" ","_")+" "+n.substring(n.indexOf(" "),r.length).trim()}else r=r+" "+t.item.value.replace(" ","_");return this.value=r.replace(/_/g," ").trim(),!1}}),o.bind("keydown keypress",function(e){e=e,n.length>0?32!=e.keyCode||angular.isUndefined(r)||l||(r=r+" "+s,o.siblings("input").val(r)):32!=e.keyCode||angular.isUndefined(r)||(r=r+" "+s,o.siblings("input").val(r)),8!=e.keyCode||angular.isUndefined(r)||0===r.length||(r=r.substr(0,o.caret("pos")-2)+""+r.substr(o.caret("pos"),r.length))})}}}]).directive("enableSave",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"=",dtId:"=",uiItems:"=",addCallAction:"="},link:function(e,t,o){t.bind("keydown keypress change",function(t){e.addCallAction.callActionFormSubmitted[e.dtId]=!1})}}}]).directive("persistentScrollBar",["pinesNotifications",function(e){"use strict";return{restrict:"A",scope:{ngModel:"=",dtId:"=",uiItems:"=",addCallAction:"="},link:function(e,t,o){t.floatingScroll()}}}]).directive("validSubmit",["$parse","pinesNotifications",function(e,t){return{require:"form",link:function(o,a,i,r){r.$submitted=!1;var n=e(i.validSubmit);a.on("submit",function(e){o.$apply(function(){var a=i.id;r.$valid=!0;var s,l,c,d=[],u=[],p="",m=[],g="",f="";$("form#"+a+" :input, select").each(function(){if(void 0!==$(this).attr("required")&&$(this).is(":visible")){var e,t=$(this).val();s=$(this).attr("validate-blur-forza").split(",").map(function(e){return e.trim()}),f=s[0],g=s[1],e=$(this).val(),null!==t&&(e=$(this).val().trim()),""===e||null===e||"?"===e?-1===u.indexOf(g)&&(u.push(g),p=f,l=g):$(this).hasClass("ng-invalid")&&-1===d.indexOf(g)&&(d.push(g),p=f,l=g)}else $(this).hasClass("ng-invalid")&&$(this).is(":visible")&&-1===d.indexOf(g)&&(d.push(g),p=f,l=g);if(void 0!==$(this).attr("datepicker-popup")&&$(this).is(":visible")&&!$(this).attr("disabled")){var o=$(this).val(),a=$(this).attr("timezone"),i=moment.tz(moment(o).format("YYYY-MM-DD HH:mm:ss"),a),r=moment.tz(moment().tz(a).format("YYYY-MM-DD"),a);i.isBefore(r)&&(s=$(this).attr("date-attribute").split(",").map(function(e){return e.trim()}),p=s[0],l=s[1],m.push(l))}}),m.length&&(r.$valid=!1,c="is of past",t.notify({title:p+" Form",text:"'"+m.join(", ")+"' "+c,type:"error"})),u.length&&(r.$valid=!1,c="field is required.",u.length>1&&(c="fields are required."),t.notify({title:p+" Form",text:"'"+u.join(", ")+"' "+c,type:"error"})),d.length&&(r.$valid=!1),r.$submitted=!0,"singlecallForm"==a&&(o.submitted1=!0),o.submitted=!0,r.$invalid&&void 0!==r.$error.phone&&!1===r.$error.required&&(r.$valid=!0),r.$valid&&(r.$invalid=!1,n(o,{$event:e}),r.$submitted=!1,"singlecallForm"==a&&(o.formSubmit1=!0),o.formSubmit=!0)})})}}}]).directive("ngEnter",function(){return function(e,t,o){t.bind("keydown keypress",function(t){if(13===t.which||9===t.which){e.$apply(function(){e.$eval(o.ngEnter)});var a=o.rowid;$("#percentage"+a).focus(),t.preventDefault()}})}}).directive("focus",function(){return{restrict:"A",link:function(e,t,o){t.bind("keydown keypress",function(e){var o=e.keyCode||e.which,a=t.parent().parent().next("div").find("input");13===o&&(e.preventDefault(),a.focus())})}}}).directive("dcChart",["$window","$interpolate",function(e,t){"use strict";return{restrict:"E",replace:!0,compile:function(){return function(e,t,o){e.$watch("chartconfig",function(t){t&&function(e,t,o){var a,i,r,n,s,l,c,d,u,p,m,g,f;p="#"+o.id,m=$(p),a=e.chartconfig,d=a.height,c=.95*m.closest("div .panel-body").innerWidth(),i=e.xf,s=e.dc,l=d3.scale.category20(),u=Math.min(c,d),m.find(".title").text(a.name);var h,v,b,w,y,S,C,A,T,D,I=function(e){return e>9?9:e-1};if(d3.format(",%"),g=d3.time.format("%H:%M:%S"),f=d3.time.format("%b-%d"),d3.time.format("%Y-%m-%d"),"time"!==a.dimensiontype?r=i.dimension(function(e){return e[a.dimension]}):"day"===a.interval?r=i.dimension(function(e){var t=moment(e.date,"YYYY-MM-DD hh:mm:ss").toDate();return e.d3datetime=d3.time.day(t),e.d3datetime}):"hour"===a.interval?r=i.dimension(function(e){return e.date=d3.time.hour(g.parse(e[a.dimension].split(" ")[1].toString())),e.hours=e.date.getHours(),e.hours}):"timezer"===a.interval?r=i.dimension(function(e){return e.date}):"weekzer"===a.interval&&(r=i.dimension(function(e){var t=moment(e.date,"YYYY-MM-DD hh:mm:ss").day();return t+"."+["Sun","Mon","Tues","Wed","Thur","Fri","Sat"][t]})),void 0!==a.filtertype)switch(a.filtertype){case"none":break;case"match":r=r.filter(function(e){if(e.disposition===e[a.filterkey])return e})}switch(a.grouptype){case"none":n=function(e){return null};break;case"none2":n=r.group();break;case"all":n=r.groupAll();break;case"value":n=function(e){return e[a.group]};break;case"count":n=r.group().reduceCount(s.pluck(a.group));break;case"sum":n=r.group().reduceSum(function(e){return e[a.group]});break;case"dayWeekReduce":n=r.group().reduce(function(e,t){return e.total_calls+=t.total_calls||0,e},function(e,t){return e.total_calls-=t.total_calls||0,e},function(){return{total_calls:0}});break;case"reduce":n=r.group().reduce(function(e,t){return e.total+=x(parseInt(t[a.group]),1),e.secondTotal+=x(parseInt(t[a.averageDenominator]),1),e.average=x(e.total,e.secondTotal),e},function(e,t){return e.total-=x(parseInt(t[a.group]),1),e.secondTotal-=x(parseInt(t[a.averageDenominator]),1),e.average=x(e.total,e.secondTotal),e},function(){return{total:0,average:0,secondTotal:0}});break;case"reducePercent":n=r.group().reduce(e.reducers.increment,e.reducers.decrement,e.reducers.initial)}if(void 0!==r.bottom(1)[0]&&(h=r.bottom(1)[0].d3datetime),void 0!==r.top(1)[0]&&(v=r.top(1)[0].d3datetime),"bar2"===a.type)a.chart=s.barChart(p).width(c).height(d).margins({left:35,top:0,bottom:20,right:20}).dimension(r).group(n).xUnits(d3.time.days).centerBar(!0).gap(20).x(d3.time.scale().domain([h,v])),D=n.all().length,T=D-1,a.chart.xAxis().tickFormat(function(e,t,o){return t===T?"":f(e)}).ticks(I(D)),a.chart.yAxis().ticks(3),1===I(D)&&a.chart.renderlet(function(e){e.selectAll("rect.bar").attr("width",15).attr("x",2.5)});else if("timeline"===a.type)a.chart=s.lineChart(p).width(c).height(d).margins({left:35,top:10,bottom:16,right:19}).dimension(r).group(n).transitionDuration(1e3).valueAccessor(function(e){return 100*e.value.conversion_percent}).xUnits(d3.time.days).renderHorizontalGridLines(!0).elasticY(!0),D=n.all().length,a.chart.x(d3.time.scale().domain([h,v])),1===I(D)&&a.chart.brushOn(!1).dotRadius(10).renderlet(function(e){e.selectAll("circle.dot").style("fill-opacity",1).on("mouseout",function(){d3.select(this).style("fill-opacity",1)})}),T=D-1,a.chart.xAxis().tickFormat(function(e,t){return t===T?"":moment(e).format("M/D")}).ticks(I(D)),a.chart.defined(function(e,t){return t!==T}),a.chart.yAxisLabel("% of Conversions ");else if("row2"===a.type)a.chart=s.rowChart(p).width(c).height(d).dimension(r).group(n).elasticX(!0).valueAccessor(function(e){return e.value.total_calls}).label(function(e){return e.key.split(".")[1]}).title(function(e){return e.key.split(".")[1]+" - "+e.value.total_calls+" calls"}).ordering(function(e){return e.key.split(".")[0]}),a.chart.xAxis().ticks(5);else if("pie"===a.type||"donut"===a.type)a.chart=s.pieChart(p).width(c).height(d).dimension(r).group(n).radius(u/2).innerRadius("pie"===a.type?0:u/5).legend(s.legend());else if("row"===a.type){var N=n.all().length,k=.88*m.closest("div .panel-body").innerHeight(),R=45*N+10;R=R>k?R:k,a.chart=s.rowChart(p).width(c).height(R).dimension(r).group(n).elasticX(!0).rowsCap(35).othersGrouper(!1).ordering(function(e){return e}),a.chart.xAxis().ticks(5)}else if("number"===a.type)a.chart=s.numberDisplay(p).width(c).height(d).group(n).valueAccessor(function(e){if(void 0===e)return console.log("Number widget 0 for",a.name),0;if(void 0!==e.key){if(isNaN(e.value))return a.averageDenominator?x(e.value.average,1):x(e.value.total,1);for(var t in a.chart.group().all())if(a.chart.group().all()[t].key===a.groupkey)return a.chart.group().all()[t].value;return 0}}).formatNumber(d3.format(a.format?a.format:"")),"HH:mm:ss"===a.format&&a.chart.formatNumber(function(e){return moment.utc(1e3*parseInt(e.toFixed())).format("HH:mm:ss")});else if("line"===a.type){y=n.top(1/0),S=1/0,C=-1/0,b=d3.min(n.all(),function(e){return e.key}),w=d3.max(n.all(),function(e){return e.key});for(var F=0;F<y.length;F++)A=parseFloat(y[F].value),S>A&&(S=A),C<A&&(C=A);a.chart=s.lineChart(p).renderArea(!1).width(c).height(d).dimension(r).group(n).x("date"!==a.dimension?d3.scale.linear().domain([b,w]):d3.time.scale().domain([h,v])).y(d3.scale.linear().domain([S,C])).renderHorizontalGridLines(!0),a.chart.valueAccessor(function(e){return e.value}).elasticY(!0).elasticX(!1).brushOn(!0)}else"bar"===a.type&&(y=n.top(1/0),S=1/0,C=-1/0,b=d3.min(n.all(),function(e){return e.key}),w=d3.max(n.all(),function(e){return e.key}),h=d3.min(n),_.each(y,function(e){A=parseFloat(y[F].value),S>A&&(S=A),C<A&&(C=A)}),a.chart=s.barChart(p).width(c).height(d).dimension(r).group(n).centerBar(!0).brushOn(!0).elasticY(!0).x("date"!==a.dimension?d3.scale.linear().domain([b,w]):d3.time.scale().domain([b,w])));function x(e,t){var o=e/t,a=isNaN(o)||null===o?0:o;return a}a.chart.on("filtered",function(){e.redotable()}),null!==a.chart&&"number"!==a.type&&"datagrid"!==a.type&&"timeline"!==a.type&&(a.chart.transitionDuration(1e3).colors(l),"asc"===a.sort?a.chart.ordering(function(e){return e.value}):"desc"===a.sort&&a.chart.ordering(function(e){return-e.value}),"top"===a.top?(n.value=parseInt(a.top_value),a.chart.data(function(e){return e.top(e.value)})):"bottom"===a.top&&(n.value=-parseInt(a.top_value),a.chart.data(function(e){return e.top(1/0).splice(e.value)}))),void 0!==e.chartcollection&&e.chartcollection.push({chart:a.chart,selector:p}),s.renderAll()}(e,0,o)})}},scope:{chartconfig:"=",xf:"=",dc:"=",secgroup:"=",primgroup:"=",chartcollection:"=",redotable:"=",reducers:"="},template:function(e,t){return{standard:["<div class='chart'>","<span class='handle'>","<span class='title'></span>","<span class='button'>","</span>","</span>","</div>"].join(""),datatable:void 0,none:["<span>","</span>"].join("")}[t.template]}}}]).directive("exportElementPdf",[function(){}]).directive("clickTip",function(){return{restrict:"A",scope:{},link:function(e,t,o){t.addClass("tip"),t.attr("title",o.clickTip),t.bind("click",function(){var e=t.find("span");e.length?e.remove():t.append('<span class="title">'+o.clickTip+"</span>")})}}}).directive("myMaxLength",function(){return{link:function(e,t,o){t.bind("input",function(){this.value&&this.value.length>o.myMaxLength&&(this.value=this.value.slice(0,o.myMaxLength))})}}}).directive("enterPress",function(){return{link:function(e,t,o){t.bind("keyup",function(t){13===t.keyCode&&(e.$apply(function(){e.$eval(o.enterPress,{event:t})}),t.preventDefault())})}}}).directive("multipleEmails",function(){var e=/^[-._a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,7})$/;return{restrict:"A",require:"ngModel",link:function(t,o,a,i){function r(t){return function(t,o,a){var i=t.$isEmpty(a)||a.split(",").every(function(t){return e.test(t.trim())});return t.$setValidity(o,i),i?a:void 0}(i,"multipleEmails",t)}i.$formatters.push(r),i.$parsers.push(r)}}}).directive("validateEmail",function(){var e=/^[-._a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,7})$/;return{restrict:"A",require:"ngModel",link:function(t,o,a,i){function r(t){return function(t,o,a){var i=t.$isEmpty(a)||e.test(a.trim());return t.$setValidity(o,i),i?a:void 0}(i,"validateEmail",t)}i.$formatters.push(r),i.$parsers.push(r)}}}).directive("disableComma",["pinesNotifications",function(e){"use strict";return{restrict:"A",link:function(e,t,o,a){t.bind("keyup change",function(e){var a=o.validateBlurForza.split(",").map(function(e){return e.trim()});a[0],a[1];t.val().indexOf(",")>-1?(t.addClass("ng-invalid ng-dirty"),t.removeClass("ng-valid")):(t.removeClass("ng-invalid ng-dirty"),t.addClass("ng-valid"))})}}}]).directive("validateMaskedPhoneNumber",["pinesNotifications",function(e){"use strict";return{restrict:"A",link:function(e,t,o,a){t.bind("keyup change",function(e){var o=t.val().replace(/\D/g,""),a=t.attr("required");o.length>0?10!==o.length||"0"==t.val().charAt(1)?(t.addClass("ng-invalid ng-dirty"),t.removeClass("ng-valid")):(t.removeClass("ng-invalid"),t.addClass("ng-valid ng-dirty")):a?(t.addClass("ng-invalid ng-dirty"),t.removeClass("ng-valid")):(t.removeClass("ng-invalid"),t.addClass("ng-valid ng-dirty"))})}}}]).directive("customizeFilter",function(){return{require:"ngModel",link:function(e,t,o){t.on("click",function(t){var a,i,r,n=JSON.parse(o.customizeFilter);"Actions"===n.label||"Play Call"===n.label||"Status"===n.label||e.isPendingReq||($("html, body").animate({scrollTop:0},"slow"),e.sortOrder=!e.sortOrder,e.urlParams.order=n.key,e.urlParams.orderBy=e.sortOrder?"ASC":"DESC",a=JSON.parse(o.headerList),i=Array.isArray(n.key)?JSON.stringify(n.key):n.key,$(this).removeClass("hoverDiv"),a.forEach(function(t,o){r=Array.isArray(t.key)?JSON.stringify(t.key):t.key,$("#arrow-"+o).removeClass("glyphicon glyphicon-chevron-up"),$("#arrow-"+o).removeClass("glyphicon glyphicon-chevron-down"),i===r?"ASC"===e.urlParams.orderBy?$("#arrow-"+o).addClass("glyphicon glyphicon-chevron-up"):$("#arrow-"+o).addClass("glyphicon glyphicon-chevron-down"):$("#header-"+o).addClass("hoverDiv")}),e.getDataforSorting())})}}}).directive("pageLoader",function(){return{restrict:"E",link:function(e){$(".pageProgressLoader").css("display","block"),$("#progressLoader").css("opacity","0"),$(".table>tbody>tr>td").css("border-top","none"),e.$watch("isLoadingApi",function(){console.log("hey, isLoadingApi has changed!",e.isLoadingApi),e.isLoadingApi?$(".pageProgressLoader").css("display","block"):($(".pageProgressLoader").css("display","none"),$("#progressLoader").css("opacity","1"),$(".table>tbody>tr>td").css("border-top","1px solid #e9ecf0"))})},scope:{isLoadingApi:"="},template:'<div class="pageProgressLoader"> </div>'}}),angular.module("theme.form-validation",[]).controller("AngularFormValidationController",["$scope",function(e){"use strict";e.validateDemoForm={};angular.copy(e.validateDemoForm);e.canResetValidationForm=function(){return e.validate_demo_form.$dirty},e.resetValidationForm=function(){e.validateDemoForm=angular.copy(e.validateDemoFormOriginal),e.validate_demo_form.$setPristine()},e.canSubmitValidationForm=function(){return e.validate_demo_form.$valid},e.submit=function(){}}]),angular.module("theme.form-inline",[]).controller("InlineEditableController",["$scope","$filter","$http","$timeout",function(e,t,o,a){"use strict";e.user={name:"awesome user",status:2,group:4,groupName:"admin",email:"email@example.com",tel:"123-45-67",number:29,range:10,url:"http://example.com",search:"blabla",color:"#6a4415",date:null,time:"12:30",datetime:null,month:null,week:null,desc:"Awesome user \ndescription!",remember:!0,dob:new Date(1984,4,15),timebs:new Date(1984,4,15,19,20)},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],e.showStatus=function(){var o=t("filter")(e.statuses,{value:e.user.status});return e.user.status&&o.length?o[0].text:"Not set"},e.groups=[{id:1,text:"MVP"},{id:2,text:"VIP"},{id:3,text:"ADMIN"},{id:4,text:"USER"}],e.$watch("user.group",function(o,a){if(o!==a){var i=t("filter")(e.groups,{id:e.user.group});e.user.groupName=i.length?i[0].text:null}})}]),angular.module("theme.tables-ng-grid",[]).controller("TablesAdvancedController",["$scope","$filter","$http",function(e,t,o){"use strict";e.filterOptions={filterText:"",useExternalFilter:!0},e.totalServerItems=0,e.pagingOptions={pageSizes:[25,50,100],pageSize:25,currentPage:1},e.setPagingData=function(t,o,a){var i=t.slice((o-1)*a,o*a);e.myData=i,e.totalServerItems=t.length,e.$$phase||e.$apply()},e.jsonFile2="assets/demo/ng-data-copy.json",e.$watch("jsonFile2",function(t,o){t!==o&&("assets/demo/ng-data-by-phone.json"==e.jsonFile2?e.selectedColumns=[{field:"Name",displayName:"Name"},{field:"PhoneNumber",displayName:"Phone Number"},{field:"Total",displayName:"Total"},{field:"Unique",displayName:"Unique"},{field:"Answered",displayName:"Answered"},{field:"Missed",displayName:"Missed"},{field:"AvgCallTime",displayName:"Avg. Call Time"},{field:"TotalMinutes",displayName:"Total Minutes"}]:e.selectedColumns=[{field:"Name",displayName:"Name"},{field:"Total",displayName:"Total"},{field:"Unique",displayName:"Unique"},{field:"Answered",displayName:"Answered"},{field:"Missed",displayName:"Missed"},{field:"AvgCallTime",displayName:"Avg. Call Time"},{field:"TotalMinutes",displayName:"Total Minutes"}],e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText))},!0),e.getPagedDataAsync=function(t,a,i){setTimeout(function(){var r;if(i){var n=i.toLowerCase();o.get(e.jsonFile2).success(function(o){r=o.filter(function(e){return-1!=JSON.stringify(e).toLowerCase().indexOf(n)}),e.setPagingData(r,a,t)})}else o.get(e.jsonFile2).success(function(o){e.setPagingData(o,a,t)})},100)},e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage),e.$watch("pagingOptions",function(t,o){t!==o&&t.currentPage!==o.currentPage&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.$watch("filterOptions",function(t,o){t!==o&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.selectedColumns=[{field:"Name",displayName:"Name"},{field:"Total",displayName:"Total"},{field:"Unique",displayName:"Unique"},{field:"Answered",displayName:"Answered"},{field:"Missed",displayName:"Missed"},{field:"AvgCallTime",displayName:"Avg Call Time"},{field:"TotalMinutes",displayName:"Total Minutes"}],e.gridOptions={data:"myData",enablePaging:!0,showFooter:!0,totalServerItems:"totalServerItems",pagingOptions:e.pagingOptions,columnDefs:"selectedColumns",filterOptions:e.filterOptions,showGroupPanel:!1}}]),angular.module("theme.report_service",[]).factory("ReportDataWebService",["$rootScope","$window","$http",function(e,t,o){var a={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+t.sessionStorage.token}}},getDashboardData:function(t,a,i){var r=["/v1/report?report=home","&ou_id="+t,"&start_date="+a,"&end_date="+i,"&role="+e.roleId].join("");return o.get(e.url+":"+e.port+r,this.getJsonConfig())},getCallFlowData:function(t,a,i,r){var n=["/v1/report?report="+r+"&user_id=",e.userId,"&grouping=",i||"ring_to_number","&start_date=",t,"&end_date=",a,"&role=",e.roleId].join("");return o.get(e.url+":"+e.port+n,this.getJsonConfig())},reportAggregateDataAndRDO:function(a,i,r,n){console.log("GET AGGREGATED DATA SD",a),console.log("GET AGGREGATED DATA ED",i),"none"===r?r="":"acq_callflow"===r&&(r="acq_call_flow");var s=["/v1/report?report=",n,"&user_id=",e.userId,"&secondary=",r,"&start_date=",a,"&end_date=",i,"&timezone=",encodeURIComponent(t.sessionStorage.timezone),"&role=",e.roleId,"&ouid="+e.currentOUId].join(""),l=e.url+":"+e.port+s;return o.get(l,this.getJsonConfig())}};return a}]);var drs=angular.module("daterange",[]);drs.factory("DateRangeSelected",[function(){var e={startDate:moment(),endDate:moment().subtract("7","days")},t={};return t.startDate=e.startDate,t.endDate=e.endDate,t.getStartDate=function(){return this.startDate},t.getEndDate=function(){return this.endDate},t.setStartDate=function(e){this.startDate=e},t.setEndDate=function(e){this.endDate=e},t.initializeDateRange=function(){this.startDate=e.startDate,this.endDate=e.endDate},t}]),function(e){e.module("numForm",[]).factory("NumberFormat",function(){var e={kShortener:function(e){if(isNaN(e))return 0;if(e<1e3)return e.toString();var t=(e/1e3).toString();if(-1===t.indexOf("."))return t;var o=/(\d+\.\d)/.exec(t);return-1!==o[0].indexOf(".0")?o[0]:o[0].replace(/\.0/,"")}};return e})}(angular),angular.module("admin-session",["org-unit"]).factory("AdminSession",["$rootScope","$window","OrgUnitLocal",function(e,t,o){"use strict";var a={isAdmin:function(){return angular.isDefined(this.adminType)},setAdminType:function(e){5===e?this.adminType="support":6===e?this.adminType="super":7===e&&(this.adminType="partner")}};return a}]).factory("SupportAdminWebService",["ApiParam","$http",function(e,t){"use strict";var o={getBillingNodes:function(o,a){return t.get(e.baseURL()+"/v1/support/billingnodes/"+o+"/"+a,e.headerConfig())},switchToSystemOUadmin:function(o){return t.post(e.baseURL()+"/v1/support/switchuser",o,e.headerConfig())},getAdminList:function(o){return t.get(e.baseURL()+"/v1/support/adminlist/"+o,e.headerConfig())},switchToAdmin:function(o,a){return t.post(e.baseURL()+"/v1/support/switchback",{support_token:o,user_token:a},e.headerConfig())},getPartnerAdminUser:function(o,a){return t.get(e.baseURL()+"/v1/support/partneradminuser/"+o+"/"+a,e.headerConfig())},getGlobalSearch:function(o,a,i,r,n,s){return t.get(e.baseURL()+"/v1/support/search/"+o+"/"+a+"/"+i+"/"+encodeURIComponent(r)+"/"+n+"/"+s,e.headerConfig())}};return o}]).controller("SupportAdminAccessController",["$scope","$rootScope","AdminSession","SupportAdminWebService","$routeParams","$location","$cookies","pinesNotifications","OrgUnitLocal","DynamicCssInsertion","$window","LogoutService",function(e,t,o,a,i,r,n,s,l,c,d,u){o.setAdminType(parseInt(d.sessionStorage.role_id)),o.isAdmin()||r.path("/access-denied"),t.user_id||(t.user_id=parseInt(d.sessionStorage.user_id)),e.currentPage=1,e.pageSize=10,e.limit=10,e.offset=0,e.searchData=[],e.filterApplied=!1,e.searchText="",e.searchLoading=!0,e.noDataFound=!1,e.totalSearchData=0,e.adminType=o.adminType,e.pagination={current:i.page?i.page:1},e.searchHeader=["Search Results","Billing Account","Billing ouid","Users"],"partner"!=e.adminType?e.searchHeader=["Search Results","Billing Account","Billing ouid","Users"]:e.searchHeader=["Search Results","Billing Account","Billing ouid"],e.actionHeader=["Action"],e.categoryList=[{name:"Account Name",value:"account_name"},{name:"Sub Group Names",value:"group_name"},{name:"External Group ID",value:"org_unit_ext_id"},{name:"Tracking Number",value:"tracking_number"},{name:"Tracking Number Name",value:"tracking_number_name"},{name:"Ring to number",value:"ring_to_number"},{name:"User name",value:"user_name"},{name:"Email",value:"email"},{name:"External User ID",value:"user_ext_id"},{name:"Campaign name",value:"campaign_name"}],a.getBillingNodes(o.adminType,t.user_id).then(function(t){var o=t.data.data;console.log("TOKEN",d.sessionStorage.token),o.length?e.billingNodes=_.sortBy(o,"org_unit_name"):e.billingNodes=[]}).catch(function(e){console.log("For some reason there was an ",e)}),e.getAdminList=function(o,i){if(angular.element(".ui-pnotify").hide(),"partner"==i)a.getPartnerAdminUser(o,t.user_id).then(function(t){"success"===t.data.status&&(console.log("-----------result:---"),console.log(t.data.data),e.selectedAdmin=t.data.data[0].ct_user_id)}).catch(function(e){console.log("Strange error with admin list",e)});else{e.adminList=null;for(var r=0;r<e.billingNodes.length;r++)if(e.billingNodes[r].org_unit_id==o){if(!1===e.billingNodes[r].allow_admin&&"support"===e.adminType){s.notify({title:"Support access",text:"Customer support access is set to No. Please check with the customer on the access.",type:"error"});break}a.getAdminList(o).then(function(t){"success"===t.data.status&&(e.adminList=t.data.data)}).catch(function(e){console.log("Strange error with admin list",e)});break}}},e.switchToUserAccount=function(o,i,p){if((i.length<1&&(i=e.adminList),o=parseInt(o),"partner"!=p)&&!_.chain(i).pluck("ct_user_id").contains(o).value())return s.notify({title:"Billing Nodes",text:"Invalid admin user for billing node selected",type:"error"});var m={user_id:o,token:d.sessionStorage.token};a.switchToSystemOUadmin(m).then(function(o){if(200!==o.status||!o.data.access_token)return s.notify({title:"Billing Nodes",text:"Invalid response from server for switching to user account of selected billing node.",type:"error"});var a=o.data,i=a.session;n.put("ct_token",a.access_token),e.isLoggedIn=!0,t.loginState="loggedin",t.token=d.sessionStorage.token=a.access_token,t.currentOUId=d.sessionStorage.currentOUId=i.ou_id,t.currentOUName=d.sessionStorage.currentOUName=i.ou_name,t.currentOULevel=d.sessionStorage.currentOULevel=0,t.topLevelOUId=d.sessionStorage.topLevelOUId=i.tl_id,t.userOULevel=d.sessionStorage.userOULevel=i.user_ou_level,t.highestOUId=d.sessionStorage.highestOUId=i.ou_id,t.highestOUName=d.sessionStorage.highestOUName=i.ou_name,t.userId=d.sessionStorage.userId=i.user_id,t.fullName=d.sessionStorage.fullName=i.first_name+" "+i.last_name,t.timezone=d.sessionStorage.timezone=i.timezone,t.billingId=d.sessionStorage.billingId=i.billing_id,t.supportToken=d.sessionStorage.supportToken=i.support_token,t.access_audio=d.sessionStorage.access_audio=i.access_audio,t.userEmail=d.sessionStorage.userEmail=i.email,t.partnerConvirzaAdmin=d.sessionStorage.partnerConvirzaAdmin=!0,t.roleId=d.sessionStorage.roleId=i.role_id,t.score_call=d.sessionStorage.score_call=i.score_call,t.protect_caller_id=d.sessionStorage.protect_caller_id=i.protect_caller_id,t.orglist=d.sessionStorage.orglist=i.orglist,d.sessionStorage.prompts=JSON.stringify(a.session.prompts),d.sessionStorage.voicemails=JSON.stringify(a.session.voicemails),d.sessionStorage.whispers=JSON.stringify(a.session.whispers),t.prompts=JSON.parse(d.sessionStorage.prompts),t.voicemails=JSON.parse(d.sessionStorage.voicemails),t.whispers=JSON.parse(d.sessionStorage.whispers),t.bc_ous[0].id=t.highestOUId,t.bc_ous[0].name=t.highestOUName,t.levelOneOus=i.levelOneOus,t.is_migrated=d.sessionStorage.is_migrated=i.is_migrated,d.sessionStorage.levelOneOus=JSON.stringify(i.levelOneOus),i.badge&&i.badge>0&&(t.activeConversation=d.sessionStorage.activeConversation=i.badge),0===i.reports.length?t.reports=[]:(d.sessionStorage.reports=JSON.stringify(i.reports),t.reports=i.reports),t.chatURL=d.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.white_label_active=d.sessionStorage.white_label_active=!1,Object.keys(i.style).length>0?(!0===i.style.white_label_active&&(t.white_label_active=d.sessionStorage.white_label_active=!0),i.style.support_url||i.style.domain_name?t.supportURL=d.sessionStorage.supportURL=i.style.support_url:t.supportURL=d.sessionStorage.supportURL="https://knowledgebase.convirza.com",t.chatActive=d.sessionStorage.chatActive=i.style.chat_active):(t.supportURL=d.sessionStorage.supportURL="https://knowledgebase.convirza.com",t.chatActive=d.sessionStorage.chatActive=!0),d.sessionStorage.scope=JSON.stringify(a.scope),l.getUserAccess(a.scope),t.$emit("current-ou-updated",{id:parseInt(t.currentOUId),level:0,billing_id:parseInt(t.billingId)}),void 0===i.style.org_logo&&(i.style.org_logo=null),i.style.white_label_css&&void 0!==i.style.white_label_css&&Object.keys(i.style.white_label_css).length>0?c.whiteLabelCSSInject(i.style.white_label_css,i.style.org_logo,i.style.org_logo,!1):c.whiteLabelCSSInject(null,null,null,!1),d.sessionStorage.style=JSON.stringify(i.style),localStorage.setItem("sessionStorageData",JSON.stringify(d.sessionStorage)),r.path("/")}).catch(function(e){s.notify({title:"Billing Nodes",text:"Session has expired",type:"error"}),u.logout()})},e.applyFilter=function(){e.filterApplied=!0,e.searchLoading=!0,a.getGlobalSearch(o.adminType,t.user_id,e.category,e.searchText,e.limit,e.offset).then(function(t){if(t.data.data&&t.data.data.length>0){var o=t.data;e.searchData=[],e.searchData=o.data,e.totalSearchData=o.total?o.total:0,e.noDataFound=!1,e.searchLoading=!1}else e.searchData=[],e.noDataFound=!0,e.searchLoading=!1}).catch(function(t){console.log("For some reason there was an ",t),e.noDataFound=!0,e.searchLoading=!1})},e.pageChanged=function(t){e.offset=e.pageSize*(e.pagination.current-1),e.applyFilter()},e.clearFilter=function(){e.filterApplied=!1,e.searchText="",e.category="",e.searchData=[]},e.changeCategory=function(){e.searchData=[],e.totalSearchData=0}}]),angular.module("api-param",[]).factory("ApiParam",["$window","$rootScope",function(e,t){var o={headerConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+e.sessionStorage.token}}},baseURL:function(){return t.url+":"+t.port},socketURL:function(){return t.socketUrl+":"+t.port}};return o}]),angular.module("scheldue_url_formatter",[]).factory("ScheldueUrlFormatter",["$window","$rootScope","$location","ScheduledReportWebService",function(e,t,o,a){var i={},r=[],n=[],s={},l={acq_campaign:"with_aggreation",acq_callflow:"with_aggreation",acq_keyword:"with_aggreation",acq_group:"with_aggreation",acq_source:"with_aggreation",call_detail:"with_aggreation",call_back:"with_aggreation",activity_stream:".html",group_activity:"without_aggreation",callflow_setting:"without_aggreation"},c={contains:"ILIKE",eq:"=",gthan:">",lthan:"<",include:"include",exclude:"exclude"},d={today:[moment(),moment().endOf("day")],yesterday:[moment().subtract("days",1),moment().subtract("days",1).endOf("day")],last_week:[moment().subtract("days",7),moment().endOf("day")],last_30:[moment().subtract("days",29),moment().endOf("day")],this_month:[moment().startOf("month"),moment().endOf("month").endOf("day")],last_month:[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month").endOf("day")]},u={acq_campaign:"acq_campaign",acq_callflow:"acq_callflow",acq_keyword:"acq_keyword",acq_group:"acq_group",acq_source:"acq_source",call_detail:"call_detail",call_back:"call_back",activity_stream:"activity_stream",group_activity:"group_activity",callflow_setting:"callflow_setting"},p={with_aggreation:{inc:"inclusivity",col:"column",compOp:"comparativeOperator",userInput:"text"},without_aggreation:{inc:"inc",col:"col",compOp:"compOp",userInput:"userInput"},group_activity_callflow:{inc:"inclusivity",col:"column",compOp:"compOperator",userInput:"userInput"}};return i.createBaseUrl=function(e,t,o,a,r,n){var s;return s="/#set-scheduled-editor?report="+n+"&start_date="+e+"&end_date="+t,void 0!==o&&""!==o&&"none"!==o&&(s+="&grouping="+o),void 0!==r&&r.length>0&&(s+="&basicFilter="+r),i.convertAdvancedFilters(n,a).length>0&&(s=s+"&advfilters="+i.convertAdvancedFilters(n,a)),s},i.createScheldulerBaseUrl=function(e,t,o,a){var r="",n=i.getFilterRelatedData(o,a,e),s="/#set-scheduled-editor?id="+t+"&report="+u[e]+"&start_date="+n.start_date+"&end_date="+n.end_date;return n.grouping&&(s+="&grouping="+n.grouping),n.basicFilter.length>0&&(s+="&basicFilter="+n.basicFilter),n.advfilters.length>0&&(r=r,s+="&advfilters="+n.advfilters),s},i.convertAdvancedFilters=function(e,t){var o="",a=l[e];return void 0!==t&&t.length>0&&_.each(t,function(e){var t=[e[p[a].inc],e[p[a].col],e[p[a].compOp],e[p[a].userInput]];o+=t.join(",")}),o},i.getFilterRulesFromUrl=function(){var e=[];if(e.push({filter_inc:"include",filter_key:"timezone",comparator:"=",filter_value:t.timezone}),void 0!==o.search().grouping&&e.push({filter_inc:"include",filter_type:"grouping",filter_key:"grouping",comparator:"=",filter_value:o.search().grouping}),void 0!==o.search().basicFilter&&e.push({filter_inc:"include",filter_type:"basic_filter",filter_value:o.search().basicFilter}),void 0!==o.search().advfilters){for(var a=[],i=o.search().advfilters.split(",");i.length>0;)a.push(i.splice(0,4));_.each(a,function(t){e.push({filter_type:"advanced_filter",filter_inc:c[t[0]],filter_key:t[1],comparator:t[2],filter_value:t[3]})})}return e},i.getFiltesFromUrl=function(){var e="";if(void 0!==o.search().start_date&&void 0!==o.search().end_date){var t=moment(o.search().start_date),a=moment(o.search().end_date);_.each(d,function(o,i){moment(o[0].format("YYYY-MM-DD")).isSame(t.format("YYYY-MM-DD"))&&moment(o[1].format("YYYY-MM-DD")).isSame(a.format("YYYY-MM-DD"))&&(e=i)})}return[e,moment(o.search().start_date).format("YYYY-MM-DD"),moment(o.search().end_date).format("YYYY-MM-DD")]},i.getFilterData=function(e,t){0===Object.keys(s).length&&a.filterRulesBasesOnId(e).then(function(e){var o=e.data.json;_.each(o,function(e){r.push({filter_key:e.filter_key,comparator:e.comparator,filter_value:e.filter_value,filter_type:e.filter_type,filter_inc:e.filter_inc})}),n.push({filter_start_date:o[0].filter_start,filter_end_date:o[0].filter_end,filter_range:o[0].filter_range});var a=i.getFilterRelatedData(n,r,o[0].report_used);s.report=o[0].report_used,s.start_date=a.start_date,s.end_date=a.end_date,s.advanced_filters=a.advfilters,s.basic_filters=a.basicFilter,s.grouping=a.grouping,t(s)})},i.getFilterRelatedData=function(e,t,o){var a,i,r,n="",s="";return _.invert(c),o=u[o],_.each(e,function(e){null!==e.filter_range?(a=d[e.filter_range][0].format("YYYY-MM-DD"),i=d[e.filter_range][1].format("YYYY-MM-DD")):(a=moment(e.filter_start_date).format("YYYY-MM-DD"),i=moment(e.filter_end_date).format("YYYY-MM-DD"))}),_.each(t,function(e){"grouping"===e.filter_type&&(r=e.filter_value),"basic_filter"===e.filter_type&&(n=e.filter_value),"advanced_filter"===e.filter_type&&(s=s+e.filter_inc+","+e.filter_key+","+e.comparator+","+e.filter_value)}),{start_date:a,end_date:i,grouping:r,basicFilter:n,advfilters:s}},i.reportSpecficAdvancedFilter=function(e){var t,a,i=[];t=null===e?o.search().advfilters:e.advanced_filters,a=null===e?o.search().report:u[e.report];var r=l[a];if("group_activity"!==a&&"callflow_setting"!==a||(r="group_activity_callflow"),void 0!==t&&t.length>0){for(var n=[],s=t.split(",");s.length>0;)n.push(s.splice(0,4));_.each(n,function(e){var t={};t[p[r].inc]=e[0],t[p[r].col]=e[1],t[p[r].compOp]=e[2],t[p[r].userInput]=e[3],i.push(t)})}return i},i.reportSpecficBasicFilter=function(e){console.log("In Method"),console.log(e);var t,a="";return t=null===e?o.search().basicFilter:e.basic_filters,null===e?o.search().report:e.report,console.log(t),void 0!==t&&(a=t),a},i}]),angular.module("filter_helper",[]).factory("filterHelper",["$window","$rootScope","$location","ScheduledReportWebService","$http",function(e,t,o,a,i){var r={},n=[],s=[],l={};return r.columnInfo,i.get("assets/demo/filter_helper_column.json").then(function(e){r.columnInfo=e.data}),r.ranges={today:[moment(),moment().endOf("day")],yesterday:[moment().subtract("days",1),moment().subtract("days",1).endOf("day")],last_week:[moment().subtract("days",7),moment().endOf("day")],last_30:[moment().subtract("days",29),moment().endOf("day")],this_month:[moment().startOf("month"),moment().endOf("month").endOf("day")],last_month:[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month").endOf("day")]},r.backendScheldueReportName={acq_campaign:"campaign",acq_callflow:"call_flow",acq_keyword:"keyword",acq_group:"group",acq_source:"source",call_detail:"calls_detail",call_back:"calls_callback",activity_stream:"activity_stream",group_activity:"group_activity",callflow_setting:"callflow_setting"},r.comparitiveOperators=[{label:"contains",val:"Contains"},{label:"eq",val:"Equals"},{label:"gt",val:"Greater than"},{label:"lt",val:"Less than"}],r.comparitiveOperatorsHash={contains:"Contains",eq:"Equals",gt:"Greater than",lt:"Less than"},r.advFilterDefinations={inclusivity:null,column:null,comparativeOperator:null,text:null},r.filterUIMappingToDatabase={contains:"ILIKE",eq:"=",gt:">",lt:"<",include:"include",exclude:"exclude"},r.extraFilterValues=[{text:"timezone",value:t.timezone},{text:"role_id",value:t.roleId},{text:"user_id",value:t.userId},{text:"ouid",value:t.currentOUId},{text:"report",value:_.invert(r.backendScheldueReportName)[o.search().report]}],r.createBaseUrl=function(e,t,o,a,i,n,s,l){var c;return c="/#set-schedule-builder?report="+n,""!==o&&void 0!==o&&"none"!==o&&(c=c+"&grouping="+o),c=c+"&start_date="+e+"&end_date="+t,void 0!==i&&i.length>0&&(c=c+"&basicFilter="+i),r.convertAdvancedFilters(n,a).length>0&&(c=c+"&advfilters="+r.convertAdvancedFilters(n,a)),s&&(c=c+"&limit="+s),void 0!==l&&(c=c+"&offset="+l),c},r.createScheldulerBaseUrl=function(e,t,o,a){var i="",n=r.getFilterRelatedData(o,a,e);return url="/#set-schedule-builder?id="+t+"&report="+r.backendScheldueReportName[e]+"&start_date="+n.start_date+"&end_date="+n.end_date,n.grouping&&(url=url+"&grouping="+n.grouping),n.basicFilter.length>0&&(url=url+"&basicFilter="+n.basicFilter),n.advfilters.length>0&&(i=i,url=url+"&advfilters="+n.advfilters),url},r.convertAdvancedFilters=function(e,t){var o,a="";return void 0!==t&&t.length>0&&_.each(t,function(t){o="calls_callback"===e||"calls_detail"===e?[t.column,t.comparativeOperator,t.inclusivity,t.text]:[t.inclusivity,t.column,t.comparativeOperator,t.text],a=a+(""!==a?",":"")+o.join(",")}),a},r.getFilterRulesFromUrl=function(){var e=[];if(_.each(r.extraFilterValues,function(t){e.push({filter_inc:"include",filter_type:"variable",filter_key:t.text,comparator:"=",filter_value:t.value})}),void 0!==o.search().grouping&&e.push({filter_inc:"include",filter_type:"grouping",filter_key:"grouping",comparator:"=",filter_value:o.search().grouping}),void 0!==o.search().basicFilter&&e.push({filter_inc:"include",filter_type:"basic_filter",filter_value:o.search().basicFilter}),void 0!==o.search().limit&&e.push({filter_inc:"include",filter_type:"variable",filter_key:"limit",comparator:"=",filter_value:o.search().limit}),void 0!==o.search().offset&&e.push({filter_inc:"include",filter_type:"variable",filter_key:"offset",comparator:"=",filter_value:o.search().offset}),void 0!==o.search().advfilters){for(var t=[],a=o.search().advfilters.split(",");a.length>0;)t.push(a.splice(0,4));_.each(t,function(t){if(t=r.convertFiltesFromUrl(t,o.search().report),"calls_detail"===o.search().report||"calls_callback"===o.search().report||"group_activity"===o.search().report||"callflow_setting"===o.search().report){var a=o.search().report;t[1]=r.columnInfo.json[a][t[1]]+"/"+t[1]}else t[1]="acq/"+t[1];e.push({filter_type:"advanced_filter",filter_inc:r.filterUIMappingToDatabase[t[0]],filter_key:t[1],comparator:r.filterUIMappingToDatabase[t[2]],filter_value:t[3]})})}return e},r.convertFiltesFromUrl=function(e,t){var o=[];return"calls_detail"===t||"calls_callback"===t?(o[0]=e[2],o[1]=e[0],o[2]=e[1],o[3]=e[3],o):e},r.getFiltesFromUrl=function(){var e="";if(void 0!==o.search().start_date&&void 0!==o.search().end_date){var t=moment(o.search().start_date),a=moment(o.search().end_date);_.each(r.ranges,function(o,i){moment(o[0].format("YYYY-MM-DD")).isSame(t.format("YYYY-MM-DD"))&&moment(o[1].format("YYYY-MM-DD")).isSame(a.format("YYYY-MM-DD"))&&(e=i)})}return[e,moment(o.search().start_date).format("YYYY-MM-DD"),moment(o.search().end_date).format("YYYY-MM-DD")]},r.getFilterData=function(e,t){0===Object.keys(l).length&&a.filterRulesBasesOnId(e).then(function(e){var o=e.data.json;_.each(o,function(e){n.push({filter_key:e.filter_key,comparator:e.comparator,filter_value:e.filter_value,filter_type:e.filter_type,filter_inc:e.filter_inc})}),s.push({filter_start_date:o[0].filter_start,filter_end_date:o[0].filter_end,filter_range:o[0].filter_range});var a=r.getFilterRelatedData(s,n,o[0].report_used);l.report=o[0].report_used,l.start_date=a.start_date,l.end_date=a.end_date,l.advanced_filters=a.advfilters,l.basic_filters=a.basicFilter,l.grouping=a.grouping,t(l)})},r.getFilterRelatedData=function(e,t,o){i.get("assets/demo/filter_helper_column.json").then(function(e){r.columnInfo=e});var a,n,s,l="",c="",d=_.invert(r.filterUIMappingToDatabase);return o=r.backendScheldueReportName[o],_.each(e,function(e){null!==e.filter_range?(a=r.ranges[e.filter_range][0].format("YYYY-MM-DD"),n=r.ranges[e.filter_range][1].format("YYYY-MM-DD")):(a=moment(e.filter_start_date).format("YYYY-MM-DD"),n=moment(e.filter_end_date).format("YYYY-MM-DD"))}),_.each(t,function(e){if("grouping"===e.filter_type&&(s=e.filter_value),"basic_filter"===e.filter_type&&(l=e.filter_value),"advanced_filter"===e.filter_type){var t="";e.filter_inc=d[e.filter_inc],e.comparator=d[e.comparator],t="calls_detail"===o||"calls_callback"===o?e.filter_key.split("/")[1]+","+e.comparator+","+e.filter_inc+","+e.filter_value:e.filter_inc+","+e.filter_key.split("/")[1]+","+e.comparator+","+e.filter_value,c=c+(""!==c?",":"")+t}}),{start_date:a,end_date:n,grouping:s,basicFilter:l,advfilters:c}},r.reportSpecficAdvancedFilter=function(e){var t,a=[];if(t=null===e?o.search().advfilters:e.advanced_filters,null===e?o.search().report:r.backendScheldueReportName[e.report],void 0!==t&&t.length>0){for(var i=[],n=t.split(",");n.length>0;)i.push(n.splice(0,4));_.each(i,function(e){var t={};t.inclusivity=e[0],t.column=e[1],t.comparativeOperator=e[2],t.text=e[3],a.push(t)})}return a},r.reportSpecficBasicFilter=function(e){var t,a="";return t=null===e?o.search().basicFilter:e.basic_filters,null===e?o.search().report:r.backendScheldueReportName[e.report],void 0!==t&&(a=t),a},r}]),angular.module("report-param",[]).factory("ReportParam",["$window","$rootScope",function(e,t){var o={getParams:function(t){return e.sessionStorage[t]},setParams:function(t,o){return e.sessionStorage[t]=o,"saved"}};return o}]);var themeTablesEditable=angular.module("theme.tables-editable",[]);themeTablesEditable.controller("TablesEditableController",["$scope","$filter",function(e,t){"use strict";e.myData=[{name:"Moroni",age:50},{name:"Tiancum",age:43},{name:"Jacob",age:27},{name:"Nephi",age:29},{name:"Enos",age:34}],e.gridOptions={data:"myData",enableCellSelection:!0,enableRowSelection:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"name",displayName:"Name",enableCellEdit:!0},{field:"age",displayName:"Age",enableCellEdit:!0}]},e.showCallFlow=!1,e.showCallActions=!1,e.showMultiPass=!1,e.selectedCallFlow={},e.loadCallFlow=function(t){e.selectedCallFlow=t,e.showCallFlow=!0,e.showCallActions=!1,e.showMultiPass=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#callFlow").offset().top-50},1e3)},100)},e.loadCallActions=function(){e.showCallActions=!0,e.showMultiPass=!1,e.showCallFlow=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#callActions").offset().top-50},1e3)},100)},e.loadMultiPass=function(){e.showMultiPass=!0,e.showCallActions=!1,e.showCallFlow=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#multiPass").offset().top-50},1e3)},100)},e.addAction=function(){if(e.callActions.length>=3)alert("Sorry, there is a limit of three actions");else{var t={id:e.callActions.length+1};e.callActions.push(t)}},e.removeAction=function(t){var o=!0;$.each(e.callActions,function(a,i){o&&i.id==t&&(e.callActions.splice(a,1),o=!1)}),$.each(e.callActions,function(o,a){a.id>t&&(e.callActions[o].id=a.id-1)})},e.showNumber=function(e){return 1==e?"First":2==e?"Second":3==e?"Third":""},e.phoneNumbers=[{id:1,phone:"435-715-2543",name:"Mailer 4",channel:1,status:!1,value:"$65.00",rinterval:"120",status2:"inactive",group:4,groupName:"admin"},{id:2,phone:"435-673-4967",name:"Mailer 1a",channel:2,status:!0,value:"$10.00",rinterval:"60",status2:"active",group:4,groupName:"admin"},{id:3,phone:"866-111-9999",name:"Retargeting",channel:7,status:!0,value:"$6.00",rinterval:"3245",status2:"active",group:3,groupName:"vip"},{id:4,phone:"Session Pool 2",name:"Website DNI2",channel:8,status:!0,value:"$94.00",rinterval:"40",status2:"active",group:3,groupName:"vip"}],e.callActions=[{id:1}],e.users=[{id:1,phone:"888-123-4567",name:"Mailer 1a",status:2,value:"$12.00",rinterval:"60",status2:"active",group:4,groupName:"admin"},{id:2,phone:"855-222-9874",name:"Facebook",status:1,value:"$24.50",rinterval:"3245",status2:"active",group:3,groupName:"vip"},{id:3,phone:"818-111-4597",name:"Email 2-21",status:2,value:"$5.00",rinterval:"480",status2:"active",group:null}],e.whispers=[{id:1,filename:"some_whisper_msg.mp3"},{id:2,filename:"another_whisper_msg.mp3"},{id:3,filename:"more_whisper_msg.mp3"}],e.saveWhisper=function(e,t){angular.extend(e,{id:t})},e.addWhisper=function(){e.inserted={id:e.whispers.length+1,name:"",status:null,group:null},e.whispers.push(e.inserted)},e.removeWhisper=function(t){e.whispers.splice(t,1)},e.prompts=[{id:1,filename:"some_voice_prompt.mp3"},{id:2,filename:"some_IVR_recording.mp3"},{id:3,filename:"another_IVR.mp3"}],e.savePrompt=function(e,t){angular.extend(e,{id:t})},e.addPrompt=function(){e.inserted={id:e.prompts.length+1,name:"",status:null,group:null},e.prompts.push(e.inserted)},e.removePrompt=function(t){e.prompts.splice(t,1)},e.users2=[{id:1,phone:"801-123-5557",name:"Mailer 2",status:5,value:"$75.00",rinterval:"120",status2:"active",group:4,groupName:"admin"},{id:2,phone:"Session Pool 1",name:"Website DNI",status:1,value:"$44.00",rinterval:"40",status2:"active",group:3,groupName:"vip"}],e.channels=[{value:1,text:"Online: Paid Search"},{value:2,text:"Online: Organic Search"},{value:3,text:"Online: Display"},{value:4,text:"Online: Email"},{value:5,text:"Offline: Direct Mail"},{value:6,text:"Offline: Magazine"},{value:7,text:"Mobile: Paid Search"},{value:8,text:"Mobile: Organic Search"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],e.showGroup=function(o){if(o.group&&e.groups.length){var a=t("filter")(e.groups,{id:o.group});return a.length?a[0].text:"Not set"}return o.groupName||"Not set"},e.showChannel=function(o){var a=[];return o.channel&&(a=t("filter")(e.channels,{value:o.channel})),a.length?a[0].text:"Not set"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeNumber=function(t){e.users.splice(t,1)},e.addUser=function(){e.inserted={id:e.users.length+1,name:"",status:null,group:null},e.users.push(e.inserted)}}]),themeTablesEditable.controller("TablesEditableController2",["$scope","$filter",function(e,t){e.showCallFlow=!1,e.showCallActions=!1,e.showMultiPass=!1,e.selectedCallFlow={},e.loadCallFlow=function(t){e.selectedCallFlow=t,e.showCallFlow=!0,e.showMultiPass=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#callFlow").offset().top-50},1e3)},100)},e.loadCallActions=function(){e.showCallActions=!0,setTimeout(function(){$("html, body").animate({scrollTop:$("#callActions").offset().top-50},1e3)},100)},e.loadMultiPass=function(){e.showMultiPass=!0,e.showCallFlow=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#multiPass").offset().top-50},1e3)},100)},e.addAction=function(){if(e.callActions.length>=3)alert("Sorry, there is a limit of three actions");else{var t={id:e.callActions.length+1};e.callActions.push(t)}},e.removeAction=function(t){var o=!0;$.each(e.callActions,function(a,i){o&&i.id==t&&(e.callActions.splice(a,1),o=!1)}),$.each(e.callActions,function(o,a){a.id>t&&(e.callActions[o].id=a.id-1)})},e.showNumber=function(e){return 1==e?"First":2==e?"Second":3==e?"Third":""},e.phoneNumbers=[{id:1,phone:"435-715-2543",name:"Mailer 4",channel:1,status:!1,value:"$65.00",rinterval:"120",status2:"inactive",group:4,groupName:"admin"},{id:2,phone:"435-673-4967",name:"Mailer 1a",channel:2,status:!0,value:"$10.00",rinterval:"60",status2:"active",group:4,groupName:"admin"},{id:3,phone:"866-111-9999",name:"Retargeting",channel:7,status:!0,value:"$6.00",rinterval:"3245",status2:"active",group:3,groupName:"vip"},{id:4,phone:"Session Pool 2",name:"Website DNI2",channel:8,status:!0,value:"$94.00",rinterval:"40",status2:"active",group:3,groupName:"vip"}],e.callActions=[{id:1}],e.channels=[{value:1,text:"Online: Paid Search"},{value:2,text:"Online: Organic Search"},{value:3,text:"Online: Display"},{value:4,text:"Online: Email"},{value:5,text:"Offline: Direct Mail"},{value:6,text:"Offline: Magazine"},{value:7,text:"Mobile: Paid Search"},{value:8,text:"Mobile: Organic Search"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],e.showChannel=function(o){var a=[];return o.channel&&(a=t("filter")(e.channels,{value:o.channel})),a.length?a[0].text:"Not set"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeNumber=function(t){e.users.splice(t,1)},e.addUser=function(){e.inserted={id:e.users.length+1,name:"",status:null,group:null},e.users.push(e.inserted)}}]),themeTablesEditable.controller("TablesEditableController3",["$scope","$filter",function(e,t){"use strict";e.showCallFlow=!1,e.showCallActions=!1,e.showMultiPass=!1,e.selectedCallFlow={},e.currentCallFlow=null,e.loadCallFlow=function(t){e.selectedCallFlow=t,e.currentCallFlow==t.id?(e.showCallFlow=!1,e.currentCallFlow=null):(e.showCallFlow=!0,e.showMultiPass=!1,e.currentCallFlow=t.id),setTimeout(function(){$("html, body").animate({scrollTop:$("#callFlow").offset().top-50},1e3)},100)},e.loadCallActions=function(){e.showCallActions=!e.showCallActions,setTimeout(function(){$("html, body").animate({scrollTop:$("#callActions").offset().top-50},1e3)},100)},e.loadMultiPass=function(){e.showMultiPass=!e.showMultiPass,e.showCallFlow=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#multiPass").offset().top-50},1e3)},100)},e.addAction=function(){if(e.callActions.length>=3)alert("Sorry, there is a limit of three actions");else{var t={id:e.callActions.length+1};e.callActions.push(t)}},e.removeAction=function(t){var o=!0;$.each(e.callActions,function(a,i){o&&i.id==t&&(e.callActions.splice(a,1),o=!1)}),$.each(e.callActions,function(o,a){a.id>t&&(e.callActions[o].id=a.id-1)})},e.showNumber=function(e){return 1==e?"First":2==e?"Second":3==e?"Third":""},e.phoneNumbers=[{id:1,phone:"435-715-2543",name:"Mailer 4",channel:1,status:!1,value:"$65.00",rinterval:"120",status2:"inactive",group:4,groupName:"admin"},{id:2,phone:"435-673-4967",name:"Mailer 1a",channel:2,status:!0,value:"$10.00",rinterval:"60",status2:"active",group:4,groupName:"admin"},{id:3,phone:"866-111-9999",name:"Retargeting",channel:7,status:!0,value:"$6.00",rinterval:"3245",status2:"active",group:3,groupName:"vip"},{id:4,phone:"Session Pool 2",name:"Website DNI2",channel:8,status:!0,value:"$94.00",rinterval:"40",status2:"active",group:3,groupName:"vip"}],e.callActions=[{id:1}],e.channels=[{value:1,text:"Online: Paid Search"},{value:2,text:"Online: Organic Search"},{value:3,text:"Online: Display"},{value:4,text:"Online: Email"},{value:5,text:"Offline: Direct Mail"},{value:6,text:"Offline: Magazine"},{value:7,text:"Mobile: Paid Search"},{value:8,text:"Mobile: Organic Search"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],e.showChannel=function(o){var a=[];return o.channel&&(a=t("filter")(e.channels,{value:o.channel})),a.length?a[0].text:"Not set"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeNumber=function(t){e.users.splice(t,1)},e.addUser=function(){e.inserted={id:e.users.length+1,name:"",status:null,group:null},e.users.push(e.inserted)}}]),themeTablesEditable.controller("UserTablesEditableController",["$scope","$filter",function(e,t){"use strict";e.users=[{id:1,fname:"Bernard",lname:"Beaver",email:"bernie@logmycalls.com",phonenumber:"888-555-1212",role:1,group:1,campaign:1}],e.roles=[{id:1,text:"Admin"},{id:2,text:"Standard"},{id:3,text:"Read-Only"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],e.campaigns=[{value:1,text:"Yes"},{value:2,text:"No"}],e.showGroups=function(o){if(o.group&&e.groups.length){var a=t("filter")(e.groups,{id:o.group});return a.length?a[0].text:"Not set"}return o.group||"Not set"},e.showRoles=function(o){if(o.role&&e.roles.length){var a=t("filter")(e.roles,{id:o.role});return a.length?a[0].text:"Not set"}return o.role||"Not set"},e.showCampaigns=function(o){var a=[];return o.campaign&&(a=t("filter")(e.campaigns,{value:o.campaign})),a.length?a[0].text:"Not set"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeUser=function(t){e.users.splice(t,1)},e.addUser=function(){e.inserted={id:e.users.length+1,name:"",status:null,group:null},e.users.push(e.inserted)}}]),angular.module("theme.charts-flot",[]).directive("flotChart",function(){"use strict";return{restrict:"AE",scope:{data:"=flotData",options:"=flotOptions",plothover:"&plotHover",plotclick:"&plotClick"},link:function(e,t,o){if(angular.isDefined(e.data))var a=$.plot($(t),e.data,e.options);$(t).bind("plothover",function(t,o,a){e.plothover({event:t,position:o,item:a})}),$(t).bind("plotclick",function(t,o,a){e.plotclick({event:t,position:o,item:a})}),e.$watch("data",function(e,t){e&&a&&(a.setData(e),a.draw())},!0),e.$watch("options",function(o,i){o&&(a=$.plot($(t),e.data,o))},!0)}}}),angular.module("theme.charts-inline",[]).directive("sparklines",["$timeout",function(e){"use strict";return{restrict:"A",scope:{options:"=sparklines",values:"=data"},link:function(e,t,o){var a={};e.options&&(a=angular.copy(e.options));var i=$(t).closest("sparklines-composite"),r=t;i.length&&(i.find("span.sparklines-container").length<1&&i.append('<span class="sparklines-container"></span>'),(r=i.find("span.sparklines-container")).find("canvas").length&&(a.composite=!0),o.values?r.attr("values",o.values):r.removeAttr("values")),e.$watch(function(){return t.is(":visible")},function(){e.values?$(r).sparkline(e.values,a):$(r).sparkline("html",a)})}}}]),angular.module("theme.pages-controllers",["ngCookies"]).factory("LoginWebService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";var r={notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},getToken:function(e){var t={method:"POST",url:i.url+":"+i.port+"/oauth/token",headers:{"content-type":"application/json"},data:e};return o(t)},recover:function(e){var t={method:"POST",url:i.url+":"+i.port+"/login/recover",headers:{"content-type":"application/json"},data:e};return o(t)},reset:function(e){var t={method:"POST",url:i.url+":"+i.port+"/login/reset",headers:{"content-type":"application/json"},data:e};return o(t)},resetCheck:function(e){var t={method:"GET",url:i.url+":"+i.port+"/login/resetCheck/"+e,headers:{"content-type":"application/json"}};return o(t)}};return r}]).factory("$remember",["$cookies",function(e){"use strict";return function(t,o){var a=e.get(t);if(1===arguments.length)return!!a&&CryptoJS.AES.decrypt(e.get(t),"Security").toString(CryptoJS.enc.Utf8);e.put(t,CryptoJS.AES.encrypt(o,"Security"))}}]).controller("SignupPageController",["$scope","$global",function(e,t){"use strict";t.set("fullscreen",!0),e.$on("$destroy",function(){t.set("fullscreen",!1)})}]).controller("LoginController",["$scope","$global","$http","$location","LoginWebService","$cookies","$remember","$window","OrgUnitLocal","$rootScope","DynamicCssInsertion","progressLoader",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.remember=!1,e.forever=!!r.forever&&r.forever;var p=n("data");p&&(e.remember=!0,e.email=p),a.search().email&&(e.email=a.search().email),e.error="",t.set("fullscreen",!0),e.$on("$destroy",function(){t.set("fullscreen",!1)}),e.logIn=function(){e.remember&&angular.isDefined(e.email)?n("data",e.email):n("data",""),u.start();r.get("name");var t={grant_type:"password",username:e.email.toLowerCase(),password:e.password,client_id:r.get("client_id"),client_secret:r.get("client_secret")};u.set(60),i.getToken(t).then(function(t){"success"===t.data.status?(e.forever&&(r.forever="on",r.refresh_token=t.data.refresh_token),r.put("ct_token",t.data.access_token),e.isLoggedIn=!0,c.loginState="loggedin",s.sessionStorage.token=t.data.access_token,c.currentOUId=s.sessionStorage.currentOUId=t.data.session.ou_id,c.currentOUName=s.sessionStorage.currentOUName=t.data.session.ou_name,c.currentOULevel=s.sessionStorage.currentOULevel=0,c.topLevelOUId=s.sessionStorage.topLevelOUId=t.data.session.tl_id,c.userOULevel=s.sessionStorage.userOULevel=t.data.session.user_ou_level,c.highestOUId=s.sessionStorage.highestOUId=t.data.session.ou_id,c.highestOUName=s.sessionStorage.highestOUName=t.data.session.ou_name,c.userId=s.sessionStorage.userId=t.data.session.user_id,c.fullName=s.sessionStorage.fullName=t.data.session.first_name+" "+t.data.session.last_name,c.timezone=s.sessionStorage.timezone=t.data.session.timezone,c.billingId=s.sessionStorage.billingId=t.data.session.billing_id,c.billingOu=s.sessionStorage.billingOu=t.data.session.billing_ou,c.userEmail=s.sessionStorage.userEmail=t.data.session.email,t.data.session.badge&&t.data.session.badge>0&&(c.activeConversation=s.sessionStorage.activeConversation=t.data.session.badge),c.orglist=s.sessionStorage.orglist=t.data.session.orglist,c.score_call=s.sessionStorage.score_call=t.data.session.score_call,c.access_audio=s.sessionStorage.access_audio=t.data.session.access_audio,c.is_migrated=s.sessionStorage.is_migrated=t.data.session.is_migrated,c.download_audio_enabled=s.localStorage.download_audio_enabled=t.data.session.download_audio_enabled,void 0!==t.data.session.prompts&&""!==t.data.session.prompts&&null!==t.data.session.prompts?s.sessionStorage.prompts=JSON.stringify(t.data.session.prompts):s.sessionStorage.prompts=[],void 0!==t.data.session.voicemails&&""!==t.data.session.voicemails&&null!==t.data.session.voicemails?s.sessionStorage.voicemails=JSON.stringify(t.data.session.voicemails):s.sessionStorage.voicemails=[],void 0!==t.data.session.whispers&&""!==t.data.session.whispers&&null!==t.data.session.whispers?s.sessionStorage.whispers=JSON.stringify(t.data.session.whispers):s.sessionStorage.whispers=[],void 0===s.sessionStorage.prompts||null===s.sessionStorage.prompts||""===s.sessionStorage.prompts?c.prompts=[]:c.prompts=JSON.parse(s.sessionStorage.prompts),void 0===s.sessionStorage.voicemails||null===s.sessionStorage.voicemails||""===s.sessionStorage.voicemails?c.voicemails=[]:c.voicemails=JSON.parse(s.sessionStorage.voicemails),void 0===s.sessionStorage.whispers||null===s.sessionStorage.whispers||""===s.sessionStorage.whispers?c.whispers=[]:c.whispers=JSON.parse(s.sessionStorage.whispers),0===t.data.session.reports.length?(c.reports=[],s.sessionStorage.reports=JSON.stringify(t.data.session.reports)):(s.sessionStorage.reports=JSON.stringify(t.data.session.reports),c.reports=t.data.session.reports),s.sessionStorage.levelOneOus=JSON.stringify(t.data.session.levelOneOus),c.levelOneOus=t.data.session.levelOneOus,c.bc_ous=[{id:c.highestOUId,name:c.highestOUName},{id:null,name:null},{id:null,name:null}],c.roleId=s.sessionStorage.roleId=t.data.session.role_id,c.uservoiceSSO=s.sessionStorage.uservoiceSSO=t.data.session.uservoiceSSO,c.protect_caller_id=s.sessionStorage.protect_caller_id=t.data.session.protect_caller_id,c.isSafari=s.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),void 0!==t.data.session.support_token&&(c.supportToken=s.sessionStorage.supportToken=t.data.session.support_token),c.white_label_active=s.sessionStorage.white_label_active=!1,c.chatURL=s.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.data.session.style||(t.data.session.style={}),!0===t.data.session.style.white_label_active&&(c.white_label_active=s.sessionStorage.white_label_active=!0),Object.keys(t.data.session.style).length>0?(c.chatActive=s.sessionStorage.chatActive=t.data.session.style.chat_active,t.data.session.style.support_url||t.data.session.style.domain_name?c.supportURL=s.sessionStorage.supportURL=t.data.session.style.support_url:c.supportURL=s.sessionStorage.supportURL="https://knowledgebase.convirza.com"):(c.chatActive=s.sessionStorage.chatActive=!0,c.supportURL=s.sessionStorage.supportURL="https://knowledgebase.convirza.com"),c.feedbackURL=s.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+s.sessionStorage.uservoiceSSO,s.sessionStorage.scope=JSON.stringify(t.data.scope),s.sessionStorage.style=JSON.stringify(t.data.session.style),l.getUserAccess(t.data.scope),console.log("Is pendo loaded 1: ",s.sessionStorage.loadedPendoScript),s.sessionStorage.loadedPendoScript&&"YES"===s.sessionStorage.loadedPendoScript&&(c.white_label_active?c.white_label_active&&!t.data.session.style.domain_name&&pendoInitializeOnLogin():(console.log("Pendo Loading"),pendoInitializeOnLogin())),t.data.session.style.org_logo||(t.data.session.style.org_logo=null),t.data.session.style.white_label_css&&Object.keys(t.data.session.style.white_label_css).length>0?d.whiteLabelCSSInject(t.data.session.style.white_label_css,t.data.session.style.org_logo,t.data.session.style.org_logo,!1):d.whiteLabelCSSInject(null,null,null,!1),localStorage.setItem("sessionStorageData",JSON.stringify(s.sessionStorage))):(console.log("FAILED",t),e.error=t.err?t.err:"Invalid email or password"),u.end()}).catch(function(t){u.end(),t.data.error_description&&"Invalid resource owner credentials"===t.data.error_description?e.error="Invalid email or password":t.data.error_description?e.error=t.data.error_description:e.error="Invalid email or password"})},e.recoverPass=function(t){console.log(t),e.show_fail=!1,e.show_succes=!1,e.error="";if(angular.isDefined(t)&&0!==t.trim().length)if(/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,9})$/.test(t)){var o={domain:location.host,username:t};i.recover(o).then(function(t){"success"===t.data.result?(e.show_success=!0,e.hide_next=!0):(e.error=t.data.err,e.show_fail=!0)})}else e.error="Invalid e-mail address",e.show_fail=!0;else e.error="Email field can not be empty.",e.show_fail=!0},e.closeFail=function(){console.log("hit close fail"),e.show_fail=!1}}]).controller("ResetController",["$scope","$global","$http","$location","LoginWebService","$remember","$window","OrgUnitLocal","$rootScope","DynamicCssInsertion","$cookies",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";t.set("fullscreen",!0),e.$on("$destroy",function(){t.set("fullscreen",!1)}),e.token=a.search().token,console.log("TOKEN: "+e.token),e.token?i.resetCheck(e.token).then(function(t){"success"===t.data.result?(e.username=t.data.json.username,e.first_name=t.data.json.first_name,e.last_name=t.data.json.last_name,e.ct_user_id=t.data.json.ct_user_id):(e.error="Invalid or expired account token used",e.show_fail=!0,e.hide_next=!0)}):(e.error="No valid token present - cannot proceed.",e.show_fail=!0,e.hide_next=!0),e.resetPass=function(){if(e.show_fail=!1,e.passwd)if(e.passwd!==e.verifypass)e.error="Passwords do not match",e.show_fail=!0;else if(e.passwd.length<6)e.error="Password must be at least 6 characters in length",e.show_fail=!0;else{var t={username:e.username,password:e.passwd,token:e.token,ct_user_id:e.ct_user_id};i.reset(t).then(function(t){if("success"===t.data.result){d.get("name");var o={grant_type:"password",username:e.username.toLowerCase(),password:e.passwd,client_id:d.get("client_id"),client_secret:d.get("client_secret")};i.getToken(o).then(function(t){"error"!==t.data.result?(e.isLoggedIn=!0,d.put("ct_token",t.data.access_token),l.token=n.sessionStorage.token=t.data.access_token,l.currentOUId=n.sessionStorage.currentOUId=t.data.session.ou_id,l.currentOUName=n.sessionStorage.currentOUName=t.data.session.ou_name,l.currentOULevel=n.sessionStorage.currentOULevel=0,l.topLevelOUId=n.sessionStorage.topLevelOUId=t.data.session.tl_id,l.userOULevel=n.sessionStorage.userOULevel=t.data.session.user_ou_level,l.highestOUId=n.sessionStorage.highestOUId=t.data.session.ou_id,l.highestOUName=n.sessionStorage.highestOUName=t.data.session.ou_name,l.userId=n.sessionStorage.userId=t.data.session.user_id,l.email=n.sessionStorage.email=t.data.session.email,l.fullName=n.sessionStorage.fullName=t.data.session.first_name+" "+t.data.session.last_name,l.timezone=n.sessionStorage.timezone=t.data.session.timezone,l.billingId=n.sessionStorage.billingId=t.data.session.billing_id,l.billingOu=n.sessionStorage.billingOu=t.data.session.billing_ou,l.orglist=n.sessionStorage.orglist=t.data.session.orglist,l.score_call=n.sessionStorage.score_call=t.data.session.score_call,l.access_audio=n.sessionStorage.access_audio=t.data.session.access_audio,l.is_migrated=n.sessionStorage.is_migrated=t.data.session.is_migrated,l.download_audio_enabled=n.localStorage.download_audio_enabled=t.data.session.download_audio_enabled,t.data.session.badge&&t.data.session.badge>0&&(l.activeConversation=n.sessionStorage.activeConversation=t.data.session.badge),t.data.session.prompts&&t.data.session.prompts.length&&(n.sessionStorage.prompts=JSON.stringify(t.data.session.prompts),l.prompts=JSON.parse(n.sessionStorage.prompts)),t.data.session.voicemails&&t.data.session.voicemails.length&&(n.sessionStorage.voicemails=JSON.stringify(t.data.session.voicemails),l.voicemails=JSON.parse(n.sessionStorage.voicemails)),t.data.session.whispers&&t.data.session.whispers.length&&(n.sessionStorage.whispers=JSON.stringify(t.data.session.whispers),l.whispers=JSON.parse(n.sessionStorage.whispers)),console.log("login.....$rootScope.access_audio==",l.access_audio),0===t.data.session.reports.length?(l.reports=[],n.sessionStorage.reports=JSON.stringify(t.data.session.reports)):(n.sessionStorage.reports=JSON.stringify(t.data.session.reports),l.reports=t.data.session.reports),n.sessionStorage.levelOneOus=JSON.stringify(t.data.session.levelOneOus),l.levelOneOus=t.data.session.levelOneOus,l.bc_ous=[{id:l.highestOUId,name:l.highestOUName},{id:null,name:null},{id:null,name:null}],l.roleId=n.sessionStorage.roleId=t.data.session.role_id,l.protect_caller_id=n.sessionStorage.protect_caller_id=t.data.session.protect_caller_id,void 0!==t.data.session.support_token&&(l.supportToken=n.sessionStorage.supportToken=t.data.session.support_token),l.chatURL=n.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",l.white_label_active=n.sessionStorage.white_label_active=!1,t.data.session.style&&!0===t.data.session.style.white_label_active&&(l.white_label_active=n.sessionStorage.white_label_active=!0),t.data.session.style||(t.data.session.style={}),Object.keys(t.data.session.style).length>0?(l.chatActive=n.sessionStorage.chatActive=t.data.session.style.chat_active,t.data.session.style.support_url||t.data.session.style.domain_name?l.supportURL=n.sessionStorage.supportURL=t.data.session.style.support_url:l.supportURL=n.sessionStorage.supportURL="https://knowledgebase.convirza.com"):(l.chatActive=n.sessionStorage.chatActive=!0,l.supportURL=n.sessionStorage.supportURL="https://knowledgebase.convirza.com"),l.feedbackURL=n.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+n.sessionStorage.uservoiceSSO,n.sessionStorage.scope=JSON.stringify(t.data.scope),n.sessionStorage.style=JSON.stringify(t.data.session.style),s.getUserAccess(t.data.scope),console.log("Is pendo loaded 2: ",n.sessionStorage.loadedPendoScript),n.sessionStorage.loadedPendoScript&&"YES"===n.sessionStorage.loadedPendoScript&&(l.white_label_active?l.white_label_active&&!t.data.session.style.domain_name&&pendoInitializeOnLogin():(console.log("Pendo Loading"),pendoInitializeOnLogin())),t.data.session.style&&void 0===t.data.session.style.org_logo&&(t.data.session.style.org_logo=null),t.data.session.style&&void 0!==t.data.session.style.white_label_css&&Object.keys(t.data.session.style.white_label_css).length>0?c.whiteLabelCSSInject(t.data.session.style.white_label_css,t.data.session.style.org_logo,t.data.session.style.org_logo,!1):c.whiteLabelCSSInject(null,null,null,!1),localStorage.setItem("sessionStorageData",JSON.stringify(n.sessionStorage)),a.path("/")):(e.error=t.data.err,e.show_fail=!0)})}else e.error=t.data.err,e.show_fail=!0})}else e.error="You must enter a Password",e.show_fail=!0},e.closeFail=function(){e.show_fail=!1}}]).controller("RegistrationPageController",["$scope","$timeout",function(e,t){"use strict";e.checking=!1,e.checked=!1,e.checkAvailability=function(){!1!==e.reg_form.username.$dirty&&(e.checking=!0,t(function(){e.checking=!1,e.checked=!0},500))}}]).controller("ChatRoomController",["$scope","$timeout",function(e,t){"use strict";var o=new ElizaBot,a=["potter.png","tennant.png","johansson.png","jackson.png","jobs.png"];e.messages=[],e.userText="",e.elizaTyping=!1,e.elizaAvatar="johansson.png",e.sendMessage=function(i){var r={class:"me",avatar:"jackson.png",text:i};this.messages.push(r),this.userText="",t(function(){e.elizaAvatar=_.shuffle(a).shift(),e.elizaTyping=!0},500),t(function(){var t=o.transform(i),a={class:"chat-success",avatar:e.elizaAvatar,text:t};e.elizaTyping=!1,e.messages.push(a)},1200)}}]).directive("scrollToBottom",function(){"use strict";return{restrict:"A",scope:{model:"=scrollToBottom"},link:function(e,t,o){e.$watch("model",function(e,o){e!=o&&(t[0].scrollTop=t[0].scrollHeight)})}}}).controller("AdminLoginController",["$scope","$global","$http","$location","LoginWebService","$cookies","$remember","$window","OrgUnitLocal","$rootScope","AdminSession","pinesNotifications",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.remember=!1,e.forever=!!r.forever&&r.forever;var p=n("data");p&&(e.remember=!0,e.email=p),e.error="",t.set("fullscreen",!0),e.$on("$destroy",function(){t.set("fullscreen",!1)}),e.logIn=function(){e.remember&&angular.isDefined(e.email)?n("data",e.email):n("data","");r.get("name");var t={grant_type:"password",username:e.email,password:e.password,client_id:r.get("client_id"),client_secret:r.get("client_secret")};i.getToken(t).then(function(t){if(console.log("------------result:-----------"),console.log(t),"success"===t.data.status){try{if(!_.contains([5,6,7],t.data.session.role_id))return u.notify({title:"Permissions",text:"You dont have permission to login as an Admin.\n\n You are being redirected to the standard login page.",type:"error"}),void a.path("/login")}catch(e){return"TypeError"===e.name?console.log("Your object property access path is unavailable. Probably a backend problem."):console.log("Error thrown from login response - figure out how to handle this:\n",e),void a.path("/login")}e.forever&&(r.forever="on",r.refresh_token=t.data.refresh_token),e.isLoggedIn=!0,c.user_id=s.sessionStorage.user_id=t.data.session.user_id,c.token=s.sessionStorage.token=t.data.access_token,r.put("ct_token",c.token),c.role_id=s.sessionStorage.role_id=t.data.session.role_id,d.setAdminType(t.data.session.role_id),a.path("/admin-access")}else e.error=t.error_description?t.error_description:"Invalid email or password"}).catch(function(t){e.error=t.data.error_description?t.data.error_description:"Invalid email or password"})}}]),angular.module("theme.pages-signup",[]).factory("signUpWebService",["$http","ApiParam",function(e,t){"use strict";var o={getGeoArea:function(o){var a={method:"GET",url:t.baseURL()+"/v1/signup/npa/"+o};return e(a)},getIndustry:function(o){var a={method:"GET",url:t.baseURL()+"/v1/signup",data:o};return e(a)},getUserEmail:function(o){var a={method:"GET",url:t.baseURL()+"/v1/signup/"+o};return e(a)},saveuser:function(o){var a={method:"POST",url:t.baseURL()+"/v1/signup",data:o};return e(a)}};return o}]).controller("signUpController",["$scope","$global","$window","signUpWebService","pinesNotifications","$location","$cookies",function(e,t,o,a,i,r,n){"use strict";n.get("name");var s,l=(new Date).getFullYear(),c=[],d=[],u="",p=[];for(t.set("fullscreen",!0),e.creditCardTypes=["Visa","MasterCard","AmericanExpress","Discover"],e.countries=["United States","Canada"],e.united=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],e.canada=["Alberta","British Columbia","Manitoba","New Brunswick","Newfoundland","Northwest Territories","Nova Scotia","Ontario","Prince Edward Island","Quebec","Saskatchewan","Yukon"],e.tollFree=["800","844","855","866","877","888","833","822"],e.showSignUpPage=!0,e.showcreditDetailPage=!1,e.showalreadyEmail=!1,e.showNext=!0,e.mask="'mask':'999999999999999'",e.cvvMask="'mask':'999'",e.AccountTier="Tier 4 = >$29-$500",e.stateName="State",e.zipType="/^(d{5}([-]d{4})?)*$/",e.zipError="Zip Code",e.zipLength=5,e.num="/^d+$",e.cardNumMin=16,e.cardNumMax=16,e.disableSignup=!1,e.encryptionKey=n.get("encryptionKey"),r.search().subscription_id||"/signup"!==r.path()||r.search("subscription_id",16),r.search().free_trial||"/signup"!==r.path()||r.search("free_trial","no"),e.subscription_id=r.search().subscription_id?parseInt(r.search().subscription_id):16,e.isFreeTrial=r.search().free_trial,e.free_trial="yes"===r.search().free_trial,e.free_trial?e.AccountTier="Marketing Qualified Lead":e.AccountTier="Tier 4 = >$29-$500",e.lable="Start with Convirza because you deserve",e.lable1="the best call analytics on the market today!",e.navigateToLogin=function(){r.path("/login")},c.push(l),s=1;s<20;s++)c.push(l+s);e.years=c;var m=1,g=(new Date).getFullYear();for(s=m;s<13;s++)d.push(s);e.months=d;var f={Visa:/^4\d{3}-?\d{4}-?\d{4}-?\d{4,7}$/,MasterCard:/^5[1-5]\d{2}-?\d{4}-?\d{4}-?\d{4}$/,Discover:/^(?:6011-?\d{4}-?\d{4}-?\d{4}|5[0-9]\d{13})$/,AmericanExpress:/^3[4,7]\d{13}$/,None:/^[1,2,7,8,9,0]\d{15}|[1,2,7,8,9,0]\d{14}|[1,2,7,8,9,0]\d{18}|[3][0,1,2,3,5,6,8,9]\d{13}|[6][1,2,3,4,5,6,8,9]\d{13}$/};function h(t){return CryptoJS.AES.encrypt(t,e.encryptionKey).toString()}e.changeDate=function(t){if(m=(new Date).getMonth()+1,g==e.expirationYear&&e.expirationMonth<m)return i.notify({title:"Sign up",text:"Credit Card is Expired ",type:"error"}),e.expirationMonth="",!1},e.cardValidate=function(t){if((u=t.split("_").join("")).length<20&&u.length>14)for(var o in f){if(f[o].test(t)){e.cardType=o;break}}(14===u.length&&"Visa"!==e.cardType||"5"===u.charAt(0)&&u.charAt(1)<9)&&(e.cardNumMin=16,e.cardNumMax=16),("5"===u.charAt(0)&&(u.charAt(1)>5||0===u.charAt(1))||"3"===u.charAt(0)&&("4"===u.charAt(1)||"7"===u.charAt(1)))&&(e.cardNumMin=15,e.cardNumMax=15),"4"===u.charAt(0)&&(e.cardNumMin=16,e.cardNumMax=19),"None"===e.cardType&&u.length>14&&p.push("Invalid Credit Card Number"),p.length&&(i.notify({title:"Sign up",text:"Invalid Credit Card Number",type:"error"}),e.cardNumber="",e.cardType="",e.securityCode="",e.cardNumMin=16,e.cardNumMax=16,p.pop(),console.log(p.length))},e.selectcountry=function(t){console.log("SELECT COUNTRY FIRED:",t),"United States"===t?(e.zipType="",e.zipCode="",e.stateName="State",e.zipError="Zip Code",e.statesData=e.united,e.zipLength=5,e.zipType="^([0-9][0-9][0-9][0-9][0-9])*$"):"Canada"===t&&(e.zipType="",e.zipCode="",e.stateName="Province",e.zipError="Postal Code",e.statesData=e.canada,e.zipLength=7,e.zipType="^([A-Za-z][0-9][A-Za-z] [0-9][A-Za-z][0-9])*$")},e.phoneValidate=function(t){var o=t.replace("(","").replace(")","").split("_").join("");10===o.length&&a.getGeoArea(o.substring(0,3)).then(function(t){t.data||e.tollFree.indexOf(o.substring(0,3))>-1!=!1||(i.notify({title:"Sign up",text:"Please Enter Valid Phone Number",type:"error"}),e.phone="")})},e.next=function(){a.getUserEmail(e.email).then(function(t){t.data?(e.showSignUpPage=!1,e.showcreditDetailPage=!0,e.showalreadyEmail=!1,e.showNext=!1,e.lable1="",!0===e.free_trial?e.lable="You're almost done! Simply enter your credit card information to finish setting up your account. You won't be charged until after your free month ends.":e.lable="You're almost done! Simply enter your credit card information to finish setting up your account."):(e.showalreadyEmail=!0,e.showSignUpPage=!1,e.showcreditDetailPage=!1,e.showNext=!1,e.lable1="",e.lable="")})},e.cancel=function(){e.showSignUpPage=!0,e.showcreditDetailPage=!1,e.showNext=!0,e.showalreadyEmail=!1,e.lable="Start with Convirza because you deserve",e.lable1="the best call analytics on the market today!"},e.$watch("cardType",function(t,o){switch(e.readonly=!0,e.cvvMask="'mask':'999'",e.cvvLength="5",e.securityCode="",t){case"AmericanExpress":e.cardNumMin=15,e.cardNumMax=15,e.cvvLength="6",e.cvvMask="'mask':'9999'";break;case"Discover":e.cardNumMin=15,e.cardNumMax=16;break;case"Visa":e.cardNumMin=16,e.cardNumMax=19;break;case"MasterCard":default:e.cardNumMin=16,e.cardNumMax=16}}),a.getIndustry().then(function(t){if(200===t.status){var o,a,r,n,s={};_.each(t.data,function(e){o=e.industry_group,a=e.industry_name,void 0===s[o]&&(s[o]={name:o,specific:[]}),"Other"!==o?s[o].specific.push({name:" - "+a,id:e.industry_id}):(r=e.industry_id,n=o)}),s.Other={name:n,specific:[]},s.Other.specific.push({id:r}),e.industryList=s}else i.notify({title:"Sign up",text:t.data,type:"error"})}),e.zipLen=function(){return e.zipCode=e.zipCode.replace(/[@!&\/\\#,+()$~%.'":*?<>{}]/g,""),"United States"===e.country&&e.zipCode.length<5?(i.notify({title:"Sign up",text:"Zip Code field is invalid.",type:"error"}),!1):!("Canada"===e.country&&e.zipCode.length<7)||(i.notify({title:"Sign up",text:"Postal Code field is invalid.",type:"error"}),!1)},e.signUp=function(){if(!e.zipLen())return!1;e.cardNumber=e.cardNumber.replace("_","");var t=new Date;t.setDate(t.getDate()+1);var r=e.cardNumber.replace(/-/g,""),n=e.securityCode.replace(/-/g,""),s={},l={name:e.company,currency:"USD",billCycleDay:t.getDate(),Industry_Id__c:e.industry,Account_Tier__c:e.AccountTier,billToContact:{firstName:e.firstName,lastName:e.lastName,state:e.state,country:e.country,workEmail:e.email,mobilePhone:e.phone},creditCard:{cardType:e.cardType,cardNumber:h(r),securityCode:h(n),expirationMonth:h(e.expirationMonth.toString()),expirationYear:h(e.expirationYear.toString()),cardHolderInfo:{cardHolderName:h(e.cardHolderName),addressLine1:e.addressLine,city:e.city,state:e.state,zipCode:e.zipCode,country:e.country}}};s.userData=l,s.subscriptionData={free_trial:e.free_trial,subscription_id:e.subscription_id},e.disableSignup=!0,a.saveuser(s).then(function(e){!0===e.data.success?o.location.href="#/thankyou":i.notify({title:"Sign up",text:e.data,type:"error"})})}}]),angular.module("theme.templates",[]).run(["$templateCache",function(e){"use strict";e.put("templates/bs-modal.html",'<div class="modal-header">\n    <h3 class="modal-title">I\'m a modal!</h3>\n</div>\n<div class="modal-body">\n    <ul>\n        <li ng-repeat="item in items">\n            <a ng-click="selected.item = item">{{ item }}</a>\n        </li>\n    </ul>\n    Selected: <b>{{ selected.item }}</b>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" ng-click="ok()">OK</button>\n    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>\n</div>\n'),e.put("templates/contextual-progressbar.html",'<div class="contextual-progress">\n\t<div class="clearfix">\n\t\t<div class="progress-title">{{heading}}</div>\n\t\t<div class="progress-percentage">{{percent | number:0}}%</div>\n\t</div>\n\t<div class="progress">\n\t\t<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: percent + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n\t</div>\n</div>\n'),e.put("templates/nav_renderer.html",'<a ng-click="select(item)" ng-href="{{item.url}}">\n\t<i ng-if="item.iconClasses" class="{{item.iconClasses}}"><div ng-if="item.count > 0" class="badge badge-danger customBadge">{{item.count}}</div></i><span>{{item.label}}</span>\n\t<span ng-bind-html="item.html"></span>\n</a>\n<ul ng-if="item.children.length" data-slide-out-nav="item.open">\n    <li ng-repeat="item in item.children"\n\t    ng-class="{ hasChild: (item.children!==undefined),\n                      active: item.selected,\n                        open: (item.children!==undefined) && item.open }"\n    \tng-include="\'templates/nav_renderer.html\'"\n    ></li>\n</ul>\n'),e.put("templates/nav_renderer_horizontal.html",'<a ng-click="select(item)" ng-href="{{item.url}}">\n  <i ng-if="item.iconClasses" class="{{item.iconClasses}}"><div ng-if="item.count > 0" class="badge badge-danger customBadge">{{item.count}}</div></i><span>{{item.label}}</span>\n  <span ng-bind-html="item.html"></span>\n</a>\n<ul ng-if="item.children.length">\n    <li ng-repeat="item in item.children"\n      ng-class="{ hasChild: (item.children!==undefined),\n                      active: item.selected,\n                        open: (item.children!==undefined) && item.open }"\n      ng-include="\'templates/nav_renderer_horizontal.html\'"\n    ></li>\n</ul>\n'),e.put("templates/panel-tabs-without-heading.html",'<div class="panel {{panelClass}}">\n  <div class="panel-heading">\n        <h4>\n            <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n        </h4>\n  </div>\n  <div class="panel-body">\n    <div class="tab-content">\n        <div class="tab-pane"\n            ng-repeat="tab in tabs"\n            ng-class="{active: tab.active}"\n            tab-content-transclude="tab">\n        </div>\n    </div>\n  </div>\n</div>\n'),e.put("templates/panel-tabs.html",'<div class="panel {{panelClass}}">\n  <div class="panel-heading">\n        <h4><i ng-if="panelIcon" class="{{panelIcon}}"></i>{{(panelIcon? " ":"")+heading}}</h4>\n        <div class="options">\n            <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n        </div>\n  </div>\n  <div class="panel-body">\n    <div class="tab-content">\n        <div class="tab-pane"\n            ng-repeat="tab in tabs"\n            ng-class="{active: tab.active}"\n            tab-content-transclude="tab">\n        </div>\n    </div>\n  </div>\n</div>\n'),e.put("templates/panel.html",'<div class="panel {{panelClass}}">\n  <div class="panel-heading">\n        <h4><i ng-if="panelIcon" class="{{panelIcon}}"></i>{{(panelIcon? " ":"")+heading}}</h4>\n        <div class="options">\n        </div>\n  </div>\n  <div class="panel-body" ng-transclude>\n  </div>\n</div>\n'),e.put("templates/themed-tabs-bottom.html",'<div class="tab-container tab-{{theme || \'primary\'}} tab-{{position || \'normal\'}}">\n  <div class="tab-content">\n    <div class="tab-pane"\n        ng-repeat="tab in tabs"\n        ng-class="{active: tab.active}"\n        tab-content-transclude="tab">\n    </div>\n  </div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n</div>\n'),e.put("templates/themed-tabs.html",'<div class="tab-container tab-{{theme || \'primary\'}} tab-{{position || \'normal\'}}">\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane"\n        ng-repeat="tab in tabs"\n        ng-class="{active: tab.active}"\n        uib-tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n'),e.put("templates/tile-generic.html",'<div class="info-tiles tiles-{{type}}">\n\t<div class="tiles-heading">\n\t\t{{heading}}\n\t</div>\n\t<div class="tiles-body" ng-transclude>\n\t</div>\n</div>\n'),e.put("templates/tile-large.html",'<a class="info-tiles tiles-{{item.color}}" ng-href="{{item.href}}">\n    <div class="tiles-heading">\n        <div class="pull-left">{{item.title}}</div>\n        <div class="pull-right">{{item.titleBarInfo}}</div>\n    </div>\n    <div class="tiles-body">\n        <div class="pull-left"><i class="{{item.classes}}"></i></div>\n        <div class="pull-right" ng-show="item.text">{{item.text}}</div>\n        <div class="pull-right" ng-show="!item.text" ng-transclude></div>\n    </div>\n</a>\n'),e.put("templates/tile-mini.html",'<a class="shortcut-tiles tiles-{{item.color}}" ng-href="{{item.href}}">\n\t<div class="tiles-body">\n\t\t<div class="pull-left"><i class="{{item.classes}}"></i></div>\n\t\t<div class="pull-right"><span class="badge">{{item.titleBarInfo}}</span></div>\n\t</div>\n\t<div class="tiles-footer">\n\t\t{{item.text}}\n\t</div>\n</a>\n')}]),angular.module("theme.template-overrides",[]).config(["$provide",function(e){"use strict";e.decorator("uibTabsetDirective",["$delegate",function(e){return e[0].templateUrl=function(e,t){return t.tabPosition||t.tabTheme?!t.tabPosition||"'bottom'"!=t.tabPosition&&"bottom"!=t.tabPosition?"templates/themed-tabs.html":"templates/themed-tabs-bottom.html":t.panelTabs&&void 0!==t.heading?"templates/panel-tabs.html":t.panelTabs&&void 0===t.heading?"templates/panel-tabs-without-heading.html":"templates/themed-tabs.html"},angular.extend(e[0].scope,{heading:"@",panelClass:"@",panelIcon:"@",theme:"@tabTheme",position:"@tabPosition"}),e}]),e.decorator("uibProgressbarDirective",["$delegate",function(e){return e[0].templateUrl=function(e,t){return t.contextual&&"true"==t.contextual?"templates/contextual-progressbar.html":"template/progressbar/progressbar.html"},angular.extend(e[0].scope,{heading:"@"}),e}])}]).run(["$templateCache",function(e){"use strict";e.put("footerTemplate.html",'<div ng-show="showFooter" class="ng-grid-footer" ng-style="footerStyle()">\r\n    <div class="col-md-4" >\r\n        <div class="ngFooterTotalItems" ng-class="{\'ngNoMultiSelect\': !multiSelect}" >\r\n            <span class="ngLabel">{{i18n.ngTotalItemsLabel}} {{maxRows()}}</span><span ng-show="filterText.length > 0" class="ngLabel">({{i18n.ngShowingItemsLabel}} {{totalFilteredItemsLength()}})</span>\r\n        </div>\r\n        <div class="ngFooterSelectedItems" ng-show="multiSelect">\r\n            <span class="ngLabel">{{i18n.ngSelectedItemsLabel}} {{selectedItems.length}}</span>\r\n        </div>\r\n    </div>\r\n    <div class="col-md-4" ng-show="enablePaging" ng-class="{\'ngNoMultiSelect\': !multiSelect}">\r\n            <label class="control-label ng-grid-pages center-block">{{i18n.ngPageSizeLabel}}\r\n               <select class="form-control input-sm" ng-model="pagingOptions.pageSize" >\r\n                      <option ng-repeat="size in pagingOptions.pageSizes">{{size}}</option>\r\n                </select>\r\n        </label>\r\n</div>\r\n     <div class="col-md-4">\r\n        <div class="pull-right ng-grid-pagination">\r\n            <button type="button" class="btn btn-default btn-sm" ng-click="pageToFirst()" ng-disabled="cantPageBackward()" title="{{i18n.ngPagerFirstTitle}}"><i class="fa fa-angle-double-left"></i></button>\r\n            <button type="button" class="btn btn-default btn-sm" ng-click="pageBackward()" ng-disabled="cantPageBackward()" title="{{i18n.ngPagerPrevTitle}}"><i class="fa fa-angle-left"></i></button>\r\n            <label class="control-label">\r\n                   <input class="form-control input-sm" min="1" max="{{currentMaxPages}}" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0 4px;" ng-model="pagingOptions.currentPage"/>\r\n            </label>\r\n            <span class="ngGridMaxPagesNumber" ng-show="maxPages() > 0">/ {{maxPages()}}</span>\r\n            <button type="button" class="btn btn-default btn-sm" ng-click="pageForward()" ng-disabled="cantPageForward()" title="{{i18n.ngPagerNextTitle}}"><i class="fa fa-angle-right"></i></button>\r\n            <button type="button" class="btn btn-default btn-sm" ng-click="pageToLast()" ng-disabled="cantPageToLast()" title="{{i18n.ngPagerLastTitle}}"><i class="fa fa-angle-double-right"></i></button>\r\n        </div>\r\n     </div>\r\n</div>\r\n'),e.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <i ng-repeat="r in range track by $index" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="fa" ng-class="$index < value && (r.stateOn || \'fa-star\') || (r.stateOff || \'fa-star-o\')">\n        <span class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    </i>\n</span>')}]),angular.module("theme.navigation-controller",["theme.conversations"]).service("menuBarService",function(){var e={};return{getMenuBar:function(){return e},setMenuBar:function(t){e=t}}}).controller("NavigationController",["$scope","$rootScope","$location","$timeout","$interval","$global","$cookies","menuBarService","ConversationWebService",function(e,t,o,a,i,r,n,s,l){"use strict";var c=function(e,t){angular.forEach(e,function(e){e.parent=t,void 0!==e.children&&c(e.children,e)})},d=function(){var o=[{label:"Home",iconClasses:"fa fa-home",url:"#/"},{label:"Reports",iconClasses:"fa fa-bar-chart-o",id:"elemReport",url:"#/cfa-reports"},{label:"Scorecard",iconClasses:"fa fa-columns",children:[]}];!0!==t.download_audio_enabled&&null!==t.download_audio_enabled||-1==_.findIndex(o,{label:"Legacy Reports"})&&o.splice(2,0,{label:"Legacy Reports",iconClasses:"fa fa-bar-chart-o",children:[{label:"Call Details",url:"#/calls-details?report=call_detail"},{label:"Group Activity",url:"#/activity-group?report=group_activity"},{label:"Tracking Number Settings",url:"#/settings-call-flow?report=callflow_setting"}]});if(e.userAccess&&parseInt(e.userAccess.campaign)>4&&o.push({label:"Campaign & Tracking Number",iconClasses:"fa fa-phone",url:"#/set-campaign"}),e.userAccess&&parseInt(e.userAccess.campaign)>4&&(4===parseInt(t.roleId)||1===parseInt(t.roleId)||5===parseInt(t.roleId)||6===parseInt(t.roleId))&&(!0===t.is_migrated||"true"===t.is_migrated?o.push({label:"Group & User",iconClasses:"fa fa-group",url:"#/set-group"}):o.push({label:"Group & User",iconClasses:"fa fa-group",url:"#/set-legacy-group"})),(!0===t.is_migrated||"true"===t.is_migrated)&&e.userAccess&&parseInt(e.userAccess.sms)>4&&o.push({label:"Conversations",iconClasses:"fa fa-comment",url:"#/sms-conversations",count:t.activeConversation}),e.userAccess&&parseInt(e.userAccess.campaign)>4&&(!0===t.is_migrated||"true"===t.is_migrated?o.push({label:"Settings",iconClasses:"fa fa-cog",children:[{label:"My Scheduled Reports",url:"#/scheduled-plans"},{label:"Legacy Scheduled Reports",url:"#/set-scheduled"},{label:"Customization",children:[{label:"Legacy Distribution Lists",url:"#/set-dist"},{label:"GeoRoute",url:"#/set-location"},{label:"Tags ",url:"#/set-tags"},{label:"Webhook",url:"#/set-webhook"}]},{label:"Integration",children:[{label:"Acquisio",url:"#/set-acquisio"},{label:"Data Append",url:"#/set-append"},{label:"DoubleClick",url:"#/set-doubleclick"},{label:"Google Analytics",url:"#/set-ga"}]}]}):o.push({label:"Settings",iconClasses:"fa fa-cog",children:[{label:"My Scheduled Reports",url:"#/scheduled-plans"},{label:"Legacy Scheduled Reports",url:"#/set-scheduled"},{label:"Customization",children:[{label:"Legacy Distribution Lists",url:"#/set-dist"},{label:"GeoRoute",url:"#/set-legacy-location"},{label:"Tags ",url:"#/set-tags"},{label:"Webhook",url:"#/set-webhook"}]},{label:"Integration",children:[{label:"Acquisio",url:"#/set-acquisio"},{label:"Data Append",url:"#/set-append"},{label:"DoubleClick",url:"#/set-doubleclick"},{label:"Google Analytics",url:"#/set-ga"}]}]})),e.userAccess&&!e.userAccess.blocked_recording&&e.userAccess.manualscorecard>=4?(1!==parseInt(t.roleId)&&4!==parseInt(t.roleId)||_.each(o,function(e,a){"Scorecard"===e.label&&(!0!==t.score_call&&"true"!==t.score_call||o[a].children.push({label:"Manage Scorecard",url:"#/set-score-card"}),o[a].children.push({label:"Select & Score",url:"#/set-select-score"}))}),8!==parseInt(t.roleId)&&2!==parseInt(t.roleId)&&3!==parseInt(t.roleId)||_.each(o,function(e,t){"Scorecard"===e.label&&o[t].children.push({label:"Select & Score",url:"#/set-select-score"})})):o.splice(_.findLastIndex(o,{label:"Scorecard"}),1),e.userAccess&&e.userAccess.blocked_data_append&&_.each(o,function(e,t){if("Settings"===e.label){var a=_.findLastIndex(o[t].children,{label:"Integration"});o[t].children[a].children.splice(_.findLastIndex(o[t].children[a].children,{label:"Data Append"}),1)}}),8!==parseInt(t.billingId)&&194!==parseInt(t.billingId)&&7414!==parseInt(t.billingId)||_.each(o,function(e,t){"Reports"===e.label&&_.each(o[t].children,function(e,a){"Activity & Settings"===e.label&&o[t].children.push({label:"Calls Overview",url:"#/call-overview?report=call_overview"})})}),t.highestOUId===t.billingId&&e.userAccess&&e.userAccess.dni>=4&&_.each(o,function(e,t){"Settings"===e.label&&_.each(o[t].children,function(e,a){"Customization"===e.label&&o[t].children[a].children.push({label:"DNI",url:"#/set-dni"})})}),!1===t.download_audio_enabled){var a=-1;_.each(o,function(e,t){"Settings"===e.label&&(_.each(o[t].children,function(e,t){"Legacy Scheduled Reports"===e.label&&(a=t)}),-1!==a&&o[t].children.splice(a,1))})}t.highestOUId===t.billingId&&e.userAccess&&e.userAccess.white>=6&&_.each(o,function(e,t){"Settings"===e.label&&_.each(o[t].children,function(e,a){"Customization"===e.label&&o[t].children[a].children.push({label:"Whitelabel",url:"#/set-whitelabel"})})}),t.highestOUId===t.billingId&&t.userAccess&&!t.userAccess.blocked_data_append&&t.userAccess.hipaa&&1===parseInt(t.roleId)&&7===parseInt(t.userAccess.hipaa)&&_.each(o,function(e,t){"Settings"===e.label&&_.each(o[t].children,function(e,a){"Customization"===e.label&&o[t].children[a].children.push({label:"Caller Privacy",url:"#/set-caller-privacy"}),o[t].children[a].children=_.sortBy(o[t].children[a].children,function(e){return e.label})})}),!1!==t.protect_caller_id&&"false"!==t.protect_caller_id||_.each(o,function(e,t){"Settings"===e.label&&_.each(o[t].children,function(e,a){"Customization"===e.label&&o[t].children[a].children.push({label:"Blacklist",url:"#/set-blacklist"}),o[t].children[a].children=_.sortBy(o[t].children[a].children,function(e){return e.label})})}),e.userAccess&&e.userAccess.report>=4&&_.each(o,function(e,t){"Reports"===e.label&&_.each(o[t].children,function(e,a){"Activity & Settings"===e.label&&o[t].children[a].children.push({label:"Call Flow Settings",url:"#/settings-call-flow?report=callflow_setting"})})}),s.setMenuBar(o),c(o,null)};d(),e.menu=s.getMenuBar(),e.$watch(function(){return s.getMenuBar()},function(t){c(t,null),e.menu=t}),e.$on("download_audio_setting_changed",function(){d()},!1),e.$on("unread_msgs",function(){d()},!1),e.$on("msg_read",function(e,o){t.activeConversation=o,d()},!1),e.$watch("userAccess",function(e,t){d()},!1),e.findItemByUrl=function(t,o){for(var a=0,i=t.length;a<i;a++){if(t[a].url&&t[a].url.replace("#","")==o)return t[a];if(void 0!==t[a].children){var r=e.findItemByUrl(t[a].children,o);if(r)return r}}},e.openItems=[],e.selectedItems=[],e.selectedFromNavMenu=!1,e.select=function(t){if(t.open)t.open=!1;else{for(var o=e.openItems.length-1;o>=0;o--)e.openItems[o].open=!1;e.openItems=[];for(var a=t;null!==a&&void 0!==a;)a.open=!0,e.openItems.push(a),a=a.parent;if(!t.children||t.children&&t.children.length<1){e.selectedFromNavMenu=!0;for(var i=e.selectedItems.length-1;i>=0;i--)e.selectedItems[i].selected=!1;for(e.selectedItems=[],a=t;null!==a&&void 0!==a;)a.selected=!0,e.selectedItems.push(a),a=a.parent}}},e.$watch(function(){return o.path()},function(t,i){var r;"/acq-call-flows4"===t&&(t=t+"?report="+o.search().report);"/profile"===t&&(t="/set-group"),"/set-campaign-builder"===t&&(t="/set-campaign"),"/calls-details"===t&&(t="/calls-details?report=call_detail"),(r=e.findItemByUrl(e.menu,t))&&a(function(){e.select(r)})}),e.showSearchBar=function(e){e.stopPropagation(),r.set("showSearchCollapsed",!0)},e.$on("globalStyles:changed:showSearchCollapsed",function(t,o){e.style_showSearchCollapsed=o}),e.goToSearch=function(){o.path("/extras-search")},i(function(){var o=n.get("ct_token");"loggedin"==t.loginState&&o&&e.userAccess&&parseInt(e.userAccess.sms)>4&&l.getActiveBadgeCount().then(function(o){o.data&&""==o.data.err?parseInt(t.activeConversation)!==parseInt(o.data.json)&&(t.activeConversation=o.data.json,e.$broadcast("unread_msgs")):(t.activeConversation=0,e.$broadcast("unread_msgs"))})},3e4)}]),angular.module("theme.notifications-controller",[]).controller("NotificationsController",["$scope","$filter",function(e,t){"use strict";e.notifications=[{text:"You are within 10% of your minutes usage",time:"4m",class:"notification-warning",iconClasses:"fa fa-warning",seen:!1},{text:"Call volume is 80% above your average",time:"10m",class:"notification-success",iconClasses:"fa fa-check",seen:!1},{text:"Conversion Rate for Online:Paid Search is 50% below last week",time:"22m",class:"notification-danger",iconClasses:"fa fa-exclamation",seen:!0},{text:"Lead Score for Mobile:Organic Search is 75% above last week",time:"30m",class:"notification-success",iconClasses:"fa fa-check",seen:!0}],e.setSeen=function(e,t){t.preventDefault(),t.stopPropagation(),e.seen=!0},e.setUnseen=function(e,t){t.preventDefault(),t.stopPropagation(),e.seen=!1},e.setSeenAll=function(t){t.preventDefault(),t.stopPropagation(),angular.forEach(e.notifications,function(e){e.seen=!0})},e.unseenCount=t("filter")(e.notifications,{seen:!1}).length,e.$watch("notifications",function(o){e.unseenCount=t("filter")(o,{seen:!1}).length},!0)}]),angular.module("theme.messages-controller",[]).factory("LogActivityService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";var r={notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},stream:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/logactivity/stream",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)}};return r}]).controller("MessagesController",["$scope","LogActivityService","$rootScope","$window",function(e,t,o,a){"use strict";e.log_list=[{log:"log_billing",text:"Billing"},{log:"log_call_action",text:"Call Actions"},{log:"log_call_flow",text:"Call Flow"},{log:"log_campaign",text:"Campaigns"},{log:"log_integration",text:"Integrations"},{log:"log_ivr",text:"IVR Route"},{log:"log_tag",text:"Tags"},{log:"log_user",text:"User/Group"},{log:"log_webhook",text:"Webhooks"}];var i={log_billing:"fa fa-money",log_call_action:"fa fa-bolt",log_call_flow:"fa fa-phone",log_campaign:"fa fa-gear",log_integration:"fa-cloud",log_ivr:"fa fa-wrench",log_tag:"fa fa-tags",log_user:"fa fa-user",log_webhook:"fa fa-info"},r={insert:"added",delete:"removed",update:"modified",login:"login for",logout:"logout for"};e.getMessageLogs=function(){var n={org_unit_id:o.currentOUId,start_date:moment().subtract("days",90).format("YYYY-MM-DD")+" 00:00:00",timezone:o.timezone,end_date:moment().format("YYYY-MM-DD")+" 23:59:59",limit:5};e.logs=[],void 0!==a.sessionStorage.token&&t.stream(n).then(function(t){"error"!=t.data.result&&_.each(t.data.json,function(t){t.log_date=moment(t.timezone,"YYYY-MM-DD hh:mm:ss A").format("YYYY-MM-DD h:m A"),t.iconcss=i[t.log_name]?i[t.log_name]:i.user,t.action=r[t.log_data.action]?r[t.log_data.action]:t.log_data.action,t.username=t.first_name+" "+t.last_name+" ("+t.username+")",_.each(e.log_list,function(e){e.log===t.log_name&&(t.log_name=e.text)}),e.logs.push(t)})})},e.setRead=function(e,t){t.preventDefault(),t.stopPropagation(),e.read=!0},e.setUnread=function(e,t){t.preventDefault(),t.stopPropagation(),e.read=!1},e.setReadAll=function(t){t.preventDefault(),t.stopPropagation(),angular.forEach(e.messages,function(e){e.read=!0})}}]);var smallerDataSet=[{call_group:1,total_count:1,provisioned_route_id:155,route_name:"Golden Auto Clinic - Store",ring_to_number:"3032795622",start_date:"2015-03-11",total_duration:91,unique_calls:1,lead_score_sum:26.3600006103516,lead_count:1,conversion_sum:0,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:1,provisioned_route_id:155,route_name:"Golden Auto Clinic - Store",ring_to_number:"3032795622",start_date:"2015-03-11",total_duration:92,unique_calls:1,lead_score_sum:21.1499996185303,lead_count:1,conversion_sum:0,conversion_count:1,keyword:"Call coolness"},{call_group:1,total_count:4,provisioned_route_id:155,route_name:"Golden Auto Clinic - Store",ring_to_number:"3032795622",start_date:"2015-03-11",total_duration:619,unique_calls:4,lead_score_sum:194.580003738403,lead_count:4,conversion_sum:234,conversion_count:4,keyword:"Callz tracking"},{call_group:1,total_count:1,provisioned_route_id:155,route_name:"Golden Auto Clinic - Store",ring_to_number:"3032795622",start_date:"2015-03-11",total_duration:154,unique_calls:1,lead_score_sum:null,lead_count:0,conversion_sum:0,conversion_count:1,keyword:"Call analytics"},{call_group:1,total_count:7,provisioned_route_id:164,route_name:"Honest-1 - Milwaukie, OR",ring_to_number:"5036592689",start_date:"2015-03-11",total_duration:1484,unique_calls:7,lead_score_sum:394.5,lead_count:6,conversion_sum:312,conversion_count:7,keyword:"Call tracking"},{call_group:1,total_count:1,provisioned_route_id:164,route_name:"Honest-1 - Milwaukie, OR",ring_to_number:"5036592689",start_date:"2015-03-11",total_duration:109,unique_calls:1,lead_score_sum:21.9400005340576,lead_count:1,conversion_sum:0,conversion_count:1,keyword:"Call coolness"},{call_group:1,total_count:2,provisioned_route_id:164,route_name:"Honest-1 - Milwaukie, OR",ring_to_number:"5036592689",start_date:"2015-03-11",total_duration:169,unique_calls:2,lead_score_sum:44.0900001525879,lead_count:1,conversion_sum:78,conversion_count:2,keyword:"Call analytics"},{call_group:1,total_count:1,provisioned_route_id:240,route_name:"Abington Sunoco Tracking",ring_to_number:"7818788415",start_date:"2015-03-11",total_duration:190,unique_calls:1,lead_score_sum:53.7999992370605,lead_count:1,conversion_sum:0,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:1,provisioned_route_id:295,route_name:"Autohaus Import Services ",ring_to_number:"9198810364",start_date:"2015-03-11",total_duration:170,unique_calls:1,lead_score_sum:null,lead_count:0,conversion_sum:78,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:4,provisioned_route_id:295,route_name:"Autohaus Import Services ",ring_to_number:"9198810364",start_date:"2015-03-11",total_duration:781,unique_calls:4,lead_score_sum:263.559997558594,lead_count:4,conversion_sum:237,conversion_count:4,keyword:"Call analytics"},{call_group:1,total_count:1,provisioned_route_id:295,route_name:"Autohaus Import Services ",ring_to_number:"9198810364",start_date:"2015-03-11",total_duration:120,unique_calls:1,lead_score_sum:64.5599975585938,lead_count:1,conversion_sum:78,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:2,provisioned_route_id:318,route_name:"Preferred Automotive",ring_to_number:"4088428640",start_date:"2015-03-11",total_duration:218,unique_calls:2,lead_score_sum:53.3800010681152,lead_count:1,conversion_sum:0,conversion_count:2,keyword:"Call tracking"},{call_group:1,total_count:1,provisioned_route_id:446,route_name:"The Driving Machine",ring_to_number:"4084469727",start_date:"2015-03-11",total_duration:652,unique_calls:1,lead_score_sum:83.5100021362305,lead_count:1,conversion_sum:78,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:1,provisioned_route_id:476,route_name:"Moore Performance",ring_to_number:"4104374870",start_date:"2015-03-11",total_duration:65,unique_calls:1,lead_score_sum:42.689998626709,lead_count:1,conversion_sum:78,conversion_count:1,keyword:"Call tracking"},{call_group:1,total_count:2,provisioned_route_id:476,route_name:"Moore Performance",ring_to_number:"4104374870",start_date:"2015-03-11",total_duration:201,unique_calls:2,lead_score_sum:89.75,lead_count:2,conversion_sum:78,conversion_count:2,keyword:"Call tracking"}];angular.module("theme.dashboard",[]).service("cfilter",["$http",function(e){"use strict";var t={};return t.cf=crossfilter([]),e.get("assets/demo/call_flow.json").success(function(e){void 0!==e.json&&(t.data=e.json,t.ndx=t.cf.add(t.data),t.all=t.ndx.groupAll())}).error(function(e){alert("error loading config.json")}),t}]).controller("CFController2",["$scope","cfilter",function(e,t){"use strict";return e.cfobj=t,e.cfobj}]).controller("TablesAdvancedController2",["$scope","cfilter","$filter","$http",function(e,t,o,a){"use strict";e.cfobj=t,e.filterOptions={filterText:"",useExternalFilter:!0},e.totalServerItems=0,e.pagingOptions={pageSizes:[25,50,100],pageSize:25,currentPage:1},e.setPagingData=function(t,o,a){var i=t.slice((o-1)*a,o*a);e.myData=i,e.totalServerItems=t.length,e.$$phase||e.$apply()},e.getPagedDataAsync=function(t,o,i){setTimeout(function(){if(i){var r=i.toLowerCase();a.get("assets/demo/ng-data.json").success(function(a){a.filter(function(e){return-1!=JSON.stringify(e).toLowerCase().indexOf(r)}),e.setPagingData(e.cfobj.data,o,t)})}else e.setPagingData(e.cfobj.data,o,t)},100)},e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage),e.$watch("pagingOptions",function(t,o){t!==o&&t.currentPage!==o.currentPage&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.$watch("filterOptions",function(t,o){t!==o&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.gridOptions={data:"myData",enablePaging:!0,showFooter:!0,totalServerItems:"totalServerItems",pagingOptions:e.pagingOptions,filterOptions:e.filterOptions}}]).controller("DashboardController",["$scope","$timeout",function(e,t){t(function(){e.plotStatsData=[{data:[[1,500],[2,4],[3,3],[4,800],[5,600],[6,800],[7,700],[8,999]],label:"Calls by Day"}],e.plotStatsOptions={series:{lines:{show:!0,lineWidth:1.5,fill:.1},points:{show:!0},shadowSize:0},grid:{labelMargin:10,hoverable:!0,clickable:!0,borderWidth:0},tooltip:!0,tooltipOpts:{defaultTheme:!1,content:"Count: %y"},colors:["#b3bcc7"],xaxis:{tickColor:"transparent",tickDecimals:0,autoscaleMargin:0,font:{color:"rgba(0,0,0,0.4)",size:11}},yaxis:{ticks:4,tickDecimals:0,tickColor:"rgba(0,0,0,0.04)",font:{color:"rgba(0,0,0,0.4)",size:11},tickFormatter:function(e,t){return e>999?e/1e3+"K":e}},legend:{labelBoxBorderColor:"transparent"}},e.plotRevenueData=[{data:[[1,1100],[2,1400],[3,1200],[4,800],[5,600],[6,800],[7,700]],label:"Unique Calls"}],e.plotRevenueOptions={series:{bars:{show:!0,fill:1,lineWidth:0,barWidth:.6,align:"center"},points:{show:!1},shadowSize:0},grid:{labelMargin:10,hoverable:!0,clickable:!0,borderWidth:0},tooltip:!0,tooltipOpts:{defaultTheme:!1,content:"Count: %y"},colors:["#b3bcc7"],xaxis:{tickColor:"transparent",tickDecimals:0,autoscaleMargin:0,font:{color:"rgba(0,0,0,0.4)",size:11}},yaxis:{ticks:4,tickDecimals:0,tickColor:"rgba(0,0,0,0.04)",font:{color:"rgba(0,0,0,0.4)",size:11},tickFormatter:function(e,t){return e>999?e/1e3+"K":""+e}},legend:{labelBoxBorderColor:"transparent"}}},3e3)}]),angular.module("theme.cfareports",["ui.select2","angularUtils.directives.dirPagination","api-param"]).factory("CfaReportsWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getLookerUrl:function(e){o.defaults.useXDomain=!0;var t={method:"POST",url:r.baseURL()+"/v1/looker",headers:r.headerConfig().headers,data:e};return o(t)},getDataAppend:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/userpermissions/ouid/"+e,r.headerConfig())}};return n}]).directive("setHeight",["$window",function(e){return function(t,o){var a=angular.element(e);t.getWindowDimensions=function(){return{h:a.innerHeight()}},t.$watch(t.getWindowDimensions,function(e,a){t.windowHeight=e.h,o.css("height",e.h-135+"px")},!0),a.bind("resize",function(){t.$apply()})}}]).controller("CfaReportsController",["$scope","$rootScope","$sce","$http","$window","$routeParams","progressLoader","CfaReportsWebService","pinesNotifications","$timeout","$compile","$q","$bootbox","$uibModal","$location","ApiParam",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f){e.reportList=[];if(e.looker_filters={},e.reportList=t.reports,e.showCompare=!1,e.isCompare=!1,e.loadReport=function(a){10===(a=JSON.parse(a)).looker_id?e.showCompare=!0:(e.showCompare=!1,e.isCompare=!1);var r=t.timezone;1133!==a.report_id&&1134!==a.report_id||(r="GMT");var n={dashboard_id:a.looker_id,host:g.host(),api_url:f.baseURL(),timezone:r,filters:e.looker_filters,isCompare:e.isCompare};console.log("$location.host()",g.host()),s.getLookerUrl(n).then(function(r){e.lookerUrl=o.trustAsResourceUrl(r.data.json),s.getDataAppend(t.currentOUId).then(function(e){"success"!=e.data.result||1131!==a.report_id||!1!==e.data.json[0].data_append||(i.location.href="#/access-denied")})})},e.reportList.length<1)return i.location.href="#/access-denied",void l.notify({title:"Reports",text:"It looks like you do not have permission to access this page. Please reach out to your administrator to have permissions granted.",type:"error"});_.map([1139,1111],function(t){var o=_.find(e.reportList,function(e){return e.report_id===t});o&&(e.reportList.unshift(o),e.reportList=_.uniq(e.reportList,function(e){return e.report_id}))}),e.loadReport(JSON.stringify(e.reportList[0])),e.selectedReport=function(t){e.loadReport(t)}}]),angular.module("theme.call_flow",["theme.report_service"]).controller("CallFlowsReportController",["$scope","$http","$routeParams","$window","$rootScope","ReportDataWebService","$location","pinesNotifications","DateRangeFiller","ReportParam","advFilSrvc","progressLoader",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.hideDataTable=!1,e.filterApplied=!1,e.simpleSearchFilter="",e.horsemanFlag=!1,e.roleId=i.roleId,e.parseInt=parseInt,e.advFiltersAreApplied=!1,e.simpleSearchApplied=!0,e.URLbase=a.location.origin,e.report=n.search().report,e.showAdvFilter=!1,e.preview=!!n.search().preview&&n.search().preview,n.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>'),i.isSafari=a.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),i.isFromReportCampagnName&&(e.simpleSearchFilter=i.isFromReportCampagnName,i.isFromReportCampagnName=!1),e.drp_options={ranges:{Today:[moment(),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(7,"days"),moment().subtract(1,"days").endOf("day")],"Last 30 Days":[moment().subtract(30,"days"),moment().subtract(1,"days").endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days"),endDate:moment().subtract(1,"days").endOf("day")},a.sessionStorage.report_start_date?e.drp_start=moment(a.sessionStorage.report_start_date).format("MMMM D, YYYY"):e.drp_start=e.drp_options.ranges["Last 7 Days"][0].format("MMMM D, YYYY"),a.sessionStorage.report_end_date?e.drp_end=moment(a.sessionStorage.report_end_date).format("MMMM D, YYYY"):e.drp_end=e.drp_options.ranges["Last 7 Days"][1].format("MMMM D, YYYY"),e.drp_options.startDate=moment(e.drp_start),e.drp_options.endDate=moment(e.drp_end),e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},e.callDetailRedirectUrlBuilder=function(e,t,o,i){function r(e){return{acq_callflow:"pr.provisioned_route_name",acq_campaign:"c.campaign_name",campaign_name:"c.campaign_name",acq_group:"ou.org_unit_name",keyword:"keyword",source:"dynamicsource",acq_keyword:"ck.keyword",call_flow_name:"pr.provisioned_route_name",channel:"category",ring_to_number:"cd.ring_to_name",last_page:"last_page",first_page:"first_page",medium:"medium",source_medium:"source_medium"}[e]}void 0===i&&(i="none");var n=r(e),s=r(t);return[a.location.origin+"/#/calls-details?filtertype=a","&filter="+n+",=,"+encodeURIComponent(o)+",",void 0!==s?","+s+",=,"+i.replace(/,/g,"**")+",AND":""].join("")},e.dcCharts=[],e.getSimplyFilteredData=function(){var t,o,a,i=e.urlParams.filter.toLowerCase(),r=_.filter(e.dataTableValues,function(r){return t=r.value.primaryGrouping.toLowerCase(),e.hasSecondaryGrouping?(o=r.value.secondaryGrouping.toLowerCase(),a=t+" "+o):a=t,-1!==a.indexOf(i)});"source"===e.primaryGrouping&&(e.primaryGrouping="dynamicsource");var n,s=e.backEndNameToAggKey[e.report];"dynamicsource"===e.primaryGrouping&&"source"===s&&(s="dynamicsource"),e.hasSecondaryGrouping&&(n=e.secondaryGrouping);var l=[],c=[];r.length&&_.each(r,function(t){c=_.filter(e.original.aggregated_data,function(o){var a,i=t.value.primaryGrouping;return e.hasSecondaryGrouping&&(a=t.value.secondaryGrouping),"null"==a&&(a=null),void 0!==n&&void 0!==a?o[s]==i&&o[n]==a:o[s]==i}),_.each(c,function(e){l.push(e)})}),l=_.uniq(l);e.ShowChart=!0,console.log([]),e.original.aggregated_data=l,console.log("CREATE DC OBJECTS DATA",e.original),A(e.original)},e.getErrorsAndAdvFilters=function(){e.advFDef=[],_.each(e.advFilterDefinitions,function(t){var o={};o.column=t.selected_column.value,o.comparativeOperator=p.operators[t.selected_operator.value],o.text=t.user_input,o.rule=t.rule,o.inclusivity=t.selected_inclusivity.value,e.advFDef.push(o)});var t=[],o=[];_.each(e.advFDef,function(a,i){"OR"===a.rule?(o.push(t),(t=[]).push(a)):t.push(a),i===e.advFDef.length-1&&o.push(t)});var a=[],i=[];_.each(e.dataTableValues,function(e){i.push(e.value)}),_.each(o,function(t){"source"===e.primaryGrouping&&(e.primaryGrouping="dynamicsource");var o,r=e.backEndNameToAggKey[e.report];"dynamicsource"===e.primaryGrouping&&"source"===r&&(r="dynamicsource"),e.hasSecondaryGrouping&&(o=e.secondaryGrouping);var n=e.getFilteredData(i,t),s=[];n.length&&_.each(n,function(t){s=_.filter(e.original.aggregated_data,function(a){var i,n=t.primaryGrouping;return e.hasSecondaryGrouping&&(i=t.secondaryGrouping),"null"==i&&(i=null),void 0!==o&&void 0!==i?a[r]==n&&a[o]==i:a[r]==n}),_.each(s,function(e){a.push(e)})})}),a=_.uniq(a);e.ShowChart=!0,console.log([]),e.original.aggregated_data=a,console.log("CREATE DC OBJECTS DATA",e.original),A(e.original)},e.getFilteredData=function(t,o){var a,i,r;return _.reduce(o,function(t,o){if(o.text=o.text.toString(),o.text)return _.filter(t,function(t){return i=I.scrubUserText(o.text),a=t[o.column],void 0===t[o.column]&&(o.column===e.primaryGrouping&&(a=t.primaryGrouping),o.column===e.secondaryGrouping&&(a=t.secondaryGrouping)),"average_duration"===o.column&&"contains"!==o.comparativeOperator&&(a=R(a),i=R(i)),r=I[o.comparativeOperator](a,i),N(o.inclusivity,r)})},t)},e.exportPDF=function(){$("ul[role=menu]")[0].style.display="none";var t=e.secondaryGrouping;e.secondaryGrouping="";var o=new jsPDF("p","pt","a4");o.addHTML($("#dataTableReport"),function(){o.output("datauristring")}),setTimeout(function(){o.save(e.report+"_datatable.pdf"),e.secondaryGrouping=t,$("ul[role=menu]")[0].style.display=""},2e3)};var p={};function m(){var e=p.reportNames,t=p.secondaryGroupNames,o=p.aggregate_property_keys,a={};return a[e.acq_callflow]=o.call_flow,a[e.acq_keyword]=o.keyword,a[e.acq_source]=o.source,a[e.acq_group]=o.group,a[e.acq_campaign]=o.campaign,a[t.channel]=o.channel,a[t.ring_to_number]=o.ring_to_number,a[t.last_page]=o.last_page,a[t.first_page]=o.first_page,a[t.source]=o.source,a[t.medium]=o.medium,a[t.source_medium]=o.source_medium,a}function g(t,o){var a,i,r,n=p.dataTableHeaderValues,s=(a=p.aggregate_property_keys,i=p.dataTableHeaderValues,(r={})[a.call_flow]=i.call_flow,r[a.campaign]=i.campaign,r[a.group]=i.group,r[a.keyword]=i.keyword,r[a.channel]=i.channel,r[a.ring_to_number]=i.ring_to_number,r[a.last_page]=i.last_page,r[a.first_page]=i.first_page,r[a.source]=i.source,r[a.dynamicsource]=i.dynamicsource,r[a.medium]=i.medium,r[a.source_medium]=i.source_medium,r),l=[s[t],n.total_calls,n.total_leads,n.percent_of_leads,n.avg_lead_quality,n.converted,n.conversion_percent,n.avg_duration,n.total_unique];return e.hasSecondaryGrouping&&l.splice(1,0,s[o]),l}p.reportNames={acq_campaign:"acq_campaign",acq_keyword:"acq_keyword",acq_callflow:"acq_callflow",acq_group:"acq_group",acq_source:"acq_source"},p.operators={ILIKE:"contains","=":"equals",">=":"gthan","<=":"lthan","NOT ILIKE":"contains","!=":"equals"},p.secondaryGroupNames={campaign:"campaign",keyword:"keyword",call_flow:"call_flow",channel:"channel",ring_to_number:"ring_to_number",last_page:"last_page",first_page:"first_page",source:"source",medium:"medium",source_medium:"source_medium"},p.aggregate_property_keys={call_flow_id:"provisioned_route_id",call_flow:"call_flow_name",campaign:"campaign_name",campaign_id:"campaign",group:"org_unit_name",group_id:"org_unit_id",keyword:"keyword",channel:"channel",ring_to_number:"ring_to_number",last_page:"last_page",first_page:"first_page",total_calls:"total_calls",total_leads:"lead_count",percent_of_leads:"percent_of_leads",avg_lead_quality:"avg_lead_quality",conversion_percent:"conversion_percent",avg_duration:"average_duration",unique_calls:"unique_calls",unique_percent:"unique_percent",leads:"lead_count",lead_score:"lead_sum",converted:"conversion_count",conversion_score:"conversion_sum",date:"date",duration:"duration_sum",sales_inquiries:"sales_inquiry_count",sales_score_sum:"sales_inquiry_score_sum",source:"source",dynamicsource:"dynamicsource",medium:"medium",source_medium:"source_medium",simpleSearchFilterTxt:"simpleSearch",secondaryGroupCFDimension:"secGroupDimension",reducedPrimGroup:"primaryGrouping",reducedSecGroup:"secondaryGrouping"},p.dataTableHeaderValues={call_flow:"Call Flow",campaign:"Campaign",group:"Group",keyword:"Keyword",channel:"Ad Source",ring_to_number:"Ring To Number",last_page:"Last Page",first_page:"First Page",source:"Source",dynamicsource:"dynamicsource",medium:"Medium",source_medium:"Source/Medium",total_calls:"Total Calls",total_leads:"Total Leads",percent_of_leads:"% of Leads",avg_lead_quality:"Avg Lead Quality",converted:"Conversion",conversion_percent:"Conversion %",avg_duration:"Avg Duration",total_unique:"Unique Calls"},p.reportTitleValues={call_flow:p.dataTableHeaderValues.call_flow+"s",campaign:p.dataTableHeaderValues.campaign+"s",group:p.dataTableHeaderValues.group+"s",keyword:p.dataTableHeaderValues.keyword+"s",dynamicsource:p.dataTableHeaderValues.source+"s"},p.callVolumeChartTitle={call_flow:"Call Volume by "+p.dataTableHeaderValues.call_flow,campaign:"Call Volume by "+p.dataTableHeaderValues.campaign,group:"Call Volume by "+p.dataTableHeaderValues.group,keyword:"Call Volume by "+p.dataTableHeaderValues.keyword,source:"Call Volume by "+p.dataTableHeaderValues.source,channel:"Call Volume by "+p.dataTableHeaderValues.channel};var f={acq_campaign:v,acq_keyword:function(e,t){var o=v(e,t);return o.keyword=e.keyword,o.sales_inquiry_score_sum=e.sales_inquiry_sum,o.source=e.source,o.medium=e.medium,o.source_medium=e.source_medium,o},acq_callflow:function(e,t){var o=v(e,t);return o.keyword=e.keyword,o.source=e.source,o.first_page=e.first_page,o.last_page=e.last_page,o.ring_to_number=e.ring_to_number,o},acq_group:function(e,t){var o=v(e,t);return o.source=e.source,o.medium=e.medium,o.source_medium=e.source_medium,o.org_unit_id=e.org_unit_id,o.org_unit_name=e.org_unit_name,o},acq_source:function(e,t){return{average_duration:0,avg_lead_quality:0,call_flow:e.call_flow,call_flow_name:e.call_flow_name,call_group:1,campaign_id:e.campaign_id,conversion_count:0,conversion_percent:0,conversion_sum:null,date:t+" 00:00:00",duration_sum:0,dynamicsource:e.dynamicsource,medium:e.medium,keyword:e.keyword,first_page:e.first_page,last_page:e.last_page,lead_count:0,lead_sum:null,percent_of_leads:0,sales_inquiry_count:0,sales_inquiry_sum:null,secGroupDimension:e.secGroupDimension,simpleSearch:e.simpleSearch,total_calls:0,unique_calls:0,unique_percent:0}}};function h(e,t,o){return f[o](e,t)}function v(e,t){return{average_duration:0,avg_lead_quality:0,call_flow:e.call_flow,call_flow_name:e.call_flow_name,call_group:1,campaign_id:e.campaign_id,campaign_name:e.campaign_name,channel:e.channel,conversion_count:0,conversion_percent:0,conversion_sum:null,d3datetime:e.d3datetime,date:t+" 00:00:00",duration_sum:0,lead_count:0,lead_sum:null,percent_of_leads:0,sales_inquiry_count:0,sales_inquiry_sum:null,secGroupDimension:e.secGroupDimension,simpleSearch:e.simpleSearch,total_calls:0,unique_calls:0,unique_percent:0,keyword:null}}e.advFiltersAreApplied=!1,e.simpleSearchApplied=!0;var b,w,y,S,C=_.debounce(function(){_.each(e.dcCharts,function(e){var t=.95*$(e.selector).closest("div .panel-body").innerWidth();e.chart.width(t)}),e.dc1&&e.dc1.renderAll()},50);function A(t){var o=t.aggregated_data;if(e.isEmptyDataSet=!1,o.length<1){e.isEmptyDataSet=!0;var a={call_flow:0,call_flow_name:"n/a",campaign_id:0,campaign_name:"n/a",d3datetime:null,secGroupDimension:"n/a",simpleSearch:"n/a undefined",date:moment(e.drp_start.toString(),"MMMM D, YYYY").format("YYYY-MM-DD")};o.push(h(a,moment(e.drp_start.toString(),"MMMM D, YYYY").format("YYYY-MM-DD"),e.report))}var i,r,n,s,c,d,u,m=_.chain(o).pluck("date").map(function(e){return e.split(" ")[0]}).uniq().sortBy(function(e){return moment(e,"YYYY-MM-DD").unix()}).value(),f=l.fillInDays(m,moment(e.drp_start.toString(),"MMMM D, YYYY").format("YYYY-MM-DD"),moment(e.drp_end.toString(),"MMMM D, YYYY").format("YYYY-MM-DD"),"YYYY-MM-DD"),v=_.map(f,function(t){return h(_.clone(o[0]),t,e.report)});(o=o.concat(v)).push(h(_.clone(o[0]),moment(e.drp_end.toString(),"MMMM D, YYYY").add(1,"day").format("YYYY-MM-DD"),e.report)),e.reportTitle=(i=p.aggregate_property_keys,r=p.reportTitleValues,n={},n[i.call_flow]=r.call_flow,n[i.campaign]=r.campaign,n[i.group]=r.group,n[i.keyword]=r.keyword,n[i.source]=r.source,n[i.dynamicsource]=r.dynamicsource,n)[e.primaryGrouping],e.hasSecondaryGrouping=null!==e.secondary&&"none"!==e.secondary&&void 0!==e.secondary,e.headerNames=g(e.primaryGrouping,e.secondary),e.csvHeaderNames=g(e.primaryGrouping,e.secondary),e.mappedHeaderValues=function(){var e=p.dataTableHeaderValues,t=p.aggregate_property_keys,o={};return o[e.call_flow]=t.call_flow,o[e.campaign]=t.campaign,o[e.group]=t.group,o[e.keyword]=t.keyword,o[e.channel]=t.channel,o[e.ring_to_number]=t.ring_to_number,o[e.last_page]=t.last_page,o[e.first_page]=t.first_page,o[e.source]=t.source,o[e.dynamicsource]=t.dynamicsource,o[e.medium]=t.medium,o[e.source_medium]=t.source_medium,o[e.total_calls]=t.total_calls,o[e.total_leads]=t.total_leads,o[e.percent_of_leads]=t.percent_of_leads,o[e.avg_lead_quality]=t.avg_lead_quality,o[e.converted]=t.converted,o[e.conversion_percent]=t.conversion_percent,o[e.avg_duration]=t.avg_duration,o[e.total_unique]=t.unique_calls,o}(),e.secondaryGroupSelectOptions=(s={label:"none",val:"None"},c={},d=p.aggregate_property_keys,u=p.dataTableHeaderValues,c[p.reportNames.acq_callflow]=[s,{label:d.keyword,val:u.keyword},{label:d.channel,val:u.channel},{label:d.first_page,val:u.first_page},{label:d.last_page,val:u.last_page},{label:d.ring_to_number,val:u.ring_to_number}],c[p.reportNames.acq_campaign]=[s,{label:d.call_flow,val:u.call_flow},{label:d.channel,val:u.channel}],c[p.reportNames.acq_group]=[s,{label:d.campaign,val:u.campaign},{label:d.call_flow,val:u.call_flow},{label:d.keyword,val:u.keyword},{label:d.channel,val:u.channel},{label:d.source,val:u.source},{label:d.medium,val:u.medium},{label:d.source_medium,val:u.source_medium}],c[p.reportNames.acq_keyword]=[s,{label:d.source,val:u.source},{label:d.medium,val:u.medium},{label:d.source_medium,val:u.source_medium}],c[p.reportNames.acq_source]=[s,{label:d.call_flow,val:u.call_flow},{label:d.keyword,val:u.keyword},{label:d.first_page,val:u.first_page},{label:d.last_page,val:u.last_page},{label:d.medium,val:u.medium}],c)[e.report];var b=d3.time.format("%Y-%m-%d"),w=p.aggregate_property_keys,y={};y[w.keyword]=function(e,t){t.keyword=null===t.keyword?"(no keywords)":""===t.keyword?"Not Provided":t.keyword};var S=angular.isDefined(y[e.primaryGrouping]);_.each(o,function(t){t.call_group=1,t.d3datetime=b.parse(t[w.date]),t[w.unique_percent]=k(t[w.unique_calls],t[w.total_calls]),t[w.percent_of_leads]=k(t[w.total_leads],t[w.total_calls]),t[w.avg_lead_quality]=k(t[w.lead_score],t[w.total_calls]),t[w.avg_duration]=k(t[w.duration],t[w.total_calls]),t[w.conversion_percent]=k(t[w.converted],t[w.total_calls]),t[w.simpleSearchFilterTxt]=(t[e.primaryGrouping]+" "+t[e.secondary]).toLowerCase(),S&&y[e.primaryGrouping](o,t)}),_.each(o,function(t){e.hasSecondaryGrouping?t[w.secondaryGroupCFDimension]=t[e.primaryGrouping]+"---"+t[e.secondary]:t[w.secondaryGroupCFDimension]=t[e.primaryGrouping]});var C=t.rdo[0].data.chartobjs;e.xf1=crossfilter(o),e.dc1=dc,e.ShowChart&&(e.chartsConfigs=C,e.chartsConfigs[13].dimension=e.primaryGrouping),e.dataTableValues=T(e.xf1,x,L,O),setTimeout(function(){e.horsemanFlag=!0},1e3)}function T(e,t,o,a){var i=p.aggregate_property_keys;return b&&b.dispose(),b=e.dimension(function(e){return e[i.secondaryGroupCFDimension]}),w=b.group().reduce(t,o,a),y=_.sortBy(w.top(1/0),"key"),S=_.filter(y,function(e){return e.value.count>0}),function(e){var t=p.aggregate_property_keys;function o(e){return Math.round(100*e)}return _.each(e,function(e){var a;e.value[t.avg_duration]=(a=Math.round(e.value[t.avg_duration]),moment().startOf("day").seconds(a).format("H:mm:ss")),e.value[t.avg_lead_quality]=Math.round(e.value[t.avg_lead_quality]),e.value[t.conversion_percent]=o(e.value[t.conversion_percent]),e.value[t.percent_of_leads]=o(e.value[t.percent_of_leads])}),e}(S)}a.onresize=function(){C()},e.changeDateRange=function(){u.start(),e.filterReset(),e.applyFilter(),a.sessionStorage.report_start_date=e.drp_start,a.sessionStorage.report_end_date=e.drp_end},e.changeSecondaryGrouping=function(t){e.disableAdvFilterBtn=!0,e.secondary=e.aggKeyToBackendName[t],d.resetAdvFilter(),e.advFilterDefinitions=d.getAdvFilterDefinitions(),e.simpleSearchFilter="",e.filter=void 0,e.filtertype="s",e.showAdvFilter=!1,e.ShowChart=!0,e.applyFilter()},e.changeReportParams=function(t,o){console.log("starting changeReportParams"),e.applyFilterParams(),n.url(n.path()+"?"+$.param(e.urlParams))},e.loadReportBasedOnQueryStringFlexible=function(){var t,o;console.log("starting loadReportBasedOnQueryStringFlexible"),e.backEndNameToAggKey=m(),e.aggKeyToBackendName=(t=m(),o={},_.each(t,function(e,t){o[e]=t}),o),void 0!==e.urlParams.secondary&&null!==e.urlParams.secondary&&"none"!==e.urlParams.secondary&&(e.secondary=e.aggKeyToBackendName[e.urlParams.secondary]),void 0===e.secondary&&(e.secondary=e.urlParams.secondary),r.reportAggregateDataAndRDO(e.start_date,e.end_date,e.secondary,e.report,e.filter,e.filtertype).then(function(t){console.log("inside ReportDataWebService.reportAggregateDataAndRDO"),e.aggKeyValues=p.aggregate_property_keys,e.primaryGrouping=e.backEndNameToAggKey[e.report],"source"===e.primaryGrouping&&(e.primaryGrouping="dynamicsource"),e.secondary=null!==e.urlParams.secondary&&"none"!==e.urlParams.secondary?e.backEndNameToAggKey[e.urlParams.secondary]:"none",null!==e.urlParams.secondary&&"none"!==e.urlParams.secondary&&void 0===e.secondary&&(e.secondary=e.urlParams.secondary),e.secondaryGrouping=e.secondary,e.original=t.data.json,void 0===e.urlParams.filter&&(e.ShowChart=!0),A(t.data.json),void 0!==e.urlParams.filtertype&&"s"===e.urlParams.filtertype&&void 0!==e.urlParams.filter&&""!==e.urlParams.filter?(e.getSimplyFilteredData(),e.simpleSearchFilter=e.urlParams.filter):void 0!==e.urlParams.filtertype&&"a"===e.urlParams.filtertype&&void 0!==e.urlParams.filter?e.getErrorsAndAdvFilters():e.ShowChart=!1,!0===e.showAdvFilter&&e.advFilterDefinitions.length>0?(e.advFilterDefinitions[0].user_input||0===e.advFilterDefinitions[0].user_input)&&(e.filterApplied=!0):e.simpleSearchFilter.length>0&&(e.filterApplied=!0),e.disableAdvFilterBtn=!1,e.hideDataTable=!1,u.end()})},e.filterData=null,e.resetCharts=function(){console.log("@@@@@@@@@ ResetCharts Triggered @@@@@@@@@"),e.clearSimpleFilterText(),e.urlParams.filterRule=[],e.urlParams.filter=void 0,e.urlParams.filtertype=void 0,e.dc1.filterAll(),e.dc1.redrawAll(),e.filterReset()},e.clearSimpleFilterText=function(){e.simpleSearchApplied&&(e.simpleSearchApplied=!1),e.simpleSearchFilter&&(e.simpleSearchFilter="",e.urlParams.filter="",e.urlParams.filtertype="",jQuery("#simpleChart").val(""))},e.updateDataTableWithNewFilteredDS=function(t){var o,a,i,r,n;t?e.dataTableValues=T(e.xf1,x,L,O):e.advFiltersAreApplied?e.dataTableValues=e.getDsWithAppliedAdvFilters():e.simpleSearchApplied&&e.simpleSearchFilter?e.dataTableValues=(r=e.simpleSearchFilter.toLowerCase(),n=T(e.xf1,x,L,O),_.filter(n,function(t){return o=t.value.primaryGrouping.toLowerCase(),e.hasSecondaryGrouping?(a=t.value.secondaryGrouping.toLowerCase(),i=o+" "+a):i=o,-1!==i.indexOf(r)})):e.dataTableValues=T(e.xf1,x,L,O)},e.applyAdvancedFiltersToDataGrid=function(){var t=e.validateAdvFilterDefinitions(e.advFilterDefinitions);0!==t.length?s.notify({title:"Advanced Filter Error(s)",text:t.join(""),type:"error"}):(e.advFiltersAreApplied=!0,e.updateDataTableWithNewFilteredDS())},e.getCSVData=function(t){console.log("$scope.headerNames",e.headerNames),e.headerNames[_.indexOf(e.headerNames,"Source")]="dynamicsource";var o,a=_.pluck(e.dataTableValues,"value"),r=_.map(a,function(t){var a={};return _.each(e.headerNames,function(i){e.mappedHeaderValues[i]!==e.primaryGrouping&&e.mappedHeaderValues[i]!==e.secondaryGrouping?o=e.mappedHeaderValues[i]:e.mappedHeaderValues[i]===e.primaryGrouping?o="primaryGrouping":e.mappedHeaderValues[i]===e.secondaryGrouping&&(o="secondaryGrouping"),a[i]=t[o]}),a});if(e.headerNames[_.indexOf(e.headerNames,"dynamicsource")]="Source",!i.isSafari)return r;var n="csv_data_table";"tsv"===t&&(n="tsv_data_table"),JSONToCSVConvertor(r,n,!0,t)},e.changeOptions=function(e){return"Greater than and Equals"===e?"Greater than":"Less than and Equals"===e?"Less than":e},e.getCSVDataReports=function(){console.log(e.csvHeaderNames);var t,o=_.pluck(e.dataTableValues,"value"),a=_.map(o,function(o){var a={};if(_.each(e.csvHeaderNames,function(i){e.mappedHeaderValues[i]!==e.primaryGrouping&&e.mappedHeaderValues[i]!==e.secondaryGrouping?t=e.mappedHeaderValues[i]:e.mappedHeaderValues[i]===e.primaryGrouping?t="primaryGrouping":e.mappedHeaderValues[i]===e.secondaryGrouping&&(t="secondaryGrouping"),a[i]=o[t]}),a.dynamicsource){var i=a.dynamicsource;delete a.dynamicsource,a.Source=i}return a});return e.csvHeaderNames[_.indexOf(e.csvHeaderNames,"dynamicsource")]="Source",console.log(e.csvHeaderNames),e.csvDataScheduleReport=a,a},e.unApplyAdvancedFiltersToDataGrid=function(){e.advFiltersAreApplied=!1,e.updateDataTableWithNewFilteredDS()},e.toggleFilterUsed=function(){e.advFiltersAreApplied=!e.advFiltersAreApplied,e.simpleSearchApplied=!e.simpleSearchApplied,e.updateDataTableWithNewFilteredDS(!0)};var D,I={};function N(e,t){return"include"===e?t:"exclude"===e&&!t}function k(e,t){var o=e/t;return isNaN(o)||null===o?0:o}function R(e){return 60*+(e=e.toString().split(":"))[0]*60+60*+e[1]+ +e[2]}I.gthan=function(e,t){return t=parseInt(t),!isNaN(e)&&!isNaN(t)&&e>t},I.lthan=function(e,t){return t=parseInt(t),!isNaN(e)&&!isNaN(t)&&e<t},I.contains=function(e,t){return-1!==e.toString().toLowerCase().indexOf(t)},I.equals=function(e,t){return e.toString().toLowerCase()===t.toString().toLowerCase()},I.scrubUserText=function(e){return e=e.toString(),_.replaceAll(e.trim().toLowerCase(),"%","")},e.getDsWithAppliedAdvFilters=function(){var t,o,a,i;return i=T(e.xf1,x,L,O),_.reduce(e.advFilterDefinitions,function(i,r){if(r.text)return _.filter(i,function(i){return o=I.scrubUserText(r.text),t=i.value[r.column],void 0===i.value[r.column]&&(r.column===e.primaryGrouping&&(t=i.value.primaryGrouping),r.column===e.secondaryGrouping&&(t=i.value.secondaryGrouping)),"average_duration"===r.column&&"contains"!==r.comparativeOperator&&(t=R(t),o=R(o)),a=I[r.comparativeOperator](t,o),N(r.inclusivity,a)})},i)},e.applySearchTextFilter=_.debounce(e.updateDataTableWithNewFilteredDS,0),e.validateSimpleTextFilter=function(t){void 0!==t?(e.simpleSearchApplied=!0,e.simpleSearchFilter=t,e.applyFilter()):e.simpleSearchApplied=!1};var F=p.aggregate_property_keys;function x(e,t){return D=t[F.secondaryGroupCFDimension].split("---"),e[F.reducedPrimGroup]=D[0],"Online"===e[F.reducedPrimGroup]&&(e[F.reducedPrimGroup]="Online (Generic)"),e[F.reducedSecGroup]=D[1],e[F.converted]+=t[F.converted],e[F.total_calls]+=t[F.total_calls],e[F.duration]+=t[F.duration],e[F.total_leads]+=t[F.total_leads],e[F.lead_score]+=t[F.lead_score],e[F.unique_calls]+=t[F.unique_calls],e.count+=1,e[F.percent_of_leads]=k(e[F.total_leads],e[F.total_calls]),e[F.avg_lead_quality]=k(e[F.lead_score],e[F.total_calls]),e[F.avg_duration]=k(e[F.duration],e[F.total_calls]),e[F.conversion_percent]=k(e[F.converted],e[F.total_calls]),e}function L(e,t){return D=t[F.secondaryGroupCFDimension].split("---"),e[F.reducedPrimGroup]=D[0],e[F.reducedSecGroup]=D[1],e[F.converted]-=t[F.converted],e[F.total_calls]-=t[F.total_calls],e[F.duration]-=t[F.duration],e[F.total_leads]-=t[F.total_leads],e[F.lead_score]-=t[F.lead_score],e[F.unique_calls]-=t[F.unique_calls],e.count-=1,e[F.percent_of_leads]=k(e[F.total_leads],e[F.total_calls]),e[F.avg_lead_quality]=k(e[F.lead_score],e[F.total_calls]),e[F.avg_duration]=k(e[F.duration],e[F.total_calls]),e[F.conversion_percent]=k(e[F.converted],e[F.total_calls]),e}function O(){var e={};return e[F.converted]=0,e[F.total_leads]=0,e[F.total_calls]=0,e[F.duration]=0,e[F.unique_calls]=0,e[F.lead_score]=0,e[F.conversion_percent]=0,e.count=0,e}e.reducers={initial:O,increment:x,decrement:L},e.showAdvUi=function(){e.secondary=e.aggKeyToBackendName[e.secondaryGrouping],d.resetAdvFilter(),e.advFilterDefinitions=d.getAdvFilterDefinitions(),e.showAdvFilter=!0},e.preloading=!1,e.showAdvFilter=!1,e.advancedFilterConfig={maxQuantity:5},e.extendUrlParams=function(t){e.urlParams=t.vars,angular.extend(e,t.vars),delete t.vars,delete t.showAdvFilter,angular.extend(e,t)},e.getInitialUrlParams=void d.determineInitializationMethod(e).then(function(t){e.advFilterDefinitions=d.getAdvFilterDefinitions(),e.advFilterDefinitions[0].selected_column&&(e.showAdvFilter=!0),e.extendUrlParams(t),e.ShowChart=!0,e.loadReportBasedOnQueryStringFlexible()}),e.addFilterDefinition=function(){d.addFilterDefinition(!1),e.advFilterDefinitions=d.getAdvFilterDefinitions()},e.updateOperators=function(t,o,a){d.updateOperators(t,o,a),e.advFilterDefinitions=d.getAdvFilterDefinitions()},e.applyFilterParams=function(){u.set(75);var t=d.applyFilter(e);return!!t&&(e.extendUrlParams(t),!0)},e.applyFilter=function(){u.set(50),e.applyFilterParams()&&e.loadReportBasedOnQueryStringFlexible()},e.filterReset=function(){u.set(25),d.resetAdvFilter(),e.advFilterDefinitions=d.getAdvFilterDefinitions(),e.simpleSearchFilter="",e.filter=void 0,e.filtertype="s",e.showAdvFilter=!1,e.ShowChart=!0,e.filterApplied&&(e.applyFilter(),e.filterApplied=!1)},e.removeFilterDefinition=function(t){d.removeFilterDefinition(t),e.advFilterDefinitions=d.getAdvFilterDefinitions()},e.validateInput=function(e){d.validateInput(e)}}]),function(){function e(e,t,o,a){this.display=e,this.fieldName=t,this.filterType=o,this.options=a}function t(e,t){this.operator=e,this.display=t}var o=angular.module("call-flow-settings",["report-components","angularUtils.directives.dirPagination","callflow-report-settings-webservices"]);o.filter("ucfirst",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}),o.controller("CallFlowSettingsController",["$scope","CallFlowSettingsReportWebService","pinesNotifications","$q","progressLoader","$window","filterHelper","$location","$rootScope","advFilSrvc","$compile",function(o,a,i,r,n,s,l,c,d,u,p){var m=s.localStorage.download_audio_enabled;m="boolean"==typeof m?m:void 0==m||"undefined"==m||"true"===s.localStorage.download_audio_enabled.toLowerCase(),d.download_audio_enabled!==m&&(d.download_audio_enabled=m,d.$broadcast("download_audio_setting_changed")),!0===d.is_migrated||"true"===d.is_migrated?o.is_migrated=!0:o.is_migrated=!1,o.currentPaginationId="pgCallFlow",o.simpleSearchFilter="",o.filterApplied=!1,o.horsemanFlag=!1,o.report=c.search().report,o.currentPage=1,o.pageSize=100,o.totalDataRows=0,o.total_dataset_count=void 0,o.limit=100,o.offset=0,o.filter="",o.filtertype="s",o.filterDef=[],o.exportData=!1,o.stopPagechanged=!1,o.showActualEportLink=!1,o.showExportErrorLink=!0,o.ouList=[],d.isSafari=s.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),u.getAllCustomSources(),o.preview=!!c.search().preview&&c.search().preview,o.isFromReportEngine=!!c.search().isFromReportEngine&&c.search().isFromReportEngine,c.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>');var g=!1;function f(e){var t=[];return _.map(e,function(e,o){var a={};a.key=o,a.value=e,t.push(a)}),t}(o.preview||o.isFromReportEngine)&&(g="true"===d.is_migrated,o.horsemanFlag=!0),o.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},a.getAllOus().then(function(e){if("error"==e.data.result)return console.log("Error in ","CallFlowSettingsReportWebService.getAllOus SUCCESS callback");_.each(e.data.json,function(e){var t={};t.key=e.org_unit_id,t.value=e.org_unit_name,o.ouList.push(t)})}),o.$watch("ouList",function(e){e&&(o.columnDefinitions[7].options=o.ouList)},!0),o.redirectScheduledEditor=function(){var e=moment().subtract("days",7).format("YYYY-MM-DD"),t=moment().format("YYYY-MM-DD");void 0!==o.filter&&"a"===o.filtertype&&o.filterDef,s.location.href=l.createBaseUrl(e,t,"none",o.filterDef,o.simpleSearchFilter,"callflow_setting",o.limit,o.offset)},o.pageChanged=function(e){o.horsemanFlag=!1,o.urlParams.offset=o.pageSize*(e-1),o.offset=o.urlParams.offset,console.log("URL PARAMS OFFSET",o.urlParams.offset),window.scrollTo(0,0),o.loadReportData(),o.stopPagechanged=!1},o.showNoRecordsError=function(){i.notify({title:"Export",text:"There is no data to export report.",type:"error"})},o.objectURL=function(){o.filter,o.filtertype,o.limit,o.offset},o.getUrlParams=function(){return o.urlParams={},o.applyFilterParams(),o.urlParams},o.loadReportData=function(){if(!1!==d.download_audio_enabled){n.set(75),o.paginateHeader="Loading Data...",o.isLoadingApi=!0,console.log("INSIDE LOAD REPORT DATA, $scope.urlParams:",o.urlParams),void 0!==o.filtertype&&(o.stopPagechanged=!0);var e="";if("s"==o.urlParams.filtertype)o.urlParams.filter,e=o.urlParams.filter,o.urlParams.filter.indexOf("`")>-1&&(e=o.urlParams.filter.replace(/`/g,",")),o.simpleSearchFilter=e;a.getDataTableInfo(o.urlParams).then(function(e){if(console.log("GOT TABLE INFO",e.data),"success"!==e.data.result)return console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo SUCCESS callback");var t=e.data.json;console.log(t),0===o.offset&&(o.totalDataRows=o.total_dataset_count=t.totalcnt,o.totalDataRows>100&&!0===o.stopPagechanged&&(o.currentPage=1)),o.huntingOptions={rollover:"Rollover",simultaneous:"Simultaneous Ring",overflow:"Overflow"};for(var a=0;a<t.dataset.length;a++)"VoicemailRoute"===t.dataset[a].routable_type&&(t.dataset[a].vm_enabled=""),t.dataset[a].hunt_type&&(t.dataset[a].hunt_type=o.huntingOptions[t.dataset[a].hunt_type]);o.dataTableValues=t.dataset,o.dataTableTotalCount=t.totalcnt,o.horsemanFlag=!0,o.paginateHeader="Showing "+parseInt(o.offset+1)+" - "+parseInt(o.offset+o.dataTableValues.length)+" of "+o.dataTableTotalCount,n.end(),o.isLoadingApi=!1,o.dataTableValues.length>0?(o.showActualEportLink=!0,o.showExportErrorLink=!1):(o.showActualEportLink=!1,o.showExportErrorLink=!0,o.paginateHeader="No data Found",o.isLoadingApi=!1),!0===o.showAdvFilter&&o.advFilterDefinitions.length>0?(o.advFilterDefinitions[0].user_input||0===o.advFilterDefinitions[0].user_input)&&(o.filterApplied=!0):o.simpleSearchFilter.length>0&&(o.filterApplied=!0),e.error&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo ERROR callback"),o.resizeWindow(),window.scrollTo(0,0)})}},o.dbfn={id:"provisioned_route_id",call_flow_name:"provisioned_route_name",phone_number:"number",type:"routable_type",strategy:"strategy",hunt_type:"hunt_type",ring_to:"default_ringto",ad_source:"cat_combo",custom_source1:"Custom Source 1",custom_source2:"Custom Source 2",custom_source3:"Custom Source 3",custom_source4:"Custom Source 4",custom_source5:"Custom Source 5",active:"provisioned_route_status",group_name:"org_unit_name",group_id:"org_unit_id",ou_level:"level",billing_id:"billing_id",parent_id:"org_unit_parent_id",campaign_id:"campaign_id",campaign_name:"campaign_name",dni:"dni_type",instant_insights:"instant_insights",instant_insights_config:"instant_insights_config",host_domain:"destination_url",referring_website:"referrer",html_class:"dni_element",custom_params:"custom_params",rc:"record_until",pd:"play_disclaimer",vp:"message_enabled",wm:"whisper_enabled",webhook_name:"webhook_name",voicemail:"vm_enabled"},o.routeTypes={SimpleRoute:"Simple",IvrRoute2:"IVR",PercentageBasedRoute:"Percentage",GeoRoute:"Geo Route",OutboundRoute:"Outbound",ScheduleRoute:"Schedule",VoicemailRoute:"Voicemail"},!1!==d.is_migrated&&"false"!==d.is_migrated||(o.routeTypes.SimpleRoute="SimpleRoute"),o.geoTypes={claimedState:"Claimed State",Claimed:"Claimed Zip-code",Npa:"Caller Area Code Proximity",Zipcode:"Zip-code Proximity"},o.checkVisible=function(){o.$watch("visibleColumns",function(){var e=_.filter(o.visibleColumns,function(e){return!1===e.visible}),t=_.filter(o.visibleColumns,function(e){return e.visible});_.each(e,function(e){angular.isObject(e.col)||$(".subrows_"+e.col).hide()}),_.each(t,function(e){angular.isObject(e.col)||$(".subrows_"+e.col).show()})},!0)},o.showScheduleData=function(e,t,a){if($(".subrows"+t+"_"+a).length>0)return $(".subrows"+t+"_"+a).remove(),!1;var i=e;i.schedules.push({activateVoicemail:i.vm_enabled,ringTo:i.default_ringto}),o.schedulerows="",i.schedules.forEach(function(e){var i="";e.overflowNumbers&&e.overflowNumbers[0].overflowNumber&&e.overflowNumbers.length>0&&!0===e.simultaneousRings&&(i="Simultaneous"),e.overflowNumbers&&e.overflowNumbers[0].overflowNumber&&1==e.overflowNumbers.length&&!1===e.simultaneousRings&&(i="Overflow"),e.overflowNumbers&&e.overflowNumbers[0].overflowNumber&&e.overflowNumbers.length>1&&!1===e.simultaneousRings&&(i="Rollover");var r="";void 0!==e.days&&void 0!==e.fromTime&&void 0!==e.toTime&&(r=e.days[0].id+" "+e.fromTime+" To "+e.toTime);var n=!0===e.activateVoicemail?"Yes":"No";o.schedulerows+="<tr class='subrows"+t+"_"+a+" datapoint1_"+t+"'><td class='subrows_"+o.dbfn.id+"' ></td><td class='subrows_"+o.dbfn.call_flow_name+"'> </td><td class='subrows_"+o.dbfn.phone_number+"'></td><td class='subrows_"+o.dbfn.type+"'>"+r+"</td><td class='subrows_"+o.dbfn.hunt_type+"'>"+i+"</td><td class='subrows_"+o.dbfn.ring_to+"'>"+e.ringTo+"</td><td class='subrows_"+o.dbfn.ad_source+"'></td> <td class='subrows_"+o.dbfn.custom_source1+"'></td> <td class='subrows_"+o.dbfn.custom_source2+"'></td> <td class='subrows_"+o.dbfn.custom_source3+"'></td> <td class='subrows_"+o.dbfn.custom_source4+"'></td> <td class='subrows_"+o.dbfn.custom_source5+"'></td> <td class='subrows_"+o.dbfn.active+"'></td> <td class='subrows_"+o.dbfn.group_name+"'></td> <td class='subrows_"+o.dbfn.campaign_name+"'></td><td class='subrows_"+o.dbfn.dni+"'></td> <td class='subrows_"+o.dbfn.host_domain+"'></td> <td class='subrows_"+o.dbfn.referring_website+"'></td> <td class='subrows_"+o.dbfn.html_class+"'></td><td class='subrows_"+o.dbfn.custom_params+"'></td><td class='subrows_"+o.dbfn.rc+"'></td><td class='subrows_"+o.dbfn.pd+"'></td><td class='subrows_"+o.dbfn.vp+"'></td><td class='subrows_"+o.dbfn.wm+"'></td><td class='subrows_"+o.dbfn.webhook_name+"'></td><td class='subrows_"+o.dbfn.voicemail+"'>"+n+"</td></tr>"}),$("#rowdata_"+t+"_"+a).after(p(o.schedulerows)(o)),o.checkVisible()},o.showSubData=function(e,t,i){return $(".subrows"+e).length>0?($(".subrows"+e).remove(),$(".datapoint1_"+e).length>0&&$(".datapoint1_"+e).remove(),!1):(console.log(e,t,i),o.subrows="",(!o.requestSent||o.old_routable_id!==t)&&(o.requestSent=!0,o.old_routable_id=t,void a.ivrSettings(t).then(function(t){if(o.requestSent=!1,null===t.data.err||""===t.data.err)if("IvrRoute2"===i&&void 0!==t.data.json.ivrs){t.data.json.ivrs.sort(function(e,t){return e.value-t.value});var a=function(e){var t,o,a=[],i={};keypressArray=[];for(var r=0,n=e.length;r<n;r++)i[(t=e[r]).id]=t,i[t.id].keyPath=t.key_press,i[t.id].ivrActions=[];for(var s in i)i.hasOwnProperty(s)&&((o=i[s]).parentid?(i[o.parentid].ivrActions.push(o),i[o.parentid].keyPath=i[o.parentid].keyPath+">"+o.key_press):a.push(o));return a}(t.data.json.ivrs);a=_.sortBy(a,"action_order");for(var r=[],n=0;n<a.length;n++)if(a[n].ivrActions.length>0)for(var s=0;s<a[n].ivrActions.length;s++){var l=a[n].keyPath.split(">");if(a[n].ivrActions[s].ivrActions.length)for(var c=0;c<a[n].ivrActions[s].ivrActions.length;c++){var d={isSchedule:!1},u=a[n].ivrActions[s].keyPath.split(">");u[0]=l[0]+">"+u[0]+">"+a[n].ivrActions[s].ivrActions[c].keyPath,d.keyPress=u[0],d.record_enabled=!0===a[n].ivrActions[s].ivrActions[c].record_enabled?"Yes":"No",d.message=a[n].ivrActions[s].ivrActions[c].message&&a[n].ivrActions[s].ivrActions[c].message.length>1?"Yes":"No",d.simultaneousRings=1===a[n].ivrActions[s].ivrActions[c].simultaneous_ring?"Simultaneous Ring":"Hunting Rollover",d.playDisclaimer="Yes"===d.record_enabled?a[n].ivrActions[s].ivrActions[c].play_disclaimer:"";var m=null!==a[n].ivrActions[s].ivrActions[c].target_did&&a[n].ivrActions[s].ivrActions[c].target_did.indexOf("geo_route")>-1?t.data.json.call_flow.default_ringto:a[n].ivrActions[s].ivrActions[c].target_did;d.ringToNumber="hangup"===m?"Hang Up":m,d.voicemail=!0===a[n].ivrActions[s].ivrActions[c].vm_enabled?"Yes":"No",a[n].ivrActions[s].ivrActions[c].target_did.indexOf("schedule_route")>-1&&(d.scheduleRoute=JSON.stringify(a[n].ivrActions[s].ivrActions[c].scheduleRoute),d.isSchedule=!0,d.voicemail=""),r.push(d)}else{var g={isSchedule:!1};l[0]=l[0]+">"+a[n].ivrActions[s].keyPath,g.keyPress=l[0],g.record_enabled=!0===a[n].ivrActions[s].record_enabled?"Yes":"No",g.message=a[n].ivrActions[s].message&&a[n].ivrActions[s].message.length>1?"Yes":"No",g.simultaneousRings=1===a[n].ivrActions[s].simultaneous_ring?"Simultaneous Ring":"Hunting Rollover",g.playDisclaimer="Yes"===g.record_enabled?a[n].ivrActions[s].play_disclaimer:"";var f=null!==a[n].ivrActions[s].target_did&&a[n].ivrActions[s].target_did.indexOf("geo_route")>-1?t.data.json.call_flow.default_ringto:a[n].ivrActions[s].target_did;g.ringToNumber="hangup"===f?"Hang Up":f,g.voicemail=!0===a[n].ivrActions[s].vm_enabled?"Yes":"No",a[n].ivrActions[s].target_did.indexOf("schedule_route")>-1&&(g.scheduleRoute=JSON.stringify(a[n].ivrActions[s].scheduleRoute),g.isSchedule=!0,g.voicemail=""),r.push(g)}}else{var h,v={};v.isSchedule=!1,h=void 0==a[n].keyPath?a[n].value:a[n].keyPath,v.keyPress=h,v.record_enabled=!0===a[n].record_enabled?"Yes":"No",v.message=a[n].message&&a[n].message.length>1?"Yes":"No",v.simultaneousRings=1===a[n].simultaneous_ring?"Simultaneous Ring":"Hunting Rollover",v.playDisclaimer="Yes"===v.record_enabled?a[n].play_disclaimer:"";var b=null!==a[n].target_did&&a[n].target_did.indexOf("geo_route")>-1?t.data.json.call_flow.default_ringto:a[n].target_did;v.ringToNumber="hangup"===b?"Hang Up":b,v.voicemail=!0===a[n].vm_enabled?"Yes":"No",a[n].target_did.indexOf("schedule_route")>-1&&(v.scheduleRoute=JSON.stringify(a[n].scheduleRoute),v.isSchedule=!0,v.voicemail=""),r.push(v)}r.forEach(function(t,a){o.subrows+="<tr class='subrows"+e+"' id='rowdata_"+e+"_"+a+"'><td class='subrows_"+o.dbfn.id+"' ></td><td class='subrows_"+o.dbfn.call_flow_name+"'> </td><td class='subrows_"+o.dbfn.phone_number+"'></td><td class='subrows_"+o.dbfn.type+"'> Keypress: "+t.keyPress+" </td><td class='subrows_"+o.dbfn.hunt_type+"'></td><td class='subrows_"+o.dbfn.ring_to+"' ng-if='"+t.isSchedule+" != true'>"+t.ringToNumber+"</td><td class='subrows_"+o.dbfn.ring_to+"' ng-if='"+t.isSchedule+" == true'><a ng-click='showScheduleData("+t.scheduleRoute+","+e+","+a+")'> View All </a></td><td class='subrows_"+o.dbfn.ad_source+"'></td> <td class='subrows_"+o.dbfn.custom_source1+"'></td> <td class='subrows_"+o.dbfn.custom_source2+"'></td> <td class='subrows_"+o.dbfn.custom_source3+"'></td> <td class='subrows_"+o.dbfn.custom_source4+"'></td> <td class='subrows_"+o.dbfn.custom_source5+"'></td> <td class='subrows_"+o.dbfn.active+"'></td> <td class='subrows_"+o.dbfn.group_name+"'></td> <td class='subrows_"+o.dbfn.campaign_name+"'></td><td class='subrows_"+o.dbfn.dni+"'></td> <td class='subrows_"+o.dbfn.host_domain+"'></td> <td class='subrows_"+o.dbfn.referring_website+"'></td> <td class='subrows_"+o.dbfn.html_class+"'></td><td class='subrows_"+o.dbfn.custom_params+"'></td><td class='subrows_"+o.dbfn.rc+"'>"+t.record_enabled+"</td><td class='subrows_"+o.dbfn.pd+"'>"+t.playDisclaimer+"</td><td class='subrows_"+o.dbfn.vp+"'>"+t.message+"</td><td class='subrows_"+o.dbfn.wm+"'></td><td class='subrows_"+o.dbfn.webhook_name+"'></td><td class='subrows_"+o.dbfn.voicemail+"'>"+t.voicemail+"</td></tr>"})}else if("PercentageBasedRoute"===i&&void 0!==t.data.json.ringto_percentage){var w=t.data.json.ringto_percentage;(w=_.sortBy(w,"route_order")).forEach(function(t){var a="";t.overflowNumbers&&t.overflowNumbers.length>0&&!0===t.isSimultaneousRing&&(a="Simultaneous"),t.overflowNumbers&&t.overflowNumbers.length>1&&!1===t.isSimultaneousRing&&(a="Rollover"),t.overflowNumbers&&1==t.overflowNumbers.length&&!1===t.isSimultaneousRing&&(a="Overflow");var i=!0===t.activateVoicemail?"Yes":"No";o.subrows+="<tr class='subrows"+e+"'><td class='subrows_"+o.dbfn.id+"' ></td><td class='subrows_"+o.dbfn.call_flow_name+"'> </td><td class='subrows_"+o.dbfn.phone_number+"'></td><td class='subrows_"+o.dbfn.type+"'>"+t.percentage+" % </td><td class='subrows_"+o.dbfn.hunt_type+"'>"+a+"</td><td class='subrows_"+o.dbfn.ring_to+"'>"+t.ringToNum+"</td><td class='subrows_"+o.dbfn.ad_source+"'></td> <td class='subrows_"+o.dbfn.custom_source1+"'></td> <td class='subrows_"+o.dbfn.custom_source2+"'></td> <td class='subrows_"+o.dbfn.custom_source3+"'></td> <td class='subrows_"+o.dbfn.custom_source4+"'></td> <td class='subrows_"+o.dbfn.custom_source5+"'></td> <td class='subrows_"+o.dbfn.active+"'></td> <td class='subrows_"+o.dbfn.group_name+"'></td> <td class='subrows_"+o.dbfn.campaign_name+"'></td><td class='subrows_"+o.dbfn.dni+"'></td> <td class='subrows_"+o.dbfn.host_domain+"'></td> <td class='subrows_"+o.dbfn.referring_website+"'></td> <td class='subrows_"+o.dbfn.html_class+"'></td><td class='subrows_"+o.dbfn.custom_params+"'></td><td class='subrows_"+o.dbfn.rc+"'></td><td class='subrows_"+o.dbfn.pd+"'></td><td class='subrows_"+o.dbfn.vp+"'></td><td class='subrows_"+o.dbfn.wm+"'></td><td class='subrows_"+o.dbfn.webhook_name+"'></td><td class='subrows_"+o.dbfn.voicemail+"'>"+i+"</td></tr>"})}else if("ScheduleRoute"===i&&void 0!==t.data.json.schedule){var y=t.data.json.schedule,S=t.data.json.schedule.default_ringto,C=t.data.json.schedule.vm_enabled;y.schedule.push({activateVoicemail:C,ringTo:S}),y.schedule.forEach(function(t){var a="";t.overflowNumbers&&t.overflowNumbers[0].overflowNumber&&t.overflowNumbers.length>0&&!0===t.simultaneousRings&&(a="Simultaneous"),t.overflowNumbers&&t.overflowNumbers[0].overflowNumber&&1==t.overflowNumbers.length&&!1===t.simultaneousRings&&(a="Overflow"),t.overflowNumbers&&t.overflowNumbers[0].overflowNumber&&t.overflowNumbers.length>1&&!1===t.simultaneousRings&&(a="Rollover");var i="";void 0!==t.days&&void 0!==t.fromTime&&void 0!==t.toTime&&(i=t.days[0].id+" "+t.fromTime+" To "+t.toTime);var r=!0===t.activateVoicemail?"Yes":"No";o.subrows+="<tr class='subrows"+e+"'><td class='subrows_"+o.dbfn.id+"' ></td><td class='subrows_"+o.dbfn.call_flow_name+"'> </td><td class='subrows_"+o.dbfn.phone_number+"'></td><td class='subrows_"+o.dbfn.type+"'>"+i+"</td><td class='subrows_"+o.dbfn.hunt_type+"'>"+a+"</td><td class='subrows_"+o.dbfn.ring_to+"'>"+t.ringTo+"</td><td class='subrows_"+o.dbfn.ad_source+"'></td> <td class='subrows_"+o.dbfn.custom_source1+"'></td> <td class='subrows_"+o.dbfn.custom_source2+"'></td> <td class='subrows_"+o.dbfn.custom_source3+"'></td> <td class='subrows_"+o.dbfn.custom_source4+"'></td> <td class='subrows_"+o.dbfn.custom_source5+"'></td> <td class='subrows_"+o.dbfn.active+"'></td> <td class='subrows_"+o.dbfn.group_name+"'></td> <td class='subrows_"+o.dbfn.campaign_name+"'></td><td class='subrows_"+o.dbfn.dni+"'></td> <td class='subrows_"+o.dbfn.host_domain+"'></td> <td class='subrows_"+o.dbfn.referring_website+"'></td> <td class='subrows_"+o.dbfn.html_class+"'></td><td class='subrows_"+o.dbfn.custom_params+"'></td><td class='subrows_"+o.dbfn.rc+"'></td><td class='subrows_"+o.dbfn.pd+"'></td><td class='subrows_"+o.dbfn.vp+"'></td><td class='subrows_"+o.dbfn.wm+"'></td><td class='subrows_"+o.dbfn.webhook_name+"'></td><td class='subrows_"+o.dbfn.voicemail+"'>"+r+"</td></tr>"})}else o.subrows+="<tr class='subrows"+e+"'><td colspan='18'> No data found</td></tr>";$("#rowdataitem"+e).after(p(o.subrows)(o)),o.checkVisible()})))},o.visibleColumnsIndicies={},o.visibleColumnsIndicies[o.dbfn.id]=0,o.visibleColumnsIndicies[o.dbfn.call_flow_name]=1,o.visibleColumnsIndicies[o.dbfn.phone_number]=2,o.visibleColumnsIndicies[o.dbfn.type]=3,o.visibleColumnsIndicies[o.dbfn.hunt_type]=4,o.visibleColumnsIndicies[o.dbfn.ring_to]=5,o.visibleColumnsIndicies[o.dbfn.ad_source]=6,o.visibleColumnsIndicies[o.dbfn.custom_source1]=7,o.visibleColumnsIndicies[o.dbfn.custom_source2]=8,o.visibleColumnsIndicies[o.dbfn.custom_source3]=9,o.visibleColumnsIndicies[o.dbfn.custom_source4]=10,o.visibleColumnsIndicies[o.dbfn.custom_source5]=11,o.visibleColumnsIndicies[o.dbfn.active]=12,o.visibleColumnsIndicies[o.dbfn.group_name]=13,o.visibleColumnsIndicies[o.dbfn.campaign_name]=14,o.visibleColumnsIndicies[o.dbfn.dni]=15,o.visibleColumnsIndicies[o.dbfn.instant_insights]=16,o.visibleColumnsIndicies[o.dbfn.instant_insights_config]=17,o.visibleColumnsIndicies[o.dbfn.host_domain]=18,o.visibleColumnsIndicies[o.dbfn.referring_website]=19,o.visibleColumnsIndicies[o.dbfn.html_class]=20,o.visibleColumnsIndicies[o.dbfn.custom_params]=21,o.visibleColumnsIndicies[o.dbfn.rc]=22,o.visibleColumnsIndicies[o.dbfn.pd]=23,o.visibleColumnsIndicies[o.dbfn.vp]=24,o.visibleColumnsIndicies[o.dbfn.wm]=25,o.visibleColumnsIndicies[o.dbfn.webhook_name]=26,o.visibleColumnsIndicies[o.dbfn.voicemail]=27,o.visibleColumns=[],o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.id]]={truncate:!1,visible:!0,label:"ID",col:o.dbfn.id,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.call_flow_name]]={truncate:!1,visible:!0,label:"Tracking Number Name",col:o.dbfn.call_flow_name,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.phone_number]]={truncate:!1,visible:!0,label:"Tracking Number",col:o.dbfn.phone_number,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.type]]={truncate:!1,visible:!0,label:"Type",col:o.dbfn.type,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.hunt_type]]={truncate:!1,visible:g,label:"Hunt Type",col:o.dbfn.hunt_type,show:"true"===d.is_migrated||!0===d.is_migrated},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.ring_to]]={truncate:!1,visible:!0,label:"Ring-to Phone Number",col:o.dbfn.ring_to,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.ad_source]]={truncate:!1,visible:!0,label:"Ad Source",col:o.dbfn.ad_source,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_source1]]={truncate:!1,visible:g,label:"Custom Source 1",col:o.dbfn.custom_source1,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_source2]]={truncate:!1,visible:g,label:"Custom Source 2",col:o.dbfn.custom_source2,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_source3]]={truncate:!1,visible:g,label:"Custom Source 3",col:o.dbfn.custom_source3,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_source4]]={truncate:!1,visible:g,label:"Custom Source 4",col:o.dbfn.custom_source4,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_source5]]={truncate:!1,visible:g,label:"Custom Source 5",col:o.dbfn.custom_source5,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.active]]={truncate:!1,visible:!0,label:"Status",col:o.dbfn.active,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.group_name]]={truncate:!1,visible:!0,label:"Group Name",col:o.dbfn.group_name,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.campaign_name]]={truncate:!1,visible:!0,label:"Campaign name",col:o.dbfn.campaign_name,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.dni]]={truncate:!1,visible:!0,label:"DNI",col:o.dbfn.dni,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.instant_insights]]={truncate:!1,visible:!1,label:"Instant Insights",col:o.dbfn.instant_insights,show:"true"===d.is_migrated||!0===d.is_migrated},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.instant_insights_config]]={truncate:!1,visible:!1,label:"Instant Insights Config",col:o.dbfn.instant_insights_config,show:"true"===d.is_migrated||!0===d.is_migrated},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.host_domain]]={truncate:!1,visible:!1,label:"Host Domain",col:o.dbfn.host_domain,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.referring_website]]={truncate:!1,visible:!1,label:"Referring Website",col:o.dbfn.referring_website,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.html_class]]={truncate:!1,visible:!1,label:"HTML Class",col:o.dbfn.html_class,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.custom_params]]={truncate:!1,visible:!1,label:"Custom Params",col:o.dbfn.custom_params,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.rc]]={truncate:!0,visible:!0,label:"Record Call",col:o.dbfn.rc,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.pd]]={truncate:!0,visible:!0,label:"Play Disclaimer",col:o.dbfn.pd,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.vp]]={truncate:!0,visible:!0,label:"Voice Prompt",col:o.dbfn.vp,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.wm]]={truncate:!0,visible:!0,label:"Whisper Message",col:o.dbfn.wm,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.webhook_name]]={truncate:!0,visible:g,label:"Pre-Call Webhook",col:o.dbfn.webhook_name,show:!0},o.visibleColumns[o.visibleColumnsIndicies[o.dbfn.voicemail]]={truncate:!0,visible:g,label:"Voicemail",col:o.dbfn.voicemail,show:"true"===d.is_migrated||!0===d.is_migrated},o.filterTypes={inputNumber:{comparativeOperators:[new t("eq",l.comparitiveOperatorsHash.eq),new t("gt",l.comparitiveOperatorsHash.gt),new t("lt",l.comparitiveOperatorsHash.lt)],fieldType:"input"},inputText:{comparativeOperators:[new t("eq",l.comparitiveOperatorsHash.eq),new t("contains",l.comparitiveOperatorsHash.contains)],fieldType:"input"},inputTextNumber:{comparativeOperators:[new t("eq",l.comparitiveOperatorsHash.eq),new t("contains",l.comparitiveOperatorsHash.contains)],fieldType:"input"},dropdown:{comparativeOperators:[new t("eq",l.comparitiveOperatorsHash.eq)],fieldType:"dropdown"}},o.columnDefinitions=[new e("ID",o.dbfn.id,"inputNumber"),new e("Tracking Number Name",o.dbfn.call_flow_name,"inputText"),new e("Tracking Number",o.dbfn.phone_number,"inputText"),new e("Type",o.dbfn.type,"dropdown",f({SimpleRoute:"Simple",tollfree:"TollFree","Geo Route":"Geo Route",IvrRoute2:"IVR",PercentageBasedRoute:"Percentage",ScheduleRoute:"Schedule",hangup:"Hang Up",number_pool:"Number Pool",OutboundRoute:"Outbound"})),new e("Hunt Type",o.dbfn.hunt_type,"dropdown",f({simultaneous:"Hunt: Simultaneous Ring",rollover:"Hunt: Rollover",overflow:"Hunt: Overflow"})),new e("Ring-to Phone Number",o.dbfn.ring_to,"inputTextNumber"),new e("Ad Source",o.dbfn.ad_source,"inputText"),new e("Custom Source 1",o.dbfn.custom_source1,"inputText"),new e("Custom Source 2",o.dbfn.custom_source2,"inputText"),new e("Custom Source 3",o.dbfn.custom_source3,"inputText"),new e("Custom Source 4",o.dbfn.custom_source4,"inputText"),new e("Custom Source 5",o.dbfn.custom_source5,"inputText"),new e("Status",o.dbfn.active,"dropdown",f({active:"Active",inactive:"Inactive"})),new e("Group Name",o.dbfn.group_id,"dropdown",{}),new e("Campaign Name",o.dbfn.campaign_name,"inputText"),new e("DNI",o.dbfn.dni,"dropdown",f({source:"source",session:"session",url:"url"})),new e("Instant Insights",o.dbfn.instant_insights,"inputText"),new e("Instant Insights Config",o.dbfn.instant_insights_config,"inputText"),new e("Host Domain",o.dbfn.host_domain,"inputText"),new e("Referring Website",o.dbfn.referring_website,"inputText"),new e("HTML Class",o.dbfn.html_class,"inputText"),new e("Custom Parameters",o.dbfn.custom_params,"inputText"),new e("RC",o.dbfn.rc,"dropdown",f({1:"Yes",0:"No"})),new e("PD",o.dbfn.pd,"dropdown",f({before:"Before",never:"Never",after:"After"})),new e("VP",o.dbfn.vp,"dropdown",f({1:"Yes",0:"No"})),new e("WM",o.dbfn.wm,"dropdown",f({1:"Yes",0:"No"})),new e("Pre-Call Webhook",o.dbfn.webhook_name,"inputText"),new e("Voicemail",o.dbfn.voicemail,"dropdown",f({1:"Yes",0:"No"}))],o.validateAdvFilters=function(e){var t=[];return _.every(e,function(e){var a=_.find(o.columnDefinitions,function(t){return t.fieldName===e.column});return"ID"===a.display&&parseInt(e.text)>9999&&t.push("Please enter valid ID."),"inputNumber"!==a.filterType&&"inputTextNumber"!==a.filterType||!isNaN(e.text)&&null!==e.text&&!Array.isArray(e.text)})||t.push("You're giving a non-numerical input to a field that requires a number."),t},o.getCSVData=function(e){o.filter;o.urlParams.limit=5e4,o.urlParams.exportData=!0;var t=[];!0===o.is_migrated||"true"===o.is_migrated?o.headerNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI Type","Instant Insights","Instant Insight Config","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook","Hunt Type","Voicemail"]:o.headerNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI Type","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook"];var i=r.defer();if(a.getDataTableInfo(o.urlParams).success(function(o){"success"!==o.result&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo SUCCESS callback");if(t=finalizaDataToExport(o.json.dataset),i.resolve(t),d.isSafari){var a="csv_callflowSettingsReport";"tsv"===e&&(a="tsv_callflowSettingsReport"),i.resolve(JSONToCSVConvertor(t,a,!0,e))}}).error(function(e){e.data.error&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo ERROR callback")}),!d.isSafari)return i.promise},o.getCSVDataReports=function(){o.filter;var e=[];!0===o.is_migrated||"true"===o.is_migrated?o.csvHeaderNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI","Instant Insights","Instant Insights Config","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook","Hunt Type","Voicemail"]:o.csvHeaderNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook"],o.urlParams.limit=5e4,o.urlParams.exportData=!0;var t=r.defer();return a.getDataTableInfo(o.urlParams).success(function(a){"success"!==a.result&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo SUCCESS callback");e=finalizaDataToExport(a.json.dataset),t.resolve(e),o.csvDataScheduleReport=e}).error(function(e){e.error&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo ERROR callback")}),t.promise},o.getExcelData=function(){o.limit=1e5,o.applyFilterParams();o.filter;o.exportData=!0;var e=[];!0===o.is_migrated||"true"===o.is_migrated?o.headerNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI","Instant Insights","Instant Insights Config","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook","Hunt Type","Voicemail"]:o.headerNames=["ID","Tracking Number Name","Tracking Number","Type","Keypress","Day And Time","%","Ring-to","Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Medium","Status","Group Name","Campaign Name","DNI","Host Domain","Referring Website","HTML Class","Custom Parameters","RC","PD","VP","WM","Pre-Call Webhook"];var t=r.defer();return a.getDataTableInfo(o.urlParams).success(function(o){"success"!==o.result&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo SUCCESS callback");e=finalizaDataToExport(o.json.dataset),alasql('SELECT * INTO XLSX("xls_data_table.xlsx",{sheetid:"Sheet name",headers:true}) FROM ?',[e]),t.resolve()}).error(function(e){e.data.error&&console.log("Error in ","CallFlowSettingsReportWebService.getDataTableInfo ERROR callback")}),t.promise},o.getCSVData_old=function(){var e=[{},{},{}];e[0][o.dbfn.id]=1,e[0][o.dbfn.call_flow_name]="Happy Bar and Grill",e[0][o.dbfn.phone_number]="123-123-1234",e[0][o.dbfn.type]="IRA",e[0][o.dbfn.ring_to]="VIEW ALL LINK",e[0][o.dbfn.ad_source]="Chipotle",e[0][o.dbfn.active]=1,e[0][o.dbfn.group_name]="Hannibal Lecter",e[0][o.dbfn.campaign_name]="Fish and Pastries",e[0][o.dbfn.dni]="what goes here?",e[0][o.dbfn.host_domain]="google.com",e[0][o.dbfn.referring_website]="www.bing.com/porkchops",e[0][o.dbfn.html_class]="right_hurr",e[0][o.dbfn.custom_params]="q=10,aaa=56",e[0][o.dbfn.rc]="happy day what!?",e[0][o.dbfn.pd]="happy day what!?",e[0][o.dbfn.vp]=0,e[0][o.dbfn.wm]=1,e[1][o.dbfn.id]=22,e[1][o.dbfn.call_flow_name]="Happy Bar and Grill22",e[1][o.dbfn.phone_number]="123-123-1234",e[1][o.dbfn.type]="IVR22",e[1][o.dbfn.ring_to]="VIEW22 ALL LINK2",e[1][o.dbfn.ad_source]="Chip22otle22",e[1][o.dbfn.active]=1,e[1][o.dbfn.group_name]="Hannib22al Lecterzz2",e[1][o.dbfn.campaign_name]="Fi22sh and GAGAH",e[1][o.dbfn.dni]="what goes here?",e[1][o.dbfn.host_domain]="google.com",e[1][o.dbfn.referring_website]="www.bing.com/porkchops",e[1][o.dbfn.html_class]="right_hurr",e[1][o.dbfn.custom_params]="q=10,aaa=56",e[1][o.dbfn.rc]="happy 22day what!?",e[1][o.dbfn.pd]="happy 22day what!?",e[1][o.dbfn.vp]=1,e[1][o.dbfn.wm]=0;var t=_.filter(o.visibleColumns,function(e){return e.visible});return o.headerNames=_.map(t,function(e){return e.label}),_.each(e,function(e,o,a){var i={};_.each(t,function(t){i[t.label]=e[t.col]}),a[o]=i}),console.log(e),e},finalizaDataToExport=function(e){console.log("datata:",e);var t=[],a=[],i=[];return!0===d.is_migrated||"true"===d.is_migrated?o.is_migrated=!0:o.is_migrated=!1,_.each(e,function(e){var r=[null,null];""!==e.cat_combo&&e.cat_combo&&e.cat_combo&&(r=e.cat_combo.split(":")),1==e.instant_insights?e.instant_insights="Yes":e.instant_insights="No";var n="Yes"==e.record_call?"Yes":"No",s=e.play_disclaimer,l=e.message_enabled?"Yes":"No",c="";e.dni_type&&(c=e.custom_params);var u=e.number;e.number||(u="Number Pool");var p=" ",m=e.default_ringto;if(e.target_did&&"PercentageBasedRoute"===e.routable_type)m=e.target_did,vm_enabled=e.percentage_vm_enabled;else if(e.ivr_target_did&&"IvrRoute2"===e.routable_type)m=e.ivr_target_did;else if(e.schedule_target_did&&"ScheduleRoute"===e.routable_type){m=e.schedule_target_did;var g=e.from_time,f=e.to_time,h=+g.substr(0,2),v=+f.substr(0,2),_=v%12||12,b=h<12||24===h?"AM":"PM",w=v<12||24===v?"AM":"PM";g=(h%12||12)+g.substr(2,3)+b,f=_+f.substr(2,3)+w,p=e.days+" "+g+" To "+f,vm_enabled=e.schedule_vm_enabled}m&&m.indexOf("geo_route")>-1&&(m=e.default_ringto);var y={ID:e.provisioned_route_id,"Tracking Number Name":e.provisioned_route_name,"Tracking Number":u,Type:o.routeTypes[e.routable_type]?o.routeTypes[e.routable_type]:e.routable_type,Keypress:e.ivr_value,"Day And Time":p,"%":e.percentage,"Ring-to":m,Source:r[0],"Custom Source 1":e["Custom Source 1"],"Custom Source 2":e["Custom Source 2"],"Custom Source 3":e["Custom Source 3"],"Custom Source 4":e["Custom Source 4"],"Custom Source 5":e["Custom Source 5"],Medium:r[1],Status:e.provisioned_route_status,"Group Name":e.org_unit_name,"Campaign Name":e.campaign_name,DNI:e.dni_type,"Instant Insight":e.instant_insights,"Instant Insight Config":e.instant_insights_config?e.instant_insights_config:" ","Host Domain":e.destination_url,"Referring Website":e.referrer,"HTML Class":e.dni_element,"Custom Parameters":c,RC:"IvrRoute2"===e.routable_type?" ":n,PD:"IvrRoute2"===e.routable_type?" ":s,VP:"IvrRoute2"===e.routable_type?" ":l,WM:"IvrRoute2"===e.routable_type?" ":e.whisper_enabled&&"IvrRoute2"!==e.routable_type&&"hangup"!==e.default_ringto?"Yes":"No","Pre-Call Webhook":e.webhook_name};if(!0===d.is_migrated||"true"===d.is_migrated?(y["Hunt Type"]=e.hunt_type?e.hunt_type:" ","PercentageBasedRoute"===e.routable_type?y.Voicemail=e.percentage_vm_enabled?"Yes":"No":"ScheduleRoute"==e.routable_type?y.Voicemail=e.schedule_vm_enabled?"Yes":"No":y.Voicemail=e.vm_enabled?"Yes":"No"):null!==y.Type&&y.Type.startsWith("GeoRoute")&&(y.Type="Geo Route"),t.push(y),-1===a.indexOf(e.provisioned_route_id)&&e.sch_ringto&&"ScheduleRoute"==e.routable_type){var S={};Object.keys(y).forEach(function(e){S[e]=y[e]}),S["Ring-to"]=e.sch_ringto,S["Day And Time"]="",S.Voicemail=!0===e.sch_enabled?"Yes":"No",i.push(e.sch_ringto),S["Hunt Type"]="",t.push(S)}a.push(e.provisioned_route_id)}),t},o.preloading=!1,o.showAdvFilter=!1,o.advancedFilterConfig={maxQuantity:5},o.extendUrlParams=function(e){n.set(50),"s"===e.vars.filtertype&&(o.simpleSearchFilter=e.vars.filter),o.urlParams=e.vars,angular.extend(o,e.vars),delete e.vars,angular.extend(o,e)},o.getInitialUrlParams=(n.start(),void u.determineInitializationMethod(o).then(function(e){n.set(25),o.advFilterDefinitions=u.getAdvFilterDefinitions(),o.advFilterDefinitions.length>0&&o.advFilterDefinitions[0].selected_column&&(o.showAdvFilter=!0),o.extendUrlParams(e),o.loadReportData()})),o.addFilterDefinition=function(){u.addFilterDefinition(!1),o.advFilterDefinitions=u.getAdvFilterDefinitions()},o.updateOperators=function(e,t,a){u.updateOperators(e,t,a),o.advFilterDefinitions=u.getAdvFilterDefinitions()},o.applyFilterParams=function(){n.set(25);var e=u.applyFilter(o);return!!e&&(o.extendUrlParams(e),!0)},o.applyFilter=function(){o.horsemanFlag=!1,o.applyFilterParams()&&o.loadReportData()},o.filterReset=function(){u.resetAdvFilter(),o.advFilterDefinitions=u.getAdvFilterDefinitions(),o.simpleFilterText="",o.filtertype="s",o.showAdvFilter=!1,o.filter="",o.filterApplied&&(o.applyFilter(),o.filterApplied=!1)},o.removeFilterDefinition=function(e){u.removeFilterDefinition(e),o.advFilterDefinitions=u.getAdvFilterDefinitions()},o.validateInput=function(e){u.validateInput(e)}}])}(),function(){function e(e,t,o,a){this.display=e,this.fieldName=t,this.filterType=o,this.options=a}angular.module("group_activity",[]).filter("megaNumber",function(){return function(e,t){if(null===e)return null;if(0===e)return"0";(!t||t<0)&&(t=2);for(var o=Math.abs(e),a=Math.pow(10,t),i=e<0,r="",n=[{key:"Q",value:Math.pow(10,15)},{key:"T",value:Math.pow(10,12)},{key:"B",value:Math.pow(10,9)},{key:"M",value:Math.pow(10,6)}],s=0;s<n.length;s++){var l=o/n[s].value;if((l=Math.round(l*a)/a)>=1){o=l,r=n[s].key;break}}return(i?"-":"")+o+r}}).filter("noFractionCurrency",["$filter","$locale",function(e,t){var o=e("currency"),a=t.NUMBER_FORMATS;return function(e,t){var i=o(e,t);if(e>=0&&null!==i){var r=i.indexOf(a.DECIMAL_SEP);return i.substring(0,r)}return"$"+e}}]).controller("groupActivityController",["$scope","$http","$routeParams","$window","$rootScope","GroupActivitySettingsReportWebservices","$location","pinesNotifications","DateRangeFiller","$q","CallFlowSettingsReportWebService","paginationService","advFilSrvc","progressLoader",function(t,o,a,i,r,n,s,l,c,d,u,p,m,g){"use strict";var f=i.localStorage.download_audio_enabled;function h(e){return _.map(e,function(e){null===e.tracking_number&&(e.tracking_number="Number Pool")}),e}function v(e){return{none:w,call_flow:y,campaign:S}[void 0===t.secondary||0===t.secondary.length?"none":t.secondary](e)}function b(){return t.urlParams.exportData=!0,t.urlParams.limit=1e5,n.getDataTableInfo($.param(t.urlParams))}function w(e){var o=[];return _.each(e,function(e){!0===t.is_migrated||"true"===t.is_migrated?o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Voicemail:e[t.groupActivityMapping.gridBackendPropertyNames.voice_mail],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]}):o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]})}),o}function y(e){var o=[];return _.each(e,function(e){!0===t.is_migrated||"true"===t.is_migrated?o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],"Traking Number":null===e[t.groupActivityMapping.gridBackendPropertyNames.tracking_num]?"Number Pool":e[t.groupActivityMapping.gridBackendPropertyNames.tracking_num],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Voicemail:e[t.groupActivityMapping.gridBackendPropertyNames.voice_mail],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]}):o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],"Traking Number":null===e[t.groupActivityMapping.gridBackendPropertyNames.tracking_num]?"Number Pool":e[t.groupActivityMapping.gridBackendPropertyNames.tracking_num],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]})}),o}function S(e){var o=[];return _.each(e,function(e){!0===t.is_migrated||"true"===t.is_migrated?o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],Campaign:e[t.groupActivityMapping.gridBackendPropertyNames.campaign],"Campaign Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.camp_ext_id],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Voicemail:e[t.groupActivityMapping.gridBackendPropertyNames.voice_mail],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]}):o.push({"'ID":e[t.groupActivityMapping.gridBackendPropertyNames.ouid],Group:e[t.groupActivityMapping.gridBackendPropertyNames.group],"Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.ext_id],Campaign:e[t.groupActivityMapping.gridBackendPropertyNames.campaign],"Campaign Ext ID":e[t.groupActivityMapping.gridBackendPropertyNames.camp_ext_id],"Calls (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.calls],"Billable Minutes (GMT)":e[t.groupActivityMapping.gridBackendPropertyNames.billable_mintes],Leads:e[t.groupActivityMapping.gridBackendPropertyNames.leads],Conversions:e[t.groupActivityMapping.gridBackendPropertyNames.conversion],"Call Value":e[t.groupActivityMapping.gridBackendPropertyNames.call_value],Unique:e[t.groupActivityMapping.gridBackendPropertyNames.unique],Answered:e[t.groupActivityMapping.gridBackendPropertyNames.answered]})}),o}f="boolean"==typeof f?f:void 0==f||"undefined"==f||"true"===i.localStorage.download_audio_enabled.toLowerCase(),r.download_audio_enabled!==f&&(r.download_audio_enabled=f,r.$broadcast("download_audio_setting_changed")),t.isLoadingApi=!0,t.hidePaginationControls=!1,t.currentPaginationId="gaReport",t.hideDataTable=!1,t.filterApplied=!1,t.horsemanFlag=!1,t.simpleSearchFilter="",t.report=s.search().report,t.drp_start=moment().subtract(7,"days").format("MMMM D, YYYY"),t.drp_end=moment().subtract(1,"days").endOf("day"),t.preview=!!s.search().preview&&s.search().preview,s.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>'),r.isSafari=i.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),!0===r.is_migrated||"true"===r.is_migrated?t.is_migrated=!0:t.is_migrated=!1,t.roleId=r.roleId,t.reportTitle="Group Activity",t.groupActivityMapping={},t.secondary,t.pageSize=100,t.offset=0,t.showActualEportLink=!1,t.showExportErrorLink=!0,t.ouList=[],t.whichScheduleReport="none",t.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},t.drp_options={ranges:{Today:[moment(),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days"),moment().subtract(0,"days").endOf("day")],"Last 30 Days":[moment().subtract(29,"days"),moment().subtract(0,"days").endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days"),endDate:moment().subtract(1,"days").endOf("day")},i.sessionStorage.report_start_date?t.drp_start=moment(i.sessionStorage.report_start_date).format("MMMM D, YYYY"):t.drp_start=t.drp_options.ranges["Last 7 Days"][0].format("MMMM D, YYYY"),i.sessionStorage.report_end_date?t.drp_end=moment(i.sessionStorage.report_end_date).format("MMMM D, YYYY"):t.drp_end=t.drp_options.ranges["Last 7 Days"][1].format("MMMM D, YYYY"),t.drp_options.startDate=moment(t.drp_start),t.drp_options.endDate=moment(t.drp_end),t.redirectScheduledEditor=function(){t.applyFilterParams(),t.loadIntialReportData()},t.currentPage=1,t.groupActivityMapping.summaryGridMapping={total_calls:"Total Calls (GMT)",bill_minutes:"Billable Minutes (GMT)",total_leads:"Total Leads",conversion:"Conversions",call_value:"Total Call Value",unique_calls:"Unique Calls"},t.groupActivityMapping.secondaryGrouping=[{label:"none",val:"None"},{label:"call_flow",val:"Tracking Number"},{label:"campaign",val:"Campaign"}],t.groupActivityMapping.secondaryGroupingColumn={call_flow:["call_flow","tracking_num"],campaign:["campaign","camp_ext_id"]},t.groupActivityMapping.secondaryGroupingAdFiter={call_flow:"inputText",tracking_num:"inputText",campaign:"inputText",camp_ext_id:"inputText"},t.groupActivityMapping.secondaryGroupingHref={none:"",call_flow:"pr.provisioned_route_name",campaign:"c.campaign_name"},t.emptyAsZero=function(e){return void 0===e||null===e?0:e},t.groupActivityMapping.hrefClickableMethod=function(e,t,o,a){var r="#/calls-details?filtertype=a&filter=ou.org_unit_name,=,"+encodeURIComponent(t)+",";console.log(e,o,a),"none"!==e&&(r=r+","+o+",=,"+a+",AND"),i.open(encodeURI(r))},!0===t.is_migrated||"true"===t.is_migrated?(t.groupActivityMapping.gridBackendPropertyNames={ouid:"org_unit_id",group:"org_unit_name",ext_id:"org_unit_ext_id",call_flow:"call_flow",tracking_num:"tracking_number",calls:"total_calls",call_value:"call_value",unique:"unique_calls",voice_mail:"voicemail",answered:"answered",billable_mintes:"billable_mintes",conversion:"conversion",campaign:"campaign_name",camp_ext_id:"campaign_ext_id",leads:"leads"},t.groupActivityMapping.dataTableHeaderValues={ouid:"ID",group:"Group",ext_id:"Ext ID",tracking_num:"Tracking Number",calls:"Calls (GMT)",billable_mintes:"Billable Minutes (GMT)",conversion:"Conversions",call_value:"Call Value",unique:"Unique",voice_mail:"Voicemail",answered:"Answered",campaign:"Campaign",camp_ext_id:"Campaign Ext ID",leads:"Leads"},t.columnDefinitions=[new e(t.groupActivityMapping.dataTableHeaderValues.ouid,"ouid","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.group,"group","dropdown"),new e(t.groupActivityMapping.dataTableHeaderValues.ext_id,"ext_id","inputText"),new e(t.groupActivityMapping.dataTableHeaderValues.calls,"calls","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.billable_mintes,"billable_mintes","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.leads,"leads","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.conversion,"conversion","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.call_value,"call_value","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.unique,"unique","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.voice_mail,"voice_mail","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.answered,"answered","inputNumber")]):(t.groupActivityMapping.gridBackendPropertyNames={ouid:"org_unit_id",group:"org_unit_name",ext_id:"org_unit_ext_id",call_flow:"call_flow",tracking_num:"tracking_number",calls:"total_calls",call_value:"call_value",unique:"unique_calls",answered:"answered",billable_mintes:"billable_mintes",conversion:"conversion",campaign:"campaign_name",camp_ext_id:"campaign_ext_id",leads:"leads"},t.groupActivityMapping.dataTableHeaderValues={ouid:"ID",group:"Group",ext_id:"Ext ID",tracking_num:"Tracking Number",calls:"Calls (GMT)",billable_mintes:"Billable Minutes (GMT)",conversion:"Conversions",call_value:"Call Value",unique:"Unique",answered:"Answered",campaign:"Campaign",camp_ext_id:"Campaign Ext ID",leads:"Leads"},t.columnDefinitions=[new e(t.groupActivityMapping.dataTableHeaderValues.ouid,"ouid","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.group,"group","dropdown"),new e(t.groupActivityMapping.dataTableHeaderValues.ext_id,"ext_id","inputText"),new e(t.groupActivityMapping.dataTableHeaderValues.calls,"calls","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.billable_mintes,"billable_mintes","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.leads,"leads","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.conversion,"conversion","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.call_value,"call_value","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.unique,"unique","inputNumber"),new e(t.groupActivityMapping.dataTableHeaderValues.answered,"answered","inputNumber")]),n.getAllOus().then(function(e){if("error"==e.data.result)return console.log("Error in ","CallFlowSettingsReportWebService.getAllOus SUCCESS callback");JSON.stringify(e.data.json);_.each(e.data.json,function(e){var o={};o.key=e.org_unit_id,o.value=e.org_unit_name,t.ouList.push(o)})}),t.$watch("ouList",function(e){e&&(t.columnDefinitions[1].options=t.ouList)},!0),t.loadIntialReportData=function(){if(!1!==r.download_audio_enabled){var o,a;if(g.set(50),!0===t.is_migrated||"true"===t.is_migrated?t.groupActivityMapping.visibleColumns=[{key:"ouid",visible:!0,disabled:!1},{key:"group",visible:!0,disabled:!1},{key:"ext_id",visible:!0,disabled:!1},{key:"campaign",visible:!1,disabled:!0},{key:"camp_ext_id",visible:!1,disabled:!0},{key:"tracking_num",visible:!1,disabled:!0},{key:"calls",visible:!0,disabled:!1},{key:"billable_mintes",visible:!0,disabled:!1},{key:"leads",visible:!0,disabled:!1},{key:"conversion",visible:!0,disabled:!1},{key:"call_value",visible:!0,disabled:!1},{key:"unique",visible:!0,disabled:!1},{key:"voice_mail",visible:!0,disabled:!1},{key:"answered",visible:!0,disabled:!1}]:t.groupActivityMapping.visibleColumns=[{key:"ouid",visible:!0,disabled:!1},{key:"group",visible:!0,disabled:!1},{key:"ext_id",visible:!0,disabled:!1},{key:"campaign",visible:!1,disabled:!0},{key:"camp_ext_id",visible:!1,disabled:!0},{key:"tracking_num",visible:!1,disabled:!0},{key:"calls",visible:!0,disabled:!1},{key:"billable_mintes",visible:!0,disabled:!1},{key:"leads",visible:!0,disabled:!1},{key:"conversion",visible:!0,disabled:!1},{key:"call_value",visible:!0,disabled:!1},{key:"unique",visible:!0,disabled:!1},{key:"answered",visible:!0,disabled:!1}],"none"!==t.urlParams.secondary){var i,s=t.groupActivityMapping.secondaryGroupingColumn[t.urlParams.secondary];_.map(s,function(o){i=_.find(t.groupActivityMapping.visibleColumns,function(e){return e.key===o}),t.groupActivityMapping.visibleColumns[_.findLastIndex(t.groupActivityMapping.visibleColumns,i)].visible=!0,t.groupActivityMapping.visibleColumns[_.findLastIndex(t.groupActivityMapping.visibleColumns,i)].disabled=!1;var a=new e(t.groupActivityMapping.dataTableHeaderValues[o],o,t.groupActivityMapping.secondaryGroupingAdFiter[o]);"call_flow"===o||"campaign"===o?t.columnDefinitions.splice(3,0,a):t.columnDefinitions.splice(4,0,a)})}n.groupActivitySummary($.param(t.urlParams)).then(function(e){a?(t.summaryGridData=e.data.json[0],t.dataTableData=a,t.finishLoadingDataSet()):o=e.data.json[0]}),n.getDataTableInfo($.param(t.urlParams)).then(function(e){t.totalDataRows=0===e.data.json.length?0:e.data.json[0].totalrecords,o?(t.dataTableData=h(e.data.json),t.summaryGridData=o,t.finishLoadingDataSet(),t.isLoadingApi=!1):(a=h(e.data.json),t.isLoadingApi=!1)})}},t.updateTheDataTableBasedOnQuertString=function(){var e,o;g.set(75),console.log("starting updateTheDataTableBasedOnQuertString"),n.groupActivitySummary($.param(t.urlParams)).then(function(a){o?(t.summaryGridData=a.data.json[0],t.dataTableData=o,t.finishLoadingDataSet()):e=a.data.json[0]}),n.getDataTableInfo($.param(t.urlParams)).then(function(a){t.totalDataRows=0===a.data.json.length?0:a.data.json[0].totalrecords,e?(t.dataTableData=h(a.data.json),t.summaryGridData=e,t.finishLoadingDataSet()):o=h(a.data.json)})},t.finishLoadingDataSet=function(){t.hideDataTable=!1,t.hidePaginationControls=!1,g.end(),setTimeout(function(){t.horsemanFlag=!0},1e3),t.totalDataRows>0?(t.showActualEportLink=!0,t.showExportErrorLink=!1):(t.showActualEportLink=!1,t.showExportErrorLink=!0),!0===t.showAdvFilter&&t.advFilterDefinitions.length>0?(t.advFilterDefinitions[0].user_input||0===t.advFilterDefinitions[0].user_input)&&(t.filterApplied=!0):t.simpleSearchFilter.length>0&&(t.filterApplied=!0)},t.changeDateRange=function(){g.start(),t.horsemanFlag=!1,t.filterApplied=!1,t.filterReset(),i.sessionStorage.report_start_date=t.drp_start,i.sessionStorage.report_end_date=t.drp_end,setTimeout(function(){g.set(25),t.applyFilter()},1)},t.changeSecondaryGrouping=function(e){m.resetAdvFilter(),t.advFilterDefinitions=m.getAdvFilterDefinitions(),t.showAdvFilter=!1,t.simpleFilterText="",t.filtertype="s",t.applyFilter()},t.pageChanged=function(e){g.start(),t.horsemanFlag=!1,t.filterApplied=!1,t.filterReset(),t.urlParams.offset=t.pageSize*(e-1),setTimeout(function(){t.updateTheDataTableBasedOnQuertString(),g.set(50)},1)},t.changeReportParams=function(e,o){t.horsemanFlag=!1,t.filterApplied=!1,t.filterReset(),t.applyFilter(),setTimeout(function(){t.updateTheDataTableBasedOnQuertString()},1)},t.notSorted=function(e){return e?Object.keys(e):[]},t.getCSVData=function(e){t.limit=1e5,t.exportData=!0;var o=[],a=_.filter(t.groupActivityMapping.visibleColumns,function(e){return!1===e.disabled});t.headerNames=_.map(a,function(e){return"ID"===t.groupActivityMapping.dataTableHeaderValues[e.key]?"'ID":t.groupActivityMapping.dataTableHeaderValues[e.key]});var i=d.defer();if(b().then(function(t){if(o=v(t.data.json),i.resolve(o),r.isSafari){var a="csv_groupActivityReport";"tsv"===e&&(a="tsv_groupActivityReport"),i.resolve(JSONToCSVConvertor(o,a,!0,e))}}),!r.isSafari)return i.promise},t.getCSVDataReports=function(){t.limit=5e4,t.exportData=!0;var e=[],o=_.filter(t.groupActivityMapping.visibleColumns,function(e){return!1===e.disabled});t.csvHeaderNames=_.map(o,function(e){return"ID"===t.groupActivityMapping.dataTableHeaderValues[e.key]?"'ID":t.groupActivityMapping.dataTableHeaderValues[e.key]});var a=d.defer();return b().then(function(o){e=v(o.data.json),a.resolve(e),t.csvDataScheduleReport=e}),a.promise},t.getExcelData=function(){var e=[],o=_.filter(t.groupActivityMapping.visibleColumns,function(e){return!1===e.disabled});t.headerNames=_.map(o,function(e){return"ID"===t.groupActivityMapping.dataTableHeaderValues[e.key]?"'ID":t.groupActivityMapping.dataTableHeaderValues[e.key]});var a=d.defer();return b().then(function(t){e=v(t.data.json),alasql('SELECT * INTO XLSX("xls_data_table.xlsx",{sheetid:"Sheet name",headers:true}) FROM ?',[e]),a.resolve(),a.resolve(e)}),a.promise},t.preloading=!1,t.showAdvFilter=!1,t.advancedFilterConfig={maxQuantity:5},t.extendUrlParams=function(e){"s"===e.vars.filtertype&&""===t.simpleSearchFilter&&(t.simpleSearchFilter=e.vars.filter),t.urlParams=e.vars,angular.extend(t,e.vars),delete e.vars,angular.extend(t,e)},t.getInitialUrlParams=void m.determineInitializationMethod(t).then(function(e){t.advFilterDefinitions=m.getAdvFilterDefinitions(),t.advFilterDefinitions.length>0&&t.advFilterDefinitions[0].selected_column&&(t.showAdvFilter=!0),t.extendUrlParams(e),t.loadIntialReportData()}),t.addFilterDefinition=function(){m.addFilterDefinition(!1),t.advFilterDefinitions=m.getAdvFilterDefinitions()},t.updateOperators=function(e,o,a){m.updateOperators(e,o,a),t.advFilterDefinitions=m.getAdvFilterDefinitions()},t.applyFilterParams=function(){var e=m.applyFilter(t);return!!e&&(t.extendUrlParams(e),!0)},t.applyFilter=function(){t.horsemanFlag=!1,t.applyFilterParams()&&t.loadIntialReportData()},t.filterReset=function(){m.resetAdvFilter(),t.advFilterDefinitions=m.getAdvFilterDefinitions(),t.showAdvFilter=!1,t.simpleFilterText="",t.filtertype="s",t.filter="",t.filterApplied&&(t.applyFilter(),t.filterApplied=!1)},t.removeFilterDefinition=function(e){m.removeFilterDefinition(e),t.advFilterDefinitions=m.getAdvFilterDefinitions()},t.validateInput=function(e){m.validateInput(e)}}])}(),function(){angular.module("campaign_list",[]).controller("CampaignsListController",["$scope","$http","$routeParams","$compile","CampaignListWebservices","VoicePromptService","WhisperMessageService","$window","$rootScope","GroupActivitySettingsReportWebservices","$location","pinesNotifications","DateRangeFiller","$q","paginationService","progressLoader","$bootbox","$route",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v){"use strict";var b=!1;e.isLoadingApi=!0,e.userAccess&&e.userAccess.spamguard&&(b=!0),!0===l.is_migrated||"true"===l.is_migrated?e.is_migrated=!0:e.is_migrated=!1,e.collasped=!0,e.hidePaginationControls=!1,e.currentPaginationId="campaign-list",e.hideDataTable=!1,e.filterApplied=!1,e.horsemanFlag=!1,e.simpleSearchFilter="",e.searchLoading=!1,e.report=d.search().report,e.CurrentOUName=l.currentOUName,l.currentOUName.length>50?e.reportName=e.CurrentOUName.slice(0,50)+" groups campaigns tracking numbers list "+moment().format("YYYY-MM-DD"):e.reportName=e.CurrentOUName+" groups campaigns tracking numbers list "+moment().format("YYYY-MM-DD"),e.CurrentOUNameCSV=e.reportName+".csv",e.CurrentOUNameTSV=e.reportName+".tsv",e.drp_start=moment().subtract(7,"days").format("MMMM D, YYYY"),e.drp_end=moment().subtract(1,"days").endOf("day"),e.preview=!!d.search().preview&&d.search().preview,d.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>');var w={};if(e.roleId=l.roleId,e.reportTitle="Campaigns",e.groupActivityMapping={},e.secondary,e.pageSize=100,e.offset=0,e.showActualEportLink=!1,e.showExportErrorLink=!0,e.ouList=[],e.whichScheduleReport="none",e.onGoingRequests=[],e.applyExpand=!1,e.showMasterExpand=!1,e.callflowDataInProcess=!1,e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},e.currentPage=1,e.groupActivityMapping.hrefClickableMethod=function(e,t,o,a){var i="#/calls-details?filtertype=a&filter=ou.org_unit_name,=,"+encodeURIComponent(t)+",";console.log(e,o,a),"none"!==e&&(i=i+","+o+",=,"+a+",AND"),s.open(encodeURI(i))},e.groupActivityMapping.gridBackendPropertyNames={camp_ext_id:"camp_ext_id",camp_name:"name",start_date:"start_date",end_date:"end_date",tracking_quantity:"quantity",status:"status",actions:"actions",ad_source:"ad_source",call_value:"call_value",custom_parameters:"custom_parameters",custom_source_1:"custom_source_1",custom_source_2:"custom_source_2",custom_source_3:"custom_source_3",custom_source_4:"custom_source_4",custom_source_5:"custom_source_5",dni:"dni",dni_type:"dni_type",host_domain:"host_domain",html_class:"html_class",play_disclaimer:"play_disclaimer",pre_call_webhook:"pre_call_webhook",record_call:"record_call",referring_website:"referring_website",repeat_interval:"repeat_interval",ring_to_number:"ring_to_number",spam_guard:"spam_guard",tracking:"tracking",tracking_number_name:"tracking_number_name",tracking_number_status:"tracking_number_status",tracking_number_type:"tracking_number_type",voice_prompt:"voice_prompt",whisper_message:"whisper_message",callflow_action:"callflow_action",action:"action",vm_enabled:"vm_enabled",sms_enabled:"sms_enabled"},e.groupActivityMapping.dataTableHeaderValues=[{key:"camp_name",value:"Campaign ",disable:!1},{key:"camp_ext_id",value:"Campaign External ID",disable:!1},{key:"start_date",value:"Campaign Start",disable:!1},{key:"end_date",value:"Campaign End",disable:!1},{key:"status",value:"Campaign Status",disable:!1},{key:"tracking_quantity",value:"Tracking Number Quantity",disable:!1},{key:"tracking_number_name",value:"Tracking Number Name",disable:!1},{key:"ad_source",value:"Ad Source",disable:!1},{key:"call_value",value:"Call Value",disable:!1},{key:"custom_parameters",value:"Custom Parameters",disable:!1},{key:"custom_source_1",value:"Custom Source 1",disable:!1},{key:"custom_source_2",value:"Custom Source 2",disable:!1},{key:"custom_source_3",value:"Custom Source 3",disable:!1},{key:"custom_source_4",value:"Custom Source 4",disable:!1},{key:"custom_source_5",value:"Custom Source 5",disable:!1},{key:"dni",value:"DNI",disable:!1},{key:"dni_type",value:"DNI Type",disable:!1},{key:"host_domain",value:"Host Domain",disable:!1},{key:"html_class",value:"HTML Class",disable:!1},{key:"play_disclaimer",value:"Play Disclaimer",disable:!1},{key:"pre_call_webhook",value:"Pre Call Webhook",disable:!1},{key:"record_call",value:"Record Call",disable:!1},{key:"referring_website",value:"Referring Website",disable:!1},{key:"repeat_interval",value:"Repeat Interval",disable:!1},{key:"ring_to_number",value:"Ring TO",disable:!1},{key:"spam_guard",value:"Spam Guard",disable:!1},{key:"tracking",value:"Tracking Number",disable:!1},{key:"tracking_number_status",value:"Tracking Number Status",disable:!1},{key:"tracking_number_type",value:"Tracking Number Type",disable:!1},{key:"instant_insights",value:"Instant Insights",disable:!1},{key:"instant_insights_config",value:"Instant Insights Config",disable:!1},{key:"hunt_type",value:"Hunt Type",disable:!1},{key:"voice_prompt",value:"Voice Prompt",disable:!1},{key:"whisper_message",value:"Whisper Message",disable:!1},{key:"callflow_action",value:"Actions",disable:!0},{key:"action",value:"Actions",disable:!0},{key:"vm_enabled",value:"vm_enabled",disable:!1}],e.groupActivityMapping.callFlowdataTableHeaderValues=[{key:"tracking",value:"Tracking Number"},{key:"tracking_number_name",value:"Tracking Number Name"},{key:"ring_to_number",value:"Ring-to Phone Number"},{key:"tracking_number_type",value:"Tracking Number Type"},{key:"instant_insights",value:"Instant Insights"},{key:"instant_insights_config",value:"Instant Insights Config"},{key:"hunt_type",value:"Hunt Type"},{key:"spam_guard",value:"Spam Guard"},{key:"tracking_number_status",value:"Tracking Number Status"},{key:"call_value",value:"Call Value"},{key:"repeat_interval",value:"Repeat Interval"},{key:"ad_source",value:"Ad Source"},{key:"vm_enabled",value:"Voicemail"},{key:"custom_source_1",value:"Custom Source 1"},{key:"custom_source_2",value:"Custom Source 2"},{key:"custom_source_3",value:"Custom Source 3"},{key:"custom_source_4",value:"Custom Source 4"},{key:"custom_source_5",value:"Custom Source 5"},{key:"record_call",value:"Record Call"},{key:"play_disclaimer",value:"Play Disclaimer"},{key:"voice_prompt",value:"Voice Prompt"},{key:"whisper_message",value:"Whisper Message"},{key:"dni",value:"DNI"},{key:"dni_type",value:"DNI Type"},{key:"host_domain",value:"Host Domain"},{key:"referring_website",value:"Referring Website"},{key:"html_class",value:"HTML Class"},{key:"custom_parameters",value:"Custom Parameters"},{key:"pre_call_webhook",value:" Pre-call Webhook"},{key:"callflow_action",value:"Actions"}],e.groupActivityMapping.visibleColumns=[{key:"ad_source",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Ad Source"},{key:"call_value",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Call Value"},{key:"camp_name",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Campaign "},{key:"camp_ext_id",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Campaign External ID"},{key:"start_date",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Campaign Start"},{key:"end_date",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Campaign End"},{key:"status",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Campaign Status"},{key:"custom_parameters",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Parameters"},{key:"custom_source_1",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Source 1"},{key:"custom_source_2",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Source 2"},{key:"custom_source_3",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Source 3"},{key:"custom_source_4",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Source 4"},{key:"custom_source_5",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Custom Source 5"},{key:"dni",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"DNI"},{key:"dni_type",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"DNI Type"},{key:"host_domain",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Host Domain"},{key:"html_class",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"HTML Class"},{key:"play_disclaimer",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Play Disclaimer"},{key:"pre_call_webhook",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Pre-call Webhook"},{key:"record_call",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Record Call"},{key:"referring_website",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Referring Website"},{key:"repeat_interval",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Repeat Interval"},{key:"ring_to_number",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Ring-to Phone Number"},{key:"spam_guard",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Spam Guard"},{key:"tracking",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Tracking Number"},{key:"tracking_number_name",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Tracking Number Name"},{key:"tracking_quantity",visible:!0,truncate:!1,disable:!1,callFlow:!1,show:!0,value:"Tracking Number Quantity"},{key:"tracking_number_status",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Tracking Number Status"},{key:"tracking_number_type",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Tracking Number Type"},{key:"instant_insights",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:e.is_migrated,value:"Instant Insights"},{key:"instant_insights_config",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:e.is_migrated,value:"Instant Insights Config"},{key:"hunt_type",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:e.is_migrated,value:"Hunt Type"},{key:"voice_prompt",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Voice Prompt"},{key:"vm_enabled",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:e.is_migrated,value:"Voicemail"},{key:"whisper_message",visible:!1,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"Whisper Message"},{key:"callflow_action",visible:!0,truncate:!1,disable:!0,callFlow:!0,show:!0,value:"Actions"},{key:"action",visible:!0,truncate:!1,disable:!0,callFlow:!1,show:!0,value:"Actions"}],!0===l.is_migrated||"true"===l.is_migrated){var y=e.groupActivityMapping.dataTableHeaderValues.findIndex(function(e,t,o){return"spam_guard"===e.key});y>-1&&e.groupActivityMapping.dataTableHeaderValues.splice(y+1,0,{key:"sms_enabled",value:"SMS",disable:!1});var S=e.groupActivityMapping.callFlowdataTableHeaderValues.findIndex(function(e,t,o){return"spam_guard"===e.key});S>-1&&e.groupActivityMapping.callFlowdataTableHeaderValues.splice(S+1,0,{key:"sms_enabled",value:"SMS"});var C=e.groupActivityMapping.visibleColumns.findIndex(function(e,t,o){return"spam_guard"===e.key});C>-1&&e.groupActivityMapping.visibleColumns.splice(C+1,0,{key:"sms_enabled",visible:!0,truncate:!1,disable:!1,callFlow:!0,show:!0,value:"SMS"})}e.loadIntialReportData=function(t){e.paginationHeader="",e.searchLoadingText="Loading Data...",e.onGoingRequests.length<2&&i.getCampaigns(l.currentOUId,e.userAccess.campaign,l.timezone,t,e.simpleSearchFilter).then(function(t){if(e.searchLoading=!1,"No Data Found"===t.data.err)e.dataTableData=void 0,e.totalDataRows=0,e.isLoadingApi=!1;else if(t.data.json.campaigns.length>0){e.dataTableData=t.data.json.campaigns;var o=_.find(e.dataTableData,function(e){return e.provisioned_route_ids.length>0});e.showMasterExpand=void 0!==o,e.totalDataRows=parseInt(t.data.json.total),e.paginationHeader="Showing "+parseInt(e.offset+1)+" - "+parseInt(e.offset+e.dataTableData.length)+" of "+e.totalDataRows,e.onGoingRequests=[],e.isLoadingApi=!1,e.applyExpand&&setTimeout(function(){e.collasped=!e.collasped,e.masterexpand(!0)},100)}})},e.loadIntialReportData(1),e.reseticon=function(){e.collasped=!0},e.checkVisibleColumns=function(t){var o=_.find(e.groupActivityMapping.visibleColumns,function(o){if(!1===_.find(e.groupActivityMapping.visibleColumns,function(e){return!1===e.callFlow}).callFlow)return o.key==t});if(void 0!==o&&!1===o.callFlow)return o.visible},e.checkpicklist=function(t){var o=_.find(e.groupActivityMapping.dataTableHeaderValues,function(e){return e.key===t});if(void 0!==o&&!1===o.disable)return o.value},e.getClass=function(e){var t="";return e.truncate&&(t+=" trunc"),e.customClass&&(t+=" headerActions"),t},e.masterexpand=function(t){var o=[],a=[],s=!1,l=[];if(e.callflowDataInProcess=!0,$(".expand").each(function(){var e=$(this).attr("id"),t={index:e.split("_")[2],routeableId:e.split("_")[1]};a.push(t),l.push(t),o.push(e.split("_")[1])}),e.collasped)e.applyExpand=!0,i.getAllCampaignsCallFlow({campaign_ids:o}).then(function(t){e.callflowDataInProcess=!1;for(var i=r.getPrompts(),c=n.getWhispers(),d=[],u=[],p=0;p<i.length;p++)d.push(i[p].filename);for(var m=0;m<c.length;m++)u.push(c[m].filename);for(var g=0;g<o.length;g++){s=!1;var f=_.find(a,function(e){return e.routeableId==o[g]}),h=[];e.visiblecallFlow(l[g]);for(var v=0;v<t.data.json.length;v++)if(t.data.json[v].campaign_id==o[g]){if(s=!0,t.data.json[v].voice_prompt&&null!=t.data.json[v].voice_prompt)if(t.data.json[v].voice_prompt.includes("file://"))for(var b=t.data.json[v].voice_prompt.split("file://")[1].split(".")[0],w=0;w<i.length;w++){!0===(A=d.includes(b))||"true"===A?b===i[w].filename&&(t.data.json[v].voice_prompt=i[w].name):t.data.json[v].voice_prompt=""}else{var y=t.data.json[v].voice_prompt.split("tts://")[1];t.data.json[v].voice_prompt=y}if(t.data.json[v].whisper_message&&null!=t.data.json[v].whisper_message)if(t.data.json[v].whisper_message.includes("file://"))for(var S=t.data.json[v].whisper_message.split("file://")[1].split(".")[0],C=0;C<c.length;C++){var A;!0===(A=u.includes(S))||"true"===A?S===c[C].filename&&(t.data.json[v].whisper_message=c[C].name):t.data.json[v].whisper_message=""}else{var T=t.data.json[v].whisper_message.split("tts://")[1];t.data.json[v].whisper_message=T}e.displayCallFlow(l[g],t.data.json[v],t.data.json,h)}e.subrows+="</table>",e.subrows+="</div>",e.subrows+="</td>",e.subrows+="<td class='colSpanHide2'></td>",e.subrows+="</tr>",$(".subrowheader"+l[g].routeableId).length>0&&$(".subrowheader"+l[g].routeableId).remove(),s&&($("#row_"+o[g]+"_"+f.index).children().removeClass("fa fa-caret-right"),$("#row_"+o[g]+"_"+f.index).children().addClass("fa fa-caret-down"),$("#rowdataitem"+f.index).after(e.subrows))}$(".disabled").prop("disabled",!0)});else{e.applyExpand=!1,e.callflowDataInProcess=!1;for(var c=0;c<o.length;c++){var d=_.find(a,function(e){return e.routeableId==o[c]});$("#row_"+o[c]+"_"+d.index).children().removeClass("fa fa-caret-down"),$("#row_"+o[c]+"_"+d.index).children().addClass("fa fa-caret-right"),$(".subrowheader"+l[c].routeableId).length>0&&$(".subrowheader"+l[c].routeableId).remove()}}e.collasped=!e.collasped},e.yell=function(t,o,a){var i=0;if(a&&(o?$("."+t).show():$("."+t).hide()),_.map(e.groupActivityMapping.visibleColumns,function(e){!1===e.callFlow&&e.visible&&i++}),!1===o){var r=i;0===(i=r-2)&&(i=0,$(".colSpanHide2").hide()),i<=5&&$(".colSpanHide2").show()}else $(".colSpanHide2").show(),(r=$(".colspan_class").attr("colspan"))<=6?(i=parseInt(r)+parseInt(1),a?6==r?$(".colSpanHide2").hide():(i-=1,$(".colSpanHide2").show()):$(".colSpanHide2").show()):($(".colSpanHide2").show(),i=6);$(".colspan_class").attr("colspan",""+parseInt(i))},e.visiblecallFlow=function(t){var o=[];_.each(e.groupActivityMapping.callFlowdataTableHeaderValues,function(t){!0===_.find(e.groupActivityMapping.visibleColumns,function(e){return e.key==t.key}).visible?(t=[{colHead:t.value},{colKey:t.key},{colFlag:!0}],o.push(t)):(t=[{colHead:t.value},{colKey:t.key},{colFlag:!1}],o.push(t))}),e.subrows="",e.subrows+="<tr class='subrowheader"+t.routeableId+"'>",e.subrows+="<td class='colSpanHide'> </td>",e.subrows+="<td class='colspan_class' colspan='6'>",e.subrows+="<div class='settingsstyle' >",e.subrows+="<table class='table'>",e.subrows+="<tr>";for(var a=0;a<o.length;a++)if(!0===o[a][2].colFlag){var i="";"Actions"==o[a][0].colHead&&(i="style='text-align:right'"),e.subrows+="<th class='"+o[a][1].colKey+" CallFlowHeader' "+i+">"+o[a][0].colHead+" </th>"}else e.subrows+="<th class='"+o[a][1].colKey+" CallFlowHeader' style='display:none;'>"+o[a][0].colHead+" </th>";return e.subrows+="</tr>",o},e.showSubData=function(t){if(w=t,e.callflowDataInProcess)return!1;e.callflowDataInProcess=!0;if($(".subrowheader"+t.routeableId).length>0)return e.callflowDataInProcess=!1,$("#row_"+t.routeableId+"_"+t.index).children().removeClass("fa fa-caret-down"),$("#row_"+t.routeableId+"_"+t.index).children().addClass("fa fa-caret-right"),$(".subrowheader"+t.routeableId).remove(),!1;i.getCampaignsCallFlow(t.routeableId).then(function(o){e.callflowDataInProcess=!1,e.visiblecallFlow(t);for(var i=[],s=r.getPrompts(),l=n.getWhispers(),c=[],d=[],u=0;u<s.length;u++)c.push(s[u].filename);for(var p=0;p<l.length;p++)d.push(l[p].filename);for(var m=0;m<o.data.json.length;m++){if("PercentageBasedRoute"===o.data.json[m].tracking_number_type&&(o.data.json[m].tracking_number_type="Percentage"),"hangup"===o.data.json[m].ring_to_number&&(o.data.json[m].tracking_number_type="Simple"),"Outbound"==o.data.json[m].tracking_number_type&&(o.data.json[m].repeat_interval=""),"Voicemail"==o.data.json[m].tracking_number_type&&(o.data.json[m].ring_to_number="Voicemail",o.data.json[m].vm_enabled=""),o.data.json[m].voice_prompt&&null!=o.data.json[m].voice_prompt)if(o.data.json[m].voice_prompt.includes("file://"))for(var g=o.data.json[m].voice_prompt.split("file://")[1].split(".")[0],f=0;f<s.length;f++){!0===(_=c.includes(g))||"true"===_?g===s[f].filename&&(o.data.json[m].voice_prompt=s[f].name):o.data.json[m].voice_prompt=""}else{var h=o.data.json[m].voice_prompt.split("tts://")[1];o.data.json[m].voice_prompt=h}if(o.data.json[m].whisper_message&&null!=o.data.json[m].whisper_message)if(o.data.json[m].whisper_message.includes("file://")){var v=o.data.json[m].whisper_message.split("file://")[1].split(".")[0];for(f=0;f<l.length;f++){var _;!0===(_=d.includes(v))||"true"===_?v===l[f].filename&&(o.data.json[m].whisper_message=l[f].name):o.data.json[m].whisper_message=""}}else{var b=o.data.json[m].whisper_message.split("tts://")[1];o.data.json[m].whisper_message=b}var w=o.data.json[m];e.displayCallFlow(t,w,o.data.json,i)}e.subrows+="</table>",e.subrows+="</div>",e.subrows+="</td>",e.subrows+="<td class='colSpanHide2'></td>",e.subrows+="</tr>",$("#rowdataitem"+t.index).after(a(e.subrows)(e)),$("#row_"+t.routeableId+"_"+t.index).children().removeClass("fa fa-caret-right"),$("#row_"+t.routeableId+"_"+t.index).children().addClass("fa fa-caret-down")})},e.displayCallFlow=function(t,o,a,i){var r=[],n=[];t.routeableId;e.subrows+="<tr id='callflowrow' class='subrows"+t.index+"'>",_.each(e.groupActivityMapping.callFlowdataTableHeaderValues,function(t){var o=_.find(e.groupActivityMapping.visibleColumns,function(e){return e.key==t.key});o.visible,r=[{callflowheader:t.value},{callflowkey:t.key},{callflowflag:o.visible}],n.push(r)});for(var s=0;s<n.length;s++){var l=n[s][1].callflowkey;if("callflow_action"===n[s][1].callflowkey){e.subrows+="<td class='subrowsActions'>",-1===i.indexOf(o.tracking)&&(i.push(o.tracking),"Referral"===o.tracking_number_status?(e.subrows+="<span><button class='campaignbuttons btn btn-sm btn-primary disabled' onclick=angular.element(this).scope().editCampaign("+t.routeableId+","+o.call_flow_id+")>Edit </button>",e.subrows+="&nbsp;<button class='campaignbuttons btn btn-sm btn-danger disabled'  onclick=angular.element(this).scope().removeCallFlow("+o.call_flow_id+")>Delete</button> </span>"):(e.subrows+="<span><button class='campaignbuttons btn btn-sm btn-primary' onclick=angular.element(this).scope().editCampaign("+t.routeableId+","+o.call_flow_id+")>Edit </button>",e.subrows+="&nbsp;<button class='campaignbuttons btn btn-sm btn-danger'  onclick=angular.element(this).scope().removeCallFlow("+o.call_flow_id+","+t.routeableId+","+t.index+")>Delete</button> </span>")),e.subrows+="</td>"}else"spam_guard"==n[s][1].callflowkey?!0===n[s][2].callflowflag?o[l]&&b?e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader'><img src='assets/img/spam.jpg' class='spam_gurad' > </td>":e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader'></td>":e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader' style='display:none;'></td>":"sms_enabled"==n[s][1].callflowkey?!0===n[s][2].callflowflag?o[l]&&b?e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader'><img src='assets/img/spam.jpg' class='spam_gurad' > </td>":e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader'></td>":e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader' style='display:none;'></td>":!0===n[s][2].callflowflag?e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader'>"+o[l]+" </th>":e.subrows+="<td class='"+n[s][1].callflowkey+" CallFlowHeader' style='display:none;'>"+o[l]+" </th>"}e.subrows+="</tr>"},e.editCampaign=function(e,t){l.is_migrated?(d.path("/set-campaign-builder"),setTimeout(function(){$("html, body").animate({scrollTop:$("#addTrackingNumber").offset().top-20},1e3)},100)):(d.path("/set-legacy-campaign-builder"),setTimeout(function(){$("html, body").animate({scrollTop:$("#addTrackingNumber").offset().top-20},1e3)},100)),d.search("id",e),d.search("cfid",t),l.editClickId=e},e.removeCallFlow=function(t,o,r){var n={provisioned_route:{ids:[t]}};w.routeableId=o,w.index=r,h.confirm("Are you sure you want to delete this Tracking Number?",function(t){t&&i.removeCallFlow(n).then(function(t){""===t.data.err?(u.notify({title:"Remove Tracking Number",text:"Tracking Number removed successfully.",type:"success"}),i.getCampaignsCallFlow(w.routeableId).then(function(t){e.callflowDataInProcess=!1;var o=[];$(".subrowheader"+w.routeableId).length>0&&(e.callflowDataInProcess=!1,$("#row_"+w.routeableId+"_"+w.index).children().removeClass("fa fa-caret-down"),$("#row_"+w.routeableId+"_"+w.index).children().addClass("fa fa-caret-right"),$(".subrowheader"+w.routeableId).remove());e.visiblecallFlow(w);for(var i=0;i<t.data.json.length;i++){var r=t.data.json[i];e.displayCallFlow(w,r,t.data.json,o)}e.subrows+="</table>",e.subrows+="</div>",e.subrows+="</td>",e.subrows+="<td class='colSpanHide2'></td>",e.subrows+="</tr>",$("#rowdataitem"+w.index).after(a(e.subrows)(e)),$("#row_"+w.routeableId+"_"+w.index).children().removeClass("fa fa-caret-right"),$("#row_"+w.routeableId+"_"+w.index).children().addClass("fa fa-caret-down")})):u.notify({title:"Remove Call Flow",text:t.data.err.data,type:"error"})})})},e.archiveCampaign=function(t){console.log(a);var o=t.name,a=t.campaign_id,r={campaign:{id:a,status:"deleted",org_unit_id:l.currentOUId}},n="";n+="Are you sure you want to archive campaign - "+o+"?",h.confirm(n,function(t){t&&i.setCampaignStatus(r).then(function(t){"success"===t.data.status?(u.notify({title:"Campaign",text:o+" has been archived.",type:"success"}),v.reload()):e.error=t})})},e.pageChanged=function(t){e.currentPage=t,e.onGoingRequests.push(!0),e.isLoadingApi=!0,e.loadIntialReportData(t)},e.changeReportParams=function(t,o){e.filterReset(),e.loadIntialReportData(1)},!0===e.is_migrated||"true"===e.is_migrated?e.getHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","Campaign","Campaign ID","Campaign External ID","Campaign Start","Campaign End","Campaign Status","Referral","Tracking Number Name","Tracking Number ID","Tracking Number","Tracking Number Type","Tracking Number Status","Ring-to Phone Number","Call Value","Repeat Interval (in Hours)","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Spam Guard","SMS","Record Call","Play Disclaimer","Voice Prompt","Whisper Message","DNI","Host Domain","Referring Website","HTML Class","DNI Type","Custom Parameters","Pre-call Webhook","Instant Insights","Instant Insights Config","Hunt Type","Voicemail"]}:e.getHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","Campaign","Campaign ID","Campaign External ID","Campaign Start","Campaign End","Campaign Status","Referral","Tracking Number Name","Tracking Number ID","Tracking Number","Tracking Number Type","Tracking Number Status","Ring-to Phone Number","Call Value","Repeat Interval (in Hours)","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Spam Guard","Record Call","Play Disclaimer","Voice Prompt","Whisper Message","DNI","Host Domain","Referring Website","HTML Class","DNI Type","Custom Parameters","Pre-call Webhook"]},e.getCSVData=function(t){f.start();var o={},a=m.defer();if(i.getCampaignsCallFlowReport(e.userAccess.campaign,l.currentOUId).then(function(i){if("error"!=i.data.json){o=i.data.json;for(var r=[],n=0;n<o.length;n++){var c=o[n].ring_to_number,d=o[n].tracking_number_type;if(e.prompts=JSON.parse(s.sessionStorage.prompts),"file://"==o[n].voice_prompt.substring(0,7)){var u=o[n].voice_prompt.substring(o[n].voice_prompt.lastIndexOf("/")+1,o[n].voice_prompt.length);if(e.prompts)for(var p=0;p<e.prompts.length;p++){e.prompts[p].filename+".wav"==u&&(o[n].voice_prompt=e.prompts[p].name.split(" ").join("_")+".wav")}}else o[n].voice_prompt=o[n].voice_prompt.substring(6,o[n].voice_prompt.length);if(e.whispers=JSON.parse(s.sessionStorage.whispers),"file://"==o[n].whisper_message.substring(0,7)){var m=o[n].whisper_message.substring(o[n].whisper_message.lastIndexOf("/")+1,o[n].whisper_message.length);if(e.whispers)for(p=0;p<e.whispers.length;p++){e.whispers[p].filename+".wav"==m&&(o[n].whisper_message=e.whispers[p].name.split(" ").join("_")+".wav")}}else o[n].whisper_message=o[n].whisper_message.substring(6,o[n].whisper_message.length);if(e.prompts=JSON.parse(s.sessionStorage.prompts),"file://"==o[n].voice_prompt.substring(0,7)){u=o[n].voice_prompt.substring(o[n].voice_prompt.lastIndexOf("/")+1,o[n].voice_prompt.length);if(e.prompts)for(p=0;p<e.prompts.length;p++){e.prompts[p].filename+".wav"==u&&(o[n].voice_prompt=e.prompts[p].name.split(" ").join("_")+".wav")}}else o[n].voice_prompt=o[n].voice_prompt.substring(6,o[n].voice_prompt.length);if(e.whispers=JSON.parse(s.sessionStorage.whispers),"file://"==o[n].whisper_message.substring(0,7)){m=o[n].whisper_message.substring(o[n].whisper_message.lastIndexOf("/")+1,o[n].whisper_message.length);if(e.whispers)for(p=0;p<e.whispers.length;p++){e.whispers[p].filename+".wav"==m&&(o[n].whisper_message=e.whispers[p].name.split(" ").join("_")+".wav")}}else o[n].whisper_message=o[n].whisper_message.substring(6,o[n].whisper_message.length);var g={a:o[n].account_name,b:o[n].account_id,c:o[n].account_exid,d:o[n].parent_group_name,e:o[n].parent_group_id,f:o[n].parent_group_external_id,g:o[n].group_name,h:o[n].group_id,i:o[n].group_external_id,j:o[n].campaign_name,k:o[n].campaign_id,l:o[n].campaign_external_id,m:o[n].start_date,n:o[n].end_date,o:o[n].campaign_status,p:o[n].referral_number,q:o[n].tracking_name,r:o[n].tracking_id,s:o[n].tracking_number,t:"hangup"==c?"Hangup":o[n].tracking_number_type,u:o[n].tracking_number_status,v:o[n].ring_to_number,w:o[n].call_value,x:"Outbound"==d?" ":o[n].repeat_interval,y:o[n].ad_source,z:o[n].custom_source_name1,A:o[n].custom_source_name2,B:o[n].custom_source_name3,C:o[n].custom_source_name4,D:o[n].custom_source_name5,E:o[n].spam_guard,zz:o[n].sms_enabled,F:o[n].record_call,G:o[n].play_disclaimer,H:o[n].voice_prompt,I:o[n].whisper_message,J:o[n].dni,K:o[n].host_domain,L:o[n].referring_website,M:o[n].html_class,N:o[n].dni_type,O:o[n].custom_parameters,P:o[n].pre_call_webhook,Q:o[n].post_call_ivr_status,R:null==o[n].post_call_ivr||void 0==o[n].post_call_ivr?" ":o[n].post_call_ivr,S:o[n].hunt_type&&void 0!==o[n].hunt_type?o[n].hunt_type:"",yy:o[n].voicemail};!1!==e.is_migrated&&"false"!==e.is_migrated||(delete g.Q,delete g.R,delete g.S,delete g.yy,delete g.zz),r.push(g)}if(a.resolve(r),!l.isSafari)return f.end(),a.promise;a.resolve(JSONToCSVConvertor(r,reportName,!0,t))}}),!l.isSafari)return a.promise;f.end()},e.preloading=!1,e.applyFilter=function(){f.start(),""!==e.simpleSearchFilter&&void 0!==e.simpleSearchFilter?e.searchLoading=!0:e.searchLoading=!1,e.reseticon(),e.loadIntialReportData(e.currentPage)},e.filterReset=function(){f.start(),e.reseticon(),e.loadIntialReportData(e.currentPage)}}])}(),function(){var e=angular.module("report-components",[]);e.directive("callflowSettingsReportTable",function(){return{restrict:"E",link:function(e){e.pageSize=100,e.getType=function(e){return typeof e}},scope:{visibleColumns:"=",rowData:"=",totalRows:"=",dbFieldNames:"=",columnDefIndices:"=",currentPage:"=",secondaryGrouping:"=",currentPaginationId:"=",routeTypes:"=",geoTypes:"=",showSubData:"&"},templateUrl:function(e,t){return t.templateUrl}}}).directive("overflowRouting",function(){return{restrict:"E",link:function(e){e.currentOverFlowNumber=e.overflowNumbers[0],e.shownotification=!1,e.byDefaultRing||(e.byDefaultRing=3),e.addOtherOverflowNumber=function(){void 0!==e.overflowNumbers[e.overflowNumbers.length-1].overflow_order&&null!==e.overflowNumbers[e.overflowNumbers.length-1].overflow_order&&""!==e.overflowNumbers[e.overflowNumbers.length-1].overflow_order||1!==e.overflowNumbers.length||(e.overflowNumbers[e.overflowNumbers.length-1].overflow_order=1),e.overflowNumbers.push({overflowNumber:"",rings:e.byDefaultRing,overflow_order:e.overflowNumbers[e.overflowNumbers.length-1].overflow_order+1}),e.currentOverFlowNumber=e.overflowNumbers[e.overflowNumbers.length-1]},e.removeOverflowNumber=function(t,o){bootbox.confirm("Are you sure you want to delete this Overflow Number?",function(a){a&&(e.overflowNumbers=_.without(e.overflowNumbers,_.findWhere(e.overflowNumbers,{overflowNumber:t,rings:o})),0===e.overflowNumbers.length&&(e.openOverflowBox=!1,e.overflowNumbers=[{overflowNumber:"",rings:e.byDefaultRing}],e.isSimultaneousRing=!1),e.currentOverFlowNumber=e.overflowNumbers[e.overflowNumbers.length-1],e.shownotification=!0,e.showSubmitFunction())})},e.replaceMasking=function(){e.currentOverFlowNumber=e.overflowNumbers[e.overflowNumbers.length-1],e.currentOverFlowNumber.unmaskNumber=e.currentOverFlowNumber.overflowNumber.replace(/[^0-9]+/g,""),e.showSubmitFunction()}},scope:{overflowNumbers:"=",openOverflowBox:"=",isSimultaneousRing:"=",currentOverFlowNumber:"=",byDefaultRing:"=",fromDirectiveFn:"=method",shownotification:"=",showSubmitFunction:"&showSubmit",overflowValidationHeader:"="},templateUrl:"views/directives/overflow.html"}}),e.directive("thirdMultiLevelIvr",["pinesNotifications","$uibModal","$bootbox","VoicePromptService","WhisperMessageService","CampaignWebService",function(e,t,o,a,i,r){return{restrict:"E",link:function(n,s){n.idnum=n.ivrActions.length;var l="",c="";n.byDefaultRing||(n.byDefaultRing=3),n.tcAction.ivrActions&&n.tcAction.ivrActions.length||(n.tcAction.ivrActions=[],n.tcAction.ivrActions=[{id:1,action:"simple",action_order:1,TTSIVRSelected:!0,voicepromptURL:"",voicepromptId:"",ringtoNum:"",message_type:l,message:c,keypress:"",destination:"",previousmenu:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",isLocationIvr:!1,disableRC:!1,voicemailComponent:!1}]),n.tcAction.ringtoNum&&10==n.tcAction.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length?n.tcAction.isValidRingTo=!0:n.tcAction.isValidRingTo=!1,void 0!==n.tcAction.geoRoute&&null!==n.tcAction.geoRoute&&""!==n.tcAction.geoRoute&&(n.tcAction.geoRoute.geoList&&void 0!==n.tcAction.geoRoute.geoList&&""!==n.tcAction.geoRoute.geoList&&null!==n.tcAction.geoRoute.geoList?n.georoutelocations.forEach(function(e){e.id===parseInt(n.tcAction.geoRoute.geoList)&&(n.locObj=e)}):n.locObj={id:"",name:""}),n.changeLocId=function(e){n.tcAction.geoRoute.geoList=e.id},n.showSubmit=function(){n.showSubmitFunction(),n.tcAction.ringtoNum&&10==n.tcAction.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length?n.tcAction.isValidRingTo=!0:n.tcAction.isValidRingTo=!1};n.whisperIVRTextChange=function(e){void 0===e.whisperTTSText&&0===e.whisperTTSText.length||n.chkSpclChar(e.whisperTTSText,"3rd Level Whisper Message",function(t){e.whisperTTSText=t}),void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,void 0===e.whisperText||0===e.whisperText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):(e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0)},n.disableRecordCall=function(){n.tcAction.activateVoiceMail?(n.tcAction.disableRC=!1,n.tcAction.recordCall=!0):(n.tcAction.disableRC=!0,n.tcAction.recordCall=!0)},n.removeSelectedWhisperAudio=function(e){void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,e.TTSWhisperSelected=!0,e.whisperTTSText="",e.hasValidWhisperURL=!1,e.whisperURL=""},n.showIVRWhisperModal=function(e){n.disableBtn=!0,d(),t.open({templateUrl:"assets/partials/assignWhisper.html",controller:"whisperModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<i.whispers.length;t++)!0===i.whispers[t].selectedwhisper&&(e.whisperText=i.whispers[t].name,e.whisperFileName=i.whispers[t].filename,e.whisperId=i.whispers[t].id,e.whisperURL=i.whispers[t].url,n.whisperAudio=void 0,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0);e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.whisperTTSText="",n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})},n.playWhisperAudio=function(e){void 0===n.whisperAudio||n.whisperAudio.paused?void 0!==n.whisperAudio&&n.whisperAudio.paused?n.whisperAudio.play():e.whisperTTSText.length>0?(n.whisperAudio=new Audio,n.onTTS_IVR_Request=!0,r.getTTS(e.whisperTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.whisperAudio.src=t,n.whisperAudio.paused?n.whisperAudio.play():n.whisperAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.whisperAudio=new Audio(e.whisperURL),n.whisperAudio.play()):n.whisperAudio.pause()},n.whisperAudioIsPlaying=function(){return void 0!==n.whisperAudio&&!n.whisperAudio.paused&&!n.whisperAudio.ended},n.removeSelectedIvrVoiceAudio=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,e.voicepromptURL=void 0,e.voicepromptTTSText="",e.voicepromptText="",e.TTSIVRSelected=!0,e.hasValidTTSVoiceURL=!1},n.removeIvrAction=function(t){o.confirm("Are you sure you want to delete this IVR Action?",function(o){if(o){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),n.pauseCurrentPlayingAudio();var a=!0;$.each(n.ivrActions,function(e,o){a&&o.id==t&&(n.ivrActions.splice(e,1),a=!1)}),$.each(n.ivrActions,function(e,o){o.id>t&&0!==t&&(n.ivrActions[e].id=o.id-1),0===o.id&&(n.ivrActions[e].id=e+1)}),e.notify({title:"Multilevel IVR Key Press",text:"Deleted Successfully",type:"success"})}})};n.inheritKeyPress=function(){n.thirdkeyPress=n.ivrActions.slice(-1)[0].previousmenu;for(var e=0;e<n.ivrActions.length;e++)n.ivrActions[e].previousmenu=n.thirdkeyPress},n.addAction=function(){if(n.inheritKeyPress(),function(){for(var t,o=!1,a=[],i=!1,r=n.ivrActions.length-1;r>=0;r--)console.log("ivr =",n.ivrActions[r]),""!==n.ivrActions[r].keypress&&void 0!==n.ivrActions[r].keypress&&null!==n.ivrActions[r].keypress||a.push("Keypress"),""!==n.ivrActions[r].destination&&void 0!==n.ivrActions[r].destination&&null!==n.ivrActions[r].destination||a.push("Destination"),""!==n.ivrActions[r].voicepromptTTSText&&void 0!==n.ivrActions[r].voicepromptTTSText&&null!==n.ivrActions[r].voicepromptTTSText||""!==n.ivrActions[r].voicepromptURL&&void 0!==n.ivrActions[r].voicepromptURL&&null!==n.ivrActions[r].voicepromptURL||"interactiveVoice"!==n.ivrActions[r].action||a.push("Voice Prompt"),r===n.ivrActions.length-1&&(""!==n.ivrActions[r].previousmenu&&void 0!==n.ivrActions[r].previousmenu&&null!==n.ivrActions[r].previousmenu||a.push("Go Back to the previous menu")),"interactiveVoice"!==n.ivrActions[r].action&&(!0===n.ivrActions[r].openOverflowBox&&n.ivrActions[r].overflowNumbers.length>0&&angular.forEach(n.ivrActions[r].overflowNumbers,function(e){""!==e.overflowNumber&&void 0!==e.overflowNumber&&null!==e.overflowNumber&&10===e.overflowNumber.replace(/[^0-9]+/g,"").length||a.push("Overflow Ring to Phone Number")}),n.ivrActions[r].recordCall&&("true"!==n.ivrActions[r].playDisclaimer&&""!==n.ivrActions[r].playDisclaimer&&void 0!==n.ivrActions[r].playDisclaimer&&null!==n.ivrActions[r].playDisclaimer||a.push("Play call recording disclaimer")),n.ivrActions[r].whisperPrompt&&(void 0!==n.ivrActions[r].whisperTTSText&&""!==n.ivrActions[r].whisperTTSText&&null!==n.ivrActions[r].whisperTTSText||""!==n.ivrActions[r].whisperURL&&void 0!==n.ivrActions[r].whisperURL&&null!==n.ivrActions[r].whisperURL||a.push("Play whisper message before connecting")),"simple"===n.ivrActions[r].action&&(""!==n.ivrActions[r].ringtoNum&&10===n.ivrActions[r].ringtoNum.replace(/[^0-9]+/g,"").length||(a.push("Ring to Phone Number"),n.ivrActions[r].isValidRingTo=!1)),"geo"===n.ivrActions[r].action&&(""!==n.ivrActions[r].geoRoute.routeBy&&void 0!==n.ivrActions[r].geoRoute.routeBy||a.push("Route By"),""!==n.ivrActions[r].geoRoute.geoList&&void 0!==n.ivrActions[r].geoRoute.geoList||a.push("Location List"),""!==n.ivrActions[r].ringtoNum&&10===n.ivrActions[r].ringtoNum.replace(/[^0-9]+/g,"").length||a.push("Default Number"),"Zipcode"!==n.ivrActions[r].geoRoute.routeBy&&"Npa"!==n.ivrActions[r].geoRoute.routeBy||""!==n.ivrActions[r].geoRoute.radius&&void 0!==n.ivrActions[r].geoRoute.radius||a.push("Proximity Limit")),"schedule"===n.ivrActions[r].action&&(""!==n.ivrActions[r].scheduleRoute.timezone&&void 0!==n.ivrActions[r].scheduleRoute.timezone&&null!==n.ivrActions[r].scheduleRoute.timezone||a.push("Time Zone"),_.each(n.ivrActions[r].scheduleRoute.scheduleInfo,function(e){""!==e.fromTime&&void 0!==e.fromTime&&null!==e.fromTime||a.push("FromTime"),""!==e.toTime&&void 0!==e.toTime&&null!==e.toTime||a.push("ToTime"),0===e.days.length&&a.push("Days"),""!==e.ringTo&&void 0!==e.ringTo&&null!==e.ringTo&&10===e.ringTo.replace(/[^0-9]+/g,"").length||a.push("Ring to Phone Number"),_.each(e.overflowNumbers,function(t){!e.openOverflowBox||""!==t.overflowNumber&&void 0!==t.overflowNumber&&null!==t.overflowNumber&&10===t.overflowNumber.replace(/[^0-9]+/g,"").length||a.push("Overflow Ring to Phone Number")})}))),a.length>0&&(r=0);_.each(n.ivrActions,function(t){n.overflowNumberDuplicateL3=[],n.duplicateRingToOverflowL3=[],_.forEach(t.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var o=e.overflowNumber.replace(/[^0-9]+/g,"").replace(/^0+/,"");o===t.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"")&&n.duplicateRingToOverflowL3.push(o),n.overflowNumberDuplicateL3.push({unmaskNumber:o,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),n.overflowNumberDuplicateL3.length!=_.uniq(n.overflowNumberDuplicateL3,"unmaskNumber").length&&!0===t.isSimultaneousRing&&"interactiveVoice"!==t.action&&(e.notify({title:"3rd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),i=!0),_.isEmpty(n.duplicateRingToOverflowL3)||!0!==t.isSimultaneousRing||"interactiveVoice"===t.action||(e.notify({title:"3rd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),i=!0)});for(var s=0;s<n.ivrActions.length;s++)n.ivrActions[s].keypress==n.ivrActions[s].previousmenu&&(e.notify({title:"Third level IVR Key Press",text:"keypress and backpress value should not be same",type:"error"}),o=!0);return a.length>0?(t=" field is required.",a.length>1&&(t=" fields are required."),e.notify({title:"3rd level IVR Form",text:a.toString()+t,type:"error"}),!1):!i&&!o}()){var t={id:n.tcAction.id+1,action:"simple",action_order:n.ivrActions[n.ivrActions.length-1].action_order+1,voicepromptURL:"",TTSIVRSelected:!0,voicepromptId:"",ringtoNum:"",keypress:"",destination:"",previousmenu:n.thirdkeyPress,message_type:l,message:c,recordCall:!1,playDisclaimer:"before",activateVoiceMail:!1,geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,isLocationIvr:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",disableRC:!1,voicemailComponent:!1};n.ivrActions.push(t)}},n.chkSpclChar=function(t,o,a){var i=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;i.test(t)?(e.notify({title:o,text:"Special characters are not allowed",type:"error"}),a(t.replace(i,""))):a(t)},n.voiceTextIvrChange=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,void 0===e.voicepromptTTSText||0===e.voicepromptTTSText.length?(e.hasValidTTSVoiceURL=!1,e.TTSIVRSelected=!0):n.chkSpclChar(e.voicepromptTTSText,"3rd Level Voice Prompt",function(t){e.voicepromptTTSText=t,e.hasValidTTSVoiceURL=!0,e.TTSIVRSelected=!0})},n.showIvrVoiceModal=function(e){n.disableBtn=!0,d(),t.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:"lg"}).result.then(function(){for(var t=0;t<a.prompts.length;t++)!0===a.prompts[t].selectedprompt&&(e.voicepromptText=a.prompts[t].name,e.voicepromptFileName=a.prompts[t].filename,e.voicepromptURL=a.prompts[t].url,e.voicepromptId=a.prompts[t].id);e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0,e.voicepromptTTSText="",n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})},n.disablePlayBtn=function(e){var t=$(".playpadding").not(this),o=angular.element(document.querySelector("#voicemail")),a=e.currentTarget,i=a.children[0];i.classList.add("fa-pause");var r=setInterval(function(){i.classList.contains("fa-pause")?(t.each(function(e,t){!1===t.disabled&&(t.classList.add("customDisabled"),n.disableBtn=!0)}),a.classList.remove("customDisabled"),o.removeClass("customDisabled")):(t.removeClass("customDisabled"),o.removeClass("customDisabled"),n.disableBtn=!1,clearInterval(r))},100)};var d=function(){void 0!==n.ivrAudio&&(n.ivrAudio.pause(),n.ivrAudio=void 0),void 0!==n.whisperAudio&&(n.whisperAudio.pause(),n.whisperAudio=void 0)};n.tcAction.TTSIVRSelected?(l="text",c=n.tcAction.voicepromptTTSText):(l="file",c=n.tcAction.voicepromptFileName),n.playTtsVoiceAudio=function(e){void 0===n.ivrAudio||n.ivrAudio.paused?void 0!==n.ivrAudio&&n.ivrAudio.paused?n.ivrAudio.play():e.voicepromptTTSText.length>0?(n.ivrAudio=new Audio,n.onTTS_IVR_Request=!0,r.getTTS(e.voicepromptTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.ivrAudio.src=t,n.ivrAudio.paused?n.ivrAudio.play():n.ivrAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.ivrAudio=new Audio(e.voicepromptURL),n.ivrAudio.play()):n.ivrAudio.pause()},n.retainDataOnChange=function(){n.tcAction.scheduleRoute.default_ringto=n.tcAction.ringtoNum,n.tcAction.scheduleRoute.activate_voicemail=n.tcAction.activateVoiceMail,n.tcAction.scheduleRoute.recordCall=n.tcAction.recordCall,n.tcAction.scheduleRoute.disableRC=n.tcAction.disableRC},n.getGeoLocationList=function(){r.getGeoLocations().then(function(e){"error"!=e.data.result&&(n.georoutelocations=[],e.data.json.locations.forEach(function(e){e.count>0&&n.georoutelocations.push({id:e.id,name:e.name})}))})}},scope:{level:"=",ivrActions:"=",tcactionId:"=",tcAction:"=",georoutelocations:"=",removeSelectedIvrVoiceAudio:"&",audioIsDownloading:"&",audioIsPlaying:"&",showIvrVoiceModal:"&",playTtsVoiceAudio:"&",voiceTextIvrChange:"&",voicePrompts:"=",stopAudio:"&",showSubmitFunction:"&showSubmit",isLocationIvr:"=",byDefaultRing:"=",validateIvr:"&",defaultData:"=",showSubmitOverflow:"&",disableRC:"=",voicemailComponent:"=",disableSaveForSchedule:"="},controller:["$scope","$rootScope",function(e,t){if(void 0!==e.locObj&&null!==e.locObj&&""!==e.locObj||(e.locObj={id:"",name:""}),e.overflowValidationHeader="3rd level IVR",""!==e.defaultData&&void 0!==e.defaultData){if(!0===e.defaultData.play_whisper_message){e.tcAction.whisperTTSText="",e.whisperAudio=void 0;var o=e.defaultData.play_whisper_message_text;"file://"==e.defaultData.play_whisper_message_text.substring(0,7)?(e.tcAction.TTSWhisperSelected=!1,e.tcAction.whisperPrompt=e.defaultData.play_whisper_message,e.tcAction.whisperText=e.defaultData.whisper_message_name,e.tcAction.whisperFileName=o.replace("file://",""),e.tcAction.whisperURL=e.defaultData.whisper_message_url,e.tcAction.whisperId=e.defaultData.whisper_id,e.tcAction.hasValidWhisperURL=!0):(e.tcAction.TTSWhisperSelected=!0,e.tcAction.whisperPrompt=e.defaultData.play_whisper_message,e.tcAction.whisperTTSText=o,e.tcAction.whisperFileName=o)}if(!0===e.defaultData.play_voice_prompt_first){e.ivrAudio=void 0,e.tcAction.voicepromptTTSText="";var a=e.defaultData.play_voice_prompt_first_text;"file://"==a.substring(0,7)?(e.tcAction.TTSIVRSelected=!1,e.tcAction.hasValidTTSVoiceURL=!0,e.tcAction.voicepromptText=e.defaultData.prompt_message_name,e.tcAction.voicepromptFileName=a.replace("file://",""),e.tcAction.voicepromptURL=e.defaultData.voice_prompt_url,e.tcAction.voicepromptId=e.defaultData.voice_prompt_id,e.tcAction.hasValidTTSVoiceURL=!0):(e.tcAction.TTSIVRSelected=!0,e.tcAction.voicepromptTTSText=a,e.tcAction.voicepromptFileName=a)}e.tcAction.playDisclaimer=e.defaultData.play_disclaimer,e.tcAction.activateVoiceMail=!1===e.voicemailComponent?e.tcAction.activateVoiceMail=!1:e.defaultData.activate_voicemail,e.tcAction.activateVoiceMail?(e.tcAction.recordCall=!0,e.tcAction.disableRC=!0):e.tcAction.recordCall=e.defaultData.record_call}e.pauseCurrentPlayingAudio=function(){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),t.$emit("stopIvrAudios",{})},t.$on("stopIvrAudios",function(){e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio1&&e.ivrAudio1.pause(),e.whisperAudio&&e.whisperAudio.pause()})}],templateUrl:"views/directives/third_multi_level_ivr.html"}}]),e.directive("secondMultiLevelIvr",["pinesNotifications","$uibModal","$bootbox","VoicePromptService","WhisperMessageService","CampaignWebService",function(e,t,o,a,i,r){return{restrict:"E",link:function(n,s){n.idnum=n.ivrActions.length;var l="",c="";n.byDefaultRing||(n.byDefaultRing=3),n.scAction.ivrActions&&n.scAction.ivrActions.length||(n.scAction.ivrActions=[],n.scAction.ivrActions=[{id:1,action:"simple",action_order:1,TTSIVRSelected:!0,voicepromptURL:"",voicepromptId:"",ringtoNum:"",keypress:"",destination:"",previousmenu:"",message_type:l,message:c,recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",isLocationIvr:!1,disableRC:!1,voicemailComponent:!1}]),n.scAction.ringtoNum&&10==n.scAction.ringtoNum.replace(/[^0-9]+/g,"").length?n.scAction.isValidRingTo=!0:n.scAction.isValidRingTo=!1,void 0!==n.scAction.geoRoute&&null!==n.scAction.geoRoute&&""!==n.scAction.geoRoute&&(n.scAction.geoRoute.geoList&&void 0!==n.scAction.geoRoute.geoList&&""!==n.scAction.geoRoute.geoList&&null!==n.scAction.geoRoute.geoList?n.georoutelocations.forEach(function(e){e.id===parseInt(n.scAction.geoRoute.geoList)&&(n.locObj=e)}):n.locObj={id:"",name:""}),n.changeLocId=function(e){n.scAction.geoRoute.geoList=e.id},n.removeIvrAction=function(t){o.confirm("Are you sure you want to delete this IVR Action?",function(o){if(o){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),n.pauseCurrentPlayingAudio();var a=!0;$.each(n.ivrActions,function(e,o){a&&o.id==t&&(n.ivrActions.splice(e,1),a=!1)}),$.each(n.ivrActions,function(e,o){o.id>t&&0!==t&&(n.ivrActions[e].id=o.id-1),0===o.id&&(n.ivrActions[e].id=e+1)}),e.notify({title:"Multilevel IVR Key Press",text:"Deleted Successfully",type:"success"})}})},n.showSubmit=function(){n.showSubmitFunction(),n.scAction.ringtoNum&&10==n.scAction.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length?n.scAction.isValidRingTo=!0:n.scAction.isValidRingTo=!1};n.chkSpclChar=function(t,o,a){var i=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;i.test(t)?(e.notify({title:o,text:"Special characters are not allowed",type:"error"}),a(t.replace(i,""))):a(t)},n.whisperIVRTextChange=function(e){void 0!==e.whisperTTSText&&0!==e.whisperTTSText.length&&n.chkSpclChar(e.whisperTTSText,"2nd Level Whisper Message",function(t){e.whisperTTSText=t}),void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,void 0===e.whisperText||0===e.whisperText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):n.chkSpclChar(e.voicepromptTTSText,"2nd Level Voice Prompt",function(t){e.voicepromptTTSText=t,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0})},n.removeSelectedWhisperAudio=function(e){void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,e.TTSWhisperSelected=!0,e.whisperTTSText="",e.hasValidWhisperURL=!1,e.whisperURL=""},n.showIVRWhisperModal=function(e){n.disableBtn=!0,d(),t.open({templateUrl:"assets/partials/assignWhisper.html",controller:"whisperModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<i.whispers.length;t++)!0===i.whispers[t].selectedwhisper&&(e.whisperText=i.whispers[t].name,e.whisperFileName=i.whispers[t].filename,e.whisperId=i.whispers[t].id,e.whisperURL=i.whispers[t].url,e.whisperAudio=void 0,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0);n.whisperAudio=void 0,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.whisperTTSText="",n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})},n.playWhisperAudio=function(e){void 0===n.whisperAudio||n.whisperAudio.paused?void 0!==n.whisperAudio&&n.whisperAudio.paused?n.whisperAudio.play():e.whisperTTSText.length>0?(n.whisperAudio=new Audio,n.onTTS_IVR_Request=!0,r.getTTS(e.whisperTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.whisperAudio.src=t,n.whisperAudio.paused?n.whisperAudio.play():n.whisperAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.whisperAudio=new Audio(e.whisperURL),n.whisperAudio.play()):n.whisperAudio.pause()},n.whisperAudioIsPlaying=function(){return void 0!==n.whisperAudio&&!n.whisperAudio.paused&&!n.whisperAudio.ended},n.disableRecordCall=function(){n.scAction.activateVoiceMail?(n.scAction.disableRC=!1,n.scAction.recordCall=!0):(n.scAction.disableRC=!0,n.scAction.recordCall=!0)};n.inheritKeyPress=function(){n.secondkeyPress=n.ivrActions.slice(-1)[0].previousmenu;for(var e=0;e<n.ivrActions.length;e++)n.ivrActions[e].previousmenu=n.secondkeyPress},n.addAction=function(){if(n.inheritKeyPress(),function(){for(var t,o=!1,a=[],i=!1,r=n.ivrActions.length-1;r>=0;r--)console.log("ivr =",n.ivrActions[r]),""!==n.ivrActions[r].keypress&&void 0!==n.ivrActions[r].keypress&&null!==n.ivrActions[r].keypress||a.push("Keypress"),""!==n.ivrActions[r].destination&&void 0!==n.ivrActions[r].destination&&null!==n.ivrActions[r].destination||a.push("Destination"),""!==n.ivrActions[r].voicepromptTTSText&&void 0!==n.ivrActions[r].voicepromptTTSText&&null!==n.ivrActions[r].voicepromptTTSText||""!==n.ivrActions[r].voicepromptURL&&void 0!==n.ivrActions[r].voicepromptURL&&null!==n.ivrActions[r].voicepromptURL||"interactiveVoice"!==n.ivrActions[r].action||a.push("Voice Prompt"),""!==n.ivrActions[r].previousmenu&&void 0!==n.ivrActions[r].previousmenu&&null!==n.ivrActions[r].previousmenu||a.push("Go Back to the previous menu"),"interactiveVoice"!==n.ivrActions[r].action&&(!0===n.ivrActions[r].openOverflowBox&&n.ivrActions[r].overflowNumbers.length>0&&angular.forEach(n.ivrActions[r].overflowNumbers,function(e){""!==e.overflowNumber&&void 0!==e.overflowNumber&&null!==e.overflowNumber&&10===e.overflowNumber.replace(/[^0-9]+/g,"").length||a.push("Overflow Ring to Phone Number")}),n.ivrActions[r].recordCall&&("true"!==n.ivrActions[r].playDisclaimer&&""!==n.ivrActions[r].playDisclaimer&&void 0!==n.ivrActions[r].playDisclaimer&&null!==n.ivrActions[r].playDisclaimer||a.push("Play call recording disclaimer")),n.ivrActions[r].whisperPrompt&&(void 0!==n.ivrActions[r].whisperTTSText&&""!==n.ivrActions[r].whisperTTSText&&null!==n.ivrActions[r].whisperTTSText||""!==n.ivrActions[r].whisperURL&&void 0!==n.ivrActions[r].whisperURL&&null!==n.ivrActions[r].whisperURL||a.push("Play whisper message before connecting")),"simple"===n.ivrActions[r].action&&(""!==n.ivrActions[r].ringtoNum&&10===n.ivrActions[r].ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length||(a.push("Ring to Phone Number"),n.ivrActions[r].isValidRingTo=!1)),"geo"===n.ivrActions[r].action&&(""!==n.ivrActions[r].geoRoute.routeBy&&void 0!==n.ivrActions[r].geoRoute.routeBy||a.push("Route By"),""!==n.ivrActions[r].geoRoute.geoList&&void 0!==n.ivrActions[r].geoRoute.geoList||a.push("Location List"),""!==n.ivrActions[r].ringtoNum&&10===n.ivrActions[r].ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length||(a.push("Default Number"),n.ivrActions[r].isValidRingTo=!0),"Zipcode"!==n.ivrActions[r].geoRoute.routeBy&&"Npa"!==n.ivrActions[r].geoRoute.routeBy||""!==n.ivrActions[r].geoRoute.radius&&void 0!==n.ivrActions[r].geoRoute.radius||a.push("Proximity Limit")),"schedule"===n.ivrActions[r].action&&(""!==n.ivrActions[r].scheduleRoute.timezone&&void 0!==n.ivrActions[r].scheduleRoute.timezone&&null!==n.ivrActions[r].scheduleRoute.timezone||a.push("Time Zone"),_.each(n.ivrActions[r].scheduleRoute.scheduleInfo,function(e){""!==e.fromTime&&void 0!==e.fromTime&&null!==e.fromTime||a.push("FromTime"),""!==e.toTime&&void 0!==e.toTime&&null!==e.toTime||a.push("ToTime"),0===e.days.length&&a.push("Days"),""!==e.ringTo&&void 0!==e.ringTo&&null!==e.ringTo&&10===e.ringTo.replace(/[^0-9]+/g,"").length||a.push("Ring to Phone Number"),_.each(e.overflowNumbers,function(t){!e.openOverflowBox||""!==t.overflowNumber&&void 0!==t.overflowNumber&&null!==t.overflowNumber&&10===t.overflowNumber.replace(/[^0-9]+/g,"").length||a.push("Overflow Ring to Phone Number")})}))),a.length>0&&(r=0);_.each(n.ivrActions,function(t){n.overflowNumberDuplicateL2=[],n.duplicateRingToOverflowL2=[],_.forEach(t.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var o=e.overflowNumber.replace(/[^0-9]+/g,"").replace(/^0+/,"");o===t.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"")&&n.duplicateRingToOverflowL2.push(o),n.overflowNumberDuplicateL2.push({unmaskNumber:o,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),n.overflowNumberDuplicateL2.length!=_.uniq(n.overflowNumberDuplicateL2,"unmaskNumber").length&&!0===t.isSimultaneousRing&&"interactiveVoice"!==t.action&&(e.notify({title:"2nd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),i=!0),_.isEmpty(n.duplicateRingToOverflowL2)||!0!==t.isSimultaneousRing||"interactiveVoice"===t.action||(e.notify({title:"2nd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),i=!0)});for(var s=0;s<n.ivrActions.length;s++)n.ivrActions[s].keypress==n.ivrActions[s].previousmenu&&(e.notify({title:"Secong level IVR Key Press",text:"keypress and backpress value should not be same",type:"error"}),o=!0);return a.length>0?(t=" field is required.",a.length>1&&(t=" fields are required."),e.notify({title:"2nd level IVR Form",text:a.toString()+t,type:"error"}),!1):!o&&!i}()){var t={id:n.scAction.id+1,action:"simple",action_order:n.ivrActions[n.ivrActions.length-1].action_order+1,TTSIVRSelected:!0,voicepromptURL:"",voicepromptId:"",ringtoNum:"",keypress:"",destination:"",previousmenu:n.secondkeyPress,message_type:l,message:c,recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,isLocationIvr:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",disableRC:!1,voicemailComponent:!1};n.ivrActions.push(t)}},n.removeSelectedIvrVoiceAudio=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,e.voicepromptURL=void 0,e.voicepromptTTSText="",e.TTSIVRSelected=!0,e.voicepromptText="",e.hasValidTTSVoiceURL=!1},n.voiceTextIvrChange=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,void 0===e.voicepromptTTSText||0===e.voicepromptTTSText.length?(e.hasValidTTSVoiceURL=!1,e.TTSIVRSelected=!0):n.chkSpclChar(e.voicepromptTTSText,"2nd Level Voice Prompt",function(t){e.voicepromptTTSText=t,e.hasValidTTSVoiceURL=!0,e.TTSIVRSelected=!0})},n.disablePlayBtn=function(e){var t=$(".playpadding"),o=angular.element(document.querySelector("#voicemail")),a=e.currentTarget,i=a.children[0];i.classList.add("fa-pause");var r=setInterval(function(){i.classList.contains("fa-pause")?(t.each(function(e,t){!1===t.disabled&&(t.classList.add("customDisabled"),n.disableBtn=!0)}),a.classList.remove("customDisabled"),o.removeClass("customDisabled")):(t.removeClass("customDisabled"),o.removeClass("customDisabled"),n.disableBtn=!1,clearInterval(r))},100)},n.showIvrVoiceModal=function(e){n.disableBtn=!0,d(),t.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:"lg"}).result.then(function(){for(var t=0;t<a.prompts.length;t++)!0===a.prompts[t].selectedprompt&&(e.voicepromptText=a.prompts[t].name,e.voicepromptFileName=a.prompts[t].filename,e.voicepromptURL=a.prompts[t].url,e.voicepromptId=a.prompts[t].id);e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0,e.voicepromptTTSText="",n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})};var d=function(){void 0!==n.ivrAudio&&(n.ivrAudio.pause(),n.ivrAudio=void 0),void 0!==n.whisperAudio&&(n.whisperAudio.pause(),n.whisperAudio=void 0)};n.playTtsVoiceAudio=function(e){void 0===n.ivrAudio||n.ivrAudio.paused?void 0!==n.ivrAudio&&n.ivrAudio.paused?n.ivrAudio.play():e.voicepromptTTSText.length>0?(n.ivrAudio=new Audio,n.onTTS_IVR_Request=!0,r.getTTS(e.voicepromptTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.ivrAudio.src=t,n.ivrAudio.paused?n.ivrAudio.play():n.ivrAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.ivrAudio=new Audio(e.voicepromptURL),n.ivrAudio.play()):n.ivrAudio.pause()},n.retainDataOnChange=function(){n.scAction.scheduleRoute.default_ringto=n.scAction.ringtoNum,n.scAction.scheduleRoute.activate_voicemail=n.scAction.activateVoiceMail,n.scAction.scheduleRoute.recordCall=n.scAction.recordCall,n.scAction.scheduleRoute.disableRC=n.scAction.disableRC},n.getGeoLocationList=function(){r.getGeoLocations().then(function(e){"error"!=e.data.result&&(n.georoutelocations=[],e.data.json.locations.forEach(function(e){e.count>0&&n.georoutelocations.push({id:e.id,name:e.name})}))})},n.scAction.TTSIVRSelected?(l="text",c=n.scAction.voicepromptTTSText):(l="file",c=n.scAction.voicepromptFileName)},scope:{level:"=",ivrActions:"=",scactionId:"=",scAction:"=",georoutelocations:"=",removeSelectedIvrVoiceAudio:"&",audioIsDownloading:"&",audioIsPlaying:"&",showIvrVoiceModal:"&",playTtsVoiceAudio:"&",voiceTextIvrChange:"&",voicePrompts:"=",stopAudio:"&",showSubmitFunction:"&showSubmit",isLocationIvr:"=",byDefaultRing:"=",defaultData:"=",showSubmitOverflow:"&",disableRC:"=",voicemailComponent:"=",disableSaveForSchedule:"="},controller:["$scope","$rootScope",function(e,t){if(void 0!==e.locObj&&null!==e.locObj&&""!==e.locObj||(e.locObj={id:"",name:""}),e.overflowValidationHeader="2nd level IVR",""!==e.defaultData&&void 0!==e.defaultData){if(!0===e.defaultData.play_whisper_message){e.scAction.whisperTTSText="",e.whisperAudio=void 0;var o=e.defaultData.play_whisper_message_text;"file://"==e.defaultData.play_whisper_message_text.substring(0,7)?(e.scAction.TTSWhisperSelected=!1,e.scAction.whisperPrompt=e.defaultData.play_whisper_message,e.scAction.whisperText=e.defaultData.whisper_message_name,e.scAction.whisperFileName=o.replace("file://",""),e.scAction.whisperURL=e.defaultData.whisper_message_url,e.scAction.whisperId=e.defaultData.whisper_id,e.scAction.hasValidWhisperURL=!0):(e.scAction.TTSWhisperSelected=!0,e.scAction.whisperPrompt=e.defaultData.play_whisper_message,e.scAction.whisperTTSText=o,e.scAction.whisperFileName=o)}if(!0===e.defaultData.play_voice_prompt_first){e.ivrAudio=void 0,e.scAction.voicepromptTTSText="";var a=e.defaultData.play_voice_prompt_first_text;"file://"==a.substring(0,7)?(e.scAction.TTSIVRSelected=!1,e.scAction.hasValidTTSVoiceURL=!0,e.scAction.voicepromptText=e.defaultData.prompt_message_name,e.scAction.voicepromptFileName=a.replace("file://",""),e.scAction.voicepromptURL=e.defaultData.voice_prompt_url,e.scAction.voicepromptId=e.defaultData.voice_prompt_id,e.scAction.hasValidTTSVoiceURL=!0):(e.scAction.TTSIVRSelected=!0,e.scAction.voicepromptTTSText=a,e.scAction.voicepromptFileName=a)}e.scAction.playDisclaimer=e.defaultData.play_disclaimer,e.scAction.activateVoiceMail=!1===e.voicemailComponent?e.scAction.activateVoiceMail=!1:e.defaultData.activate_voicemail,e.scAction.activateVoiceMail?(e.scAction.recordCall=!0,e.scAction.disableRC=!0):e.scAction.recordCall=e.defaultData.record_call}e.pauseCurrentPlayingAudio=function(){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),t.$emit("stopIvrAudios",{})},t.$on("stopIvrAudios",function(){e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio1&&e.ivrAudio1.pause(),e.whisperAudio&&e.whisperAudio.pause()})}],templateUrl:"views/directives/second_multi_level_ivr.html"}}]),e.factory("MaxNumbersService",[function(){function e(e,t,o){this.val=e.toString(),this.pointIndex=this.val.indexOf("."),this.integersLength=-1!==this.pointIndex?this.val.substring(0,this.pointIndex).length:this.val.length,this.decimalsLength=-1!==this.pointIndex?this.val.substring(this.pointIndex+1).length:0,this.allowedIntegerLength=t,this.allowedDecimalLength=o,this.hasChanged=!1}return e.prototype.isNotANumber=function(){return isNaN(Number(this.val))},e.prototype.handleIsNaN=function(){for(;isNaN(Number(this.val));)this.val=this.val.substr(0,this.val.length-1);this.hasChanged=!0},e.prototype.throwDecimals=function(){var e=this.allowedDecimalLength?this.allowedDecimalLength+1:0;this.val=this.val.substring(0,this.pointIndex+e),this.hasChanged=!0},e.prototype.hasDecimals=function(){return-1!==this.val.indexOf(".")},e.prototype.hasTooMuchDecimals=function(){return this.decimalsLength>this.allowedDecimalLength},e.prototype.hasTooMuchIntegers=function(){return this.integersLength>this.allowedIntegerLength},e.prototype.throwIntegers=function(){var e=this.allowedIntegerLength;-1!==this.pointIndex?(e=this.pointIndex<=this.allowedIntegerLength?this.pointIndex:this.allowedIntegerLength,this.val=this.val.substr(0,e)):this.val=this.val.substr(0,e),this.hasChanged=!0},e.prototype.didItChanged=function(){return this.hasChanged},e}]),e.directive("maxNumbers",["MaxNumbersService",function(e){return{require:"ngModel",link:function(t,o,a,i){var r=parseInt(a.maxNumbers),n=r,s=0;if("decimals"in a&&(s=parseInt(a.decimals),n=r-s),"min"in a){var l=parseFloat(a.min);i.$validators.min=function(e){return!e||e>=l}}if("max"in a){var c=parseFloat(a.max);i.$validators.max=function(e){return!e||e<=c}}i.$parsers.unshift(function(t){var o=new e(t,n,s);return o.isNotANumber()&&o.handleIsNaN(),o.hasDecimals()&&(s?o.hasTooMuchDecimals()&&o.throwDecimals():o.throwDecimals()),o.hasTooMuchIntegers()&&o.throwIntegers(),o.didItChanged()&&i.$setViewValue(o.val),i.$render(),o.val}),i.$parsers.unshift(function(e){return String(e)}),i.$parsers.push(function(e){return e?Number(e):e}),"simpleLink"in a||(i.$formatters.unshift(function(e){return e?String(e):e}),i.$formatters.push(function(t){if(!t)return t;var o=new e(t,n,s);return o.isNotANumber()&&o.handleIsNaN(),o.hasDecimals()&&(s?o.hasTooMuchDecimals()&&o.throwDecimals():o.throwDecimals()),o.hasTooMuchIntegers()&&o.throwIntegers(),o.didItChanged()&&i.$setViewValue(t),o.val}))}}}]),e.directive("multiLevelIvr",["pinesNotifications","WhisperMessageService","$uibModal","$bootbox","CampaignWebService","VoicePromptService",function(e,t,o,a,i,r){return{restrict:"E",link:function(n,s){n.idnum=n.ivrActions.length;n.byDefaultRing||(n.byDefaultRing=3),n.overflowValidationHeader="1st level IVR",n.cAction.ivrActions&&n.cAction.ivrActions.length||(n.cAction.ivrActions=[],n.cAction.ivrActions=[{id:1,action:"simple",action_order:1,TTSIVRSelected:!0,voicepromptURL:"",voicepromptId:"",ringtoNum:"",keypress:"",destination:"",message_type:"",message:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",isLocationIvr:!1,disableRC:!1,voicemailComponent:!1}]),n.cAction.ringtoNum&&10==n.cAction.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length?n.cAction.isValidRingTo=!0:n.cAction.isValidRingTo=!1,void 0!==n.cAction.geoRoute&&null!==n.cAction.geoRoute&&""!==n.cAction.geoRoute&&(n.cAction.geoRoute.geoList&&void 0!==n.cAction.geoRoute.geoList&&""!==n.cAction.geoRoute.geoList&&null!==n.cAction.geoRoute.geoList?n.georoutelocations.forEach(function(e){e.id===parseInt(n.cAction.geoRoute.geoList)&&(n.locObj=e)}):n.locObj={id:"",name:""}),n.changeLocId=function(e){n.cAction.geoRoute.geoList=e.id},n.whisperIVRTextChange=function(e){void 0===e.whisperTTSText&&0===e.whisperTTSText.length||n.chkSpclChar(e.whisperTTSText,"1st Level Whisper Message",function(t){e.whisperTTSText=t}),void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,void 0===e.whisperText||0===e.whisperText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):(e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0)},n.removeSelectedWhisperAudio=function(e){void 0!==n.whisperAudio&&n.whisperAudio.pause(),n.whisperAudio=void 0,e.TTSWhisperSelected=!0,e.whisperTTSText="",e.hasValidWhisperURL=!1,e.whisperURL=""},n.showIVRWhisperModal=function(e){n.disableBtn=!0,l(),o.open({templateUrl:"assets/partials/assignWhisper.html",controller:"whisperModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){for(var o=0;o<t.whispers.length;o++)!0===t.whispers[o].selectedwhisper&&(e.whisperText=t.whispers[o].name,e.whisperFileName=t.whispers[o].filename,e.whisperId=t.whispers[o].id,e.whisperURL=t.whispers[o].url,e.whisperAudio=void 0,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0);e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.whisperTTSText="",n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})},n.disablePlayBtn=function(e){var t=$(".playpadding").not(this),o=angular.element(document.querySelector("#voicemail")),a=e.currentTarget,i=a.children[0];i.classList.add("fa-pause");var r=setInterval(function(){i.classList.contains("fa-pause")?(t.each(function(e,t){!1===t.disabled&&(t.classList.add("customDisabled"),n.disableBtn=!0)}),a.classList.remove("customDisabled"),o.removeClass("customDisabled")):(t.removeClass("customDisabled"),o.removeClass("customDisabled"),n.disableBtn=!1,clearInterval(r))},100)},n.playWhisperAudio=function(e){void 0===n.whisperAudio||n.whisperAudio.paused?void 0!==n.whisperAudio&&n.whisperAudio.paused?n.whisperAudio.play():e.whisperTTSText.length>0?(n.whisperAudio=new Audio,n.onTTS_IVR_Request=!0,i.getTTS(e.whisperTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.whisperAudio.src=t,n.whisperAudio.paused?n.whisperAudio.play():n.whisperAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.whisperAudio=new Audio(e.whisperURL),n.whisperAudio.play()):n.whisperAudio.pause()},n.whisperAudioIsPlaying=function(){return void 0!==n.whisperAudio&&!n.whisperAudio.paused&&!n.whisperAudio.ended};var l=function(){void 0!==n.whisperAudio&&(n.whisperAudio.pause(),n.whisperAudio=void 0),void 0!==n.ivrAudio&&(n.ivrAudio.pause(),n.ivrAudio=void 0)};n.removeIvrAction=function(t){a.confirm("Are you sure you want to delete this IVR Action?",function(o){if(o){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),n.pauseCurrentPlayingAudio();var a=!0;$.each(n.ivrActions,function(e,o){a&&o.id==t&&(n.ivrActions.splice(e,1),a=!1)}),$.each(n.ivrActions,function(e,o){o.id>t&&0!==t&&(n.ivrActions[e].id=o.id-1),0===o.id&&(n.ivrActions[e].id=e+1)}),e.notify({title:"Multilevel IVR Key Press",text:"Deleted Successfully",type:"success"})}})};n.showSubmit=function(){n.showSubmitFunction(),n.cAction.ringtoNum&&10==n.cAction.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length?n.cAction.isValidRingTo=!0:n.cAction.isValidRingTo=!1},n.showIvrVoiceModal=function(e){n.disableBtn=!0,l(),o.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:"lg"}).result.then(function(){for(var t=0;t<r.prompts.length;t++)!0===r.prompts[t].selectedprompt&&(e.voicepromptText=r.prompts[t].name,e.voicepromptFileName=r.prompts[t].filename,e.voicepromptURL=r.prompts[t].url,e.voicepromptId=r.prompts[t].id);console.log(r.prompts),n.prompts=r.prompts,e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0,e.voicepromptTTSText="",n.ivrAudio=void 0,n.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),n.disableBtn=!1})},n.removeSelectedIvrVoiceAudio=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,e.voicepromptURL=void 0,e.voicepromptTTSText="",e.TTSIVRSelected=!0,e.voicepromptText="",e.hasValidTTSVoiceURL=!1},n.chkSpclChar=function(t,o,a){var i=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;i.test(t)?(e.notify({title:o,text:"Special characters are not allowed",type:"error"}),a(t.replace(i,""))):a(t)},n.voiceTextIvrChange=function(e){void 0!==n.ivrAudio&&n.ivrAudio.pause(),n.ivrAudio=void 0,void 0===e.voicepromptTTSText||0===e.voicepromptTTSText.length?(e.hasValidTTSVoiceURL=!1,e.TTSIVRSelected=!0):n.chkSpclChar(e.voicepromptTTSText,"1st Level Voice Prompt",function(t){e.voicepromptTTSText=t,e.hasValidTTSVoiceURL=!0,e.TTSIVRSelected=!0})},n.playTtsVoiceAudio=function(e){void 0===n.ivrAudio||n.ivrAudio.paused?void 0!==n.ivrAudio&&n.ivrAudio.paused?n.ivrAudio.play():e.voicepromptTTSText.length>0?(n.ivrAudio=new Audio,n.onTTS_IVR_Request=!0,i.getTTS(e.voicepromptTTSText).then(function(e){if(e.data.json.length>1){var t="data:audio/mp3;base64,"+e.data.json;n.ivrAudio.src=t,n.ivrAudio.paused?n.ivrAudio.play():n.ivrAudio.pause()}n.onTTS_IVR_Request=void 0})):(n.ivrAudio=new Audio(e.voicepromptURL),n.ivrAudio.play()):n.ivrAudio.pause()},n.disableRecordCall=function(){n.cAction.activateVoiceMail?(n.cAction.disableRC=!1,n.cAction.recordCall=!0):(n.cAction.disableRC=!0,n.cAction.recordCall=!0)};n.addAction=function(){if(function(){for(var t=[],o="",a=!1,i=n.ivrActions.length-1;i>=0;i--)console.log("ivr =",n.ivrActions[i]),""!==n.ivrActions[i].keypress&&void 0!==n.ivrActions[i].keypress&&null!==n.ivrActions[i].keypress||t.push("Keypress"),""!==n.ivrActions[i].destination&&void 0!==n.ivrActions[i].destination&&null!==n.ivrActions[i].destination||t.push("Destination"),""!==n.ivrActions[i].voicepromptTTSText&&void 0!==n.ivrActions[i].voicepromptTTSText&&null!==n.ivrActions[i].voicepromptTTSText||""!==n.ivrActions[i].voicepromptURL&&void 0!==n.ivrActions[i].voicepromptURL&&null!==n.ivrActions[i].voicepromptURL||"interactiveVoice"!==n.ivrActions[i].action||t.push("Voice Prompt"),"interactiveVoice"!==n.ivrActions[i].action&&(!0===n.ivrActions[i].openOverflowBox&&n.ivrActions[i].overflowNumbers.length>0&&angular.forEach(n.ivrActions[i].overflowNumbers,function(e){""!==e.overflowNumber&&void 0!==e.overflowNumber&&null!==e.overflowNumber&&10===e.overflowNumber.replace(/[^0-9]+/g,"").length||t.push("Overflow Ring to Phone Number")}),n.ivrActions[i].recordCall&&("true"!==n.ivrActions[i].playDisclaimer&&""!==n.ivrActions[i].playDisclaimer&&void 0!==n.ivrActions[i].playDisclaimer||t.push("Play call recording disclaimer")),n.ivrActions[i].whisperPrompt&&(void 0!==n.ivrActions[i].whisperTTSText&&""!==n.ivrActions[i].whisperTTSText&&null!==n.ivrActions[i].whisperTTSText||""!==n.ivrActions[i].whisperURL&&void 0!==n.ivrActions[i].whisperURL&&null!==n.ivrActions[i].whisperURL||t.push("Play whisper message before connecting")),"simple"===n.ivrActions[i].action&&(void 0!==n.ivrActions[i].ringtoNum&&""!==n.ivrActions[i].ringtoNum&&10===n.ivrActions[i].ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length||(t.push("Ring to Phone Number"),n.ivrActions[i].isValidRingTo=!1)),"geo"===n.ivrActions[i].action&&(""!==n.ivrActions[i].geoRoute.routeBy&&void 0!==n.ivrActions[i].geoRoute.routeBy||t.push("Route By"),""!==n.ivrActions[i].geoRoute.geoList&&void 0!==n.ivrActions[i].geoRoute.geoList||t.push("Location List"),""!==n.ivrActions[i].ringtoNum&&10===n.ivrActions[i].ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"").length||(t.push("Default Number"),n.ivrActions[i].isValidRingTo=!0),"Zipcode"!==n.ivrActions[i].geoRoute.routeBy&&"Npa"!==n.ivrActions[i].geoRoute.routeBy||""!==n.ivrActions[i].geoRoute.radius&&void 0!==n.ivrActions[i].geoRoute.radius||t.push("Proximity Limit")),"schedule"===n.ivrActions[i].action&&(""!==n.ivrActions[i].scheduleRoute.timezone&&void 0!==n.ivrActions[i].scheduleRoute.timezone&&null!==n.ivrActions[i].scheduleRoute.timezone||t.push("Time Zone"),_.each(n.ivrActions[i].scheduleRoute.scheduleInfo,function(e){""!==e.fromTime&&void 0!==e.fromTime&&null!==e.fromTime||t.push("FromTime"),""!==e.toTime&&void 0!==e.toTime&&null!==e.toTime||t.push("ToTime"),0===e.days.length&&t.push("Days"),""!==e.ringTo&&void 0!==e.ringTo&&null!==e.ringTo&&10===e.ringTo.replace(/[^0-9]+/g,"").length||t.push("Ring to Phone Number"),_.each(e.overflowNumbers,function(o){!e.openOverflowBox||""!==o.overflowNumber&&void 0!==o.overflowNumber&&null!==o.overflowNumber&&10===o.overflowNumber.replace(/[^0-9]+/g,"").length||t.push("Overflow Ring to Phone Number")})}))),t.length>0&&(i=0);return _.each(n.ivrActions,function(t){n.overflowNumberDuplicateL1=[],n.duplicateRingToOverflowL1=[],_.forEach(t.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var o=e.overflowNumber.replace(/[^0-9]+/g,"").replace(/^0+/,"");o===t.ringtoNum.replace(/[^0-9]+/g,"").replace(/^0+/,"")&&n.duplicateRingToOverflowL1.push(o),n.overflowNumberDuplicateL1.push({unmaskNumber:o,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),n.overflowNumberDuplicateL1.length!=_.uniq(n.overflowNumberDuplicateL1,"unmaskNumber").length&&!0===t.isSimultaneousRing&&"interactiveVoice"!==t.action&&(e.notify({title:"1st level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),a=!0),_.isEmpty(n.duplicateRingToOverflowL1)||!0!==t.isSimultaneousRing||"interactiveVoice"===t.action||(e.notify({title:"1st level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),a=!0)}),t.length>0?(o=" field is required.",t.length>1&&(o=" fields are required."),e.notify({title:"1st level IVR Form",text:t.toString()+o,type:"error"}),!1):!a}()){var t={id:n.cAction.id+1,action_order:n.ivrActions[n.ivrActions.length-1].action_order+1,action:"simple",value:"",TTSIVRSelected:!0,voicepromptURL:"",voicepromptId:"",ringtoNum:"",keypress:"",destination:"",message_type:"",message:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:[{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before",disableRC:!1}],overflowNumbers:[{overflowNumber:"",rings:n.byDefaultRing,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,isLocationIvr:!1,whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",disableRC:!1,voicemailComponent:!1};n.ivrActions.push(t)}},n.retainDataOnChange=function(){n.cAction.scheduleRoute.default_ringto=n.cAction.ringtoNum,n.cAction.scheduleRoute.activate_voicemail=n.cAction.activateVoiceMail,n.cAction.scheduleRoute.recordCall=n.cAction.recordCall,n.cAction.scheduleRoute.disableRC=n.cAction.disableRC},n.getGeoLocationList=function(){i.getGeoLocations().then(function(e){"error"!=e.data.result&&(n.georoutelocations=[],e.data.json.locations.forEach(function(e){e.count>0&&n.georoutelocations.push({id:e.id,name:e.name})}))})}},scope:{level:"=",ivrActions:"=",cactionId:"=",cAction:"=",georoutelocations:"=",removeSelectedIvrVoiceAudio:"&",voicePrompts:"=",audioIsDownloading:"&",stopAudio:"&",showSubmitFunction:"&showSubmit",isLocationIvr:"=",byDefaultRing:"=",validateIvr:"&",defaultData:"=",showSubmitOverflow:"&",disableRC:"=",voicemailComponent:"=",disableSaveForSchedule:"="},controller:["$scope","$rootScope",function(e,t){if(void 0!==e.locObj&&null!==e.locObj&&""!==e.locObj||(e.locObj={id:"",name:""}),""!==e.defaultData&&void 0!==e.defaultData){if(!0===e.defaultData.play_whisper_message){e.cAction.whisperTTSText="",e.whisperAudio=void 0;var o=e.defaultData.play_whisper_message_text;"file://"==e.defaultData.play_whisper_message_text.substring(0,7)?(e.cAction.TTSWhisperSelected=!1,e.cAction.whisperPrompt=e.defaultData.play_whisper_message,e.cAction.whisperText=e.defaultData.whisper_message_name,e.cAction.whisperFileName=o.replace("file://",""),e.cAction.whisperURL=e.defaultData.whisper_message_url,e.cAction.whisperId=e.defaultData.whisper_id,e.cAction.hasValidWhisperURL=!0):(e.cAction.TTSWhisperSelected=!0,e.cAction.whisperPrompt=e.defaultData.play_whisper_message,e.cAction.whisperTTSText=o,e.cAction.whisperFileName=o)}if(!0===e.defaultData.play_voice_prompt_first){e.ivrAudio=void 0,e.cAction.voicepromptTTSText="";var a=e.defaultData.play_voice_prompt_first_text;"file://"==a.substring(0,7)?(e.cAction.TTSIVRSelected=!1,e.cAction.hasValidTTSVoiceURL=!0,e.cAction.voicepromptText=e.defaultData.prompt_message_name,e.cAction.voicepromptFileName=a.replace("file://",""),e.cAction.voicepromptURL=e.defaultData.voice_prompt_url,e.cAction.voicepromptId=e.defaultData.voice_prompt_id,e.cAction.hasValidTTSVoiceURL=!0):(e.cAction.TTSIVRSelected=!0,e.cAction.voicepromptTTSText=a,e.cAction.voicepromptFileName=a)}e.cAction.playDisclaimer=e.defaultData.play_disclaimer,e.cAction.activateVoiceMail=!1===e.voicemailComponent?e.cAction.activateVoiceMail=!1:e.defaultData.activate_voicemail,e.cAction.activateVoiceMail?(e.cAction.recordCall=!0,e.cAction.disableRC=!0):e.cAction.recordCall=e.defaultData.record_call}e.pauseCurrentPlayingAudio=function(){$(".playpadding").each(function(e,t){t.children[0].classList.remove("fa-pause")}),t.$emit("stopIvrAudios",{})},t.$on("stopIvrAudios",function(){e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio1&&e.ivrAudio1.pause(),e.whisperAudio&&e.whisperAudio.pause()})}],templateUrl:"views/directives/multilevel_ivr.html"}}]),e.directive("firstLevelScheduleRoute",["$http","UserWebService","pinesNotifications","$bootbox",function(e,t,o,a){return{restrict:"E",link:function(i){e.get("assets/demo/schedule_data.json").then(function(e){i.timeZones=e.data.timeZones,i.extendScheduleDays=e.data.extendScheduleDays,i.scheduledDays=e.data.scheduledDays,i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.scheduleEndTimeSlots=e.data.scheduleTimeSlots,$.each(i.scheduleRoute.scheduleInfo,function(t,o){i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.formationscheduleTimeSlots(t)})}),i.settings={enableSearch:!1,scrollable:!0,scrollableHeight:200,smartButtonMaxItems:5,showCheckAll:!1,showUncheckAll:!1},i.scheduleRoute.scheduleInfo?(i.scheduleInfo=i.scheduleRoute.scheduleInfo,_.each(i.scheduleRoute.scheduleInfo,function(e){1==e.activateVoicemail&&(i.scheduleRoute.disableRC=!0)}),i.scheduleRoute.activate_voicemail&&(i.scheduleRoute.disableRC=!0),void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0):(i.scheduleInfo=[],i.scheduleRoute.scheduleInfo=i.scheduleInfo,i.scheduleRoute.default_ringto=i.cAction.ringtoNum,i.scheduleRoute.activate_voicemail=i.cAction.activateVoiceMail,i.scheduleRoute.playDisclaimer="before",i.scheduleRoute.recordCall=i.cAction.recordCall,i.scheduleRoute.disableRC=i.cAction.disableRC,i.showAddSchedule=!0,void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0,i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,openOverflowBox:!1,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})),i.scheduleEvents={onItemCustomSelect:function(e){i.checkCurrentSchedule(e),i.showSubmitFunction()}},i.showSubmit=function(){i.showSubmitFunction()},i.showAddOverflow=function(e){void 0!==t.unMaskData(i.scheduleInfo[e].ringTo)&&10==t.unMaskData(i.scheduleInfo[e].ringTo).length&&"0"!==t.unMaskData(i.scheduleInfo[e].ringTo).slice(0,1)?(i.scheduleInfo[e].isAddOverflow=!1,i.checkCurrentSchedule(e)):(i.scheduleInfo[e].isAddOverflow=!0,i.showAddSchedule=!0)},i.checkCurrentSchedule=function(e){if(_.each(i.scheduleInfo,function(e){0!==e.days.length&&""!==e.fromTime&&""!==e.toTime&&void 0!==t.unMaskData(e.ringTo)?i.showAddSchedule=!1:i.showAddSchedule=!0}),r(e)){i.showAddSchedule=!0,i.disableSaveForSchedule.levelOne=!0,i.invalidSchedules++;var a=i.duplicateSchelduleID+1;1==a?a+="st":2==a?a+="nd":3==a?a+="rd":a>=4&&(a+="th"),i.scheduleRoute.isValid=!1,i.scheduleRoute.error="Check for Overlaping Schedule For "+a+" Schedule",o.notify({title:"1st level IVR Form",text:"Check for Overlaping Schedule For "+a+" Schedule",type:"error"})}else i.disableSaveForSchedule.levelOne=!1};var r=function(e){i.duplicateScheldule=!1,i.duplicateSchelduleID=-1,i.scheduleTimeSlots.push("End of Day");var t="",o="",a="",r="",n="",s="";if(i.scheduleRoute.error="",i.scheduleRoute.isValid=!0,i.scheduleInfo.length<1)return!1;if(9999==e?(t=i.scheduleInfo[$scope.scheduleInfo.length-1],o=i.scheduleInfo.length-1):(t=i.scheduleInfo[e],o=e),!(i.scheduleInfo.length>1))return i.scheduleTimeSlots.splice(-1,1),!1;for(var l=0;l<i.scheduleInfo.length;l++)if(i.scheduleInfo[l].days&&i.scheduleInfo[l].days.length>0)for(var c=0;c<i.scheduleInfo[l].days.length;c++)for(var d=0;d<t.days.length;d++)i.extendScheduleDays[i.scheduleInfo[l].days[c].id].indexOf(t.days[d].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l)),i.extendScheduleDays[t.days[d].id].indexOf(i.scheduleInfo[l].days[c].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l));return i.scheduleTimeSlots.splice(-1,1),i.duplicateScheldule?i.scheduleInfo[o].invalid=!0:void 0!==o&&(i.scheduleInfo[o].invalid=!1),i.duplicateScheldule};i.checkForValidSchedules=function(){for(var e=0,t=i.scheduleInfo.length-1;t>=0;t--)r(t);return _.each(i.scheduleInfo,function(t){(t.invalid||0===t.days.length)&&i.scheduleInfo.length>1&&e++}),e},i.addSchedule=function(){i.showAddSchedule=!0;var e=!1;_.each(i.scheduleInfo,function(o){e=0===o.days.length||""===o.fromTime||""===o.toTime||void 0===t.unMaskData(o.ringTo)}),e?0!==i.checkForValidSchedules()&&o.notify({title:"1st level IVR Form",text:"Please check for invalid schedule",type:"error"}):i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})},i.formationscheduleTimeSlots=function(e){i.scheduleInfo[e].scheduleEndTimeSlots=i.scheduleTimeSlots.slice(i.scheduleTimeSlots.indexOf(i.scheduleInfo[e].fromTime)+1,i.scheduleTimeSlots.length),i.scheduleInfo[e].scheduleEndTimeSlots.push("End of Day")},i.checkRingToNumberSchedule=function(e){return!e||"0"==t.unMaskData(e).charAt(0)||10!=t.unMaskData(e).length},i.removeSchedule=function(e){a.confirm("Are you sure you want to delete this Schedule?",function(t){r(e)&&i.invalidSchedules--,t&&(i.scheduleInfo.splice(e,1),angular.forEach(i.scheduleInfo,function(e){i.disableRC=!1,1==e.activateVoicemail&&(i.disableRC=!0,i.recordCall=!0),1==i.scheduleRoute.activate_voicemail&&(i.disableRC=!0)})),0===i.checkForValidSchedules()?(i.showAddSchedule=!1,i.disableSaveForSchedule.levelOne=!1,i.showSubmitFunction()):(o.notify({title:"1st level IVR Form",text:"Please check for invalid schedule",type:"error"}),i.showAddSchedule=!0)})},i.activateVoicemailSchedule=function(){i.scheduleRoute.default_ringto&&10==t.unMaskData(i.scheduleRoute.default_ringto).length?i.activatevm=!0:(i.scheduleRoute.activate_voicemail=!1,i.activatevm=!1)},i.retainDataOnChange=function(){i.cAction.ringtoNum=i.scheduleRoute.default_ringto,i.cAction.activateVoiceMail=i.scheduleRoute.activate_voicemail,i.cAction.recordCall=i.scheduleRoute.recordCall,i.cAction.disableRC=i.scheduleRoute.disableRC},i.disableRecordCall=function(e){var t=[];i.scheduleRoute.disableRC=!1,i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail,t.push(i.scheduleRoute.activate_voicemail);var o=_.pluck(i.scheduleRoute.scheduleInfo,"activateVoicemail");_.filter(o.concat(t),function(e){return!0===e}).length>0&&(i.scheduleRoute.disableRC=!0,i.scheduleRoute.recordCall=!0),i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail}},scope:{overflowValidationHeader:"=",scheduleRoute:"=",disableSaveForSchedule:"=",showSubmitOverflowMethod:"&",showSubmitFunction:"&showSubmit",voicemailComponent:"=",cAction:"="},templateUrl:"views/directives/firstLevel_scheduleRoute.html"}}]),e.directive("secondLevelScheduleRoute",["$http","UserWebService","pinesNotifications","$bootbox",function(e,t,o,a){return{restrict:"E",link:function(i){e.get("assets/demo/schedule_data.json").then(function(e){i.timeZones=e.data.timeZones,i.extendScheduleDays=e.data.extendScheduleDays,i.scheduledDays=e.data.scheduledDays,i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.scheduleEndTimeSlots=e.data.scheduleTimeSlots,$.each(i.scheduleRoute.scheduleInfo,function(t,o){i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.formationscheduleTimeSlots(t)})}),i.settings={enableSearch:!1,scrollable:!0,scrollableHeight:200,smartButtonMaxItems:5,showCheckAll:!1,showUncheckAll:!1},i.scheduleRoute.scheduleInfo?(i.scheduleInfo=i.scheduleRoute.scheduleInfo,_.each(i.scheduleRoute.scheduleInfo,function(e){1==e.activateVoicemail&&(i.scheduleRoute.disableRC=!0)}),i.scheduleRoute.activate_voicemail&&(i.scheduleRoute.disableRC=!0),void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0):(i.scheduleInfo=[],i.scheduleRoute.scheduleInfo=i.scheduleInfo,i.scheduleRoute.default_ringto=i.scAction.ringtoNum,i.scheduleRoute.activate_voicemail=i.scAction.activateVoiceMail,i.scheduleRoute.playDisclaimer="before",i.scheduleRoute.recordCall=i.scAction.recordCall,i.scheduleRoute.disableRC=i.scAction.disableRC,i.showAddSchedule=!0,void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0,i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,openOverflowBox:!1,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})),i.scheduleEvents={onItemCustomSelect:function(e){i.checkCurrentSchedule(e),i.showSubmitFunction()}},i.showSubmit=function(){i.showSubmitFunction()},i.showAddOverflow=function(e){void 0!==t.unMaskData(i.scheduleInfo[e].ringTo)&&10==t.unMaskData(i.scheduleInfo[e].ringTo).length&&"0"!==t.unMaskData(i.scheduleInfo[e].ringTo).slice(0,1)?(i.scheduleInfo[e].isAddOverflow=!1,i.checkCurrentSchedule(e)):(i.scheduleInfo[e].isAddOverflow=!0,i.showAddSchedule=!0)},i.checkCurrentSchedule=function(e){if(_.each(i.scheduleInfo,function(e){0!==e.days.length&&""!==e.fromTime&&""!==e.toTime&&void 0!==t.unMaskData(e.ringTo)?i.showAddSchedule=!1:i.showAddSchedule=!0}),r(e)){i.showAddSchedule=!0,i.disableSaveForSchedule.levelTwo=!0,i.invalidSchedules++;var a=i.duplicateSchelduleID+1;1==a?a+="st":2==a?a+="nd":3==a?a+="rd":a>=4&&(a+="th"),i.scheduleRoute.isValid=!1,i.scheduleRoute.error="Check for Overlaping Schedule For "+a+" Schedule",o.notify({title:"2nd level IVR Form",text:"Check for Overlaping Schedule For "+a+" Schedule",type:"error"})}else i.disableSaveForSchedule.levelTwo=!1};var r=function(e){i.duplicateScheldule=!1,i.duplicateSchelduleID=-1,i.scheduleTimeSlots.push("End of Day"),i.scheduleRoute.error="",i.scheduleRoute.isValid=!0;var t="",o="",a="",r="",n="",s="";if(i.scheduleInfo.length<1)return!1;if(9999==e?(t=i.scheduleInfo[$scope.scheduleInfo.length-1],o=i.scheduleInfo.length-1):(t=i.scheduleInfo[e],o=e),!(i.scheduleInfo.length>1))return i.scheduleTimeSlots.splice(-1,1),!1;for(var l=0;l<i.scheduleInfo.length;l++)if(i.scheduleInfo[l].days&&i.scheduleInfo[l].days.length>0)for(var c=0;c<i.scheduleInfo[l].days.length;c++)for(var d=0;d<t.days.length;d++)i.extendScheduleDays[i.scheduleInfo[l].days[c].id].indexOf(t.days[d].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l)),i.extendScheduleDays[t.days[d].id].indexOf(i.scheduleInfo[l].days[c].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l));return i.scheduleTimeSlots.splice(-1,1),i.duplicateScheldule?i.scheduleInfo[o].invalid=!0:void 0!==o&&(i.scheduleInfo[o].invalid=!1),i.duplicateScheldule};i.checkForValidSchedules=function(){for(var e=0,t=i.scheduleInfo.length-1;t>=0;t--)r(t);return _.each(i.scheduleInfo,function(t){(t.invalid||0===t.days.length)&&i.scheduleInfo.length>1&&e++}),e},i.addSchedule=function(){i.showAddSchedule=!0;var e=!1;_.each(i.scheduleInfo,function(o){e=0===o.days.length||""===o.fromTime||""===o.toTime||void 0===t.unMaskData(o.ringTo)}),e?0!==i.checkForValidSchedules()&&o.notify({title:"2nd level IVR Form",text:"Please check for invalid schedule",type:"error"}):i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})},i.formationscheduleTimeSlots=function(e){i.scheduleInfo[e].scheduleEndTimeSlots=i.scheduleTimeSlots.slice(i.scheduleTimeSlots.indexOf(i.scheduleInfo[e].fromTime)+1,i.scheduleTimeSlots.length),i.scheduleInfo[e].scheduleEndTimeSlots.push("End of Day")},i.checkRingToNumberSchedule=function(e){return!e||"0"==t.unMaskData(e).charAt(0)||10!=t.unMaskData(e).length},i.removeSchedule=function(e){a.confirm("Are you sure you want to delete this Schedule?",function(t){r(e)&&i.invalidSchedules--,t&&(i.scheduleInfo.splice(e,1),angular.forEach(i.scheduleInfo,function(e){i.disableRC=!1,1==e.activateVoicemail&&(i.disableRC=!0,i.recordCall=!0),1==i.scheduleRoute.activate_voicemail&&(i.disableRC=!0)})),0===i.checkForValidSchedules()?(i.showAddSchedule=!1,i.disableSaveForSchedule.levelTwo=!1,i.showSubmitFunction()):(o.notify({title:"2nd level IVR Form",text:"Please check for invalid schedule",type:"error"}),i.showAddSchedule=!0)})},i.activateVoicemailSchedule=function(){i.scheduleRoute.default_ringto&&10==t.unMaskData(i.scheduleRoute.default_ringto).length?i.activatevm=!0:(i.scheduleRoute.activate_voicemail=!1,i.activatevm=!1)},i.retainDataOnChange=function(){i.scAction.ringtoNum=i.scheduleRoute.default_ringto,i.scAction.activateVoiceMail=i.scheduleRoute.activate_voicemail,i.scAction.recordCall=i.scheduleRoute.recordCall,i.scAction.disableRC=i.scheduleRoute.disableRC},i.disableRecordCall=function(e){var t=[];i.scheduleRoute.disableRC=!1,i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail,t.push(i.scheduleRoute.activate_voicemail);var o=_.pluck(i.scheduleRoute.scheduleInfo,"activateVoicemail");_.filter(o.concat(t),function(e){return!0===e}).length>0&&(i.scheduleRoute.disableRC=!0,i.scheduleRoute.recordCall=!0),i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail}},scope:{overflowValidationHeader:"=",scheduleRoute:"=",disableSaveForSchedule:"=",showSubmitOverflowMethod:"&",showSubmitFunction:"&showSubmit",voicemailComponent:"=",scAction:"="},templateUrl:"views/directives/secondLevel_scheduleRoute.html"}}]),e.directive("thirdLevelScheduleRoute",["$http","UserWebService","pinesNotifications","$bootbox",function(e,t,o,a){return{restrict:"E",link:function(i){e.get("assets/demo/schedule_data.json").then(function(e){i.timeZones=e.data.timeZones,i.extendScheduleDays=e.data.extendScheduleDays,i.scheduledDays=e.data.scheduledDays,i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.scheduleEndTimeSlots=e.data.scheduleTimeSlots,$.each(i.scheduleRoute.scheduleInfo,function(t,o){i.scheduleTimeSlots=e.data.scheduleTimeSlots,i.formationscheduleTimeSlots(t)})}),i.settings={enableSearch:!1,scrollable:!0,scrollableHeight:200,smartButtonMaxItems:5,showCheckAll:!1,showUncheckAll:!1},i.scheduleRoute.scheduleInfo?(i.scheduleInfo=i.scheduleRoute.scheduleInfo,_.each(i.scheduleRoute.scheduleInfo,function(e){1==e.activateVoicemail&&(i.scheduleRoute.disableRC=!0)}),i.scheduleRoute.activate_voicemail&&(i.scheduleRoute.disableRC=!0),void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0):(i.scheduleInfo=[],i.scheduleRoute.scheduleInfo=i.scheduleInfo,i.scheduleRoute.default_ringto=i.tcAction.ringtoNum,i.scheduleRoute.activate_voicemail=i.tcAction.activateVoiceMail,i.scheduleRoute.playDisclaimer="before",i.scheduleRoute.recordCall=i.tcAction.recordCall,i.scheduleRoute.disableRC=i.tcAction.disableRC,i.showAddSchedule=!0,void 0==i.scheduleRoute.default_ringto||""==i.scheduleRoute.default_ringto?i.activatevm=!1:i.activatevm=!0,i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,openOverflowBox:!1,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})),i.scheduleEvents={onItemCustomSelect:function(e){i.checkCurrentSchedule(e),i.showSubmitFunction()}},i.showSubmit=function(){i.showSubmitFunction()},i.showAddOverflow=function(e){void 0!==t.unMaskData(i.scheduleInfo[e].ringTo)&&10==t.unMaskData(i.scheduleInfo[e].ringTo).length&&"0"!==t.unMaskData(i.scheduleInfo[e].ringTo).slice(0,1)?(i.scheduleInfo[e].isAddOverflow=!1,i.checkCurrentSchedule(e)):(i.scheduleInfo[e].isAddOverflow=!0,i.showAddSchedule=!0)},i.checkCurrentSchedule=function(e){if(_.each(i.scheduleInfo,function(e){0!==e.days.length&&""!==e.fromTime&&""!==e.toTime&&void 0!==t.unMaskData(e.ringTo)?i.showAddSchedule=!1:i.showAddSchedule=!0}),r(e)){i.showAddSchedule=!0,i.disableSaveForSchedule.levelThird=!0,i.invalidSchedules++;var a=i.duplicateSchelduleID+1;1==a?a+="st":2==a?a+="nd":3==a?a+="rd":a>=4&&(a+="th"),i.scheduleRoute.isValid=!1,i.scheduleRoute.error="Check for Overlaping Schedule For "+a+" Schedule",o.notify({title:"3rd level IVR Form",text:"Check for Overlaping Schedule For "+a+" Schedule",type:"error"})}else i.disableSaveForSchedule.levelThird=!1};var r=function(e){i.duplicateScheldule=!1,i.duplicateSchelduleID=-1,i.scheduleTimeSlots.push("End of Day");var t="",o="",a="",r="",n="",s="";if(i.scheduleRoute.error="",i.scheduleRoute.isValid=!0,i.scheduleInfo.length<1)return!1;if(9999==e?(t=i.scheduleInfo[$scope.scheduleInfo.length-1],o=i.scheduleInfo.length-1):(t=i.scheduleInfo[e],o=e),!(i.scheduleInfo.length>1))return i.scheduleTimeSlots.splice(-1,1),!1;for(var l=0;l<i.scheduleInfo.length;l++)if(i.scheduleInfo[l].days&&i.scheduleInfo[l].days.length>0)for(var c=0;c<i.scheduleInfo[l].days.length;c++)for(var d=0;d<t.days.length;d++)i.extendScheduleDays[i.scheduleInfo[l].days[c].id].indexOf(t.days[d].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l)),i.extendScheduleDays[t.days[d].id].indexOf(i.scheduleInfo[l].days[c].id)>-1&&(a=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].fromTime),r=i.scheduleTimeSlots.indexOf(i.scheduleInfo[l].toTime),n=i.scheduleTimeSlots.indexOf(t.fromTime),s=i.scheduleTimeSlots.indexOf(t.toTime),l!==o&&(n<r&&s>a||n<r&&n>=a||s<=r&&s>a)&&(i.duplicateScheldule=!0,i.duplicateSchelduleID=l));return i.scheduleTimeSlots.splice(-1,1),i.duplicateScheldule?i.scheduleInfo[o].invalid=!0:void 0!==o&&(i.scheduleInfo[o].invalid=!1),i.duplicateScheldule};i.checkForValidSchedules=function(){for(var e=0,t=i.scheduleInfo.length-1;t>=0;t--)r(t);return _.each(i.scheduleInfo,function(t){(t.invalid||0===t.days.length)&&i.scheduleInfo.length>1&&e++}),e},i.addSchedule=function(){i.showAddSchedule=!0;var e=!1;_.each(i.scheduleInfo,function(o){e=0===o.days.length||""===o.fromTime||""===o.toTime||void 0===t.unMaskData(o.ringTo)}),e?0!==i.checkForValidSchedules()&&o.notify({title:"3rd level IVR Form",text:"Please check for invalid schedule",type:"error"}):i.scheduleInfo.push({scheduleId:i.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})},i.formationscheduleTimeSlots=function(e){i.scheduleInfo[e].scheduleEndTimeSlots=i.scheduleTimeSlots.slice(i.scheduleTimeSlots.indexOf(i.scheduleInfo[e].fromTime)+1,i.scheduleTimeSlots.length),i.scheduleInfo[e].scheduleEndTimeSlots.push("End of Day")},i.checkRingToNumberSchedule=function(e){return!e||"0"==t.unMaskData(e).charAt(0)||10!=t.unMaskData(e).length},i.removeSchedule=function(e){a.confirm("Are you sure you want to delete this Schedule?",function(t){r(e)&&i.invalidSchedules--,t&&(i.scheduleInfo.splice(e,1),angular.forEach(i.scheduleInfo,function(e){i.disableRC=!1,1==e.activateVoicemail&&(i.disableRC=!0,i.recordCall=!0),1==i.scheduleRoute.activate_voicemail&&(i.disableRC=!0)})),0===i.checkForValidSchedules()?(i.showAddSchedule=!1,i.disableSaveForSchedule.levelThird=!1,i.showSubmitFunction()):(i.showAddSchedule=!0,o.notify({title:"3rd level IVR Form",text:"Please check for invalid schedule",type:"error"}))})},i.activateVoicemailSchedule=function(){i.scheduleRoute.default_ringto&&10==t.unMaskData(i.scheduleRoute.default_ringto).length?i.activatevm=!0:(i.scheduleRoute.activate_voicemail=!1,i.activatevm=!1)},i.retainDataOnChange=function(){i.tcAction.ringtoNum=i.scheduleRoute.default_ringto,i.tcAction.activateVoiceMail=i.scheduleRoute.activate_voicemail,i.tcAction.recordCall=i.scheduleRoute.recordCall,i.tcAction.disableRC=i.scheduleRoute.disableRC},i.disableRecordCall=function(e){var t=[];i.scheduleRoute.disableRC=!1,i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail,t.push(i.scheduleRoute.activate_voicemail);var o=_.pluck(i.scheduleRoute.scheduleInfo,"activateVoicemail");_.filter(o.concat(t),function(e){return!0===e}).length>0&&(i.scheduleRoute.disableRC=!0,i.scheduleRoute.recordCall=!0),i.scheduleRoute.scheduleInfo[e]?i.scheduleRoute.scheduleInfo[e].activateVoicemail=!i.scheduleRoute.scheduleInfo[e].activateVoicemail:i.scheduleRoute.activate_voicemail=!i.scheduleRoute.activate_voicemail}},scope:{overflowValidationHeader:"=",scheduleRoute:"=",disableSaveForSchedule:"=",showSubmitOverflowMethod:"&",showSubmitFunction:"&showSubmit",voicemailComponent:"=",tcAction:"="},templateUrl:"views/directives/thirdLevel_scheduleRoute.html"}}]),e.service("advFilSrvc",["$rootScope","$window","$http","$location","ApiParam","pinesNotifications","$q",function(e,t,o,a,i,r,n){console.log("@@@@@@@@@@@@@@@@ Advanced Filter Service Loaded @@@@@@@@@@@@@@@@");var s=function(a){return o.defaults.useXDomain=!0,o.get(e.url+":"+e.port+"/v1/report/filter/"+a,{headers:{"content-type":"application/json",Authorization:"bearer "+t.sessionStorage.token}})},l=[{label:"Call ID",value:"call.call_id"},{label:"Date",value:"call.call_started"},{label:"Group Name",value:"ou.org_unit_name"},{label:"Campaign Name",value:"c.campaign_name"},{label:"Ad Source",value:"ch.channel_id"},{label:"Custom Source 1",value:"cfcs1.custom_source_type = 'CS1' AND cs1.custom_source_id"},{label:"Custom Source 2",value:"cfcs2.custom_source_type = 'CS2' AND cs2.custom_source_id"},{label:"Custom Source 3",value:"cfcs3.custom_source_type = 'CS3' AND cs3.custom_source_id"},{label:"Custom Source 4",value:"cfcs4.custom_source_type = 'CS4' AND cs4.custom_source_id"},{label:"Custom Source 5",value:"cfcs5.custom_source_type = 'CS5' AND cs5.custom_source_id"},{label:"Caller ID",value:"call.source"},{label:"Tracking Number",value:"call.tracking"},{label:"Destination Name",value:"cd.ring_to_name"},{label:"Destination Number",value:"call.ring_to"},{label:"Duration",value:"call.duration"},{label:"Route Name",value:"pr.provisioned_route_name"},{label:"Tag",value:"t.tag_name"},{label:"Caller/Company Name",value:"cext.call_data.name"},{label:"Address",value:"cext.call_data.address"},{label:"City",value:"cext.call_data.city"},{label:"State/Province",value:"cext.call_data.state"},{label:"Zip/Postal Code",value:"cext.call_data.zip"},{label:"Disposition",value:"call.disposition"},{label:"Line Type",value:"cext.call_data.line"}];void 0!==e.userAccess&&void 0!==e.userAccess.manualscorecard&&e.userAccess.manualscorecard>=4&&l.push({label:"Identified Agent",value:"call.ct_user_id"}),void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated||l.push({label:"Sent to Voicemail",value:"cds.is_voicemail"},{label:"Hunt Type",value:"cds.hunt_type"},{label:"Tracking Number Type",value:"cds.tracking_type"},{label:"Instant Insights",value:"pcir.call_id"},{label:"Instant Insight Config",value:"pcir.post_Call_ivr_option_name"});var c=[{label:"Duration",value:"c.duration"},{label:"Group",value:"ou.org_unit_name"},{label:"Identified Agent",value:"c.ct_user_id"},{label:"Scorecard",value:"sc.score_card_id"},{label:"Score",value:"scc.final_score"},{label:"Call Title",value:"cf.call_title"},{label:"Tag",value:"t.tag_name"},{label:"Comments",value:"cm.comment_text"}],d=[{label:"Tracking Number ID",value:"pr.provisioned_route_id"},{label:"Tracking Number Name",value:"pr.provisioned_route_name"},{label:"Tracking Number",value:"pn.number_str"},{label:"Tracking Number Type",value:"cf.routable_type"},{label:"Ring to phone number",value:"cf.default_ringto"},{label:"Ad Source",value:"ch.channel_id"},{label:"Custom Source 1",value:"cfcs1.custom_source_type = 'CS1' AND cs1.custom_source_id"},{label:"Custom Source 2",value:"cfcs2.custom_source_type = 'CS2' AND cs2.custom_source_id"},{label:"Custom Source 3",value:"cfcs3.custom_source_type = 'CS3' AND cs2.custom_source_id"},{label:"Custom Source 4",value:"cfcs4.custom_source_type = 'CS4' AND cs4.custom_source_id"},{label:"Custom Source 5",value:"cfcs5.custom_source_type = 'CS5' AND cs3.custom_source_id"},{label:"Tracking Number Status",value:"pr.provisioned_route_status"},{label:"Group name",value:"ou.org_unit_name"},{label:"Campaign Name",value:"c.campaign_name"},{label:"DNI Type",value:"ds.dni_type"},{label:"Host Domain",value:"ds.destination_url"},{label:"Referring Website",value:"ds.referrer"},{label:"Html Class",value:"ds.dni_element"},{label:"Custom Parameters",value:"dou.custom_params"},{label:"Play Disclaimer",value:"cf.play_disclaimer"},{label:"Voice Prompt",value:"cf.message_enabled"},{label:"Whisper Message",value:"cf.whisper_enabled"},{label:"Record Call",value:"cf.record_until"},{label:"Pre-call webhook",value:"pr.webhook_id"}];void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated||d.push({label:"Hunt Type",value:"pr.hunt_type"},{label:"Voicemail",value:"cf.vm_enabled"},{label:"Instant Insights",value:"cf.postcall_ivr_enabled"},{label:"Instant Insights Config",value:"pcio.post_Call_ivr_option_name"});var u=[{label:"Group ID",value:"ou.org_unit_id"},{label:"Group Name",value:"ou.org_unit_name"},{label:"Group Ext ID",value:"ou.org_unit_ext_id"},{label:"Calls (GMT)",value:"COUNT(cd.call_id)"},{label:"Billable Minutes (GMT)",value:"COALESCE(SUM(cd.bill_second) - 0)::float/60"},{label:"Leads",value:"COUNT(CASE WHEN lead_score.score_value > 50 THEN 1 END)"},{label:"Conversions",value:"COUNT(CASE WHEN conversion.score_value > 50 THEN 1 END)"},{label:"Call Value",value:"COALESCE(SUM(cd.call_value)-0 )"},{label:"Unique",value:"COUNT(CASE WHEN call.repeat_call = false THEN 1 END)"},{label:"Answered",value:"COUNT(CASE WHEN call.disposition = 'ANSWERED' THEN 1 END)"}];void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated||u.push({label:"Voicemail",value:"COUNT(CASE WHEN cd.is_voicemail = 't' THEN 1 END)"});var p,m,g,f,h,v,b,w=[{label:"Total Calls",value:"total_calls"},{label:"Total Leads",value:"lead_count"},{label:"% of Leads",value:"percent_of_leads"},{label:"Avg Lead Quality",value:"avg_lead_quality"},{label:"Conversion",value:"conversion_count"},{label:"Conversion %",value:"conversion_percent"},{label:"Avg Duration",value:"average_duration"},{label:"Unique calls",value:"unique_calls"}],y={call_flow:[{label:"Tracking Number",value:"pn.number"}],campaign:[{label:"Campaign",value:"c.campaign_name"},{label:"Campaign Ext ID",value:"c.campaign_ext_id"}]},S=[{label:"Campaign",value:"campaign_name",grouping_val:"acq_campaign"},{label:"Call Flow",value:"call_flow_name",grouping_val:"acq_callflow"},{label:"Keyword",value:"keyword",grouping_val:"acq_keyword"},{label:"Ad Source",value:"dynamicsource",grouping_val:"dynamicsource"},{label:"Ad Source",value:"channel",grouping_val:"channel"},{label:"Ring To Number",value:"ring_to_number",grouping_val:"ring_to_number"},{label:"Last Page",value:"last_page",grouping_val:"last_page"},{label:"First Page",value:"first_page",grouping_val:"first_page"},{label:"Source",value:"source",grouping_val:"source"},{label:"Medium",value:"medium",grouping_val:"medium"},{label:"Source/Medium",value:"source_medium",grouping_val:"source_medium"}],C={type:"text",options:[{label:"Contains",value:"ILIKE"},{label:"Equals",value:"="}]},A={type:"text",options:[{label:"Equals",value:"="}]},T={type:"text",options:[{label:"Equals",value:"="},{label:"Greater than and Equals",value:">="},{label:"Less than and Equals",value:"<="}]},D={type:"select-large",options:[{label:"Equals",value:"="}]},I={type:"select-small",options:[{label:"Equals",value:"="}]},N={type:"calendar",options:[{label:"Equals",value:"="},{label:"Greater than and Equals",value:">="},{label:"Less than and Equals",value:"<="}]},k={type:"int",options:[{label:"Contains",value:"ILIKE"},{label:"Equals",value:"="}]},R={type:"int",options:[{label:"Equals",value:"="}]},F={type:"int",options:[{label:"Equals",value:"="},{label:"Greater than and Equals",value:">="},{label:"Less than and Equals",value:"<="}]},x=[],L={};this.updateGlobalReportScope=function(e){L=e},this.getAdvFilterDefinitions=function(){return p},this.updateAdvFilterDefinitions=function(e){p=e},e.timezone||(t.sessionStorage.timezone="America/Chicago"),this.sanitizeDbFilterData=function(e){var t=O(e);return console.log("INSIDE sanitizeDbFilterData IN advFilSrvc.js: Sending back sanitized filter data:",t),t};var O=function(o){console.log("INSIDE dataToVariable IN advFilSrvc.js: Data:",o),angular.forEach(o.filter_rule,function(o,a){"timezone"===o.filter_key&&(e.timezone=t.sessionStorage.timezone=o.filter_value)});var a={vars:{}};e.timezone||(e.timezone=t.sessionStorage.timezone);var i=o.filter;Array.isArray(i)&&(i=i[0]);if(null!==i.filter_range?(a.vars.end_date=moment().tz(e.timezone).endOf("day"),"today"===i.filter_range?a.vars.start_date=moment().tz(e.timezone).startOf("day"):"yesterday"===i.filter_range?(a.vars.start_date=moment().tz(e.timezone).subtract(1,"days").startOf("day"),a.vars.end_date=moment().tz(e.timezone).subtract(1,"days").endOf("day")):"last_week"===i.filter_range?(a.vars.start_date=moment().tz(e.timezone).subtract(6,"days").startOf("day"),a.vars.end_date=moment().tz(e.timezone).subtract(0,"days").endOf("day")):"last_30"===i.filter_range?(a.vars.start_date=moment().tz(e.timezone).subtract(29,"days").startOf("day"),a.vars.end_date=moment().tz(e.timezone).subtract(0,"days").endOf("day")):"this_month"===i.filter_range?(a.vars.start_date=moment().tz(e.timezone).startOf("month").startOf("day"),a.vars.end_date=moment().tz(e.timezone).endOf("month").endOf("day")):"last_month"===i.filter_range&&(a.vars.start_date=moment().tz(e.timezone).subtract(1,"month").startOf("month").startOf("day"),a.vars.end_date=moment().tz(e.timezone).subtract(1,"month").endOf("month").endOf("day"))):(date_start=i.filter_start.split("T"),date_end=i.filter_end.split("T"),a.vars.start_date=moment.utc(date_start[0]).format(),a.vars.end_date=moment.utc(date_end[0]).format()),"object"==typeof a.vars.start_date?(a.drp_start=moment(a.vars.start_date).tz(e.timezone).format("MMMM D, YYYY"),a.drp_end=moment(a.vars.end_date).tz(e.timezone).format("MMMM D, YYYY"),a.vars.start_date=moment(a.vars.start_date).tz(e.timezone).format("YYYY-MM-DD"),a.vars.end_date=moment(a.vars.end_date).tz(e.timezone).format("YYYY-MM-DD")):(date_start=a.vars.start_date.split("T"),date_end=a.vars.end_date.split("T"),a.drp_start=moment(date_start[0]).format("MMMM D, YYYY"),a.drp_end=moment(date_end[0]).format("MMMM D, YYYY"),a.vars.start_date=moment(date_start[0]).format("YYYY-MM-DD"),a.vars.end_date=moment(date_end[0]).format("YYYY-MM-DD")),a.vars.filter_id=i.filter_id,void 0!==o.filter_rule){var r=[],n=[];angular.forEach(o.filter_rule,function(e,t){if("advanced_filter"===e.filter_type||"having_advanced_filter"===e.filter_type){"advanced_filter"===e.filter_type?a.vars.filtertype="a":a.vars.filtertype="ha";var o={filter_key:e.filter_key,comparator:e.comparator,filter_value:e.filter_value,filter_join:e.filter_join,filter_type:e.filter_type};r.push(o),n.push(e.filter_key),n.push(e.comparator),n.push(e.filter_value),n.push(e.filter_join)}else"basic_filter"===e.filter_type?(console.log("######### BASIC FILTER SPOTTED #########",e,t),a.vars.filter=e.filter_value,a.vars.filtertype="s"):a.vars[e.filter_key]=e.filter_value}),a.filterRule=r,n.length>0&&(a.vars.filter=n.join(","))}return Array.isArray(o.filter)&&(o.filter=o.filter[0]),void 0!==o.filter&&(a.filterData=o.filter,void 0!==o.filter.report_used&&(a.vars.report=o.filter.report_used),this.reportScope=a.vars),void 0!==o.schedule&&(a.scheduleData=o.schedule),void 0!==o.report&&(a.reportData=o.report),console.log("INSIDE dataToVariable IN advFilSrvc.js: Returning:",a),a};this.dataToVariable=O,this.getAllDynamicLists=void o.get(i.baseURL()+"/v1/report/channellist",i.headerConfig()).then(function(e){var t=[];for(var o in f=[],e.data.json)-1===t.indexOf(e.data.json[o].cat_combo)&&(f.push({label:e.data.json[o].cat_combo,value:e.data.json[o].channel_id}),t.push(e.data.json[o].cat_combo))}),this.getAllCustomSources=function(){o.get(i.baseURL()+"/v1/customSource/userAccess/"+e.userId,i.headerConfig()).then(function(e){var t=[];for(var o in v=[],e.data.json)"callflow_setting"===L.report?-1===t.indexOf(e.data.json[o].custom_source_name)&&e.data.json[o].custom_source_active&&(v.push({label:e.data.json[o].custom_source_name,value:e.data.json[o].custom_source_id,custom_source_type:e.data.json[o].custom_source_type}),t.push(e.data.json[o].custom_source_name)):(v.push({label:e.data.json[o].custom_source_name,value:e.data.json[o].custom_source_id,custom_source_type:e.data.json[o].custom_source_type}),t.push(e.data.json[o].custom_source_name))})},this.getAllWebhookList=void o.get(i.baseURL()+"/v1/webhook/webhooklist/"+e.currentOUId,i.headerConfig()).then(function(e){for(var t in h=[],e.data.json)h.push({label:e.data.json[t].webhook_name,value:e.data.json[t].webhook_id})}),this.getAllInactiveUsers=void o.get(i.baseURL()+"/v1/user/deleted/"+e.currentOUId,i.headerConfig()).then(function(e){angular.forEach(e.data.json,function(e){x.push({label:e.username,value:e.ct_user_id})})});var U=function(){console.log("INSIDE setSelectOptions IN advFilSrvc.js: Setting select options for",L.report),m=[{label:"Include",value:"include"},{label:"Exclude",value:"exclude"}];var e=[];switch(L.report){case"call_detail":g=l;break;case"set-select-score":g=c;break;case"call_back":g=l;break;case"callflow_setting":g=d;break;case"group_activity":g=u,void 0!==L.secondary&&"none"!==L.secondary&&(console.log(y[L.secondary]),g=y[L.secondary].concat(g));break;case"set-schedule-builder":break;case"acq_group":e.push({label:"Group Name",value:"org_unit_name"});break;case"acq_campaign":e.push({label:"Campaign",value:"campaign_name"});break;case"acq_callflow":e.push({label:"Call Flow",value:"call_flow_name"});break;case"acq_keyword":e.push({label:"Keyword",value:"keyword"});break;case"acq_source":e.push({label:"Source",value:"dynamicsource"})}if(void 0!==L.secondary&&"none"!==L.secondary&&"acq"===L.report.split("_")[0]){var t=L.secondary,o=_.find(S,function(e){if(e.grouping_val==t)return{label:e.label,value:e.grouping_val}});e.push(o)}else void 0!==L.report&&"acq"===L.report.split("_")[0]&&(g=w);e.length>0&&(e=e.concat(w),g=e)};this.setSelectOptions=U;var P=function(e){var t={};t.date=new Date,t.dateOptions={formatYear:"yy",startingDay:1},t.format="dd-MMMM-yyyy",t.open=function(e,t){for(var o in this.opened=!0,this.advFilterDefinitions)o!=t&&(p[o].dateTime.opened=!1)},t.opened=!1,e?p.push({inclusivity:m,columns:g,operators:void 0,selected_inclusivity:m[0],dateTime:t}):p[p.length-1].rule||1==p.length?p.push({inclusivity:m,columns:g,operators:void 0,selected_inclusivity:m[0],dateTime:t,rule:"AND"}):r.notify({title:"Advanced Filter",text:"Please complete the required join type before adding a new filter.",type:"error"})};this.addFilterDefinition=P,this.removeFilterDefinition=function(e){p.splice(e,1),p[0].rule=""};var M=function(t,o,a){var i,r;console.log("INSIDE updateOperators IN advFilSrvc.js: Updating:",t,o,a),t?(r=o.value,a=0):r=o.selected_column.value;if(-1!==["ch.cat_combo","cds.tracking_type","cf.routable_type","cds.is_voicemail","pr.provisioned_route_status","ds.dni_type","ch.channel_id","cfcs1.custom_source_type = 'CS1' AND cs1.custom_source_id","cfcs2.custom_source_type = 'CS2' AND cs2.custom_source_id","cfcs3.custom_source_type = 'CS3' AND cs3.custom_source_id","cfcs4.custom_source_type = 'CS4' AND cs4.custom_source_id","cfcs5.custom_source_type = 'CS5' AND cs5.custom_source_id","cf.play_disclaimer","cf.message_enabled","cf.whisper_enabled","cf.record_until","call.disposition","pr.webhook_id","c.ct_user_id","sc.score_card_id","call.ct_user_id","pr.hunt_type","cds.hunt_type","pcir.call_id","cf.postcall_ivr_enabled","pcir.post_Call_ivr_option_name","pcio.post_Call_ivr_option_name","cf.vm_enabled"].indexOf(r))switch(r){case"ch.cat_combo":i=D,b=f;break;case"scc.score_card_outcome_answer":i=D,b=[{label:"Yes",value:"True"},{label:"No",value:"False"}];break;case"ch.channel_id":i=D,b=f;break;case"cfcs1.custom_source_type = 'CS1' AND cs1.custom_source_id":console.log(v),i=D,b=_.where(v,{custom_source_type:"CS1"});break;case"cfcs2.custom_source_type = 'CS2' AND cs2.custom_source_id":i=D,b=_.where(v,{custom_source_type:"CS2"});break;case"cfcs3.custom_source_type = 'CS3' AND cs3.custom_source_id":i=D,b=_.where(v,{custom_source_type:"CS3"});break;case"cfcs4.custom_source_type = 'CS4' AND cs4.custom_source_id":i=D,b=_.where(v,{custom_source_type:"CS4"});break;case"cfcs5.custom_source_type = 'CS5' AND cs5.custom_source_id":i=D,b=_.where(v,{custom_source_type:"CS5"});break;case"dynamicsource":i=D,b=f;break;case"cf.routable_type":i=D,b=void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated?[{label:"SimpleRoute",value:"SimpleRoute"},{label:"TollFree",value:"tollfree"},{value:"GeoRoute-Claimed",label:"GeoRoute - Claimed Zip-code"},{value:"GeoRoute-Npa",label:"GeoRoute - Caller Area Code Proximity"},{value:"GeoRoute-Zipcode",label:"GeoRoute - Zip-code Proximity"},{label:"IVR",value:"IvrRoute2"},{label:"Percentage",value:"PercentageBasedRoute"},{label:"Hang Up",value:"Hangup"},{label:"Number Pool",value:"number_pool"},{label:"Toll Free",value:"Toll_free"}]:[{label:"Simple",value:"SimpleRoute"},{label:"Send directly to voicemail",value:"VoicemailRoute"},{value:"GeoRoute-claimedState",label:"GeoRoute - Claimed State"},{value:"GeoRoute-Claimed",label:"GeoRoute - Claimed Zip-code"},{value:"GeoRoute-Npa",label:"GeoRoute - Caller Area Code Proximity"},{value:"GeoRoute-Zipcode",label:"GeoRoute - Zip-code Proximity"},{label:"IVR",value:"IvrRoute2"},{label:"Outbound",value:"OutboundRoute"},{label:"Percentage",value:"PercentageBasedRoute"},{label:"Schedule",value:"ScheduleRoute"},{label:"Number Pool",value:"number_pool"},{label:"Hang Up",value:"Hangup"},{label:"Toll Free",value:"Toll_free"}];break;case"cds.is_voicemail":i=I,b=[{label:"Yes",value:"1"},{label:"No",value:"0"}];break;case"cds.tracking_type":i=D,b=[{label:"Simple",value:"SimpleRoute"},{value:"GeoRoute-claimedState",label:"GeoRoute - Claimed State"},{value:"GeoRoute-Claimed",label:"GeoRoute - Claimed Zip-code"},{value:"GeoRoute-Npa",label:"GeoRoute - Caller Area Code Proximity"},{value:"GeoRoute-Zipcode",label:"GeoRoute - Zip-code Proximity"},{label:"IVR",value:"IvrRoute2"},{label:"Outbound",value:"OutboundRoute"},{label:"Percentage",value:"PercentageBasedRoute"},{label:"Schedule",value:"ScheduleRoute"},{label:"Number Pool",value:"number_pool"},{label:"Hang Up",value:"Hangup"},{label:"Toll Free",value:"Toll_free"}],void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated||b.push({label:"Voicemail",value:"VoicemailRoute"});break;case"pr.provisioned_route_status":i=I,b=[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Referral",value:"referral"}];break;case"ds.dni_type":i=I,b=[{label:"Source",value:"source"},{label:"Session",value:"session"},{label:"Url",value:"url"}];break;case"cf.play_disclaimer":i=I,b=[{label:"Before",value:"before"},{label:"After",value:"after"},{label:"Never",value:"never"}];break;case"cf.message_enabled":case"cf.whisper_enabled":case"cf.vm_enabled":i=I,b=[{label:"Yes",value:"1"},{label:"No",value:"0"}];break;case"cf.record_until":i=I,b=[{label:"Yes",value:!0},{label:"No",value:!1}];break;case"call.disposition":i=I,b=void 0===e.is_migrated||!0!==e.is_migrated&&"true"!==e.is_migrated?[{label:"Answered",value:"ANSWERED"},{label:"Referral",value:"REFERRAL"},{label:"Busy",value:"BUSY"},{label:"No Answer",value:"NO ANSWER"},{label:"Hang Up",value:"HANGUP"}]:[{label:"Answered",value:"ANSWERED"},{label:"Referral",value:"REFERRAL"},{label:"Busy",value:"BUSY"},{label:"No Answer",value:"NO ANSWER"},{label:"Caller Hangup",value:"CALLER HANGUP"},{label:"Hang Up",value:"HANGUP"}];break;case"pr.hunt_type":case"cds.hunt_type":i=I,b=[{label:"Rollover",value:"rollover"},{label:"Overflow",value:"overflow"},{label:"Simultaneous Ring",value:"simultaneous"}];break;case"pcir.call_id":case"cf.postcall_ivr_enabled":i=I,b=[{label:"Yes",value:!0},{label:"No",value:!1}];break;case"pcio.post_Call_ivr_option_name":case"pcir.post_Call_ivr_option_name":i=I,b=[{label:"Call Outcome and Agent ID",value:"Call Outcome and Agent ID"},{label:"Call Outcome (Conversion type)",value:"Call Outcome (Conversion type)"},{label:"Agent ID",value:"Agent ID"}];break;case"pr.webhook_id":i=D,b=h;break;case"c.ct_user_id":i=I,b=x;break;case"sc.score_card_id":i=I,b=[],angular.forEach(L.advFilterScorecards,function(e){b.push({label:e.score_card_title,value:e.score_card_id})});break;case"call.ct_user_id":i=I,b=x}else-1!==["call.call_started"].indexOf(r)?i=N:-1!==["pr.provisioned_route_id","cf.default_ringto","call.call_id"].indexOf(r)?i=R:-1!==["call.source","cf.record_until","t.tag_name"].indexOf(r)?i=A:-1!==["call.tracking","call.ring_to","pn.number_str"].indexOf(r)?i=k:-1!==["ou.org_unit_name","org_unit_name","c.campaign_name","cd.ring_to_name","ds.destination_url","ds.referrer","ds.dni_element","dou.custom_params","ou.org_unit_ext_id","group","campaign_name","call_flow_name","keyword","dynamicsource","channel","source","medium","source_medium","first_page","last_page","ring_to_number","c.campaign_name","c.campaign_ext_id","pr.provisioned_route_name","pr.hunt_type","cds.hunt_type","cext.call_data.name","cext.call_data.address","cext.call_data.city","cext.call_data.state","cext.call_data.zip","cext.call_data.line","cf.call_title","cm.comment_text","cf.postcall_ivr_enabled","pcir.call_id","pcir.post_Call_ivr_option_name","pcio.post_Call_ivr_option_name"].indexOf(r)?i=C:-1!==["ou.org_unit_id","COUNT(cd.call_id)","COALESCE(SUM(cd.bill_second) - 0)::float/60","COUNT(CASE WHEN lead_score.score_value > 50 THEN 1 END)","COUNT(CASE WHEN conversion.score_value > 50 THEN 1 END)","COALESCE(SUM(cd.call_value)-0 )","COUNT(CASE WHEN call.repeat_call = false THEN 1 END)","total_calls","percent_of_leads","avg_lead_quality","conversion_count","conversion_percent","COUNT(CASE WHEN call.repeat_call = false THEN 1 END)","COUNT(CASE WHEN call.disposition = 'ANSWERED' THEN 1 END)","COUNT(CASE WHEN cd.is_voicemail = 't' THEN 1 END)","pn.number"].indexOf(r)?i=F:-1!==["scc.final_score","c.duration","call.duration","unique_calls","bill_minutes","lead_count","conversion","unique_calls","voicemail","answered","average_duration"].indexOf(r)&&(i=T);if(t)return i;p[a].selected_operator=i.options[0],p[a].operators=i,p[a].show_operators=!0,p[a].select_options=b};this.updateOperators=M,this.resetAdvFilter=function(){p=[],U(),P(!0)};var $=function(){console.log("INSIDE validateFilters IN advFilSrvc.js: Validating:",L.advFilterDefinitions);for(var e={},t=["first","second","third","fourth","fifth"],o=0;o<L.advFilterDefinitions.length;o++){if(!L.advFilterDefinitions[o].selected_inclusivity){e.title="Missing inclusivity",e.text="Please make sure you have selected an inclusivity for your "+t[o]+" filter.",e.found=!0;break}if(!L.advFilterDefinitions[o].selected_column){e.title="Missing column",e.text="Please make sure you have selected a column for your "+t[o]+" filter.",e.found=!0;break}if(!L.advFilterDefinitions[o].selected_operator){e.title="Missing comparator",e.text="Please make sure you have selected an comparator for your "+t[o]+" filter.",e.found=!0;break}if(!L.advFilterDefinitions[o].user_input){0!==L.advFilterDefinitions[o].user_input&&(e.title="Missing input",e.text="Please make sure you have filled out the required input for your "+t[o]+" filter.",e.found=!0);break}if(!L.advFilterDefinitions[o].rule&&0!==o){e.title="Missing filter rule",e.text="Please make sure you have selected a join type for you "+t[o]+" filter.",e.found=!0;break}}return!e.found||{title:e.title,text:e.text}};this.validateFilters=$;var j=function(){var e,t=[];for(var o in console.log("INSIDE sanitizeFilters IN advFilSrvc.js: Sanitizing:",L.advFilterDefinitions),L.advFilterDefinitions){if(e=L.advFilterDefinitions[o].selected_operator.value,"exclude"===L.advFilterDefinitions[o].selected_inclusivity.value)switch(console.log("INSIDE sanitizeFilters IN advFilSrvc.js: Inversing operator:",L.advFilterDefinitions[o]),L.advFilterDefinitions[o].selected_operator.value){case"=":e="!=";break;case"!=":e="=";break;case"ILIKE":e="NOT ILIKE";break;case"NOT ILIKE":e="ILIKE";break;case">=":e="<=";break;case"<=":e=">="}if("int"===L.advFilterDefinitions[o].operators.type){/^\(?\d{3}\)?[\s\-]\d{3}[\s\-]\d{4}\$/.test(L.advFilterDefinitions[o].user_input)&&console.log("@@@@@@@@@ PHONE NUMBER SPOTTED @@@@@@@@@"),L.advFilterDefinitions[o].user_input=parseInt(L.advFilterDefinitions[o].user_input)}t.push({filter_key:L.advFilterDefinitions[o].selected_column.value,comparator:e,filter_value:L.advFilterDefinitions[o].user_input,filter_join:L.advFilterDefinitions[o].rule?L.advFilterDefinitions[o].rule:"NONE",filter_type:"group_activity"!==L.report?"advanced_filter":"having_advanced_filter"})}return console.log("INSIDE sanitizeFilters IN advFilSrvc.js: Sanitized Definitions:",t),t}.bind(this);this.sanitizeFilters=j,this.urlStringToData=function(){var e=a.search();console.log("INSIDE urlStringToData IN directives.js: Qstr:",e),Object.keys(e).length<1&&(e.filter=decodeURIComponent(e.filter))};var V=function(o){console.log("INSIDE setUrlParams IN advFilSrvc.js: Using report scope",L);var i=L,r=!1,n={},s=[],l=[],c="",d="";if(angular.isDefined(L.advFilterDefinitions)&&L.advFilterDefinitions.length>0&&!0===$()){var u=!1,p="a";angular.forEach(L.advFilterDefinitions,function(e,t){if(void 0!==e.selected_column){if(u=!0,c=e.user_input,"string"==typeof e.user_input)e.user_input.indexOf(",")>-1&&(d=e.user_input,e.user_input=d.replace(/,/g,"`"));o?(s.push(o[t].filter_key),s.push(o[t].comparator),p="advanced_filter"===o[t].filter_type?"a":"ha"):(s.push(e.selected_column.value),s.push(e.selected_operator.value)),"calendar"===e.operators.type&&(e.user_input=moment(e.user_input).format("YYYY-MM-DD")),s.push(e.user_input),s.push(e.rule),l.push(e),e.user_input=c}}),u&&(n.filtertype=p,n.filter=s.join(","))}else void 0!==i.filter&&""!==i.filter?(console.log("filter is set in scope"),void 0===i.filtertype||"a"!==i.filtertype&&"ha"!==i.filtertype?n.filtertype="s":(n.filter=decodeURIComponent(i.filter),r=!0,n.filtertype=i.filtertype)):a.search().filter?(console.log("filter is set in query string"),"a"===a.search().filtertype?(n.filter=unescape(a.search().filter),r=!0,n.filtertype="a"):n.filtertype="s"):(console.log("SIMPLE FILTER DEFAULT",L.simpleSearchFilter),n.filtertype="s");if(r)for(s=n.filter.split(",");s.length>=4;){var m={};m.filter_key=s.shift(),m.comparator=s.shift(),m.filter_value=s.shift(),m.filter_join=s.shift(),l.push(m)}else if("s"===n.filtertype){if(n.filter=""!==L.simpleSearchFilter?L.simpleSearchFilter:"","string"==typeof n.filter)c=n.filter,n.filter.indexOf(",")>-1&&(d=n.filter,n.filter=d.replace(/,/g,"`")),""===L.simpleSearchFilter&&(L.simpleSearchFilter=c)}angular.isDefined(i.exportData)&&(n.exportData=i.exportData),n.secondary=angular.isDefined(i.secondary)?i.secondary:"none",angular.isDefined(i.drp_start)?n.start_date=moment(i.drp_start,"MMMM D, YYYY").format("YYYY-MM-DD"):a.search().start_date?n.start_date=a.search().start_date:t.sessionStorage.report_start_date?n.start_date=moment(t.sessionStorage.report_start_date,"MMMM D, YYYY").format("YYYY-MM-DD"):n.start_date=moment().subtract(1,"weeks").format("YYYY-MM-DD"),angular.isDefined(i.drp_end)?n.end_date=moment(i.drp_end,"MMMM D, YYYY").format("YYYY-MM-DD"):a.search().end_date?n.end_date=a.search().end_date:t.sessionStorage.report_end_date?n.end_date=moment(t.sessionStorage.report_end_date).format("MMMM D, YYYY"):n.end_date=moment().format("YYYY-MM-DD"),angular.isDefined(i.report)?n.report=i.report:a.search().report&&(n.report=a.search().report),angular.isDefined(i.timezone)?n.timezone=i.timezone:a.search().timezone?n.timezone=decodeURIComponent(a.search().timezone):angular.isDefined(e.timezone)&&(n.timezone=e.timezone),angular.isDefined(i.limit)?n.limit=i.limit:a.search().limit?n.limit=a.search().limit:n.limit=100,angular.isDefined(i.offset)?n.offset=i.offset:a.search().offset?n.offset=a.search().offset:n.offset=0,n.drp_start=moment(n.start_date).format("MMMM D, YYYY"),n.drp_end=moment(n.end_date).format("MMMM D, YYYY");var g={drp_start:moment(n.start_date).format("MMMM D, YYYY"),drp_end:moment(n.end_date).format("MMMM D, YYYY"),vars:n,filterRule:l};return this.reportScope=g.vars,console.log("return from setUrlParams",g.vars),g};this.setUrlParams=V,this.applyFilter=function(e){if((L=e).advFilterDefinitions.length>0&&L.advFilterDefinitions[0].selected_column&&L.showAdvFilter){var t=$();if(!0===t){var o=j();return V(o)}return r.notify({title:t.title,text:t.text,type:"error"}),!1}if(L.advFilterDefinitions.length>0&&L.showAdvFilter){var a=$();return r.notify({title:a.title,text:a.text,type:"error"}),!1}return V()};var E=function(e){if(e&&console.log("INSIDE initializeAdvFil IN advFilSrvc.js: Initializing filter with",e),p=[],U(),e)if(Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;t++){var o,a,i,r=m[0];for(var n in g)g[n].value===e[t].filter_key&&(o=g[n]);if(!o){console.log("No match found for",e[t].filter_key,JSON.stringify(g));break}switch(a=M(!0,o),e[t].comparator){case"!=":e[t].comparator="=",r=m[1];break;case"NOT ILIKE":e[t].comparator="ILIKE",r=m[1]}for(var s in a.options)a.options[s].value===e[t].comparator&&(i=a.options[s]);p.push({inclusivity:m,columns:g,operators:a,show_operators:!0,select_options:b||"",selected_inclusivity:r,selected_column:o,selected_operator:i,user_input:e[t].filter_value,rule:0!==t?e[t].filter_join:""})}else P(!0);else P(!0);console.log("INSIDE initializeAdvFil IN advFilSrvc.js: advFilterDefinitions:",p)}.bind(this);this.determineInitializationMethod=function(e){e?L=e:console.log("INSIDE determineInitializationMethod IN advFilSrvc.js: No reportScope found.");var t=n.defer();if(a.search().filter_id)return console.log("INSIDE determineInitializationMethod IN advFilSrvc.js: Loading using filter_id method:",a.search().filter_id),s(a.search().filter_id).then(function(e){if("success"===e.data.result){console.log("got filter data",e.data.json);var o=O(e.data.json);o.vars.secondary&&(L.secondary=o.vars.secondary),o.filterRule.length>=1?(console.log("############# AdvFilterDefinitions spotted"),E(o.filterRule)):E(),console.log("INSIDE determineInitializationMethod IN advFilSrvc.js: Returning retData",o),t.resolve(o)}else r.notify({title:"Filter data",text:"Failed to load filter data",type:"error"})}),t.promise;console.log("INSIDE determineInitializationMethod IN advFilSrvc.js: Loading using scope and qstr");var o=V();return t.resolve(o),angular.isDefined(o.filterRule)&&o.filterRule.length>0?E(o.filterRule):E(),t.promise},this.validateInput=function(e){var t=e.which||e.charCode;8!=e.keyCode&&(t<48||t>57)&&e.preventDefault()}}]),e.controller("advFilterController",["$scope","$rootScope","$location","$window","pinesNotifications","advFilSrvc","createDialog",function(e,t,o,a,i,r,n){if(console.log("@@@@@@@@@@@@@@@@ Advanced Filter Loaded @@@@@@@@@@@@@@@@"),console.log("@@@@@@@@@@@@@@@@ ACTIVE LISTENERS @@@@@@@@@@@@@@@@",t.$$listeners),e.preloading=!1,e.showAdvFilter=!1,t.timezone||(a.sessionStorage.timezone="America/Chicago"),"set-schedule-builder"===o.$$path.substring(1)?(e.previewMode=!0,e.hideApplyButton=!0):(e.previewMode=!1,e.hideApplyButton=!1),t.$on("send_db_filter_data",function(o,a){var i=e.dataToVariable(a);t.$broadcast("return_db_filter_data",i),i.filterRule.length>=1&&e.initializeAdvFil(i.filterRule)}),e.dataToVariable=function(o){var a={vars:{}},i=o.filter;if(Array.isArray(i)&&(i=i[0]),null!==i.filter_range?(a.vars.drp_end=moment().tz(t.timezone).endOf("day"),"today"===i.filter_range?a.vars.drp_start=moment().tz(t.timezone).startOf("day"):"yesterday"===i.filter_range?(a.vars.drp_start=moment().tz(t.timezone).subtract(1,"days").startOf("day"),a.vars.drp_end=moment().tz(t.timezone).subtract(1,"days").endOf("day")):"last_week"===i.filter_range?a.vars.drp_start=moment().tz(t.timezone).subtract(7,"days").startOf("day"):"last_30"===i.filter_range?a.vars.drp_start=moment().tz(t.timezone).subtract(29,"days").startOf("day"):"this_month"===i.filter_range?(a.vars.drp_start=moment().tz(t.timezone).startOf("month").startOf("day"),a.vars.drp_end=moment().tz(t.timezone).endOf("month").endOf("day")):"last_month"===i.filter_range&&(a.vars.drp_start=moment().tz(t.timezone).subtract(1,"month").startOf("month").startOf("day"),a.vars.drp_end=moment().tz(t.timezone).subtract(1,"month").endOf("month").endOf("day"))):(a.vars.drp_start=moment(i.filter_start).tz(t.timezone).format("YYYY-MM-DD"),a.vars.drp_end=moment(i.filter_end).tz(t.timezone).format("YYYY-MM-DD")),a.vars.filter_start=moment(a.vars.drp_start).tz(t.timezone),a.vars.filter_end=moment(a.vars.drp_end).tz(t.timezone),a.vars.drp_start=moment(a.vars.drp_start).tz(t.timezone).format("MMMM D, YYYY"),a.vars.drp_end=moment(a.vars.drp_end).tz(t.timezone).format("MMMM D, YYYY"),a.vars.filter_id=i.filter_id,void 0!==o.filter_rule){var r=[],n=[];angular.forEach(o.filter_rule,function(e,t){if("advanced_filter"===e.filter_type){a.vars.filtertype="a";var o={filter_key:e.filter_key,comparator:e.comparator,filter_value:e.filter_value,filter_join:e.filter_join,filter_type:e.filter_type};r.push(o),n.push(e.filter_key),n.push(e.comparator),n.push(e.filter_value),n.push(e.filter_join)}else"basic_filter"===e.filter_type?(a.vars.filter=e.filter_value,a.vars.filtertype="s"):a.vars[e.filter_key]=e.filter_value}),a.filterRule=r,n.length>0&&(a.vars.filter=n.join(","))}return Array.isArray(o.filter)&&(o.filter=o.filter[0]),void 0!==o.filter&&(a.filterData=o.filter,void 0!==o.filter.report_used&&(a.vars.report=o.filter.report_used),e.reportScope=a.vars),void 0!==o.schedule&&(a.scheduleData=o.schedule),void 0!==o.report&&(a.reportData=o.report),console.log("INSIDE $scope.dataToVariable IN directives.js: Sending back formatted data",a),a},e.getAllDynamicLists=void r.getAdSources().then(function(t){var o=[];for(var a in e.select_ad_names=[],t.data.json)-1===o.indexOf(t.data.json[a].cat_combo)&&(e.select_ad_names.push({label:t.data.json[a].cat_combo,value:t.data.json[a].channel_id}),o.push(t.data.json[a].cat_combo))}),e.setSelectOptions=function(){e.inclusivity=[{label:"Include",value:"include"},{label:"Exclude",value:"exclude"}];var t=[];switch(e.reportScope.report){case"call_detail":case"call_back":e.columns=r.cd_cb_columns;break;case"callflow_setting":e.columns=r.call_flow_columns;break;case"group_activity":e.columns=r.group_activity_columns;break;case"set-schedule-builder":break;case"acq_group":e.columns=r.acquisition_columns;break;case"acq_campaign":t.push({label:"Campaign",value:"campaign_name"});break;case"acq_callflow":t.push({label:"Call Flow",value:"call_flow_name"});break;case"acq_keyword":t.push({label:"Keyword",value:"keyword"});break;case"acq_source":t.push({label:"Ad Source",value:"dynamicsource"})}t.length>0&&(t=t.concat(r.acquisition_columns),e.columns=t)},t.$on("schedule_builder_report_changed",function(t,o){var a,i=[];switch(e.resetAdvFilter(),o){case"call_detail":case"call_back":e.advFilterDefinitions[0].columns=r.cd_cb_columns,e.columns=r.cd_cb_columns;break;case"group_activity":e.advFilterDefinitions[0].columns=r.group_activity_columns,e.columns=r.group_activity_columns;break;case"callflow_setting":e.advFilterDefinitions[0].columns=r.call_flow_columns,e.columns=r.call_flow_columns;break;case"acq_campaign":i.push({label:"Campaign",value:"campaign"}),a=!0;break;case"acq_callflow":i.push({label:"Call Flow",value:"call_flow_name"}),a=!0;break;case"acq_keyword":i.push({label:"Keyword",value:"keyword"}),a=!0;break;case"acq_group":e.columns=r.acquisition_columns;break;case"acq_source":i.push({label:"Ad Source",value:"dynamicsource"}),a=!0}a&&(i=i.concat(r.acquisition_columns),e.advFilterDefinitions[0].columns=i,e.columns=i)}),e.addFilterDefinition=function(t){var o={};o.date=new Date,o.dateOptions={formatYear:"yy",startingDay:1},o.format="dd-MMMM-yyyy",o.open=function(t,o){for(var a in this.opened=!0,e.advFilterDefinitions)a!=o&&(e.advFilterDefinitions[a].dateTime.opened=!1)},o.opened=!1,t?e.advFilterDefinitions.push({inclusivity:e.inclusivity,columns:e.columns,operators:e.operators,selected_inclusivity:e.inclusivity[0],dateTime:o}):e.advFilterDefinitions[e.advFilterDefinitions.length-1].rule||1==e.advFilterDefinitions.length?(e.advFilterDefinitions.push({inclusivity:e.inclusivity,columns:e.columns,operators:e.operators,selected_inclusivity:e.inclusivity[0],dateTime:o,rule:"AND"}),e.advFilterDefinitions.length==e.advancedFilterConfig.maxQuantity&&(e.advFilterMax=!0)):i.notify({title:"Advanced Filter",text:"Please complete the required join type before adding a new filter.",type:"error"})},e.removeFilterDefinition=function(t){e.advFilterDefinitions.length>e.advancedFilterConfig.minQuantity&&(e.advFilterDefinitions.splice(t,1),e.advFilterMax=!1),e.resizeWindow()},e.showOperatorSelect=function(t){e.advFilterDefinitions[t].show_operators=!0},e.updateOperators=function(t,o,a){var i,n;n=t?o.value:o.selected_column.value;if(-1!==["ch.cat_combo","cds.tracking_type","cf.routable_type","cds.is_voicemail","pr.provisioned_route_status","ds.dni_type","cs.custom_source_id","pr.hunt_type","cds.hunt_type","pcir.call_id","cf.postcall_ivr_enabled","pcir.post_Call_ivr_option_name","pcio.post_Call_ivr_option_name"].indexOf(n))switch(n){case"ch.cat_combo":i=r.selectMatch,e.advFilterDefinitions[a].select_options=e.select_ad_names;break;case"cf.routable_type":i=r.selectMatch,e.advFilterDefinitions[a].select_options=[{label:"GeoRoute",value:"GeoRoute"},{label:"IvrRoute",value:"IvrRoute"},{label:"IvrRoute2",value:"IvrRoute2"},{label:"OutboundRoute",value:"OutboundRoute"},{label:"PercentageBasedRoute",value:"PercentageBasedRoute"},{label:"ScheduleRoute",value:"ScheduleRoute"},{label:"SimpleRoute",value:"SimpleRoute"},{label:"Toll Free",value:"Toll_free"}];break;case"cds.tracking_type":i=r.selectMatch,e.advFilterDefinitions[a].select_options=[{label:"GeoRoute",value:"GeoRoute"},{label:"IvrRoute",value:"IvrRoute"},{label:"IvrRoute2",value:"IvrRoute2"},{label:"OutboundRoute",value:"OutboundRoute"},{label:"PercentageBasedRoute",value:"PercentageBasedRoute"},{label:"ScheduleRoute",value:"ScheduleRoute"},{label:"SimpleRoute",value:"SimpleRoute"}];break;case"cds.is_voicemail":i=r.selectMatch,e.advFilterDefinitions[a].select_options=[{label:"Yes",value:"Yes"},{label:"No",value:"No"}];break;case"pr.hunt_type":case"cds.hunt_type":i=selectMatchSmall,AFD_select_options=[{label:"Rollover",value:"rollover"},{label:"Overflow",value:"overflow"},{label:"Simultaneous Ring",value:"simultaneous"}];break;case"pcir.call_id":case"cf.postcall_ivr_enabled":i=selectMatchSmall,AFD_select_options=[{label:"Yes",value:!0},{label:"No",value:!1}];break;case"pcio.post_Call_ivr_option_name":case"pcir.post_Call_ivr_option_name":i=selectMatchSmall,AFD_select_options=[{label:"Call Outcome and Agent ID",value:"Call Outcome and Agent ID"},{label:"Call Outcome (Conversion type)",value:"Call Outcome (Conversion type)"},{label:"Agent ID",value:"Agent ID"}];break;case"pr.provisioned_route_status":i=r.selectMatch,e.advFilterDefinitions[a].select_options=[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Deleted",value:"deleted"},{label:"Suspended",value:"suspended"}];break;case"ds.dni_type":i=r.selectMatch,e.advFilterDefinitions[a].select_options=[{label:"Source",value:"source"},{label:"Session",value:"session"},{label:"Url",value:"url"}]}else-1!==["call.call_started"].indexOf(n)?i=r.calendarMatch:-1!==["call.call_id","pr.provisioned_route_id"].indexOf(n)?i=r.specificIntMatch:-1!==["call.source","pr.provisioned_route_name","cf.record_until"].indexOf(n)?i=r.specificTextMatch:-1!==["call.tracking","call.ring_to","pn.number_str","cf.default_ringto"].indexOf(n)?i=r.containsIntMatch:-1!==["ou.org_unit_id","ou.org_unit_name","org_unit_name","c.campaign_name","cd.ring_to_name","ds.destination_url","ds.referrer","ds.dni_element","dou.custom_params","cf.play_disclaimer","cf.message","cf.whisper_message","group","campaign_name","call_flow_name","keyword","dynamicsource","pn.number_type","pr.hunt_type","cds.hunt_type","cf.postcall_ivr_enabled","pcir.call_id","pcir.post_Call_ivr_option_name","pcio.post_Call_ivr_option_name"].indexOf(n)?i=r.containsTextMatch:-1!==["call.duration","total_calls","percent_of_leads","avg_lead_quality","conversion_count","conversion_percent","unique_calls"].indexOf(n)?i=r.flexibleIntMatch:-1!==["unique_calls","average_duration","bill_minutes","lead_count","conversion","call_value","voicemail","answered"].indexOf(n)&&(i=r.flexibleTextMatch);if(t)return i;e.advFilterDefinitions[a].selected_operator=i.options[0],e.advFilterDefinitions[a].operators=i},e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},e.toggleAdvFil=function(a){a&&e.resetAdvFilter();var i=o.$$path.substring(1);"calls-details"!==o.$$path.substring(1)&&"calls-callback"!==o.$$path.substring(1)||(i="call-log"),t.$broadcast("toggleAdvFil-"+i)},e.resetAdvFilter=function(){e.showAdvFilter=!1,e.advFilterDefinitions=[],e.showOperators=!1,e.setSelectOptions(),e.addFilterDefinition(!0)},e.validateFilters=function(){for(var t={},o=["first","second","third","fourth","fifth"],a=0;a<e.advFilterDefinitions.length;a++){if(!e.advFilterDefinitions[a].selected_inclusivity){t.title="Missing inclusivity",t.text="Please make sure you have selected an inclusivity for your "+o[a]+" filter.",t.found=!0;break}if(!e.advFilterDefinitions[a].selected_column){t.title="Missing column",t.text="Please make sure you have selected a column for your "+o[a]+" filter.",t.found=!0;break}if(!e.advFilterDefinitions[a].selected_operator){t.title="Missing comparator",t.text="Please make sure you have selected an comparator for your "+o[a]+" filter.",t.found=!0;break}if(!e.advFilterDefinitions[a].user_input){0!==e.advFilterDefinitions[a].user_input&&(t.title="Missing input",t.text="Please make sure you have filled out the required input for your "+o[a]+" filter.",t.found=!0);break}if(!e.advFilterDefinitions[a].rule&&0!==a){t.title="Missing filter rule",t.text="Please make sure you have selected a join type for you "+o[a]+" filter.",t.found=!0;break}}return!t.found||{title:t.title,text:t.text}},e.sanitizeFilters=function(){var t,o=[];for(var a in e.advFilterDefinitions){if(t=e.advFilterDefinitions[a].selected_operator.value,"exclude"===e.advFilterDefinitions[a].selected_inclusivity.value)switch(e.advFilterDefinitions[a].selected_operator.value){case"=":t="!=";break;case"!=":t="=";break;case"ILIKE":t="NOT ILIKE";break;case"NOT ILIKE":t="ILIKE";break;case">=":t="<=";break;case"<=":t=">="}"int"===e.advFilterDefinitions[a].operators.type&&(e.advFilterDefinitions[a].user_input=parseInt(e.advFilterDefinitions[a].user_input)),o.push({filter_key:e.advFilterDefinitions[a].selected_column.value,comparator:t,filter_value:e.advFilterDefinitions[a].user_input,filter_join:e.advFilterDefinitions[a].rule?e.advFilterDefinitions[a].rule:"NONE",filter_type:"advanced_filter"})}return o},t.$on("receive_scope_"+o.$$path.slice(1),function(t,a){e.reportScope=a,console.log("INSIDE 'receive_scope_"+o.$$path.slice(1)+"' IN directives.js: Setting $scope.reportScope",e.reportScope)}),t.$on("start_url_assembly",function(o,a){console.log("INSIDE start_url_assembly IN directives.js: Invoking setUrlParams");var i=e.setUrlParams();t.$broadcast("return_url_params",i)}),e.urlStringToData=function(){var e=o.search();console.log("INSIDE urlStringToData IN directives.js: Qstr:",e),Object.keys(e).length<1&&(e.filter=decodeURIComponent(e.filter))},e.setUrlParams=function(){console.log("INSIDE setUrlParams IN directives.js: Broadcasting 'request_scope_"+o.$$path.slice(1)+"'"),t.$broadcast("request_scope_"+o.$$path.slice(1));var i=e.reportScope;console.log("INSIDE setUrlParams IN directives.js: Requested scope:",i);var r=!1,n={},s=[],l=[];if(angular.isDefined(e.advFilterDefinitions)&&e.advFilterDefinitions.length>0&&!0===e.validateFilters()){var c=!1;angular.forEach(e.advFilterDefinitions,function(e,t){void 0!==e.selected_column&&(c=!0,s.push(e.selected_column.value),s.push(e.selected_operator.value),s.push(e.user_input),s.push(e.rule),l.push(e))}),c&&(n.filtertype="a",n.filter=s.join(","))}else void 0!==i.filter&&""!==i.filter?void 0!==i.filtertype&&"a"===i.filtertype?(n.filter=decodeURIComponent(i.filter),r=!0):n.filtertype="s":o.search().filter&&"a"===o.search().filtertype?(n.filter=decodeURIComponent(o.search().filter),r=!0):n.filtertype="s";if(r)for(n.filtertype="a",s=n.filter.split(",");s.length>=4;){var d={};d.filter_key=s.shift(),d.comparator=s.shift(),d.filter_value=s.shift(),d.filter_join=s.shift(),l.push(d)}else"s"===n.filtertype&&(n.filter=""!==e.simpleSearchFilter?e.simpleSearchFilter:"");angular.isDefined(i.exportData)&&(n.exportData=i.exportData),n.secondary=angular.isDefined(i.secondary)?i.secondary:"none",angular.isDefined(i.drp_start)?n.start_date=moment(i.drp_start,"MMMM D, YYYY").format("YYYY-MM-DD"):o.search().start_date?n.start_date=o.search().start_date:a.sessionStorage.report_start_date?n.start_date=moment(a.sessionStorage.report_start_date,"MMMM D, YYYY").format("YYYY-MM-DD"):n.start_date=moment().subtract(1,"weeks").format("YYYY-MM-DD"),angular.isDefined(i.drp_end)?n.end_date=moment(i.drp_end,"MMMM D, YYYY").format("YYYY-MM-DD"):o.search().end_date?n.end_date=o.search().end_date:a.sessionStorage.report_end_date?n.end_date=moment(a.sessionStorage.report_end_date).format("MMMM D, YYYY"):n.end_date=moment().format("YYYY-MM-DD"),angular.isDefined(i.report)?n.report=i.report:o.search().report&&(n.report=o.search().report),angular.isDefined(i.timezone)?n.timezone=i.timezone:o.search().timezone?n.timezone=decodeURIComponent(o.search().timezone):angular.isDefined(t.timezone)&&(n.timezone=t.timezone),angular.isDefined(i.limit)?n.limit=i.limit:o.search().limit?n.limit=o.search().limit:n.limit=100,angular.isDefined(i.offset)?n.offset=i.offset:o.search().offset?n.offset=o.search().offset:n.offset=0;var u={drp_start:moment(n.start_date).format("MMMM D, YYYY"),drp_end:moment(n.end_date).format("MMMM D, YYYY"),vars:n,filterRule:l};return e.reportScope=u.vars,u},e.applyAdvFil=function(){console.log("INSIDE applyAdvFil IN directives.js: Applying advanced filter with the following definitions:",e.advFilterDefinitions);var o=e.validateFilters();if(!0===o){e.sanitizeFilters();var a=e.setUrlParams();t.$broadcast("load_filter_params-"+e.reportScope.report,a)}else i.notify({title:o.title,text:o.text,type:"error"})},e.applyBasicFil=function(){var o=e.setUrlParams();t.$broadcast("load_filter_params-"+e.reportScope.report,o)},e.initializeAdvFil=function(t){if(t&&console.log("INSIDE $scope.initializeAdvFil IN directives.js: Initializing filter with",t),e.advFilterDefinitions=[],e.setSelectOptions(),e.advancedFilterConfig={minQuantity:1,maxQuantity:5},t)if(Array.isArray(t)&&t.length>0){for(var o=0;o<t.length;o++){var a,i,r,n=e.inclusivity[0];for(var s in e.columns)e.columns[s].value===t[o].filter_key&&(a=e.columns[s]);if(!a){console.log("No match found for",t[o].filter_key,e.columns);break}switch(i=e.updateOperators(!0,a),t[o].comparator){case"!=":t[o].comparator="=",n=e.inclusivity[1];break;case"NOT ILIKE":t[o].comparator="ILIKE",n=e.inclusivity[1]}for(var l in i.options)i.options[l].value===t[o].comparator&&(r=i.options[l]);e.advFilterDefinitions.push({inclusivity:e.inclusivity,columns:e.columns,operators:i,show_operators:!0,selected_inclusivity:n,selected_column:a,selected_operator:r,user_input:t[o].filter_value,rule:0!==o?t[o].filter_join:""})}e.showAdvFilter=!0,e.preloading=!1}else e.addFilterDefinition(!0);else e.addFilterDefinition(!0)},o.search().filter_id)console.log("INSIDE determineInitializationMethod IN directives.js: Loading using filter_id method:",o.search().filter_id),e.preloading=!0,r.getFilterData(o.search().filter_id).then(function(o){if("success"===o.data.result){var a=e.dataToVariable(o.data.json);a.filterRule.length>=1?e.initializeAdvFil(a.filterRule):e.initializeAdvFil(),console.log('INSIDE determineInitializationMethod IN directives.js: Broadcasting "load_filter_params-'+e.reportScope.report+'" with',a),t.$broadcast("load_filter_params-"+e.reportScope.report,a)}else i.notify({title:"Filter data",text:"Failed to load filter data",type:"error"})});else{console.log("INSIDE determineInitializationMethod IN directives.js: Loading using scope and qstr");var s=e.setUrlParams();angular.isDefined(s.filterRule)&&s.filterRule.length>0?e.initializeAdvFil(s.filterRule):e.initializeAdvFil(),console.log('INSIDE determineInitializationMethod IN directives.js: Broadcasting "load_filter_params-'+e.reportScope.report+'" with',s),t.$broadcast("load_filter_params-"+e.reportScope.report,s)}e.validateInput=function(e){var t=e.which||e.charCode;8!=e.keyCode&&(t<48||t>57)&&e.preventDefault()},t.$on("get_advanced_filter_definitions",function(){if(1!==e.advFilterDefinitions.length||e.advFilterDefinitions[0].selected_column){var o=e.validateFilters();!0===o?t.$broadcast("receive_advanced_filter_definitions",e.sanitizeFilters()):t.$broadcast("receive_advanced_filter_definitions",o)}else t.$broadcast("receive_advanced_filter_definitions",!1),e.showAdvFilter=!1}),e.previewReport=function(o){var a=e.setUrlParams({});delete a.drp_start,delete a.drp_end,delete a.filterRule;var i={acq_group:"views/acq-call-flows4.html?report=acq_group",acq_campaign:"views/acq-call-flows4.html?report=acq_campaign",acq_callflow:"views/acq-call-flows4.html?report=acq_callflow",acq_keyword:"views/acq-call-flows4.html?report=acq_keyword",acq_source:"views/acq-call-flows4.html?report=acq_source",call_detail:"views/calls-details.html?report=call_detail",call_back:"views/calls-callback.html?report=call_back",activity_stream:"views/activity-stream.html?report=activity_stream",group_activity:"views/activity-group.html?report=group_activity",callflow_setting:"views/settings-call-flow.html?report=callflow_setting"}[e.filterData.report_used]+"&"+$.param(a);n(i,{id:"preview-modal",title:"Preview",backdrop:!0,footerTemplate:"<br>",controller:"advFilterController",cancel:{label:"close",fn:function(){var e=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var o in t.$$listeners)-1===e.indexOf(o)&&(t.$$listeners[o]=[t.$$listeners[o].shift()]);console.log("@@@@@@@@@@@@@@@@ ACTIVE LISTENERS @@@@@@@@@@@@@@@@",t.$$listeners)}}})},e.$on("$destroy",function(){var e=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var o in t.$$listeners)-1===e.indexOf(o)&&delete t.$$listeners[o]})}]),e.directive("advancedFilter",function(){return{restrict:"E",controller:"advFilterController",templateUrl:"views/directives/advanced-filter.html"}})}(),angular.module("theme.callsdetails",["ui.select2","angularUtils.directives.dirPagination","api-param"]).service("cfilter",["$http",function(e){"use strict";var t={};return t.cf=crossfilter([]),e.get("assets/demo/call_flow.json").success(function(e){void 0!==e.json&&(t.data=e.json,t.ndx=t.cf.add(t.data),t.all=t.ndx.groupAll())}).error(function(e){alert("error loading config.json")}),t}]).factory("CallsDetailsWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getBaseURL:function(){return i.url+":"+i.port},getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getCallsSummaryList:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/report/callDetail?"+e+"&count=true",r.headerConfig())},getCallsDetailsList:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/report/callDetail?"+e,r.headerConfig())},getCallsDetailsInfo:function(e,t,a){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/call/Info/"+a+"/?report="+e+"&user_id="+t,r.headerConfig())},getCallsComments:function(e,t,a){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/call/Comment/"+a+"/?report="+e+"&user_id="+t+"&timezone="+encodeURIComponent(i.timezone),r.headerConfig())},setCallsComments:function(e,t,a){var i={method:"POST",url:r.baseURL()+"/v1/call/Comment/?report="+e+"&user_id="+a,headers:r.headerConfig().headers,data:t};return o(i)},deleteCallsComments:function(e,t,a){return o.delete(r.baseURL()+"/v1/call/Comment/"+t+"/?report="+e+"&user_id="+a,r.headerConfig())},getCallsTags:function(e,t,a){return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/call/Tag/"+a+"/?report="+e+"&user_id="+t,this.getJsonConfig())},getTags:function(e,t,a){return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/tag/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.tag+"/?report="+e,this.getJsonConfig())},setCallsTags:function(e,t){var r={method:"POST",url:i.url+":"+i.port+"/v1/call/Tag/?user_id="+t,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(r)},getCallBlacklist:function(){var e={method:"GET",url:r.baseURL()+"/v1/blacklist/?page=allNumbers",headers:r.headerConfig().headers};return o(e)},getAllTopOuUsers:function(e){return o.defaults.useXDomain=!0,console.log(r.baseURL()),o.get(r.baseURL()+"/v1/user/groups/"+e,this.getJsonConfig())},setCallBlacklist:function(e){var t={method:"POST",url:r.baseURL()+"/v1/blacklist/bulk",headers:r.headerConfig().headers,data:e};return o(t)},unsetCallBlacklist:function(e){var t=[{id:e=parseInt(e,10)}],a={method:"DELETE",url:r.baseURL()+"/v1/blacklist/",headers:r.headerConfig().headers,data:t};return o(a)},emailRecording:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/call/email",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},saveAgentToCall:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/calldetail/agent",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},checkIfUserValid:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/checkifuservalid/userid/"+e+"/callgroup/"+t,r.headerConfig())}};return n}]).directive("dynamicUrl",function(){return{restrict:"A",link:function(e,t,o){t.attr("src",o.ngId),e.increaseAudioInitializationCount(),e.loadMediaElement()}}}).controller("CallsDetailsController",["$scope","$http","$window","$rootScope","$routeParams","CallsDetailsWebService","pinesNotifications","$timeout","$compile","$q","$bootbox","$uibModal","$location","advFilSrvc","progressLoader",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g){var f=o.localStorage.download_audio_enabled;f="boolean"==typeof f?f:void 0==f||"undefined"==f||"true"===o.localStorage.download_audio_enabled.toLowerCase(),a.download_audio_enabled!==f&&(a.download_audio_enabled=f,a.$broadcast("download_audio_setting_changed")),e.audioInitializationCount=0,e.isLoadingApi=!0,e.simpleSearchFilter="",e.filterApplied=!1,e.horsemanFlag=!1,e.hideDataTable=!1,e.hidePaginationControls=!1,e.roleId=a.roleId,e.currentPage=1,e.report=p.search().report?p.search().report:"call_detail",e.pageSize=100,e.showme=[],e.actionHeader=["Actions"],e.callbackHeader=["Date/Time","Group Name","Campaign","Ad Source","Custom source 1","Custom source 2","Custom source 3","Custom source 4","Custom source 5","Caller ID","Tracking Number","Destination Name | No.","Duration","Voicemail"],e.callDetailsHeader=["Date/Time","Group Name","Campaign","Ad Source","Custom source 1","Custom source 2","Custom source 3","Custom source 4","Custom source 5","Caller ID","Tracking Number","Destination Name | No.","Duration","Voicemail"],e.pagination={current:i.page?i.page:1};var h=!1;if(e.username=null,e.IdentifiedAgentData=[],e.agentItemSelected={},a.isSafari=o.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.preview=!!p.search().preview&&p.search().preview,e.isFromReportEngine=!!p.search().isFromReportEngine&&p.search().isFromReportEngine,(e.preview||e.isFromReportEngine)&&(h=!0),m.getAllCustomSources(),e.access_audio=a.access_audio,e.audioAccessPermission=!0,!1!==e.access_audio&&"false"!==e.access_audio||(e.audioAccessPermission=!1),!0===a.is_migrated||"true"===a.is_migrated?e.isMigated=!0:e.isMigated=!1,e.callDetailsColumnMapping=[{label:"Date/Time",key:"call_started",visible:!0,disabled:!1,show:!0},{label:"Group Name",key:"org_unit_name",visible:!0,disabled:!1,show:!0},{label:"Campaign",key:"campaign_name",visible:!0,disabled:!1,show:!0},{label:"Ad Source",key:["category",":","sub_category"],visible:!0,disabled:!1,show:!0},{label:"Custom Source 1",key:"custom_source1",visible:h,disabled:!1,show:!0},{label:"Custom Source 2",key:"custom_source2",visible:h,disabled:!1,show:!0},{label:"Custom Source 3",key:"custom_source3",visible:h,disabled:!1,show:!0},{label:"Custom Source 4",key:"custom_source4",visible:h,disabled:!1,show:!0},{label:"Custom Source 5",key:"custom_source5",visible:h,disabled:!1,show:!0},{label:"Caller ID",key:"source",visible:!0,disabled:!1,show:!0},{label:"Tracking Number",key:"tracking",visible:!0,disabled:!1,show:!0},{label:"Hunt Type",key:"hunt_type",visible:h,disabled:!1,show:e.is_migrated},{label:"Number Type",key:"tracking_type",visible:h,disabled:!1,show:e.isMigated},{label:"Destination Name | No.",key:["ring_to_name"," | ","ring_to"],visible:!0,disabled:!1,show:!0},{label:"Duration",key:"duration",visible:!0,disabled:!1,show:!0},{label:"Caller Name",key:"caller_name",visible:!1,disabled:!1,show:!0},{label:"Company Name",key:"company_name",visible:!1,disabled:!1,show:!0},{label:"Address",key:"address",visible:!1,disabled:!1,show:!0},{label:"City",key:"city",visible:!1,disabled:!1,show:!0},{label:"State/Province",key:"state",visible:!1,disabled:!1,show:!0},{label:"Zip/Postal Code",key:"zip",visible:!1,disabled:!1,show:!0},{label:"Instant Insights",key:"instant_insights",visible:!1,disabled:!1,show:e.is_migrated},{label:"Instant Insights Config",key:"instant_insights_config",visible:!1,disabled:!1,show:e.is_migrated},{label:"Disposition",key:"disposition",visible:!0,disabled:!1,show:!0},{label:"Line Type",key:"line_type",visible:!0,disabled:!1,show:!0},{label:"Agent",key:"agent",visible:!0,disabled:!1,show:!0},{label:"Actions",visible:!0,disabled:!1,show:!0}],e.isMigated){var v=_.findIndex(e.callDetailsColumnMapping,{key:"line_type"});e.callDetailsColumnMapping.splice(v+1,0,{label:"Sent to Voicemail",key:"is_voicemail",visible:!1,disabled:!1,show:!0})}e.routeTypes={SimpleRoute:"Simple",IvrRoute2:"IVR",PercentageBasedRoute:"Percentage",GeoRoute:"GeoRoute",OutboundRoute:"Outbound",ScheduleRoute:"Schedule",VoicemailRoute:"Voicemail"},e.callDetailsColumnToggle=function(e){setTimeout(function(){$("#cdr_table").floatingScroll("update")},100)},p.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>'),console.log("REPORT",e.report),e.drp_options={ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"This Month":[moment().startOf("month").startOf("day"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month").startOf("day"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days").startOf("day"),endDate:moment().subtract(1,"days").endOf("day")},o.sessionStorage.report_start_date?e.drp_start=moment(o.sessionStorage.report_start_date).format("MMMM D, YYYY"):e.drp_start=e.drp_options.ranges["Last 7 Days"][0].format("MMMM D, YYYY"),o.sessionStorage.report_end_date?e.drp_end=moment(o.sessionStorage.report_end_date).format("MMMM D, YYYY"):e.drp_end=e.drp_options.ranges["Last 7 Days"][1].format("MMMM D, YYYY"),e.drp_options.startDate=moment(e.drp_start),e.drp_options.endDate=moment(e.drp_end),console.log("DRP_OPTIONS",e.drp_options),e.paginateHeaderTemp=null,e.summaryItemsTemp=null,e.showAgent=!1,(2!==parseInt(e.roleId)||"false"!==a.score_call&&!1!==a.score_call)&&(1!==parseInt(e.roleId)||"false"!==a.score_call&&!1!==a.score_call)||(e.showAgent=!1),e.disableAgent=function(t){return e.userAccess&&(void 0===e.userAccess.manualscorecard||e.userAccess.manualscorecard<=4)?(e.showAgent=!0,!1):"needs_scorecard"!==t&&"unscored"!==t||(e.showAgent=!0,!1)},e.loadReportBasedOnQueryString=function(){if(!1!==a.download_audio_enabled){e.hideDataTable=!0,e.hidePaginationControls=!0,e.isLoadingApi=!0,console.log("INSIDE loadReportBasedOnQueryString IN callsdetails.js: Loading report with urlParams:",e.urlParams),e.paginateHeader="Loading Data...";var t="";if("s"==e.urlParams.filtertype)e.urlParams.filter,t=e.urlParams.filter,e.urlParams.filter.indexOf("`")>-1&&(comIndex=e.urlParams.filter,t=comIndex.replace(/`/g,",")),e.simpleSearchFilter=t;r.getCallsSummaryList($.param(e.urlParams)).then(function(o){if(e.urlParams.filter=t,void 0!==o.data.json)if(console.log("INSIDE CallsDetailsWebService.getCallsSummaryList IN callsdetails.js: Data found",o.data.json),0===o.data.json[0].total_count_calls&&(e.paginateHeader="No Data found."),o.data.json.length>0){var a=o.data.json;_.each(a,function(e){e.singlerec=1,e.average_durationHHMMSS=moment.utc(1e3*parseInt(e.average_duration_calls)),e.total_durationHHMMSS=moment.utc(1e3*parseInt(e.total_duration_calls)),e.average_durationHH=e.average_durationHHMMSS.hours(),e.average_durationMM=e.average_durationHHMMSS.minutes(),e.average_durationSS=e.average_durationHHMMSS.seconds(),e.total_durationHH=e.total_durationHHMMSS.hours(),e.total_durationMM=e.total_durationHHMMSS.minutes(),e.total_durationSS=e.total_durationHHMMSS.seconds()}),e.summaryItemsTemp=a;var i="Showing ";i=e.pagination.current>1?i+" "+(e.pageSize*(e.pagination.current-1)+1)+" - ":i+" "+e.pagination.current+" - ",i=e.pageSize*e.pagination.current>e.summaryItemsTemp[0].total_count_calls?i+" "+e.summaryItemsTemp[0].total_count_calls+" of "+e.summaryItemsTemp[0].total_count_calls:i+" "+e.pageSize*e.pagination.current+" of "+e.summaryItemsTemp[0].total_count_calls,e.summaryItemsTemp[0].total_count_calls>0?e.paginateHeaderTemp=i:e.paginateHeaderTemp="No Data Found"}else e.paginateHeaderTemp="No Data Found",console.log("No returned result data");else e.paginateHeaderTemp="No Result",console.log("No result data")}),console.log("INSIDE loadReportBasedOnQueryString IN callsdetails.js: About to fire getCallsDetailsList"),r.getCallsDetailsList($.param(e.urlParams)).then(function(t){if(e.isLoadingApi=!0,e.horsemanFlag=!0,void 0===t.data.json)return console.log("INSIDE CallsDetailsWebService.getCallsDetailsList IN callsdetails.js: Returning false"),e.isLoadingApi=!1,!1;if(t.data.json.length>0&&t.data.json[0].callList.length>0){e.isLoadingApi=!1,setTimeout(function(){$("#cdr_table").floatingScroll("update")},100);var o=t.data.json[0].callList,i=d3.time.format("%Y-%m-%dT%H:%M:%S.%LZ");void 0!==t.data.json[0].agents&&t.data.json[0].agents.length>0&&(e.IdentifiedAgentData=t.data.json[0].agents),_.each(o,function(t){if(t.ring_to_name=""===t.ring_to_name?" ":t.ring_to_name,!1!==a.is_migrated&&"false"!==a.is_migrated||t.disposition&&(t.disposition=t.disposition.charAt(0).toUpperCase()+t.disposition.slice(1).toLowerCase()),t.is_voicemail=!0===t.is_voicemail?"Yes":"No",t.instant_insights=!0===t.instant_insights?"Yes":"No",t.instant_insights_config=t.instant_insights_config?t.instant_insights_config:" ",t.tracking_type&&"NULL"!==t.tracking_type?("GeoRoute_Npa"==t.tracking_type?t.tracking_type="GeoRoute - Caller Area Code Proximity":"GeoRoute_claimedState"==t.tracking_type?t.tracking_type="GeoRoute - Claimed State":"GeoRoute_Claimed"==t.tracking_type?t.tracking_type="GeoRoute - Claimed Zip-code":"GeoRoute_Zipcode"==t.tracking_type&&(t.tracking_type="GeoRoute - Zip-code Proximity"),e.routeTypes[t.tracking_type]&&(t.tracking_type=e.routeTypes[t.tracking_type])):t.tracking_type=" ",t.call_data&&"API"==t.cdr_source?(t.call_data="NoInfo"!==t.call_data&&"object"!=typeof t.call_data?JSON.parse(t.call_data):t.call_data,t.line_type=t.call_data.line_type?t.call_data.line_type:" ",t.call_data.belongs_to&&t.call_data.belongs_to[0]?(t.caller_name=t.call_data.belongs_to[0].name?t.call_data.belongs_to[0].name:" ",t.company_name=t.call_data.carrier?t.call_data.carrier:" "):(t.caller_name=" ",t.company_name=" "),t.call_data.current_addresses&&t.call_data.current_addresses[0]?(t.address=t.call_data.current_addresses[0].street_line_1?t.call_data.current_addresses[0].street_line_1:" ",t.state=t.call_data.current_addresses[0].state_code?t.call_data.current_addresses[0].state_code:" ",t.city=t.call_data.current_addresses[0].city?t.call_data.current_addresses[0].city:" ",t.zip=t.call_data.current_addresses[0].zip4?t.call_data.current_addresses[0].zip4:" "):(t.address=" ",t.state=" ",t.city=" ",t.zip=" ")):t.call_data?(t.call_data="NoInfo"!==t.call_data&&"object"!=typeof t.call_data?JSON.parse(t.call_data):t.call_data,t.line_type=t.call_data.line_type?t.call_data.line_type:" ",t.call_data.belongs_to&&t.call_data.belongs_to[0]&&"Person"===t.call_data.belongs_to[0].type?(t.caller_name=t.call_data.belongs_to[0].name?t.call_data.belongs_to[0].name:" ",t.company_name=" "):t.call_data.belongs_to&&t.call_data.belongs_to[0]&&"Person"!==t.call_data.belongs_to[0].type?(t.company_name=t.call_data.belongs_to[0].name?t.call_data.belongs_to[0].name:" ",t.caller_name=" "):(t.caller_name=" ",t.company_name=" "),t.call_data.current_addresses&&t.call_data.current_addresses[0]?(t.address=t.call_data.current_addresses[0].street_line_1?t.call_data.current_addresses[0].street_line_1:" ",t.state=t.call_data.current_addresses[0].state_code?t.call_data.current_addresses[0].state_code:" ",t.city=t.call_data.current_addresses[0].city?t.call_data.current_addresses[0].city:" ",t.zip=t.call_data.current_addresses[0].postal_code?t.call_data.current_addresses[0].postal_code:" "):(t.address=" ",t.state=" ",t.city=" ",t.zip=" ")):t.call_data||(t.company_name=" ",t.caller_name=" ",t.address=" ",t.state=" ",t.city=" ",t.zip=" ",t.line_type=" "),t.d3_date=i.parse(t.call_started),t.call_started=moment.utc(t.call_started).format("MM-DD-YYYY h:mm:ss a"),t.singlerec=1,t.blocktext="Block",t.blockclass="btn-danger",t.showinfo=!1,t.noRecording=!1,t.listenLabel="Listen to call",t.callAgentList=angular.copy(e.IdentifiedAgentData),t.ct_user_id){var o=_.findWhere(t.callAgentList,{ct_user_id:t.ct_user_id});o?t.agent=o:"scored"===t.score_card_call_status||"reviewed"===t.score_card_call_status?(t.callAgentList.push({ct_user_id:t.ct_user_id,username:t.username}),t.agent=_.findWhere(t.callAgentList,{ct_user_id:t.ct_user_id})):t.agent={}}else t.agent={};"REFERRAL"==t.disposition&&(t.noRecording=!0,t.listenLabel="No recording for this call"),t.callAgentList.shift(),t.callAgentList=_.sortBy(t.callAgentList,"username"),t.callAgentList.unshift({username:"Unassign",ct_user_id:"unassigned"})}),console.log("@@@@@@@@@ INSIDE CallsDetailsWebService.getCallsDetailsList IN callsdetails.js: Setting items",o),e.items=o,e.xf1=crossfilter(o),e.dc1=dc;for(var n=0;n<o.length;n++)e.showme[n]=!1;r.getCallBlacklist().then(function(t){if(t.data.json&&t.data.json.blacklistNumbers&&t.data.json.blacklistNumbers.length>0){if(void 0!==(o=t.data.json.blacklistNumbers)){for(var a=[],i=0;i<o.length;i++)a.push(o[i].number);e.blocked_calls=a.join(","),e.encrypted_source=[].join(",")}void 0!==e.blocked_calls&&_.each(e.items,function(t){var o=-1;t.source.length>1&&"0"!==t.source&&(o=e.blocked_calls.search(t.source)>-1||e.encrypted_source.search(t.encrypted_source)>-1),o?(t.blocktext="Unblock",t.blockclass="btn-danger-alt"):(t.blocktext="Block",t.blockclass="btn-danger")},e.blocked_calls,e.encrypted_source,[])}}),e.isLoadingApi=!1}else console.log("INSIDE CallsDetailsWebService.getCallsDetailsList IN callsdetails.js: The length of the results is 0."),e.items=[],e.isLoadingApi=!1;e.hideDataTable=!1,e.hidePaginationControls=!1,e.summaryitems=e.summaryItemsTemp,e.paginateHeaderTemp&&(e.paginateHeader=e.paginateHeaderTemp),!0===e.showAdvFilter&&e.advFilterDefinitions.length>0?(e.advFilterDefinitions[0].user_input||0===e.advFilterDefinitions[0].user_input)&&(e.filterApplied=!0):e.simpleSearchFilter.length>0&&(e.filterApplied=!0)})}},e.changedValue=function(t,o,a,i){"unassigned"!==t.agent.ct_user_id?r.checkIfUserValid(t.agent.ct_user_id,a).then(function(a){a.data.json.length>0?(e.saveAgentToCallRecord(t.agent,o),t.agent=_.findWhere(t.callAgentList,{ct_user_id:t.agent.ct_user_id})):d.confirm("The agent you are identifying on the call is not a part of the group the call belongs to. Are you sure you want to proceed?",function(a){a?e.saveAgentToCallRecord(t.agent,o):t.agent=null===i?[]:_.findWhere(t.callAgentList,{ct_user_id:i})})}):e.saveAgentToCallRecord(t.agent,o)},e.saveAgentToCallRecord=function(e,t){if(null!==e&&e.ct_user_id){var o={ct_user_id:e.ct_user_id,call_id:parseInt(t)};r.saveAgentToCall(o).then(function(e){"error"===e.data.result?n.notify({title:"Call Details Update",text:e.data.err,type:"error"}):n.notify({title:"Call Details Update",text:"Successfully assigned agent to call.",type:"success"})})}},e.redirectScheduledEditor=function(t){e.applyFilterParams(),e.loadReportBasedOnQueryString()},e.pageChanged=function(t){console.log("PAGE CHANGED"),e.offset=e.pageSize*(e.pagination.current-1),e.applyFilter()},e.noPulse=function(){0!==document.getElementsByClassName("pulse").length&&document.getElementsByClassName("pulse")[0].classList.remove("pulse")},e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},$("[data-collapse-group='audioShow']").click(function(){var e=$(this);$("[data-collapse-group='audioShow']:not([data-target='"+e.data("target")+"'])").each(function(){$($(this).data("target")).removeClass("in").addClass("collapse")})}),$("[data-collapse-group='infoShow']").click(function(){var e=$(this);$("[data-collapse-group='infoShow']:not([data-target='"+e.data("target")+"'])").each(function(){$($(this).data("target")).removeClass("in").addClass("collapse")})}),e.call_report=o.document.URL.split("/"),e.call_report=e.call_report[e.call_report.length-1],e.call_report=e.call_report.split("?")[0],"calls-details"===e.call_report?e.call_report="call_detail":"calls-callback"===e.call_report?e.call_report="call_back":console.log("Bad call_report value for $scope.call_report"),e.comment={},e.comment.text=[],e.isReadonly=!1,e.isTagAccess=!0,e.isClick=!0,e.userAccess&&(void 0===e.userAccess.campaign||e.userAccess.campaign<5)&&(e.isReadonly=!0),e.getCSVData=function(t){A();console.log("==================================PARSMS",e.urlParams),e.urlParams.limit=1e5,e.csvHeaderNames=["Call ID"],e.csvKeys=["call_id"],e.customSourceMapping=["Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5"],e.callDetailsColumnMapping.forEach(function(t){"Actions"!==t.label&&(-1!==e.customSourceMapping.indexOf(t.label)?(e.csvHeaderNames.push(t.label),e.csvKeys.push(t.key)):t.visible&&(e.csvHeaderNames.push(t.label),e.csvKeys.push(t.key)))}),console.log("csvHeaderNames",e.csvHeaderNames),console.log("csvKeys",e.csvKeys);var o=[];e.summaryitems&&e.summaryitems[0].total_count_calls>1e5&&(d.alert("Your export will be capped at the maximum number of 100,000 records."),e.urlParams.limit=1e5);var i=c.defer();if(r.getCallsDetailsList($.param(e.urlParams)).then(function(r){if(r.data.json.length>0&&r.data.json[0].callList.length>0){var n=r.data.json[0].callList;console.log("EXPORT CSV DATASET",n);d3.time.format("%Y-%m-%dT%H:%M:%S.%LZ");e.isLoadingApi=!1;var s,l={};e.csvKeys.forEach(function(e){Array.isArray(e)?(l[e[0]]=!0,l[e[2]]=!0):l[e]=!0});for(var c=0;c<n.length;c++){n[c].is_voicemail?n[c].is_voicemail="Yes":n[c].is_voicemail="No",1==n[c].instant_insights?n[c].instant_insights="Yes":n[c].instant_insights="No",n[c].tracking_type&&"NULL"!==n[c].tracking_type?("GeoRoute_Npa"==n[c].tracking_type?n[c].tracking_type="GeoRoute - Caller Area Code Proximity":"GeoRoute_claimedState"==n[c].tracking_type?n[c].tracking_type="GeoRoute - Claimed State":"GeoRoute_Claimed"==n[c].tracking_type?n[c].tracking_type="GeoRoute - Claimed Zip-code":"GeoRoute_Zipcode"==n[c].tracking_type&&(n[c].tracking_type="GeoRoute - Zip-code Proximity"),e.routeTypes[n[c].tracking_type]&&(n[c].tracking_type=e.routeTypes[n[c].tracking_type])):n[c].tracking_type=" ";var d={};for(var u in s=null!==n[c].call_data&&"NoInfo"!==n[c].call_data&&"object"!=typeof n[c].call_data?JSON.parse(n[c].call_data):n[c].call_data,l)switch(u){case"call_started":d[u]=moment(n[c][u]).format("MM-DD-YYYY h:mm:ss a");break;case"disposition":d[u]=n[c][u].charAt(0).toUpperCase()+n[c][u].slice(1).toLowerCase();break;case"category":d[u]=n[c][u]+":"+n[c].sub_category;break;case"ring_to_name":d.destination=n[c][u]+" | "+n[c].ring_to;break;case"caller_name":d.caller_name=s&&"NoInfo"!==s&&s.belongs_to&&s.belongs_to[0]&&s.belongs_to[0].name&&"Person"===s.belongs_to[0].type?s.belongs_to[0].name:"";break;case"company_name":"API"!=n[c].cdr_source?d.company_name=s&&"NoInfo"!==s&&s.belongs_to&&s.belongs_to[0]&&s.belongs_to[0].name&&"Person"!==s.belongs_to[0].type?s.belongs_to[0].name:"":d.company_name=s&&"NoInfo"!==s&&s.carrier?s.carrier:"";break;case"address":d[u]=s&&"NoInfo"!==s&&s.current_addresses&&s.current_addresses[0]&&s.current_addresses[0].street_line_1?s.current_addresses[0].street_line_1:"";break;case"city":d[u]=s&&"NoInfo"!==s&&s.current_addresses&&s.current_addresses[0]&&s.current_addresses[0].city?s.current_addresses[0].city:"";break;case"state":d[u]=s&&"NoInfo"!==s&&s.current_addresses&&s.current_addresses[0]&&s.current_addresses[0].state_code?s.current_addresses[0].state_code:"";break;case"zip":d[u]=s&&"NoInfo"!==s&&s.current_addresses&&s.current_addresses[0]&&s.current_addresses[0].postal_code?s.current_addresses[0].postal_code:"";break;case"agent":d[u]=n[c].username;break;case"line_type":d[u]=s&&"NoInfo"!==s&&s.line_type?s.line_type:"";break;default:"sub_category"!==u&&"ring_to"!==u&&(d[u]=n[c][u])}o.push(d)}}if(i.resolve(o),a.isSafari){var p="csv_calls";"tsv"===t&&(p="tsv_calls"),i.resolve(JSONToCSVConvertor(o,p,!0,t))}}),!a.isSafari)return i.promise},e.getCSVDataReports=function(){A();e.urlParams.limit=1e5,!0===a.is_migrated||"true"===a.is_migrated?e.csvHeaderNames=["Call ID","Date/Time","Group Name","Campaign","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Caller ID","Tracking Number","Hunt Type","Destination Name | No.","Duration","Caller Name","Company Name","Address","City","State/Province","Zip/Postal Code","Instant Insights","Instant Insights Config","Disposition","Line Type","Agent","Audio File","Voicemail"]:e.csvHeaderNames=["Call ID","Date/Time","Group Name","Campaign","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Caller ID","Tracking Number","Destination Name | No.","Duration","Caller Name","Company Name","Address","City","State/Province","Zip/Postal Code","Disposition","Line Type","Agent","Audio File"];var t=[],o=c.defer();return r.getCallsDetailsList($.param(e.urlParams)).then(function(a){if(e.isLoadingApi=!0,a.data.json.length>0&&a.data.json[0].callList.length>0){e.isLoadingApi=!1;for(var i=a.data.json[0].callList,r=0;r<i.length;r++){var n=null!==i[r].call_data&&"NoInfo"!==i[r].call_data&&"object"!=typeof i[r].call_data?JSON.parse(i[r].call_data):i[r].call_data,s=i[r].ring_to_name+" | "+i[r].ring_to;"API"==i[r].cdr_source?n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.carrier:n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.belongs_to[0].name&&n.belongs_to[0].type&&"Person"!==n.belongs_to[0].type&&n.belongs_to[0].name;!0===e.isMigated||"true"===e.isMigated?t.push({"Call ID":i[r].call_id?i[r].call_id:" ","Date/Time":i[r].call_started?moment.utc(i[r].call_started).format("MM-DD-YYYY h:mm:ss a"):" ","Group Name":i[r].org_unit_name?i[r].org_unit_name.replace(","," "):" ",Campaign:i[r].campaign_name?i[r].campaign_name:" ","Ad Source":i[r].category+":"+i[r].sub_category,"Custom Source 1":i[r].custom_source1?i[r].custom_source1:" ","Custom Source 2":i[r].custom_source2?i[r].custom_source2:" ","Custom Source 3":i[r].custom_source3?i[r].custom_source3:" ","Custom Source 4":i[r].custom_source4?i[r].custom_source4:" ","Custom Source 5":i[r].custom_source5?i[r].custom_source5:" ","Caller ID":i[r].source?i[r].source:" ","Tracking Number":i[r].tracking?i[r].tracking:" ","Hunt Type":i[r].hunt_type&&void 0!==i[r].hunt_type&&" "!==i[r].hunt_type?i[r].hunt_type:" ","Destination Name | No.":s.replace(","," "),Duration:i[r].duration,"Caller Name":"API"==i[r].cdr_source?n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0?n.belongs_to[0].name:" ":n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.belongs_to[0].name&&n.belongs_to[0].type&&"Person"===n.belongs_to[0].type?n.belongs_to[0].name:" ","Company Name":"API"==i[r].cdr_source?n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0?n.carrier:" ":n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.belongs_to[0].name&&n.belongs_to[0].type&&"Person"!==n.belongs_to[0].type?n.belongs_to[0].name:" ",Address:n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].street_line_1?n.current_addresses[0].street_line_1:" ",City:n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].city?n.current_addresses[0].city:" ","State/Province":n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].state_code?n.current_addresses[0].state_code:" ","Zip/Postal Code":n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].postal_code?n.current_addresses[0].postal_code:" ","Instant Insights":!0===i[r].instant_insights?"Yes":"No","Instant Insights Config":i[r].instant_insights_config?i[r].instant_insights_config:"",Disposition:i[r].disposition.charAt(0).toUpperCase()+i[r].disposition.slice(1).toLowerCase(),"Line Type":n&&n.line_type?n.line_type:" ",Agent:i[r].username,"Audio File":i[r].s3URL?i[r].s3URL:" ",Voicemail:i[r].is_voicemail?"Yes":"No"}):(i[r].disposition&&(i[r].disposition=i[r].disposition.charAt(0).toUpperCase()+i[r].disposition.slice(1).toLowerCase()),t.push({"Call ID":i[r].call_id?i[r].call_id:" ","Date/Time":i[r].call_started?moment.utc(i[r].call_started).format("MM-DD-YYYY h:mm:ss a"):" ","Group Name":i[r].org_unit_name?i[r].org_unit_name.replace(","," "):" ",Campaign:i[r].campaign_name?i[r].campaign_name:" ","Ad Source":i[r].category+":"+i[r].sub_category,"Custom Source 1":i[r].custom_source1?i[r].custom_source1:" ","Custom Source 2":i[r].custom_source2?i[r].custom_source2:" ","Custom Source 3":i[r].custom_source3?i[r].custom_source3:" ","Custom Source 4":i[r].custom_source4?i[r].custom_source4:" ","Custom Source 5":i[r].custom_source5?i[r].custom_source5:" ","Caller ID":i[r].source?i[r].source:" ","Tracking Number":i[r].tracking?i[r].tracking:" ","Destination Name | No.":s.replace(","," "),Duration:i[r].duration,"Caller Name":n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.belongs_to[0].name&&n.belongs_to[0].type&&"Person"===n.belongs_to[0].type?n.belongs_to[0].name:" ","Company Name":"API"==i[r].cdr_source?n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0?n.carrier:" ":n&&"NoInfo"!==n&&n.belongs_to&&n.belongs_to.length>0&&n.belongs_to[0].name&&n.belongs_to[0].type&&"Person"!==n.belongs_to[0].type?n.belongs_to[0].name:" ",Address:n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].street_line_1?n.current_addresses[0].street_line_1:" ",City:n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].city?n.current_addresses[0].city:" ","State/Province":n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].state_code?n.current_addresses[0].state_code:" ","Zip/Postal Code":n&&"NoInfo"!==n&&n.current_addresses&&n.current_addresses.length>0&&n.current_addresses[0].postal_code?n.current_addresses[0].postal_code:" ",Disposition:i[r].disposition.charAt(0).toUpperCase()+i[r].disposition.slice(1).toLowerCase(),"Line Type":n&&n.line_type?n.line_type:" ",Agent:i[r].username,"Audio File":i[r].s3URL?i[r].s3URL:" "}))}}o.resolve(t),e.csvDataScheduleReport=t}),o.promise},e.exportPDF=function(){g.start();var t=c.defer();n.notify({title:"Export Call details",text:"Download is in process, it will be completed in few minutes",type:"info"});var o=[];e.customSourceMapping=["Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5"],e.callDetailsColumnMapping.forEach(function(t){if(-1!==e.customSourceMapping.indexOf(t.label)){var a={label:t.label,visible:t.visible};o.push(a),t.visible=!0}"Actions"==t.label&&(t.visible=!1)}),e.element=document.getElementById("callsData");g.set(50);var a=html2pdf().from(e.element).set({margin:0,filename:"calls-details.pdf",image:{type:"jpeg",quality:1},html2canvas:{scale:2},jsPDF:{unit:"pt",format:"tabloid",orientation:"l"}}).save();return e.callDetailsColumnMapping.forEach(function(e){o.forEach(function(t){e.label===t.label&&(e.visible=t.visible)}),"Actions"==e.label&&(e.visible=!1)}),t.resolve(a),g.end(),t.promise},e.call_tags=[],e.selCallTags={},e.call_tagslength=[];var b,w,y,S,C={};function A(){e.applyFilterParams(),setTimeout(function(){var t=void 0!==p.search().offset?parseInt(p.search().offset):0;return e.pagination.current=parseInt(t/100)+1,e.urlParams},1e3)}C.aggregate_property_keys={call_id:"call_id",date_time:"call_started",group_name:"org_unit_name",campaign:"campaign_name",channel:"category",custom_source1:"custom_source1",custom_source2:"custom_source2",custom_source3:"custom_source3",custom_source4:"custom_source4",custom_source5:"custom_source5",subchannel:"sub_category",caller_id:"caller_id",tracking_nbr:"tracking",dest_name:"ring_to_name",dest_nbr:"ring_to",duration:"duration",is_voicemail:"is_voicemail"},C.dataTableHeaderValues={call_id:"Call ID",date_time:"Date/Time",group_name:"Group Name",campaign:"Campaign",channel:"Ad Source",custom_source1:"custom_source1",custom_source2:"custom_source2",custom_source3:"custom_source3",custom_source4:"custom_source4",custom_source5:"custom_source5",subchannel:"Sub Channel",caller_id:"Caller ID",tracking_nbr:"Tracking Number",dest_name:"Destination Name",dest_nbr:"No.",duration:"Duration",is_voicemail:"Voicemail"},e.simpleSearchApplied=!0,e.simpleSearchPlaceholder="",e.changeDateRange=function(){e.isLoadingApi=!0,e.filterReset(),o.sessionStorage.report_start_date=e.drp_start,o.sessionStorage.report_end_date=e.drp_end,e.offset=0,e.pagination.current=1,e.horsemanFlag=!1,e.filterApplied=!1,e.applyFilter()},e.changeReportParams=function(t){e.applyFilterParams()},e.call_commentslength=[],e.call_comments=[],e.getcallcomments=function(t,o){r.getCallsComments(e.call_report,t,o).then(function(t){var a=t.data.json;_.each(a,function(e){e.comment_created_formatted=moment(e.comment_created).format("MM-DD-YYYY h:mm:ss a"),e.singlerec=1}),e.call_id=o,e.call_comments[o]=_.filter(a,function(e){return null===e.comment_parent_id}),e.call_commentslength[o]=void 0!==e.call_comments[o]?e.call_comments[o].length:0,e.call_responses=_.filter(a,function(e){return null!==e.comment_parent_id}),e.call_responseslength=void 0!==e.call_responses?e.call_responses.length:0})},e.getcalltags=function(t,o){r.getCallsTags(e.call_report,a.userId,o).then(function(t){var i=t.data.json,n=[];void 0!==i&&(_.each(i,function(t){t.singlerec=1;var o={};o.id=t.tag_id,o.text=t.tag_name,n.push(o.id),t.permission>e.userAccess.tag&&(t.locked="locked")}),e.selCallTags[o]=n,e.call_id=o,e.call_tagslength[o]=i.length,e.call_tags[o]=i),r.getTags(e.call_report,a.userId,o).then(function(t){var a=t.data.json;e.selTags=[],void 0!==a&&(_.each(a,function(t){t.singlerec=1,e.selTags.push(t.tag_id),$("#calltagselect"+o).append('<option value="'+t.tag_id+'" >'+t.tag_name+"</option>")}),e.call_id=o,e.tagslength=a.length,e.tags=a)})})},e.ind_scores=[],e.dnidata=[],e.caller_info=[],e.getinfodetails=function(t,o,i){i?(r.getCallsDetailsInfo(e.call_report,a.userId,o).then(function(o){var a=o.data.json,i=a[0].dni,r=i.length,n=a[0].source_data,s=n.length,l=a[0].indicator_scores,c=l.length;if(_.each(a,function(e){e.singlerec=1}),void 0!==a[0]){if(s>0?(e.hasExtendedData=!0,"NoInfo"!=n[0].call_data&&(n[0].call_data="object"!=typeof n[0].call_data?JSON.parse(n[0].call_data):n[0].call_data),"NoInfo"===n[0].call_data?e.caller_info[t]={consumer1:{first_name:"No Information"}}:(e.caller_info[t]=n[0].call_data.reverse_phone_append?n[0].call_data.reverse_phone_append:n[0].call_data,e.caller_info[t].source=n[0].call_data.reverse_phone_append?"acxiom":"white pages")):e.hasExtendedData=!0,c>0)for(var d in e.ind_scores[t]=[],l)e.ind_scores[t][l[d].indicator_name]=l[d].score_value;if(r>0&&void 0!==i[0]){e.dnidata[t]=a[0].dni[0];var u=e.dnidata[t].referring.match(new RegExp(".+?[^/:](?=[?/]|$)"));null!==u&&(e.dnidata[t].referring=u[0])}}}),e.getcallcomments(a.userId,o),e.call_tagslength[o]="",e.call_tags[o]=[],e.getcalltags(a.userId,o)):e.comment.text=[]},e.tagoptiontemplate=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-href="#" ng-click="postcalltag($index, item.call_id, false);">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1,r=_.uniq(t,function(e){return e.text.trim()});if(a.term=a.term.trim(),a.term.length>0){for(var n in r)if(a.term.trim().toLowerCase()==r[n].text.trim().toLowerCase()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="postcalltag($index, item.call_id, false);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return r},simple_tags:!0,allowClear:!0}},e.newtagvalue=e.oldtagvalue="",e.postcalltag=function(t,o,i){var s={},l=[];if(s.addmultiple=i,s.call_id=e.call_id,s.ct_user_id=a.userId,s.currentOUId=a.currentOUId,i)currentTags=$("#calltagselect"+o).select2("data"),_.each(currentTags,function(t,o){l.push({tag:{call_id:e.call_id,ct_user_id:a.userId,org_unit_id:a.currentOUId,tag_id:parseInt(currentTags[o].id),tag_text:currentTags[o].text.trim(),tag_created:null}})}),s.calltags=l,r.setCallsTags(s,a.userId).then(function(t){t.data.json;""===t.data.err?(n.notify({title:"Update Call Tags",text:"Successfully updated call tags",type:"success"}),e.call_tagslength[o]=l.length):n.notify({title:"Update Call Tags",text:t.data.err,type:"error"})});else{var c=_.pluck(e.tags,"tag_name");c=c.map(function(e){return e.toLowerCase()});var d=_.filter(c,function(t){return t==e.noResultsTag.trim().toLowerCase()});if(""===e.newtagvalue?e.oldtagvalue="":e.oldtagvalue=e.newtagvalue,e.newtagvalue=e.noResultsTag.trim(),e.newtagvalue===e.oldtagvalue)return;if(d.length>0)return n.notify({title:"Update Call Tags",text:"This Tag already exists",type:"error"}),!1;l.push({tag:{call_id:e.call_id,ct_user_id:a.userId,org_unit_id:a.currentOUId,tag_id:null,tag_text:e.noResultsTag.trim(),tag_created:null}}),s.calltags=l,r.setCallsTags(s,a.userId).then(function(t){var o=t.data.json;if(""===t.data.err){n.notify({title:"Update Call Tags",text:"Successfully added call tag",type:"success"}),currentTags=$("#calltagselect"+e.call_id).select2("data");var a=[],i=[];_.each(currentTags,function(t){t.singlerec=1,a.push(t.id),i.push({call_id:e.call_id,tag_id:t.id,tag_name:t.text,locked:t.locked?"locked":"unlocked"})}),a.push(o.tag_id),i.push({call_id:e.call_id,tag_id:o.tag_id,tag_name:o.tag_name,locked:!1}),e.selCallTags[e.call_id]=a,e.call_tagslength[e.call_id]=i.length,e.call_tags[e.call_id]=i}else n.notify({title:"Update Comments",text:t.data.err,type:"error"})})}},e.$watch("call_tags[$scope.call_id]",function(t,o){s(function(){!angular.isUndefined(e.selCallTags[e.call_id])&&e.call_tags[e.call_id].length>0&&($(".select2-drop").hide(),$("select2-container .select2-choices").append('<li class="select2-search-choice"><div>'+e.call_tags[e.call_id][e.call_tags[e.call_id].length-1].tag_name.toString()+'<div><a href="#" class="select2-search-choice-close" tabindex="-1"></a></li>'))})},!0),e.$watch("noResultsTag",function(t,o){t&&t!==o&&s(function(){var t=$(".select2-no-results");l(t.contents())(e)})},!0),e.postcomment=function(t,o){var i={comment:{call_id:o,ct_user_id:a.userId,comment_text:e.comment.text[o],comment_created:null,is_from_report:!0,comment_modified:null,comment_parent_id:null,comment_active:!0}};r.setCallsComments(e.call_report,i,a.userId).then(function(t){t.data.json;""===t.data.err?(n.notify({title:"Update Comments",text:"Successfully added comment",type:"success"}),e.comment.text[o]="",e.getcallcomments(a.userId,o)):n.notify({title:"Update Comments",text:t.data.err,type:"error"})})},e.userCanDeleteComment=function(t){return!e.isReadonly||parseInt(a.userId)===t},e.deletecomment=function(t,o,i){r.deleteCallsComments(e.call_report,o,a.userId).then(function(t){t.data.json;""===t.data.err?(n.notify({title:"Delete Comments",text:"Successfully deleted comment",type:"success"}),e.getcallcomments(a.userId,i)):n.notify({title:"Delete Comments",text:t.data.err,type:"error"})})},e.blocknumber=function(t,o,i,s){if("0"!==i&&""!==i&&"0000000000"!==i){if(e.isClick=!1,"Block"===e.items[t].blocktext){var l={caller_id:i,org_unit_id:a.currentOUId};return r.setCallBlacklist(l).then(function(o){""===o.data.err?(_.each(e.items,function(o){o.encrypted_source!==i&&o.source!==i||(o.blocktext="Unblock",o.blockclass="btn-danger-alt",o.blockme=!1),e.items[t].blockme=!1},i,s),n.notify({title:"Block Number",text:"Successfully blacklisted Caller ID",type:"success"})):(n.notify({title:"Block Number",text:o.data.err,type:"fail"}),e.items[t].blockme=!1)}),e.isClick=!0,!0}return r.unsetCallBlacklist(i).then(function(o){""===o.data.err?(_.each(e.items,function(o){o.encrypted_source!==i&&o.source!==i||(o.blocktext="Block",o.blockclass="btn-danger",o.blockme=!1),e.items[t].blockme=!1},i),n.notify({title:"Unblock Number",text:"Successfully removed Caller ID from blacklist",type:"success"})):(n.notify({title:"Unblock Number",text:o.data.err[0].blacklist[0].errors[0],type:"fail"}),e.items[t].blockme=!1)}),e.isClick=!0,!0}e.items[t].blockme=!1,n.notify({title:"Block Number",text:i+" is not a valid number",type:"fail"})},e.updateSimpleFilter=function(t){e.advFiltersAreApplied=!1,void 0!==e.simpleSearchFilter?(e.filter=e.simpleSearchFilter,e.filtertype="s"):(e.filter="",e.filtertype="a"),e.offset=0,e.pagination.current=1,e.applyFilterParams()},e.mappedHeaderValues=(b=C.dataTableHeaderValues,w=C.aggregate_property_keys,(y={})[b.call_id]=w.call_id,y[b.date_time]=w.date_time,y[b.group_name]=w.group_name,y[b.campaign]=w.campaign,y[b.channel]=w.channel,y[b.custom_source1]=w.custom_source1,y[b.custom_source2]=w.custom_source2,y[b.custom_source3]=w.custom_source3,y[b.custom_source4]=w.custom_source4,y[b.custom_source5]=w.custom_source5,y[b.subchannel]=w.subchannel,y[b.caller_id]=w.caller_id,y[b.tracking_nbr]=w.tracking_nbr,y[b.dest_name]=w.dest_name,y[b.dest_nbr]=w.dest_nbr,y[b.duration]=w.duration,y[b.is_voicemail]=w.is_voicemail,y),e.headerNames=[(S=C.dataTableHeaderValues).call_id,S.date_time,S.group_name,S.campaign,S.channel,S.custom_source1,S.custom_source2,S.custom_source3,S.custom_source4,S.custom_source5,S.caller_id,S.tracking_nbr,S.dest_name+"|"+S.dest_nbr,S.duration,S.is_voicemail],e.toggleFilterUsed=function(){e.advFiltersAreApplied=!e.advFiltersAreApplied,e.simpleSearchApplied=!e.simpleSearchApplied,e.initializeAdvFilterDefinitions(),e.updateAdvancedFilter(!0),e.applyFilterParams()},e.disableButton=function(t){return!(void 0!==e.audio&&void 0!==e.audio[t]&&!isNaN(e.audio[t].duration))},e.openEmail=function(t,o){e.s3URL=o,u.open({animation:e.animationsEnabled,templateUrl:"assets/partials/emailCall.html",controller:"ModalInstanceCtrl",size:t,resolve:{s3URL:function(){return o}}}).result.then(function(t){e.selected=t},function(){})},e.preloading=!1,e.showAdvFilter=!1,e.advancedFilterConfig={maxQuantity:5},e.extendUrlParams=function(t){"s"===t.vars.filtertype&&(e.simpleSearchFilter=t.vars.filter),e.urlParams=t.vars,e.drp_start=moment(e.urlParams.start_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),e.drp_end=moment(e.urlParams.end_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),angular.extend(e,t.vars),delete t.vars,angular.extend(e,t)},e.getInitialUrlParams=void m.determineInitializationMethod(e).then(function(t){console.log("INSIDE getInitialUrlParams IN callsdetails.js: Returned urlParams:",t),e.advFilterDefinitions=m.getAdvFilterDefinitions(),e.advFilterDefinitions.length>0&&void 0!==e.advFilterDefinitions[0].selected_column&&(e.showAdvFilter=!0),e.extendUrlParams(t),e.loadReportBasedOnQueryString()}),e.addFilterDefinition=function(){m.addFilterDefinition(!1),e.advFilterDefinitions=m.getAdvFilterDefinitions()},e.updateOperators=function(t,o,a){m.updateOperators(t,o,a),e.advFilterDefinitions=m.getAdvFilterDefinitions()},e.applyFilterParams=function(){var t=m.applyFilter(e);return!!t&&(e.extendUrlParams(t),!0)},e.applyFilter=function(){e.horsemanFlag=!1;var t=e.applyFilterParams();for(var o in e.audio)e.audio[o].pause();var i=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var r in a.$$listeners)-1===i.indexOf(r)&&delete a.$$listeners[r];e.audio=void 0,t&&e.loadReportBasedOnQueryString()},e.filterReset=function(){i&&i.filtertype&&p.search({report:"call_detail"}),m.resetAdvFilter(),e.advFilterDefinitions=m.getAdvFilterDefinitions(),e.showAdvFilter=!1,e.simpleFilterText="",e.filtertype="s",e.filter="",e.filterApplied&&(e.applyFilter(),e.filterApplied=!1)},e.removeFilterDefinition=function(t){m.removeFilterDefinition(t),e.advFilterDefinitions=m.getAdvFilterDefinitions()},e.validateInput=function(e){m.validateInput(e)},e.increaseAudioInitializationCount=function(){++e.audioInitializationCount},e.loadMediaElement=function(){console.log("Initialize Media Elements"),e.audioInitializationCount=0,$("audio").mediaelementplayer({features:["playpause","progress","current","duration","tracks"],success:function(e){var t=$("#"+e.id+"-rendername");console.log("media id:",e.id),e.addEventListener("loadedmetadata",function(e){console.log("playing....... ")},!1),e.addEventListener("error",function(e){t.find(".error").html("<strong>Error</strong>: "+e.message)},!1)}})},e.playPause=function(e){console.log("Pausing all audios.."),$("audio").trigger("pause")}}]).controller("ModalInstanceCtrl",["$scope","CallsDetailsWebService","$uibModalInstance","s3URL","pinesNotifications","$rootScope",function(e,t,o,a,i,r){e.email={to:null,from:"no-reply@messages.services",message:null,name:r.fullName,s3URL:a},e.sendEmail=function(){var a={email:e.email},r=!0;e.email.to&&/^[_a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/.test(e.email.to)||(i.notify({title:"Email Call Form",text:"You must enter a valid To email address",type:"error"}),r=!1);e.email.from&&/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/gim.test(e.email.from)||(i.notify({title:"Email Call Form",text:"You must enter a valid From email address",type:"error"}),r=!1),r&&t.emailRecording(a).then(function(t){""===t.data.err?(i.notify({title:"Email Call",text:"Successfully emailed call",type:"success"}),o.close(e.email)):i.notify({title:"Email Call",text:"Failed to email call",type:"error"})})},e.cancel=function(){o.dismiss("cancel")}}]),angular.module("theme.conversations",["ui.select2","angularUtils.directives.dirPagination","api-param"]).factory("ConversationWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getActiveConversations:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/conversation?"+e+"&count=true&status=read,unread",r.headerConfig())},getActiveBadgeCount:function(){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/conversation/badge",r.headerConfig())},getConversations:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/conversation?"+e+"&count=true",r.headerConfig())},viewConversation:function(e){return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/conversation/"+e,r.headerConfig())},archiveConversation:function(e){var t={method:"PUT",url:r.baseURL()+"/v1/conversation/status",headers:r.headerConfig().headers,data:e};return o(t)},updateLabel:function(e){var t={method:"PUT",url:r.baseURL()+"/v1/conversation/label",headers:r.headerConfig().headers,data:e};return o(t)}};return n}]).controller("ActiveConversationController",["$scope","$window","$location","$interval","$rootScope","$routeParams","ConversationWebService","advFilSrvc","pinesNotifications","progressLoader","$bootbox",function(e,t,o,a,i,r,n,s,l,c,d){e.isActiveConversationsOpne=!0,e.activeConversationsLoading=!1,i.isSafari=t.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.conversationsHeader=["Group | External Id","Campaign | External Id","Tracking Number","Caller ID","First Message","Last Message","Agent Name | Agent Email","Label"],e.actionHeader=["Actions"],e.currentPage=1,e.pageSize=10,e.limit=10,e.isLabelEditing=!1,e.noDataFound=!1,i.activeConversations=[],e.totalActiveConversations=0,e.advFilterDefinitions=[],e.canModify=!1,e.oldLabel="",i.conversationStatus={UNREAD:"unread",READ:"read",REPLIED:"replied",DELETED:"deleted"},i.notificationType={ERROR:"error",SUCCESS:"success"},e.pagination={current:r.page?r.page:1},i.userAccess.sms&&7===parseInt(i.userAccess.sms)&&(e.canModify=!0),e.$on("message-sent",function(t,o){0===i.activeConversations.length&&(e.noDataFound=!0)}),e.showNotification=function(e,t){l.notify({title:"Conversation",text:e,type:t})},e.loadActiveConversationReport=function(){var t="";(i.activeConversations=[],e.activeConversationsLoading=!0,"s"==e.urlParams.filtertype&&e.urlParams.filter)&&(e.urlParams.filter,t=e.urlParams.filter,e.urlParams.filter.indexOf("`")>-1&&(comIndex=e.urlParams.filter,t=comIndex.replace(/`/g,",")),e.simpleSearchFilter=t);n.getActiveConversations($.param(e.urlParams)).then(function(t){t.data&&""==t.data.err&&t.data.json&&t.data.json.conversation&&t.data.json.conversation.length?(i.activeConversations=t.data.json.conversation,e.totalActiveConversations=t.data.json.total_record,e.activeConversationsLoading=!1,e.noDataFound=!1):(e.totalActiveConversations=0,i.activeConversations=[],e.activeConversationsLoading=!1,e.noDataFound=!0)})},e.applyActiveConversationsFilter=function(){e.applyActiveConversationsFilterParams();var t=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var o in i.$$listeners)-1===t.indexOf(o)&&delete i.$$listeners[o];e.loadActiveConversationReport()},e.applyActiveConversationsFilterParams=function(){var t=s.applyFilter(e);return!!t&&(e.extendActiveConversationsUrlParams(t),!0)},e.extendActiveConversationsUrlParams=function(t){"s"===t.vars.filtertype&&(e.simpleSearchFilter=t.vars.filter),e.urlParams=t.vars,e.drp_start=moment(e.urlParams.start_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),e.drp_end=moment(e.urlParams.end_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),angular.extend(e,t.vars),delete t.vars,angular.extend(e,t)},e.filterReset=function(){e.advFilterDefinitions=[],e.showAdvFilter=!1,e.simpleFilterText="",e.filtertype="s",e.filter="",e.applyActiveConversationsFilter()},e.pageChanged=function(t){e.offset=e.pageSize*(e.pagination.current-1),e.applyActiveConversationsFilter()},e.saveLabel=function(t){if(null!=e.oldLabel&&""!=e.oldLabel||null!=t.label&&""!=t.label)if(t.conversation_id){var o={conversation_id:t.conversation_id,conversation_status:t.conversation_status,label:t.label};n.updateLabel(o).then(function(o){if("success"===o.data.status)e.isLabelEditing=!1,e.applyActiveConversationsFilter(),e.showNotification("Label updated successfully",i.notificationType.SUCCESS),e.conversationData.length>0&&e.conversationData.forEach(function(o,a){t.conversation_id==o.conver.conversation_id&&(e.conversationData[a].conver.label=t.label,e.conversationData[a].conver.labelUpdate=t.label)});else{e.isLabelEditing=!1,e.applyActiveConversationsFilter();var a="Failed while updating conversation label. "+o.data.err;e.showNotification(a,i.notificationType.ERROR)}})}else e.showNotification("Failed while updating conversation label.",i.notificationType.ERROR);else{e.showNotification("Failed while updating conversation label. Label text should not be empty.",i.notificationType.ERROR)}},e.applyActiveConversationsFilter(),e.refactoringInactiveConversations=function(){var e=_.pluck(i.activeConversations,"conversation_id");_.forEach(e,function(e){var t=_.findIndex(i.conversations,function(t){return t.conversation_id==e});-1!==t?i.conversations.splice(t,1):console.log("nothing to remove")})},e.removeConversation=function(t){d.confirm("Conversation will not be shown once archived. For retrieval you need to contact customer support. Do you still want to proceed?",function(o){if(o&&t.conversation_id){var a={conversation_id:t.conversation_id,conversation_status:i.conversationStatus.DELETED};n.archiveConversation(a).then(function(o){if("success"===o.data.status){e.applyActiveConversationsFilter(),e.showNotification("Conversation archived successfully",i.notificationType.SUCCESS);var a=_.findIndex(e.conversationData,function(e){return e.conver.conversation_id==t.conversation_id});i.$broadcast("closeChatArchiev",{index:a})}else{var r="Failed while archiving your conversation. "+o.data.err;e.showNotification(r,i.notificationType.ERROR)}})}})},e.labelEdit=function(t){e.oldLabel=t.label,e.isLabelEditing=!0},e.refactoringInactiveConversations=function(){var e=_.pluck(i.activeConversations,"conversation_id");_.forEach(e,function(e){var t=_.findIndex(i.conversations,function(t){return t.conversation_id==e});-1!==t?(i.conversations.splice(t,1),i.$broadcast("conversation-moved")):console.log("nothing to remove")})},a(function(){"loggedin"==i.loginState&&"/sms-conversations"===o.path()&&0==e.isLabelEditing&&n.getActiveConversations($.param(e.urlParams)).then(function(t){t.data&&""==t.data.err&&t.data.json&&t.data.json.conversation&&t.data.json.conversation.length?(i.activeConversations=t.data.json.conversation,e.totalActiveConversations=t.data.json.total_record,e.noDataFound=!1,e.refactoringInactiveConversations()):(e.totalActiveConversations=0,i.activeConversations=[],e.activeConversationsLoading=!1,e.noDataFound=!0)})},3e4),i.replyConversation=function(t){if(e.isAlreadyOpen=!1,t.conversation_status===i.conversationStatus.UNREAD&&(t.conversation_status=i.conversationStatus.READ,i.$broadcast("msg_read",i.activeConversation-1)),e.conversationData&&e.conversationData.forEach(function(o){o.conver.conversation_id==t.conversation_id&&(e.isAlreadyOpen=!0)}),!e.isAlreadyOpen){var o=Object.assign({},t);e.countAdd++,obj={countAdd:e.countAdd},e.countChatWindow.push(obj),e.$emit("chatWindowOpen",{conver:o})}},e.$on("labelUpdate",function(t,o){e.activeConversations.forEach(function(e){o.conversation_id===e.conversation_id&&(e.label=o.label)})}),e.$on("conversation-moved",function(t){e.totalActiveConversations=e.totalActiveConversations-1,e.noDataFound=0===i.activeConversations.length})}]).controller("ConversationController",["$scope","$window","$rootScope","$routeParams","ConversationWebService","advFilSrvc","pinesNotifications","progressLoader","$bootbox","$q",function(e,t,o,a,i,r,n,s,l,c){e.isConversationsOpne=!0,e.conversationsLoading=!1,o.isSafari=t.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.conversationsHeader=["Group | External Id","Campaign | External Id","Tracking Number","Caller ID","First Message","Last Message","Agent Name | Agent Email","Label"],e.actionHeader=["Actions"],e.noDataFound=!1,o.conversations=[],e.totalConversations=0,e.advFilterDefinitions=[],e.pagination={current:a.page?a.page:1},e.currentPage=1,e.pageSize=100,e.oldLabel=null,e.canModify=!1,e.drp_options={ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"This Month":[moment().startOf("month").startOf("day"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month").startOf("day"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days").startOf("day"),endDate:moment().subtract(1,"days").endOf("day")},e.$on("message-sent",function(t,o){e.noDataFound=!1}),e.$on("conversation-moved",function(){e.totalConversations=o.conversations.length,e.noDataFound=0===o.conversations.length}),e.showNotification=function(e,t){n.notify({title:"Conversation",text:e,type:t})},t.sessionStorage.report_start_date?e.drp_start=moment(t.sessionStorage.report_start_date).format("MMMM D, YYYY"):e.drp_start=e.drp_options.ranges["Last 7 Days"][0].format("MMMM D, YYYY"),t.sessionStorage.report_end_date?e.drp_end=moment(t.sessionStorage.report_end_date).format("MMMM D, YYYY"):e.drp_end=e.drp_options.ranges["Last 7 Days"][1].format("MMMM D, YYYY"),e.drp_options.startDate=moment(e.drp_start),e.drp_options.endDate=moment(e.drp_end),o.userAccess.sms&&7===parseInt(o.userAccess.sms)&&(e.canModify=!0),e.loadConversationReport=function(){var t="";(e.conversationsLoading=!0,o.conversations=[],"s"==e.urlParams.filtertype&&e.urlParams.filter)&&(e.urlParams.filter,t=e.urlParams.filter,e.urlParams.filter.indexOf("`")>-1&&(comIndex=e.urlParams.filter,t=comIndex.replace(/`/g,",")),e.simpleSearchFilter=t);i.getConversations($.param(e.urlParams)).then(function(t){t.data&&""==t.data.err&&t.data.json&&t.data.json.conversation&&t.data.json.conversation.length?(o.conversations=t.data.json.conversation,e.totalConversations=t.data.json.total_record,e.conversationsLoading=!1,e.noDataFound=!1):(e.totalConversations=0,o.conversations=[],e.conversationsLoading=!1,e.noDataFound=!0)})},e.labelEdit=function(t){e.oldLabel=t.label};var d="SMS Conversation "+moment().format("YYYY-MM-DD");e.conversationsHeaders=function(){return["Group | External Id","Campaign | External Id","Tracking Number","Caller ID","First Message","Last Message","Agent Name | Agent Email","Label"]},e.getCSVConversationData=function(t){n.notify({title:"Export SMS Conversation",text:"Download is in process, it will be completed in few minutes",type:"info"}),e.conversationReportFileName=d+"."+t,s.start();var a={},r=c.defer(),l=e.urlParams;if(l.offset=0,l.limit=5e4,i.getConversations($.param(l)).then(function(i){if("error"!=i.data.json){a=i.data.json;for(var n=[],l=0;l<a.conversation.length;l++)n.push({a:a.conversation[l].org_unit_name+" | "+(null!=a.conversation[l].org_unit_ext_id?a.conversation[l].org_unit_ext_id:" "),b:a.conversation[l].campaign_name+" | "+(null!=a.conversation[l].campaign_ext_id?a.conversation[l].campaign_ext_id:" "),c:a.conversation[l].tracking,d:a.conversation[l].source,e:a.conversation[l].conversation_started,f:a.conversation[l].conversation_ended,g:a.conversation[l].agent_name+" | "+a.conversation[l].agent_email_id,h:a.conversation[l].label});if(s.set(50),r.resolve(n),!o.isSafari)return s.end(),r.promise;r.resolve(JSONToCSVConvertor(n,e.conversationReportFileName,!0,t))}}),!o.isSafari)return s.end(),r.promise},e.applyConversationsFilter=function(){e.applyConversationsFilterParams();var t=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var a in o.$$listeners)-1===t.indexOf(a)&&delete o.$$listeners[a];e.loadConversationReport()},e.applyConversationsFilterParams=function(){var t=r.applyFilter(e);return!!t&&(e.extendConversationsUrlParams(t),!0)},e.extendConversationsUrlParams=function(t){"s"===t.vars.filtertype&&(e.simpleSearchFilter=t.vars.filter),e.urlParams=t.vars,e.drp_start=moment(e.urlParams.start_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),e.drp_end=moment(e.urlParams.end_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),angular.extend(e,t.vars),delete t.vars,angular.extend(e,t)},e.changeDateRange=function(){e.filterReset(),t.sessionStorage.report_start_date=e.drp_start,t.sessionStorage.report_end_date=e.drp_end,e.offset=0,e.pagination.current=1,e.horsemanFlag=!1,e.applyConversationsFilter()},e.filterReset=function(){e.advFilterDefinitions=[],e.showAdvFilter=!1,e.simpleFilterText="",e.filtertype="s",e.filter="",e.applyConversationsFilter(),e.filterApplied=!1},e.pageChanged=function(t){e.offset=e.pageSize*(e.pagination.current-1),e.applyConversationsFilter()},e.$on("labelUpdate",function(t,o){e.conversations.forEach(function(e){o.conversation_id===e.conversation_id&&(e.label=o.label)})}),e.saveLabel=function(t){if(null!=e.oldLabel&&""!=e.oldLabel||null!=t.label&&""!=t.label)if(t.conversation_id){var a={conversation_id:t.conversation_id,conversation_status:t.conversation_status,label:t.label};i.updateLabel(a).then(function(a){if("success"===a.data.status)e.isLabelEditing=!1,e.applyConversationsFilter(),e.showNotification("Label updated successfully",o.notificationType.SUCCESS),e.conversationData.length>0&&e.conversationData.forEach(function(o,a){t.conversation_id==o.conver.conversation_id&&(e.conversationData[a].conver.label=t.label,e.conversationData[a].conver.labelUpdate=t.label)});else{e.isLabelEditing=!1,e.applyConversationsFilter();var i="Failed while updating conversation label. "+a.data.err;e.showNotification(i,o.notificationType.ERROR)}})}else e.showNotification("Failed while updating conversation label.",o.notificationType.ERROR);else{e.showNotification("Failed while updating conversation label. Label text should not be empty.",o.notificationType.ERROR)}},e.removeConversation=function(t){l.confirm("Conversation will not be shown once archived. For retrieval you need to contact customer support. Do you still want to proceed?",function(a){if(a&&t.conversation_id){var r={conversation_id:t.conversation_id,conversation_status:o.conversationStatus.DELETED};i.archiveConversation(r).then(function(a){if("success"===a.data.status){e.applyConversationsFilter(),e.showNotification("Conversation archived successfully.",o.notificationType.SUCCESS);var i=_.findIndex(e.conversationData,function(e){return e.conver.conversation_id==t.conversation_id});o.$broadcast("closeChatArchive",{index:i})}else{var r="Failed while archiving your conversation. "+a.data.err;e.showNotification(r,o.notificationType.ERROR)}})}})},e.applyConversationsFilter()}]),angular.module("theme.scorecards",["angularFileUpload","angularjs-dropdown-multiselect","angularUtils.directives.dirPagination","ui.select2","toggle-switch","ngTouch","ngAnimate","ui.bootstrap","api-param","datetime-timezoned"]).directive("file",function(){return{scope:{file:"="},link:function(e,t,o){t.bind("change",function(t){var o=t.target.files[0];e.file=o?o.name:void 0,e.$apply()})}}}).factory("SelectedScorecard",function(){"use strict";var e={Id:""};return{getId:function(){return e.Id},setId:function(t){e.Id=t}}}).factory("ScoreCardService",["$q","$timeout","$http","$window","$rootScope","$upload","ApiParam",function(e,t,o,a,i,r,n){"use strict";var s={getScoreCards:function(e,t,a){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/getScoreCards?page="+e+"&isExport="+t+"&timezone="+a,n.headerConfig())},getGroups:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/getGroups",n.headerConfig())},getScoreCard:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/scoreId/"+e,n.headerConfig())},archiveScorecard:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/archiveScorecard/scoreId/"+e,n.headerConfig())},getAttachedCalls:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/getAttachedCalls/scoreCardId/"+e,n.headerConfig())},checkScoreCardStatus:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/scorecard/checkScoreCardStatus/scoreId/"+e,n.headerConfig())},createScorCard:function(e){return o.post(n.baseURL()+"/v1/scorecard",e,n.headerConfig())},updateScoreCard:function(e){return o.put(n.baseURL()+"/v1/scorecard/"+e.score_card_id,e,n.headerConfig())},enableScoreCard:!0,notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t}};return s}]).controller("ScorecardsController",["$uibModal","$scope","$rootScope","$filter","SelectedScorecard","$location","$window","$bootbox","ScoreCardService","pinesNotifications","$q",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";t.currentPage=1,t.pageSize=100,t.CurrentOUId=o.currentOUId,t.scorecardHeader=["Scorecard Name","Created By","Date Created","Modified Date","Group"],t.actionHeader=["Actions"],t.scorecardList=[],t.scorecards=[],t.mutiselectDrpVals=[],t.scorecardWithCriteria=[],t.totalRecords=0,t.groupList=[],t.editButtonStatus=!1,t.scoreName="Scorecards";var u=t.scoreName+"_"+moment().format("YYYY-MM-DD");function p(){t.onGoingRequests.length<2&&(t.isLoadingApi=!0,t.onGoingRequests=[],t.isPendingReq=!0,$(".pageProgressLoader").show(),$("#progressLoader").css("opacity","0"),$(".table>tbody>tr>td").css("border-top","none"),l.getScoreCards(t.currentPage,!1,o.timezone).then(function(e){t.isLoadingApi=!1,void 0!==e.data.json&&(e.data.json.score_card_detail.length>0&&(t.scoreCardsForExport=!0),t.scorecardList=[],t.scorecardWithCriteria=e.data.json.score_card_detail,t.totalRecords=e.data.json.total,angular.forEach(e.data.json.score_card_detail,function(e,o){var a={score_card_id:e.score_card_id,score_card_title:e.score_card_title,created_by:e.created_by,created_on:e.created_on,updated_on:e.updated_on,groups_list:e.groups_list.split(","),group_name:e.groups_list.split(",")[0],outcome_label:e.score_card_outcome_label,importance:e.importance,instruction:e.score_card_instructions,criteria_count:1},i=_.find(t.scorecardList,function(e){return e.score_card_id==a.score_card_id});void 0===i?t.scorecardList.push(a):i.criteria_count+=1})),$(".pageProgressLoader").hide(),$("#progressLoader").css("opacity","1"),$(".table>tbody>tr>td").css("border-top","1px solid #e9ecf0"),t.isPendingReq=!1}))}t.roleId=o.roleId,t.isPendingReq=!0,t.settings={enableSearch:!0,scrollable:!0,scrollableHeight:200,checkBoxes:!0},o.isSafari=n.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),1!==parseInt(t.roleId)&&4!==parseInt(t.roleId)&&(n.location.href="#/access-denied"),t.onGoingRequests=[],t.isLoadingApi=!0,t.intialGrid=function(){p()},t.scoreCardsForExport=!1,o.$on("changeInRecords",function(e,o){t.totalRecords=o}),t.pageChanged=function(e){t.onGoingRequests.push(!0),t.currentPage=e,console.log("page is ",t.currentPage),p()},t.archiveScorecard=function(e){void 0!==e&&l.checkScoreCardStatus(e).then(function(o){var a="";"success"==o.data.result&&(0===parseInt(o.data.json[0].count)&&(a="Are you sure you want to delete this Scorecard?"),o.data.json[0].count>0&&(a="This scorecard is attached with ( "+o.data.json[0].count+" ) calls which might be scored and reviewed. Are you sure you want to archive it?")),s.confirm(a,function(o){o&&l.archiveScorecard(e).then(function(o){if("success"==o.data.result)for(var a=0;a<t.scorecardList.length;a++)t.scorecardList[a].score_card_id==e&&(t.scorecardList.splice(a,1),t.totalRecords=t.totalRecords-1,c.notify({title:"Scorecard",text:"Successfully Archived Scorecard",type:"success"}))})})})},t.groupListInfo=function(o){t.groupDisplay=o,t.allGroupList=_.union(o.groups_list);e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/score-grouplistinfomodel.html",scope:t,backdrop:"static",keyboard:!1,size:"lg",resolve:{}})},t.enableScoreCard=l.enableScoreCard,t.addNewScoreCard=function(a){t.enableScoreCard=!1;var i=[{key:"Pass/Fail",value:"Pass/Fail",radioOption:[]},{key:"scale_0-3",value:"Scale 0-3",radioOption:["0","1","2","3"]},{key:"scale_0-5",value:"Scale 0-5",radioOption:["0","1","2","3","4","5"]},{key:"scale_0-10",value:"Scale 0-10",radioOption:["0","1","2","3","4","5","6","7","8","9","10"]}];o.score_card_id=a,t.scorecards=a>0?t.scorecards:[],t.scorecards.criteriaList=[],t.scorecards.actions="";var r=e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/score-model.html",controllerAs:"ScoreModelController",scope:t,backdrop:"static",keyboard:!1,size:"lg",resolve:{}});a>0&&void 0!==a&&l.getScoreCard(a).then(function(e){if(void 0!==e.data.json){var o=e.data.json;t.scorecards.criteriaList=[],t.scorecards.groups=o.scoreCard.groups,t.scorecards.title=o.scoreCard.score_card_title,t.scorecards.instruction=o.scoreCard.instructions,t.scorecards.importance=o.scoreCard.importance,t.scorecards.outcome=o.scoreCard.outcome_label,angular.forEach(o.scoreCriteriaList,function(e,o){var a={key:e.criteria_type,value:_.find(i,function(t){return t.key==e.criteria_type}).value,radioOption:_.find(i,function(t){return t.key==e.criteria_type}).radioOption};t.scorecards.criteriaList.push({criteria_id:e.criteria_id,title:e.criteria_title,ctype:a,helpText:e.help_text,criteria_importance:e.criteria_importance,acceptCheck:e.is_required})})}}),t.uibModalInstance=r,o.uibModalInstance=r},t.editScoreCard=function(e){""===e&&void 0===e||t.addNewScoreCard(e)},t.close=function(){t.enableScoreCard=!0},t.getHeader=function(){return["Scorecard Name","Date Created","Created By","Modified Date","Group","Number of Criteria","Outcome Label","Importance"]},t.getCSVData=function(e){var a=d.defer(),i=[];t.groupsReportFileName=u+"."+e;if(l.getScoreCards(t.currentPage,!0,o.timezone).then(function(r){if(void 0!==r.data.json){t.scorecardListExport=r.data.json.score_card_detail;for(var n=0;n<t.scorecardListExport.length;n++)i.push({a:t.scorecardListExport[n].score_card_title,b:t.scorecardListExport[n].created_on,c:t.scorecardListExport[n].created_by,d:t.scorecardListExport[n].updated_on,e:t.scorecardListExport[n].groups_list.split(",").length,f:t.scorecardListExport[n].criteria_count,g:t.scorecardListExport[n].score_card_outcome_label,h:t.scorecardListExport[n].importance});if(a.resolve(i),!o.isSafari)return a.promise;a.resolve(JSONToCSVConvertor(i,t.groupsReportFileName,!0,e))}}),!o.isSafari)return a.promise},t.exportPDF=function(){$(".buttons").hide();var e=new jsPDF("p","pt","a4");e.addHTML($("#scoreData"),function(){e.output("datauristring")}),setTimeout(function(){e.save("scorecard.pdf"),$(".buttons").show()},5e3)},o.$on("enableScoreCard",function(e,o){t.enableScoreCard=o})}]).controller("ScoreModelController",["$uibModal","$scope","$rootScope","$filter","SelectedScorecard","$location","$window","$bootbox","ScoreCardService","pinesNotifications",function(e,t,o,a,i,r,n,s,l,c){"use strict";t.currentPage=1,t.export_scorecard_id="",t.scoreCardCreationReq=!1,t.pageSize=100,t.mutiselectDrpVals=[],t.groupList=[],t.scorecards.groups=[],t.arrRequired=[],t.arrInvalid=[],t.specificErrors=[],l.getGroups().then(function(e){void 0!==e.data.json&&(t.groupList=e.data.json,console.log("acces are",t.groupList),angular.forEach(t.groupList,function(e,o){t.mutiselectDrpVals.push({id:e.org_unit_id,label:e.org_unit_name})}))}),t.CurrentOUName=o.currentOUName,t.CurrentOUId=o.currentOUId,t.scorecardHeader=["Scorecard Name","Created By","Date Created","Modified Date","Group"],t.actionHeader=["Actions"],o.isSafari=n.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),t.ctypeOption=[{key:"Pass/Fail",value:"Pass/Fail",radioOption:[]},{key:"scale_0-3",value:"Scale 0-3",radioOption:["0","1","2","3"]},{key:"scale_0-5",value:"Scale 0-5",radioOption:["0","1","2","3","4","5"]},{key:"scale_0-10",value:"Scale 0-10",radioOption:["0","1","2","3","4","5","6","7","8","9","10"]}],t.moreactions=["Export","Import"],t.importanceOption=[1,2,3,4,5,6,7,8,9,10],t.scorecards.importance=t.importanceOption[0],t.scorecards.criteriaList=[],t.criteriaId=1;var d={id:t.criteriaId,title:"",helpText:"",importance:"",criteria_importance:t.importanceOption[0],ctype:t.ctypeOption[0]};t.scorecards.criteriaList.push(d),t.criteriaId=t.criteriaId+1,t.addNewCriteria=function(){if(t.scorecards.criteriaList.length<60){var e={id:t.criteriaId,title:"",display_order:t.scorecards.criteriaList.length-1,helpText:"",criteria_importance:t.importanceOption[0],ctype:t.ctypeOption[0]};t.scorecards.criteriaList.push(e),t.criteriaId=t.criteriaId+1}else c.notify({title:"Criteria",text:"cannot add more than 60",type:"err"})},t.removeCriteria=function(e){t.scorecards.criteriaList.splice(e,1),t.criteriaId=t.criteriaId-1},t.resetSearchFilter=function(){t.input.searchFilter=""},t.resetCriteria=function(){if(0===t.scorecards.criteriaList.length||1===t.scorecards.criteriaList.length){t.scorecards.criteriaList=[];var e={id:1,title:"",helpText:"",criteria_importance:t.importanceOption[0],ctype:t.ctypeOption[0]};t.scorecards.criteriaList.push(e)}},t.validateData=function(e,o,a){var i,r=/^[a-zA-Z0-9_ -\xAE]+$/;if("Scorecard Title"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Instruction"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Outcome Lable"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Criteria Title"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Help Text"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Criteria Type"==o&&!r.test(e))return t.arrInvalid.push(o),"   ";if("Importance"==o){if(t.arrRequired.length){i="field is required.",t.arrRequired.length>1&&(i="fields are required."),t.isRequestSent=!1,l.notify({title:"Scorecard",text:"'"+t.arrRequired.join(", ")+"' "+i,type:"error"});var n=t.arrRequired.indexOf("Importance");return t.arrInvalid=[],t.arrRequired=[],t.specificErrors=[],n>-1?"   ":""}if(t.arrInvalid.length)return i="field is invalid.",t.arrInvalid.length>1&&(i="fields are invalid."),t.arrInvalid.length&&l.notify({title:"Scorecard ",text:"'"+t.arrInvalid.join(", ")+"' "+i,type:"error"}),t.isRequestSent=!1,t.specificErrors.length&&l.notify({title:"Scorecard ",text:"'"+t.specificErrors.join(", ")+"'",type:"error"}),t.arrRequired=[],t.arrInvalid=[],t.specificErrors=[],""}},t.AvailFeild=function(){return 0===t.scorecards.groups.length?(l.notify({title:"Scorecard Details Form",text:" 'Available to' field is required",type:"error"}),!1):""===t.scorecards.title||void 0===t.scorecards.title||null===t.scorecards.title?(l.notify({title:"Scorecard Detail Form",text:" 'Scorecard Title' field is required",type:"error"}),!1):""===t.scorecards.outcome||void 0===t.scorecards.outcome||null===t.scorecards.outcome?(l.notify({title:"Scorecard Detail Form",text:" 'Outcome Label' field is required",type:"error"}),!1):void 0},t.uibModalInstance=o.uibModalInstance,t.saveScoreCard=function(e,a){if(t.scoreCardCreationReq=!0,""===e.title||void 0===e.title||null===e.title)return t.scoreCardCreationReq=!1,!1;if(0===e.groups.length)return t.scoreCardCreationReq=!1,!1;if(""===e.outcome||void 0===e.outcome||null===e.outcome)return t.scoreCardCreationReq=!1,!1;var i=e.groups;e.ou_id=t.currentOUId,e.user_name=o.fullName,_.each(e.criteriaList,function(t){t.created_by=o.userId,t.updated_by=o.userId,t.display_order=_.indexOf(e.criteriaList,t)+1,t.ctype=t.ctype}),e.groups=_.pluck(e.groups,"id");var r={criteriaList:e.criteriaList,score_card_name:e.title,ou_id:t.currentOUId,user_name:o.fullName,groups:e.groups,outcome:e.outcome,instruction:e.instruction,importance:e.importance,created_by:o.userId,updated_by:o.userId};if(0!==o.score_card_id){var n=[];r.score_card_id=o.score_card_id,t.date=new Date,t.date=moment(t.date).tz(o.timezone).format("MM-DD-YYYY h:mm:ss a"),r.score_card_modified=t.date;var d=r.score_card_id;l.getScoreCard(d).then(function(a){t.initialGroups=a.data.json.scoreCard.groups,t.initialGroups=_.pluck(t.initialGroups,"id"),t.Uncheckedflag=!0;var u=_.difference(t.initialGroups,e.groups);l.getAttachedCalls(d).then(function(e){n=e.data.json,!_.isEmpty(u)&&n.length>0?t.Uncheckedflag=!0:t.Uncheckedflag=!1,!0===t.Uncheckedflag?s.confirm("This Scorecard is attached with calls from Groups. Are you sure you want to remove its association with groups?",function(e){e&&(r.org_unit_id=u,r.flag=t.Uncheckedflag,l.updateScoreCard(r).then(function(e){if(t.scoreCardCreationReq=!1,"success"===e.data.result){l.enableScoreCard=!0,o.$emit("enableScoreCard",l.enableScoreCard),c.notify({title:"Update Scorecard",text:"Successfully updated Scorecard",type:"success"});var a=[];angular.forEach(t.groupList,function(e,t){angular.forEach(i,function(t,o){e.org_unit_id==t.id&&a.push(e.org_unit_name)})}),t.uibModalInstance.close(),r.group_name=a[0],r.groups_list=a;var n=_.find(t.scorecardList,{score_card_id:parseInt(o.score_card_id)});t.export_scorecard_id=parseInt(o.score_card_id),void 0!==n&&(n.score_card_title=r.score_card_name,n.updated_on=r.score_card_modified,n.group_name=a[0],n.groups_list=a)}else c.notify({title:"Update Scorecard",text:e.data.err,type:"error"})}))}):l.updateScoreCard(r).then(function(e){if(t.scoreCardCreationReq=!1,"success"===e.data.result){l.enableScoreCard=!0,o.$emit("enableScoreCard",l.enableScoreCard),c.notify({title:"Update Scorecard",text:"Successfully updated Scorecard",type:"success"});var a=[];angular.forEach(t.groupList,function(e,t){angular.forEach(i,function(t,o){e.org_unit_id==t.id&&a.push(e.org_unit_name)})}),t.uibModalInstance.close(),r.group_name=a[0],r.groups_list=a;var n=_.find(t.scorecardList,{score_card_id:parseInt(o.score_card_id)});t.export_scorecard_id=parseInt(o.score_card_id),void 0!==n&&(n.score_card_title=r.score_card_name,n.updated_on=r.score_card_modified,n.group_name=a[0],n.groups_list=a)}else c.notify({title:"Update Scorecard",text:e.data.err,type:"error"})})})})}else l.createScorCard(r).then(function(e){if(t.scoreCardCreationReq=!1,"success"===e.data.result){l.enableScoreCard=!0,o.$emit("changeInRecords",parseInt(t.totalRecords)+1),o.$emit("enableScoreCard",l.enableScoreCard),c.notify({title:"Create Scorecard",text:"Successfully Created Scorecard",type:"success"}),t.uibModalInstance.close(),t.date=new Date,t.date=moment(t.date).tz(o.timezone).format("MM-DD-YYYY h:mm:ss a"),r.score_card_id=e.data.json.score_card_id,t.export_scorecard_id=e.data.json.score_card_id,r.score_card_title=r.score_card_name,r.created_on=t.date,r.updated_on=t.date,r.created_by=o.fullName;var a=[];angular.forEach(t.groupList,function(e,t){-1!=r.groups.indexOf(e.org_unit_id)&&a.push(e.org_unit_name)}),r.group_name=a[0],r.groups_list=a,t.scorecardList.unshift(r)}else c.notify({title:"Create Scorecard",text:e.data.err,type:"error"})})},t.moreActions=function(a){if("Export"===a&&void 0!==o.score_card_id&&o.score_card_id>0&&l.getScoreCard(o.score_card_id).then(function(e){if(void 0!==e.data.json){var o=e.data.json;t.fileName="",t.fileName=o.scoreCard.score_card_title;var a=document.createElement("a");a.download=t.fileName+".json";var i="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(o));a.href="data:"+i,a.click(),t.scorecards.actions="",console.log("at end of the file")}}),"Import"===a){t.scorecards.actions="";var i=e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/import-scorecard.html",scope:t,backdrop:"static",keyboard:!1,size:"lg",resolve:{}});t.importScoreCardModel=i}},t.importScoreCard=function(){var e=document.getElementById("file").files[0],o=new FileReader;void 0===e?c.notify({title:"Import ScoreCard",text:"Import File is not selected",type:"error"}):".json"!=e.name.slice(-5)?c.notify({title:"Import ScoreCard",text:"Please import a .json file",type:"error"}):(o.onloadend=function(o){var a=decodeURIComponent(escape(o.target.result.replace(/[^\x00-\x7F]/g,""))),i=[{key:"Pass/Fail",value:"Pass/Fail",radioOption:[]},{key:"scale_0-3",value:"Scale 0-3",radioOption:["0","1","2","3"]},{key:"scale_0-5",value:"Scale 0-5",radioOption:["0","1","2","3","4","5"]},{key:"scale_0-10",value:"Scale 0-10",radioOption:["0","1","2","3","4","5","6","7","8","9","10"]}],r=JSON.parse(a);t.scorecards.criteriaList=[],t.scorecards.groups=[],_.forEach(t.groupList,function(e){_.forEach(r.scoreCard.groups,function(o){o.id==e.org_unit_id&&t.scorecards.groups.push(o)})}),t.scorecards.title=e.name.slice(0,-5),t.scorecards.instruction=r.scoreCard.instructions,t.scorecards.importance=r.scoreCard.importance,t.scorecards.outcome=r.scoreCard.outcome_label,angular.forEach(r.scoreCriteriaList,function(e,o){if(""===e.criteria_type||void 0===e.criteria_type||null===e.criteria_type)c.notify({title:"Import ScoreCard",text:"Criteria_Type can not be blank",type:"error"}),t.uibModalInstance.close(),console.log("i am here");else{var a={key:e.criteria_type,value:_.find(i,function(t){return t.key==e.criteria_type}).value,radioOption:_.find(i,function(t){return t.key==e.criteria_type}).radioOption};t.scorecards.criteriaList.push({criteria_id:e.criteria_id,title:e.criteria_title,ctype:a,helpText:e.help_text,criteria_importance:e.criteria_importance,acceptCheck:e.is_required})}})},o.readAsBinaryString(e),t.importScoreCardModel.close())}}]),angular.module("theme.select-score-detail",["ui.select2","angularFileUpload","theme.services","angularUtils.directives.dirPagination","api-param","xeditable","ngTagsInput"]).service("cfilter",["$http",function(e){"use strict";var t={};return t.cf=crossfilter([]),e.get("assets/demo/call_flow.json").success(function(e){void 0!==e.json&&(t.data=e.json,t.ndx=t.cf.add(t.data),t.all=t.ndx.groupAll())}).error(function(e){alert("error loading config.json")}),t}]).factory("ScoreDetailsWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getCallsSummaryList:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/retriveScoreCardCalls?"+e+"&count=true",r.headerConfig())},getCallsDetailsList:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/retriveScoreCardCalls?"+e+"&count=false",r.headerConfig())},setCallListened:function(e,t){return o.post(r.baseURL()+"/v1/scoreCard/set-call-listened/callId/"+e,t,r.headerConfig())},createScorCardCallDetail:function(e){return o.post(r.baseURL()+"/v1/scoreCard/attchscorecard/callId/"+e.call_id,e,r.headerConfig())},updateScorCardCallDetail:function(e){return o.post(r.baseURL()+"/v1/scorecard/scorecall/scoreCardCallId/"+e.call_id+"/scoreId/"+e.score_card_id,e,r.headerConfig())},updateScoreStatus:function(e,t){return o.get(r.baseURL()+"/v1/scorecarddetail/updateScoreStatus/callScorecardId/"+e+"/callScoreStatus/"+t,r.headerConfig())},getGroups:function(){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scorecard/getGroups",r.headerConfig())},getIdentifiedUsers:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/getIdentifyUsers/"+e,r.headerConfig())},checkIfUserValid:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/checkifuservalid/userid/"+e+"/callgroup/"+t,r.headerConfig())},getCallAudioFile:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scorecarddetail/getCallAudioFile/callID/"+e,r.headerConfig())},getCallsTags:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scorecarddetail/getCallsTags/callID/"+e,r.headerConfig())},getActiveScoreCards:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/retriveActiveScoreCards/"+e,r.headerConfig())},getScoreCard:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCard/scoreId/"+e+"?call_id="+t,r.headerConfig())},getCallScores:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCard/scoreCardDetail/scoreCardCallId/"+t+"/scoreId/"+e,r.headerConfig())},getTags:function(){o.defaults.useXDomain=!0;var e=r.baseURL()+"/v1/tag/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.campaign;return o.get(e,r.headerConfig())},addTagByCallId:function(e,t){return o.defaults.useXDomain=!0,o.post(r.baseURL()+"/v1/scorecarddetail/addTagByCallId/callID/"+e,t,r.headerConfig())},deleteTagByCallId:function(e,t){return o.defaults.useXDomain=!0,o.delete(r.baseURL()+"/v1/scorecarddetail/deleteTagByCallId/callID/"+e+"/tagId/"+t,r.headerConfig())},createTag:function(e){return o.post(r.baseURL()+"/v1/tag",e,r.headerConfig())},deleteTag:function(e){return o.put(r.baseURL()+"/v1/tag/delete",e,r.headerConfig())},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},addComment:function(e,t){return o.post(r.baseURL()+"/v1/scoreCardCall/saveComment/callID/"+e,t,r.headerConfig())},addAndRemoveCriteria:function(e,t){return o.post(r.baseURL()+"/v1/scoreCardCall/saveCallCriteria/callID/"+e,t,r.headerConfig())},addCommentRespons:function(e,t){return o.post(r.baseURL()+"/v1/scorecarddetail/addCommentRespons/commentID/"+e,t,r.headerConfig())},getCommentResponses:function(e){return o.get(r.baseURL()+"/v1/scorecarddetail/getCommentResponses/commentID/"+e,r.headerConfig())},getAllComments:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scorecarddetail/getAllComments/callID/"+e,r.headerConfig())},deleteComment:function(e){return o.delete(r.baseURL()+"/v1/scorecarddetail/deleteComment/commentID/"+e,r.headerConfig())},deleteCommentResponse:function(e){return o.delete(r.baseURL()+"/v1/scorecarddetail/deleteCommentResponse/responseID/"+e,r.headerConfig())},getRetriveActiveScoreCards:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoreCardCall/AdvancedActiveScoreCards/"+e,r.headerConfig())},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},getCallsDetailsInfo:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/call/Info/"+t+"/?user_id="+e,r.headerConfig())},getCallsComments:function(e,t){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/call/Comment/"+t+"/?user_id="+e+"&timezone="+encodeURIComponent(i.timezone),r.headerConfig())},setCallsComments:function(e,t){var a={method:"POST",url:r.baseURL()+"/v1/call/Comment/?user_id="+t,headers:r.headerConfig().headers,data:e};return o(a)},deleteCallsComments:function(e,t){return o.delete(r.baseURL()+"/v1/call/Comment/"+e+"/?user_id="+t,r.headerConfig())},fetchCallsTags:function(e,t){return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/call/Tag/"+t+"/?user_id="+e,this.getJsonConfig())},fetchTags:function(e,t){return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/tag/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.tag,this.getJsonConfig())},setCallsTags:function(e,t){var r={method:"POST",url:i.url+":"+i.port+"/v1/call/Tag/?user_id="+t,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(r)}};return n}]).factory("ScoreNotificationsWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getNotifcationsList:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoremanualaction/user/"+e,r.headerConfig())},getNotifications:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/scoremanualaction"+e,r.headerConfig())},createScoreNotification:function(e){return o.post(r.baseURL()+"/v1/scoremanualaction",e,r.headerConfig())},createScoreNotifications:function(e,t){return o.post(r.baseURL()+"/v1/scoremanualaction/"+e,t,r.headerConfig())},updateScoreNotifications:function(e){return o.put(r.baseURL()+"/v1/scoremanualaction",e,r.headerConfig())},deleteScoreNotification:function(e){return o.delete(r.baseURL()+"/v1/scoremanualaction/"+e,r.headerConfig())}};return n}]).directive("dynamicUrl",function(){return{restrict:"A",link:function(e,t,o){t.attr("src",o.ngId),e.increaseAudioInitializationCount()}}}).controller("SelectScoreController",["$scope","$http","$window","$rootScope","$routeParams","$filter","$sce","ScoreDetailsWebService","pinesNotifications","$timeout","$compile","$q","$bootbox","$uibModal","$location","advFilSrvc",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f){e.audioInitializationCount=0,e.simpleSearchFilter="",e.filterApplied=!1,e.horsemanFlag=!1,e.isReadonlyScore=!1,e.checkIfscorecardChange="",e.checkIfAssignChange="",e.previouscheckIfscorecardChange="",e.previouscheckIfAssignChange="",e.editButtonStatus=!1,e.attachedScoreCardChange=!1,e.roleId=a.roleId,e.currentPage=1,e.pageSize=100,e.showme=[],e.radioOption=[],e.previousDataEditable={},e.scoreName="SelectandScore_Calls";var h=e.scoreName+"_"+moment().format("YYYY-MM-DD");e.passFail=["Pass","Fail"],e.isScoreEditInProgress=!1,e.actionHeader=["Actions"],e.scoreDetailHeader=["Group Name","Agent","Call Title","Duration","Call Date/Time","Scorecard","Score Date","Score","Status"],e.pagination={current:i.page?i.page:1};a.isSafari=o.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.preview=!!g.search().preview&&g.search().preview,e.isFromReportEngine=!!g.search().isFromReportEngine&&g.search().isFromReportEngine,e.date=new Date,e.date=moment.utc(e.date).format("MM-DD-YYYY h:mm:ss a"),e.criteriaInProgress=!1;var v=0;e.isScoreCardUpdate=!1,e.isLoadingApi=!0,e.config={autoHide:!1,autoPlay:!1,sources:"",preload:"auto",controls:!1,theme:{url:"assets/css/videogular.css"}},e.scoreDetailsColumnMapping=[{label:"Play Call",key:"",visible:!0,sorting:!1},{label:"Status",key:"",visible:!0,sorting:!1},{label:"Date/Time",key:"call_date_time",visible:!0,sorting:!0},{label:"Duration",key:"duration",visible:!0,sorting:!0},{label:"Group",key:"group_name",visible:!0,sorting:!0},{label:"Identified Agent",key:"username",visible:!0,sorting:!0},{label:"Call Title",key:"call_title",visible:!0,sorting:!0},{label:"Scorecard",key:"scorecard",visible:!0,sorting:!0},{label:"Score Date",key:"score_date",visible:!0,sorting:!0},{label:"Score",key:"score",visible:!0,sorting:!0},{label:"Actions",key:"",visible:!0,sorting:!1}],"3"===e.roleId||"8"===e.roleId?e.isReadonlyScore=!0:(2!==parseInt(e.roleId)||"false"!==a.score_call&&!1!==a.score_call)&&(1!==parseInt(e.roleId)||"false"!==a.score_call&&!1!==a.score_call)||(e.isReadonlyScore=!0),e.callDetailsColumnToggle=function(e){},g.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>'),e.sortOrder=!1,e.getDataforSorting=function(){e.sortedPagination=!0,1!=e.pagination.current&&(e.pagination.current=1,e.urlParams.offset=0),e.loadReportBasedOnQueryString()},e.notificationsPopUp=function(){a.uibModalInstance=m.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/score-notifications.html",controllerAs:"ScoreNotificationsController",scope:e,backdrop:"static",keyboard:!1,size:"lg",resolve:{}})},e.drp_options={ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"This Month":[moment().startOf("month").startOf("day"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month").startOf("day"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days").startOf("day"),endDate:moment().subtract(1,"days").endOf("day")},e.userAccess.campaign>=6&&(e.canModify=!0),e.OU_Name=a.currentOUName,e.OUtags=[];e.selected=0,e.selTags=[],e.ALLOUtags=[],e.NonOUtags=[],e.isClicked=!1,e.agents=[],e.scorecardData=[],e.scorecards=[],e.groupScoreCards=[],e.indentifiedUsers=[],e.comments=[],e.comment=[],e.isRespons=!1,e.isComment=!0,e.isAddTagProcesssing=!1,e.isPendingReq=!0,s.getRetriveActiveScoreCards(a.currentOUId).then(function(t){e.isLoadingApi=!1,t.data.json.length>0&&(e.advFilterScorecards=t.data.json)}),e.ischecked=function(t,o){if(o.selected)e.selected++,e.selTags.push(o.id);else{var a=e.selTags.indexOf(o.id);a>-1&&(e.selTags.splice(a,1),e.selected--)}},e.deleteSelectedTag=function(e){p.confirm("Are you sure you want to remove this Tag?",function(t){t&&s.deleteTagByCallId(v,e).then(function(e){"error"!==e.data.result&&w(v)})})},e.deleteSelectedTags=function(){var t="Are you sure you want to delete this Tag?";e.selTags.length>1&&(t="Are you sure you want to delete these Tags?"),e.selected>0&&p.confirm(t,function(t){t&&(e.deltag={tag:{id:e.selTags}},s.deleteTag(e.deltag).then(function(t){if("error"!==t.data.result){e.deltag.tag.id.forEach(function(t){for(var o=0;o<e.OUtags.length;o++)e.OUtags[o].id===t&&(e.OUtags.splice(o,1),e.selected--)});var o="Tag deleted successfully";e.selTags.length>1&&(o="Tags deleted successfully"),l.notify({title:"Tag",text:o,type:"success"}),e.deltag=[],e.selTags=[]}else l.notify({title:"Tag",text:"Error in deleting Tag"+t.data.err,type:"error"})}))})},e.clearSelectedTags=function(){for(var t=0;t<e.OUtags.length;t++)e.OUtags[t].selected&&(e.OUtags[t].selected=!1,e.selected--);e.selTags=[]},e.addTag=function(t){e.disableAddTagButton=!0,e.isClicked=!0;var o={tag:{tag_name:e.noResultsTag,org_unit_id:a.currentOUId}};s.createTag(o).then(function(t){if(e.isClicked=!1,""===t.data.err)return e.tags.push({tag_id:t.data.json.tag_id,tag_name:e.noResultsTag,org_unit_id:a.currentOUId,editable:!1}),l.notify({title:"Create Tag",text:"Successfully created tag",type:"success"}),$(".select2-drop").hide(),void(e.disableAddTagButton=!1);e.disableAddTagButton=!1,l.notify({title:"Create tag",text:t.data.err,type:"error"})})},e.addTagByCallId=function(t){if(""==t||null==t||void 0==t)e.isAddTagProcesssing=!1,l.notify({title:"Select and Score Calls",text:"Please select tag before you add",type:"error"});else{e.isAddTagProcesssing=!0;var i=JSON.parse(t);if(void 0==_.findWhere(e.OUtags,{id:parseInt(i.tag_id)})){a.userId=o.sessionStorage.userId;var r={userId:a.userId,tag_id:i.tag_id,tag_name:i.tag_name};r.callID=v,s.addTagByCallId(v,r).then(function(t){"error"!=t.data.status&&(e.tagText="",e.isAddTagProcesssing=!1,w(v))})}else e.isAddTagProcesssing=!1,l.notify({title:"Select and Score Calls",text:"This tag is already present.",type:"error"})}},o.sessionStorage.report_start_date?e.drp_start=moment(o.sessionStorage.report_start_date).format("MMMM D, YYYY"):e.drp_start=e.drp_options.ranges["Last 7 Days"][0].format("MMMM D, YYYY"),o.sessionStorage.report_end_date?e.drp_end=moment(o.sessionStorage.report_end_date).format("MMMM D, YYYY"):e.drp_end=e.drp_options.ranges["Last 7 Days"][1].format("MMMM D, YYYY"),e.drp_options.startDate=moment(e.drp_start),e.drp_options.endDate=moment(e.drp_end),e.audioAccessPermission=!0,e.scoringPermission=!0,e.loadReportBasedOnQueryString=function(){var t=angular.copy(e.urlParams);e.isPendingReq=!0,e.userIdCheck=a.userId,$(".pageProgressLoader").show(),$("#progressLoader").css("opacity","0"),$(".table>tbody>tr>td").css("border-top","none"),s.getCallsSummaryList($.param(t)).then(function(t){var o=t.data.json.access_audio,a=t.data.json.score_call;if(!1===o&&(e.audioAccessPermission=!1),!1===a&&(e.scoringPermission=!1),e.summaryitems=t.data.json.total.total_count_calls,void 0===t.data.json)return!1;if(t.data.json.call.length>0){setTimeout(function(){$("#cdr_table").floatingScroll("update")},100);var i=t.data.json.call;e.agents=t.data.json.agent,e.scorecardData=t.data.json.score_card,console.log("$scope.scorecardData",e.scorecardData);d3.time.format("%Y-%m-%dT%H:%M:%S.%LZ");_.each(i,function(e){e.call_date_time=moment(e.call_date_time).format("MM-DD-YYYY h:mm:ss a"),e.score_date=e.score_date?moment(e.score_date).format("MM-DD-YYYY h:mm:ss a"):"Not scored",e.reviwed_date_time=e.reviwed_date_time?moment(e.reviwed_date_time).format("MM-DD-YYYY h:mm:ss a"):"Not scored",e.singlerec=1,e.call_title=e.call_title,e.agents="",e.isScoreCardSelected=!1,e.isScoreNowSelected=!1,e.scoreShow=!1,e.selectedScorecard="",e.noRecording=!1,e.audioShow=!1,e.listenLabel="Listen to call",null!==e.play_call&&""!==e.play_call&&"REFERRAL"!=e.disposition||(e.noRecording=!0,e.listenLabel="No recording for this call"),e.call_score_status=null===e.call_score_status?"Need Scorecard":e.call_score_status,null!==e.ct_user_id&&""!==e.ct_user_id&&void 0!==e.ct_user_id&&(e.identifyAgent={ct_user_id:e.ct_user_id,username:e.agent,ct_user_ou_id:e.userOuId}),null!==e.score_card_id&&""!==e.score_card_id&&void 0!==e.score_card_id&&(e.selectedScorecard={score_card_id:parseInt(e.score_card_id),score_card_title:e.scorecard},e.isScoreCardSelected=null!==e.selectedScorecard||void 0!==e.selectedScorecard)}),e.indentifiedUsers&&(e.indentifiedUsers.shift(),e.indentifiedUsers=_.sortBy(e.indentifiedUsers,"username"),e.indentifiedUsers.unshift({username:"Unassign",ct_user_id:"unassigned",ct_user_ou_id:"unassigned"})),e.items=i,e.xf1=crossfilter(i),e.dc1=dc;for(var r=0;r<i.length;r++)e.showme[r]=!1}else e.items=[];e.hideDataTable=!1,$(".pageProgressLoader").hide(),$("#progressLoader").css("opacity","1"),$(".table>tbody>tr>td").css("border-top","1px solid #e9ecf0"),e.isPendingReq=!1,setTimeout(function(){e.horsemanFlag=!0},1e3),!0===e.showAdvFilter&&e.advFilterDefinitions.length>0?(e.advFilterDefinitions[0].user_input||0===e.advFilterDefinitions[0].user_input)&&(e.filterApplied=!0):e.simpleSearchFilter.length>0&&(e.filterApplied=!0)})},e.scoreIncludes=[],e.includeScore=function(t,o){o?e.scoreIncludes.push(t):e.scoreIncludes.splice(_.lastIndexOf(e.scoreIncludes,t),1),e.urlParams.status=e.scoreIncludes,e.loadReportBasedOnQueryString(),e.isScoreEditInProgress=!1},e.getAgent=function(t){e.callAgent=[],angular.forEach(e.agents,function(o,a){_.each(o.groups_list,function(a){parseInt(a)===parseInt(t)&&e.callAgent.push(o)})}),e.callAgent.length<1&&l.notify({title:"Select and Score Calls",text:"No assign user for this call.",type:"error"})},e.loadAudio=function(t){_.map(e.items,function(e){e.call_id!=t&&(e.audioShow=!1,e.scoreShow=!1)}),s.getCallAudioFile(t).then(function(t){if(void 0!==t.data.json){var o=t.data.json.s3URL;t.data.json.noRecording=!1,t.data.json.listenLabel="Listen to call",null!==t.data.json.recording_file&&""!==t.data.json.recording_file&&"REFERRAL"!=t.data.json.disposition||(t.data.json.noRecording=!0,t.data.json.listenLabel="No recording for this call"),e.trustSrc=function(e){return n.trustAsResourceUrl(e)},e.s3URL={src:o},$(".playerProgressLoader").hide(),$("#progressLoader").css("opacity","1")}var a;a=e.s3URL.src,e.media=[{sources:[{src:a,type:"audio/mp3"}]}],e.config={autoHide:!1,autoPlay:!1,sources:e.media[0].sources,preload:"auto",controls:!1,theme:{url:"assets/css/videogular.css"}}})},e.checkIfEdit=function(t,o){e.call_title=o.call_title,e.score_card_id=o.score_card_id,e.user_id=o.user_id,e.previousDataEditable.call_title=o.call_title,e.previousDataEditable.score_card_id=o.score_card_id,e.previousDataEditable.identifyAgent=o.identifyAgent,e.previousDataEditable.selectedScorecard=o.selectedScorecard,e.previousDataEditable.isScoreCardSelected=o.isScoreCardSelected,e.editButtonStatus=!0,void 0!==o.identifyAgent&&null!==o.identifyAgent?e.identifyAgent=o.identifyAgent.ct_user_id:e.identifyAgent=void 0,e.isScoreEditInProgress?p.confirm("It seems as if you have made changes but didn't click Save. Are you sure you want to proceed?",function(a){a?($(".score-cancel").trigger("click"),e.loadScoreCard(o),t.$show()):(t.$show(),e.editButtonStatus=!0)}):(e.loadScoreCard(o),t.$show())},e.checkResponses=function(e){return parseInt(e)>0},e.scoreCardInprogress=function(){e.isScoreCardUpdate=!0},e.scoreNow=function(t,o,a){e.isComment=!0,$("#cdr_table").floatingScroll("update"),e.showScoredData(t,o,a)},e.showScoredData=function(t,o,a){e.selTag=[],e.comments=[],e.displayOrder=null,e.scorecard;var i=!1;$("#cdr_table").floatingScroll("update"),_.map(e.items,function(e){e.call_id!=o?(e.scoreShow=!1,e.audioShow=!1):(i=!e.scoreShow,e.audioShow=!e.scoreShow,e.scoreShow=!e.scoreShow)}),i&&($(".criteriaProgressLoader").show(),$(".playerProgressLoader").show(),e.isUpdateScore=!0,$("#progressLoader").css("opacity","0"),v=o,s.getCallAudioFile(o).then(function(i){if(void 0!==i.data.json){y(o),b(),w(o);var r=i.data.json.s3URL;e.totalTime=i.data.json.duration,i.data.json.noRecording=!1,i.data.json.listenLabel="Listen to call",null!==i.data.json.recording_file&&""!==i.data.json.recording_file&&"REFERRAL"!=i.data.json.disposition||(i.data.json.noRecording=!0,i.data.json.listenLabel="No recording for this call"),e.trustSrc=function(e){return n.trustAsResourceUrl(e)},e.s3URL={src:r},e.API.stop(),e.config.sources=e.s3URL.src,a||s.getScoreCard(t,o).then(function(t){if(void 0!==t.data.json){var a=t.data.json;e.scorecards.criteriaList=[],e.scorecards.title=a.scoreCard.score_card_title,e.scorecards.instruction=a.scoreCard.instructions,e.scorecards.importance=a.scoreCard.importance,e.scorecards.appt_booked=null,e.scorecards.outcome=a.scoreCard.outcome_label,angular.forEach(a.scoreCriteriaList,function(t,a){if("scale_0-3"===t.criteria_type?e.radioOption=["0","1","2","3","N/A"]:"scale_0-5"===t.criteria_type?e.radioOption=["0","1","2","3","4","5","N/A"]:e.radioOption=["0","1","2","3","4","5","6","7","8","9","10","N/A"],null!==t.tagged_scorecard_criteria_id){var i=t.tagged_scorecard_criteria_id+"_"+o;e.placeIcon(parseFloat(t.criteria_timestamp),i,"criteria","icon-marker-active.png",t.criteria_title)}e.scorecards.criteriaList.push({criteria_id:t.criteria_id,title:t.criteria_title,ctype:t.criteria_type,radioOption:e.radioOption,helpText:t.help_text,criteria_importance:t.criteria_importance.toString(),selectedCheckPass:t.selectedCheckPass,is_required:t.is_required,tagged_scorecard_criteria_id:t.tagged_scorecard_criteria_id,display_order:t.display_order})})}$(".criteriaProgressLoader").hide(),e.isUpdateScore=!1,$("#progressLoader").css("opacity","1")}),a&&s.getCallScores(t,o).then(function(t){if(void 0!==t.data.json){var a=t.data.json;0==a.scoreCriteriaList.length&&($(".criteriaProgressLoader").hide(),$("#progressLoader").css("opacity","1")),e.scorecards.criteriaList=[],e.scorecards.title=a.scoreCard.score_card_title,e.scorecards.instruction=a.scoreCard.instructions,e.scorecards.importance=a.scoreCard.importance,e.displayOrder=a.scoreCriteriaList.display_order,e.scorecards.outcome=a.scoreCard.outcome_label,a.scoreCard.outcome_answer&&1==a.scoreCard.outcome_answer?e.scorecards.appt_booked="Yes":e.scorecards.appt_booked="No",angular.forEach(a.scoreCriteriaList,function(t,a){if("scale_0-3"===t.criteria_type?(e.radioOption=["0","1","2","3","N/A"],t.selectedRadio=t.score_value):"scale_0-5"===t.criteria_type?(e.radioOption=["0","1","2","3","4","5","N/A"],t.selectedRadio=t.score_value):"scale_0-10"===t.criteria_type?(e.radioOption=["0","1","2","3","4","5","6","7","8","9","10","N/A"],t.selectedRadio=t.score_value):"true"===t.score_value?t.selectedCheckPass=!0:"false"===t.score_value?t.selectedCheckFail=!0:"N/A"===t.score_value&&(t.selectedCheckNa=!0),null!==t.tagged_scorecard_criteria_id){var i=t.tagged_scorecard_criteria_id+"_"+o;e.placeIcon(parseFloat(t.criteria_timestamp),i,"criteria","icon-marker-active.png",t.criteria_title)}e.scorecards.criteriaList.push({criteria_id:t.criteria_id,title:t.criteria_title,ctype:t.criteria_type,radioOption:e.radioOption,helpText:t.help_text,criteria_importance:t.criteria_importance.toString(),selectedCheckPass:t.selectedCheckPass,selectedCheckFail:t.selectedCheckFail,selectedCheckNa:t.selectedCheckNa,is_required:t.is_required,selectedRadio:t.selectedRadio,tagged_scorecard_criteria_id:t.tagged_scorecard_criteria_id,display_order:t.display_order})})}$(".criteriaProgressLoader").hide(),e.isUpdateScore=!1,$("#progressLoader").css("opacity","1")})}}))};var b=function(){$(".tagProgressLoader").show(),$("#progressLoader").css("opacity","0"),s.getTags().then(function(t){"error"!=t.data.status&&(e.tags=t.data.json)})},w=function(t){$(".tagProgressLoader").show(),$("#progressLoader").css("opacity","0"),e.OUtags=[],s.getCallsTags(t).then(function(t){if(void 0!==t.data.json){var o=t.data.json.tags;_.each(o,function(t){e.OUtags.push({id:t.tag_id,name:t.tag_name,OU:t.org_unit_id,selected:!0})})}$(".tagProgressLoader").hide(),$("#progressLoader").css("opacity","1")})};e.callTagOptionTemplate=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-href="#" ng-click="postcalltag($index, item.call_id, false);">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1,r=_.uniq(t,function(e){return e.text.trim()});if(a.term=a.term.trim(),a.term.length>0){for(var n in r)if(a.term.trim().toLowerCase()==r[n].text.trim().toLowerCase()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="postcalltag($index, item.call_id, false);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return r},simple_tags:!0,allowClear:!0}},e.tagoptiontemplate=function(){return{formatNoMatches:function(t){var o="";return""!==t?(o='<a ng-class="{disablePointer: disableAddTagButton}"  ng-click="addTag(term);">Add tag:"'+t.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=t})):o="",o},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.trim()==t[r].text.trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-class="{disablePointer: disableAddTagButton}" ng-href="#" ng-click="addTag(query.term);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return t},simple_tags:!0,allowClear:!0}},e.$watch("noResultsTag",function(t,o){t&&t!==o&&c(function(){var t=$(".select2-no-results");d(t.contents())(e)})},!0),e.showAgent=function(t){if(null!==t.ct_user_id||""!==t.ct_user_id||void 0!==t.ct_user_id){var o=_.find(e.indentifiedUsers,{ct_user_id:parseInt(t.ct_user_id)});return void 0!==o?o.username:"Not set"}},e.showScorecard=function(t){if(null!==t.score_card_id||""!==t.score_card_id||void 0!==t.score_card_id){var o=_.find(e.scorecards,{score_card_id:parseInt(t.score_card_id)});return void 0!==o?o.score_card_title:"Need Scorecard"}},e.removeComment=function(t){p.confirm("Are you sure you want to delete this Comment?",function(o){o&&s.deleteComment(t).then(function(t){y(v),"error"!=t.data.status&&l.notify({title:"Select and Score Calls",text:"Comment deleted successfully",type:"success"}),e.showCommentBox()})})},e.removeResponse=function(t,o){p.confirm("Are you sure you want to delete this Comment Response?",function(a){a&&s.deleteCommentResponse(t).then(function(t){"error"!=t.data.status&&(l.notify({title:"Select and Score Calls",text:"Response deleted successfully",type:"success"}),y(v),S(o)),e.showCommentBox()})})};var y=function(t){$(".commentProgressLoader").show(),$("#progressLoader").css("opacity","0"),e.isResponseBox=!1,s.getAllComments(t).then(function(t){e.commentDetails=t.data.json,$(".comment").remove(),_.each(e.commentDetails,function(t){var o=Number(t.comment_timestamp),a=(Math.floor(o/3600),Math.floor(o%3600/60)),i=Math.floor(o%3600%60);t.comment_displayDuration=("0"+a).slice(-2)+":"+("0"+i).slice(-2),t.is_from_report&&"recording"==t.source?t.comment_displayDuration="From Recording (00:00)":t.is_from_report||"API"!=t.source?t.comment_displayDuration="From Scorecard ("+t.comment_displayDuration+")":t.comment_displayDuration="From API (00:00)",t.is_from_report||e.placeIcon(t.comment_timestamp,t.comment_id,"comment","icon-post.png","")})}),$(".commentProgressLoader").hide(),$("#progressLoader").css("opacity","1")},S=function(t){s.getCommentResponses(t).then(function(t){"success"!=t.data.status||(e.responsDetails=t.data.json)})};e.makeInprogressFalse=function(){e.isScoreEditInProgress=!1},e.cancelScorecardAndAgentChange=function(){e.checkIfscorecardChange=e.previouscheckIfscorecardChange,e.checkIfAssignChange=e.previouscheckIfAssignChange},e.loadScoreCard=function(t){e.isScoreEditInProgress=!0,s.getActiveScoreCards(t.group_id).then(function(t){t.data.json.length>0&&(e.groupScoreCards=t.data.json)}),s.getIdentifiedUsers(t.call_id).then(function(t){console.log("result",t),t.data.json.length>0&&(e.indentifiedUsers=t.data.json)})},e.saveScoreCallDetail=function(t,o){o.isScoreCardChange=e.checkIfscorecardChange,o.isScoreCardAgentChange=e.checkIfAssignChange,void 0===e.previousDataEditable.identifyAgent&&t.identifyAgent&&"unassigned"!==t.identifyAgent.ct_user_id?s.checkIfUserValid(t.identifyAgent.ct_user_id,o.group_id).then(function(a){a.data.json.length>0?e.saveScoreCallDetailFinally(t,o):p.confirm("The agent you are identifying on the call is not a part of the group the call belongs to. Are you sure you want to proceed?",function(a){a?e.saveScoreCallDetailFinally(t,o):(o.call_title=e.previousDataEditable.call_title,o.score_card_id=e.previousDataEditable.score_card_id,o.identifyAgent=e.previousDataEditable.identifyAgent,o.selectedScorecard=e.previousDataEditable.selectedScorecard,o.isScoreCardSelected=e.previousDataEditable.isScoreCardSelected,void 0!==o.identifyAgent&&null!==o.identifyAgent?e.identifyAgent=o.identifyAgent.ct_user_id:e.identifyAgent=void 0,e.isScoreEditInProgress=!1)})}):t.identifyAgent&&"unassigned"!==t.identifyAgent.ct_user_id&&e.previousDataEditable.identifyAgent&&t.identifyAgent.ct_user_id!==e.previousDataEditable.identifyAgent.ct_user_id?s.checkIfUserValid(t.identifyAgent.ct_user_id,o.group_id).then(function(a){a.data.json.length>0?e.saveScoreCallDetailFinally(t,o):p.confirm("The agent you are identifying on the call is not a part of the group the call belongs to. Are you sure you want to proceed?",function(a){a?e.saveScoreCallDetailFinally(t,o):(o.call_title=e.previousDataEditable.call_title,o.score_card_id=e.previousDataEditable.score_card_id,o.identifyAgent=e.previousDataEditable.identifyAgent,o.selectedScorecard=e.previousDataEditable.selectedScorecard,o.isScoreCardSelected=e.previousDataEditable.isScoreCardSelected,void 0!==o.identifyAgent&&null!==o.identifyAgent?e.identifyAgent=o.identifyAgent.ct_user_id:e.identifyAgent=void 0,e.isScoreEditInProgress=!1)})}):e.saveScoreCallDetailFinally(t,o)},e.checkScorecardChange=function(t,o){null==o.ct_user_id&&void 0==o.ct_user_id||(e.checkIfAssignChange=o.ct_user_id,e.previouscheckIfAssignChange=t.ct_user_id),null==o.score_card_id&&void 0==o.score_card_id||(e.checkIfscorecardChange=o.score_card_id,e.previouscheckIfscorecardChange=t.score_card_id)},e.saveScoreCallDetailFinally=function(t,o){o.score=0,o.call_scored_by="",o.score_card_id=void 0!==t&&void 0!==t.selectedScorecard?t.selectedScorecard.score_card_id:o.score_card_id,o.user_id=void 0!==t&&void 0!==t.identifyAgent?t.identifyAgent.ct_user_id:o.user_id,o.call_title=void 0!==t?t.call_title:o.call_title,e.isScoreEditInProgress=!1,void 0===o.user_id&&(o.user_id=null),s.createScorCardCallDetail(o).then(function(a){if("success"===a.data.result){e.checkIfscorecardChange="",e.checkIfAssignChange="",o.call_score_card_id=a.data.json.call_score_card_id,e.previouscheckIfscorecardChange="",e.previouscheckIfAssignChange="",o.score_card_id&&(o.status=a.data.json.length>0&&void 0!=a.data.json.length?a.data.json[0].status:"unscored",o.score=a.data.json.length>0&&void 0!=a.data.json.length?a.data.json[0].score:"0",o.score_card_id="unassigned"===o.score_card_id||a.data.json.length<=0||void 0==a.data.json.length?null:o.score_card_id,o.scorecard=t.selectedScorecard&&"Unassign"===t.selectedScorecard.score_card_title||a.data.json.length<=0||void 0==a.data.json.length?null:t.selectedScorecard.score_card_title,null===o.score_card_id&&(o.status=a.data.json.length>0&&void 0!=a.data.json.length?a.data.json[0].status:"needs_scorecard",o.selectedScorecard=void 0,o.score_date="Not scored")),o.user_id&&(o.ct_user_id="unassigned"===o.user_id?null:o.user_id,o.agent=void 0==t.identifyAgent||"Unassign"===t.identifyAgent.username?null:t.identifyAgent.username,"unassigned"===o.user_id&&(o.identifyAgent=void 0));var i="Call record updated successfully.";void 0!=e.score_card_id&&null!=e.score_card_id||void 0!=e.call_title&&null!=e.call_title&&""!=e.call_title||void 0!=e.identifyAgent?void 0===e.score_card_id||null===e.score_card_id||void 0!=e.call_title&&null!=e.call_title&&""!=e.call_title||void 0===e.identifyAgent?void 0!==e.score_card_id&&null!==e.score_card_id&&void 0!=e.call_title&&null!=e.call_title&&""!=e.call_title&&void 0==e.identifyAgent?(console.log("for SC & CT is there"),null!=o.score_card_id&&void 0!=o.score_card_id&&o.score_card_id==e.score_card_id&&null!==o.call_title&&""!=o.call_title&&o.call_title==e.call_title&&null!==o.user_id&&void 0!==o.user_id&&"unassigned"!==o.user_id&&(i="Identified Agent is added successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title is removed successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is removed successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id===e.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is updated successfully.",o.scoreShow&&(o.scoreShow=!1,o.audioShow=!1)),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null===o.call_title||""==o.call_title||o.call_title===e.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title is updated successfully.")):void 0!=e.score_card_id&&null!=e.score_card_id||void 0==e.call_title||null==e.call_title||""==e.call_title||void 0===e.identifyAgent?void 0!=e.score_card_id&&null!=e.score_card_id||void 0!=e.call_title&&null!=e.call_title&&""!=e.call_title||void 0===e.identifyAgent?void 0===e.score_card_id||null===e.score_card_id||void 0!=e.call_title&&null!=e.call_title&&""!=e.call_title||void 0!=e.identifyAgent?void 0!=e.score_card_id&&null!=e.score_card_id||void 0===e.call_title||null===e.call_title||""===e.call_title||void 0!=e.identifyAgent?void 0!==e.score_card_id&&null!==e.score_card_id&&void 0!==e.call_title&&null!==e.call_title&&""!==e.call_title&&void 0!==e.identifyAgent&&(console.log("For updated"),o.score_card_id!=e.score_card_id&&null!=o.score_card_id&&o.call_title==e.call_title&&o.user_id==e.identifyAgent&&(i="Scorecard is updated successfully.",o.scoreShow&&(o.scoreShow=!1,o.audioShow=!1)),o.score_card_id==e.score_card_id&&""!=o.call_title&&o.call_title!=e.call_title&&void 0!=o.call_title&&o.user_id==e.identifyAgent&&(i="Call Title is updated successfully."),o.score_card_id==e.score_card_id&&o.call_title==e.call_title&&o.user_id!=e.identifyAgent&&"unassigned"!=o.user_id&&(i="Identified Agent is updated successfully."),null!=o.score_card_id&&void 0!=o.score_card_id&&o.score_card_id==e.score_card_id&&""!=o.call_title&&o.call_title==e.call_title&&void 0!=o.call_title&&"unassigned"==o.user_id&&(i="Identified Agent is removed successfully."),null==o.score_card_id&&""!=o.call_title&&o.call_title==e.call_title&&void 0!=o.call_title&&o.user_id==e.identifyAgent&&"unassigned"!=o.user_id&&(i="Scorecard is removed successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||void 0!=o.call_title&&""!=o.call_title||o.user_id!=e.identifyAgent||"unassigned"==o.user_id||(i="Call Title is removed successfully.")):(console.log("for CT  is there "),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||(i="Identified Agent is added successfully."),null==o.score_card_id||void 0==o.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title===e.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title is updated successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title is removed successfully.")):(console.log("for SC  is there "),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||(i="Identified Agent is added successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null===o.call_title||""==o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title is added successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id===e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is updated successfully.",o.scoreShow&&(o.scoreShow=!1,o.audioShow=!1)),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is removed successfully.")):(console.log("only for  agent is there "),null==o.score_card_id||void 0==o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||(i="Scorecard is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null==o.call_title||""==o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||(i="Call Title is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||"unassigned"!=o.user_id||(i="Identified Agent is removed successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id===e.identifyAgent||(i="Identified Agent is updated successfully.")):(console.log("for Agent & CT is there"),null!=o.score_card_id&&void 0!=o.score_card_id&&null!==o.call_title&&""!=o.call_title&&o.call_title==e.call_title&&null!==o.user_id&&void 0!==o.user_id&&"unassigned"!==o.user_id&&o.user_id==e.identifyAgent&&(i="Scorecard is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id!=e.identifyAgent||(i="Call title is removed successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||"unassigned"!=o.user_id&&null!=o.user_id&&void 0!=o.user_id||(i="Identified Agent is removed successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title===e.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id!=e.identifyAgent||(i="Call title is updated successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""==o.call_title||o.call_title!=e.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id==e.identifyAgent||(i="Identified Agent is updated successfully.")):(console.log("SC & agent is there "),null!=o.score_card_id&&void 0!=o.score_card_id&&o.score_card_id==e.score_card_id&&null!==o.call_title&&""!=o.call_title&&void 0!=o.call_title&&null!==o.user_id&&void 0!==o.user_id&&"unassigned"!==o.user_id&&o.user_id==e.identifyAgent&&(i="Call Title is added successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||"unassigned"!=o.user_id||(i="Identified Agent is removed successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id!=e.identifyAgent||(i="Scorecard is removed successfully."),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id===e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id!=e.identifyAgent||(i="Scorecard is updated successfully.",o.scoreShow&&(o.scoreShow=!1,o.audioShow=!1)),null==o.score_card_id||void 0==o.score_card_id||o.score_card_id!=e.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null===o.user_id||void 0===o.user_id||"unassigned"===o.user_id||o.user_id===e.identifyAgent||(i="Identified Agent is updated successfully.")):(console.log("I am here"),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title||null==o.user_id||void 0==o.user_id||"unassigned"===o.user_id||(i="Identified Agent is added successfully."),null==o.score_card_id&&void 0==o.score_card_id||null!=o.call_title&&""!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Scorecard is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null===o.call_title||""===o.call_title||void 0===o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Call Title  is added successfully."),null!=o.score_card_id&&void 0!=o.score_card_id||null!=o.call_title&&""!=o.call_title&&void 0!=o.call_title||null!=o.user_id&&void 0!=o.user_id&&"unassigned"!=o.user_id||(i="Nothing is added in Call record.")),l.notify({title:"Select and Score Calls",text:i,type:"success"})}else l.notify({title:"Select and Score Calls",text:a.data.err,type:"error"})})},e.changeScoreStatus=function(t,o){o.status="reviewed",o.call_score_status="reviewed",e.date=new Date,e.date=moment(e.date).tz(a.timezone).format("MM-DD-YYYY h:mm:ss a"),o.reviewer=a.fullName+" | "+a.userEmail,o.reviwed_date_time=e.date,s.updateScoreStatus(o.call_id,o.call_score_status).then(function(e){"success"===e.data.status?l.notify({title:"Select and Score Calls",text:"Call Reviewed successfully.",type:"success"}):l.notify({title:"Select and Score Calls",text:e.data.err,type:"error"})})},e.updateScoreCallDetail=function(t,o,i){var r=!1;if(o.call_scored_by=a.email,o.score_card_id=void 0!==t?t.selectedScorecard:o.score_card_id,o.user_id=void 0!==t?t.identifyAgent:o.user_id,e.totalGrade=0,e.totalImportance=0,e.finalGrade=0,e.radioScore=10,o.status="scored",o.rating=e.rating,o.isNew=i,o.scorecard_rating=e.scorecards.criteriaList,o.comments=e.comment,o.tags=e.selTags,_.map(e.scorecards.criteriaList,function(e){e.is_required&&("scale_0-3"!==e.ctype&&"scale_0-5"!==e.ctype&&"scale_0-10"!==e.ctype||e.selectedRadio||(r=!0),"Pass/Fail"===e.ctype&&1!=e.selectedCheckPass&&1!=e.selectedCheckFail&&1!=e.selectedCheckNa&&(r=!0))}),void 0==e.scorecards.appt_booked?r=!0:o.appt_booked="Yes"===e.scorecards.appt_booked,r)return o.status="unscored",l.notify({title:"Select and Score Calls",text:"Please make sure you have answered all mandatory questions before clicking on Done button",type:"error"}),!1;_.map(e.scorecards.criteriaList,function(t){var o=0,a=t.criteria_importance;"scale_0-3"===t.ctype?e.radioScore=3:"scale_0-5"===t.ctype?e.radioScore=5:e.radioScore=10,t.selectedRadio="undefined"==t.selectedRadio?void 0:t.selectedRadio,t.selectedCheckPass?(o=1,e.totalImportance+=parseInt(a)):t.selectedCheckFail?(o=0,e.totalImportance+=parseInt(a)):t.selectedCheckNa||t.selectedRadio&&("N/A"===t.selectedRadio||(e.totalImportance+=parseInt(a),o=parseFloat(parseInt(t.selectedRadio)/e.radioScore))),isNaN(o)?t.criteria_score=0:(t.criteria_score=a>0?o*a:0,e.finalGrade+=t.criteria_score),t.score=o,t.criteria_score=Math.round(parseFloat(t.criteria_score).toFixed(2))}),_.map(e.scorecards.criteriaList,function(t){var o=t.criteria_importance;if("scale_0-3"===t.ctype?e.radioScoreForCriteria=3:"scale_0-5"===t.ctype?e.radioScoreForCriteria=5:e.radioScoreForCriteria=10,t.selectedCheckPass){var a=parseInt(o);return t.criteria_score=Math.round(parseFloat(a/parseInt(t.criteria_importance)*100).toFixed(2))}if(t.selectedCheckFail){a=0;return t.criteria_score=0}if(t.selectedCheckNa){a=parseInt(o);return t.criteria_score=Math.round(parseFloat(a/parseInt(t.criteria_importance)*100).toFixed(2))}if(t.selectedRadio)return a="N/A"===t.selectedRadio?Math.round((100*parseFloat(parseInt(t.radioOption.length-2)/e.radioScoreForCriteria)).toFixed(2)):Math.round((100*parseFloat(parseInt(t.selectedRadio)/e.radioScoreForCriteria)).toFixed(2)),t.criteria_score=a}),0==e.finalGrade&&0==e.totalImportance?o.score=0:(o.score=Math.round(parseFloat(e.finalGrade/e.totalImportance*100).toFixed(2)),o.score=parseFloat(o.score)),Number(o.score)===o.score&&o.score%1==0&&(o.score=parseInt(o.score)),s.updateScorCardCallDetail(o).then(function(t){if("success"===t.data.result){e.date=new Date,e.date=moment(e.date).tz(a.timezone).format("MM-DD-YYYY h:mm:ss a"),e.updateScoreCallDetail1=!1,o.status="scored",o.scorer=a.fullName+" | "+a.userEmail,o.score_date=e.date;var r="Call Scored Successfully.";i||(r="Call Scores updated successfully.",l.notify({title:"Select and Score Calls",text:r,type:"success"}))}else l.notify({title:"Select and Score Calls",text:t.data.err,type:"error"})})},e.redirectScheduledEditor=function(t){e.applyFilterParams(),e.loadReportBasedOnQueryString()},e.pageChanged=function(t){e.sortedPagination||(e.offset=e.pageSize*(e.pagination.current-1),console.log("PAGE CHANGED"),e.applyFilter(),e.offset=e.pageSize*(e.pagination.current-1),e.applyFilter()),e.sortedPagination=!1},e.noPulse=function(){0!==document.getElementsByClassName("pulse").length&&document.getElementsByClassName("pulse")[0].classList.remove("pulse")},e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},100)},e.report="set-select-score",e.isReadonly=!1,e.isTagAccess=!0,e.isClick=!0,e.userAccess&&(void 0===e.userAccess.campaign||e.userAccess.campaign<5)&&(e.isReadonly=!0),e.getHeader=function(){return["Call ID","Status"," Call Date/Time","Duration","Group","Group ID","Group External ID","Identified Agent","Call Title","Tags","Comments","Commenter","Comment Date/Time","Scorecard","Score","Outcome","Selector","Scorer","Scored Date/Time","Reviewer","Reviewed Date/Time","Play Call"]},e.getCSVData=function(t){var o=[];e.scorecardList=[],e.groupsReportFileName=h+"."+t;var i=u.defer();if(s.getCallsDetailsList($.param(e.urlParams)).then(function(r){if(r.data.json.call.length>0){e.scorecardList=r.data.json.call;for(var n=0;n<e.scorecardList.length;n++){if(null!==e.scorecardList[n].user_id||""!==e.scorecardList[n].user_id||void 0!==e.scorecardList[n].user_id){var s=_.find(e.agents,{ct_user_id:parseInt(e.scorecardList[n].user_id)});e.scorecardList[n].username=void 0!==s?s.username:"Not set"}if(null!==e.scorecardList[n].score_card_id||""!==e.scorecardList[n].score_card_id||void 0!==e.scorecardList[n].score_card_id){var l=_.find(e.scorecardData,{score_card_id:parseInt(e.scorecardList[n].score_card_id)});e.scorecardList[n].score_card_name=void 0!==l?l.score_card_name:"Need Scorecard"}for(var c=e.scorecardList[n].comment_date_time.split(","),d="",u=0;u<c.length;u++)d+=moment.utc(c[u]).format("MM-DD-YYYY h:mm:ss a"),u!==c.length-1&&(d+=",");o.push({a:e.scorecardList[n].call_id,b:"needs_scorecard"===e.scorecardList[n].status?"Needs Scorecard":e.scorecardList[n].status.charAt(0).toUpperCase()+e.scorecardList[n].status.substr(1),c:e.scorecardList[n].call_date_time?moment.utc(e.scorecardList[n].call_date_time).format("MM-DD-YYYY h:mm:ss a"):"",d:e.scorecardList[n].duration,e:e.scorecardList[n].group_name,f:e.scorecardList[n].group_id,g:e.scorecardList[n].group_external_id,h:e.scorecardList[n].agent,i:e.scorecardList[n].call_title,j:e.scorecardList[n].tag,k:e.scorecardList[n].comment,l:e.scorecardList[n].commenter,m:e.scorecardList[n].comment_date_time?d:"",n:e.scorecardList[n].scorecard,o:e.scorecardList[n].score,p:e.scorecardList[n].outcome,q:e.scorecardList[n].selector,r:e.scorecardList[n].scorer,s:e.scorecardList[n].score_date?moment.utc(e.scorecardList[n].score_date).format("MM-DD-YYYY h:mm:ss a"):"",t:e.scorecardList[n].reviewer,u:e.scorecardList[n].reviwed_date_time?moment.utc(e.scorecardList[n].reviwed_date_time).format("MM-DD-YYYY h:mm:ss a"):"",v:e.scorecardList[n].play_call}),d=""}i.resolve(o),a.isSafari&&i.resolve(JSONToCSVConvertor(o,e.groupsReportFileName,!0,t))}}),!a.isSafari)return i.promise},e.exportPDF=function(){var t=[];e.scoreDetailsColumnMapping.forEach(function(e){var o={label:e.label,visible:e.visible};t.push(o),e.visible=!0});var o=new jsPDF("l","pt","legal");o.addHTML($("#callsData"),{pagesplit:!0},function(){o.output("datauristring");setTimeout(function(){o.save("call-detail-scoreard.pdf")},100),t.forEach(function(t){e.scoreDetailsColumnMapping.forEach(function(e){t.label===e.label&&(e.visible=t.visible)})})})},e.call_tags=[],e.selCallTags={},e.call_tagslength=[];var C,A,T,D,I,N={};N.aggregate_property_keys={call_id:"call_id",date_time:"call_started",group_name:"org_unit_name",username:"user_id",score_card_name:"score_card_id",score_date:"call_scored_date",score:"score"},N.dataTableHeaderValues={call_id:"Call ID",date_time:"Call Date/Time",group_name:"Group Name",username:"Agent",score_card_name:"Scorecard",score_date:"Score Date",score:"Score"},e.simpleSearchApplied=!0,e.simpleSearchPlaceholder="",e.changeDateRange=function(){e.filterReset(),o.sessionStorage.report_start_date=e.drp_start,o.sessionStorage.report_end_date=e.drp_end,e.offset=0,e.pagination.current=1,e.horsemanFlag=!1,e.filterApplied=!1,e.applyFilter(),e.isScoreEditInProgress=!1},e.updateSimpleFilter=function(t){e.advFiltersAreApplied=!1,void 0!==e.simpleSearchFilter?(e.filter=e.simpleSearchFilter,e.filtertype="s"):(e.filter="",e.filtertype="a"),e.offset=0,e.pagination.current=1,e.applyFilterParams()},e.mappedHeaderValues=(C=N.dataTableHeaderValues,A=N.aggregate_property_keys,(T={})[C.call_id]=A.call_id,T[C.date_time]=A.date_time,T[C.group_name]=A.group_name,T[C.username]=A.username,T[C.score_card_name]=A.score_card_name,T[C.score_date]=A.score_date,T[C.score]=A.score,T),e.headerNames=[(D=N.dataTableHeaderValues).call_id,D.date_time,D.group_name,D.username,D.score_card_name,D.score_date,D.score],e.toggleFilterUsed=function(){e.advFiltersAreApplied=!e.advFiltersAreApplied,e.simpleSearchApplied=!e.simpleSearchApplied,e.initializeAdvFilterDefinitions(),e.updateAdvancedFilter(!0),e.applyFilterParams()},e.disableButton=function(t){return!(void 0!==e.audio&&void 0!==e.audio[t]&&!isNaN(e.audio[t].duration))},e.openEmail=function(t,o){e.s3URL=o,m.open({animation:e.animationsEnabled,templateUrl:"assets/partials/emailCall.html",controller:"ModalInstanceCtrl",size:t,resolve:{s3URL:function(){return o}}}).result.then(function(t){e.selected=t},function(){})},e.currentTime=0,e.state=null,e.volume=1,e.isCompleted=!1,e.API=null,e.commentDetails=[],e.comment_id=0,e.totalTime=0,e.isProcessing=!1,e.isResponseBox=!1,e.onPlayerReady=function(t){e.API=t},e.onError=function(e){},e.onCompleteVideo=function(t){e.isCompleted=!0,t.is_call_listened||(e.setCallToListen(t.call_id),t.is_call_listened=!0)},e.setCallToListen=function(e){var t={call_id:e,userId:a.userId};s.setCallListened(e,t).then(function(e){"success"===e.data.status&&console.log("Result",e)})},e.onUpdateState=function(t){e.state=t},e.onChangeSource=function(t){e.source=t},e.onUpdateTime=function(t,o){e.currentTime=t,isNaN(o)||(e.totalTime=o)},e.onUpdateVolume=function(t){e.volume=t},e.saveAndRemoveCallCriteria=function(t,o,i,r,n){e.criteriaInProgress=!0;var l={scorecard_criteria_id:o.criteria_id,criteria_timestamp:t,ct_user_id:a.userId,isChecked:r,displayOrder:o.display_order};s.addAndRemoveCriteria(i,l).then(function(a){"success"===a.data.status&&(e.criteriaInProgress=!1);var n=o.criteria_id+"_"+i;r?(e.placeIcon(t,n,"criteria","icon-marker-active.png",o.title),o.tagged_scorecard_criteria_id=o.criteria_id):($("#"+("marker_criteria_"+n)).remove(),o.tagged_scorecard_criteria_id=null)})},e.commentResponse=function(t,o){e.isResponseBox=!0,I=t,o,e.isComment=!1},e.cancelChange=function(){e.isComment=!0},e.$watch("isComment",function(t,o){e.myplaceholder=t?"Type your comment here":"Type your response here"},!0),e.toggleResponses=function(t){_.map(e.commentDetails,function(e){e.comment_id!=t?e.showResponses=!1:e.showResponses=!e.showResponses}),e.isRespons=!e.isRespons,e.isRespons},e.showCommentBox=function(){e.isComment=!0},e.responsDetails=[],e.addRespons=function(t){if(e.isProcessing=!0,void 0==$("#commentSection").val()||""==$("#commentSection").val())e.isProcessing=!1,l.notify({title:"Select and Score Calls",text:"Response Text is needed",type:"error"});else{var o={commentText:$("#commentSection").val(),created_by:a.userId,updated_by:a.userId};s.addCommentRespons(I,o).then(function(t){"success"!=t.data.status||(e.isProcessing=!1,l.notify({title:"Select and Score Calls",text:"Response is added successfully",type:"success"})),y(v),S(I),$("#commentSection").val(""),$("#commentSection").text(""),"",e.showCommentBox()})}},e.addComment=function(t,o,i){if(e.isProcessing=!0,void 0==$("#commentSection").val()||""==$("#commentSection").val())e.isProcessing=!1,l.notify({title:"Select and Score Calls",text:"Comment Text is needed",type:"error"});else{var r={comment_text:$("#commentSection").val(),comment_timestamp:t,ct_user_id:a.userId};s.addComment(i,r).then(function(t){"success"===t.data.status&&(e.isProcessing=!1,l.notify({title:"Select and Score Calls",text:"Comment is added successfully",type:"success"})),y(i),$("#commentSection").val(""),$("#commentSection").text(""),""})}},e.exportScoreCardPDF=function(){e.pdfRenderTimeout=e.isIEOrEdge()?2e3:5e3;var t=e.isIEOrEdge()?{dpi:96,letterRendering:!0}:{scale:e.getScale(),letterRendering:!0},o=e.isIEOrEdge()&&e.scorecards.criteriaList.length>40?[6,5]:[15,15];document.getElementById("cdr_table").scrollLeft-=200,e.showHideCommentReplies(!0),setTimeout(function(){$(".pdfIcon").hide();var a=angular.element(document).find("#scorecardarea");if(angular.element(a).css("overflow-y","visible").css("max-height","100%").css("break-inside","avoid").css("page-break-inside","avoid").css("width","100%").css("background","transparent").css("pointer-events","none"),angular.element(a).find(".helpText").addClass("col-md-12 col-lg-12"),angular.element(a).find(".helpText").removeClass("col-md-8 col-lg-8"),e.commentDetails&&e.commentDetails.length>0){var i=angular.element(document).find("#commentsContainer"),r=angular.element(document).find("#commentLabel");angular.element(r.clone()).prependTo(i),angular.element(i.clone()).appendTo(a),angular.element(a).find("#commentsContainer").css("overflow-y","visible").css("max-height","100%"),angular.element(a).find(".Responses").css("display","none"),angular.element(a).find(".fa-times").css("display","none"),angular.element(a).find("#commentLabel").css("margin-top","20px")}var n=document.getElementById("scorecardarea");pdfFileName=$("#scorecardarea").attr("name")+".pdf";var s={margin:o,filename:pdfFileName,image:{type:"jpeg",quality:.98},html2canvas:t,jsPDF:{unit:"pt",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};const l=html2pdf().set(s).from(n).outputImg();l.then(function(){setTimeout(function(){l.save(),$(".buttons").show(),$(".pdfIcon").show(),angular.element(a).css("overflow-y","auto").css("max-height","490px").css("width","66.667%").css("pointer-events","auto").css("background","#fff"),angular.element(a).find(".helpText").addClass("col-md-8 col-lg-8"),angular.element(a).find(".helpText").removeClass("col-md-12 col-lg-12"),angular.element(a).find("#commentLabel").remove(),angular.element(a).find("#commentsContainer").remove(),angular.element(document).find("#commentsContainer").find("#commentLabel").remove(),e.showHideCommentReplies(!1),setTimeout(function(){for(var t=0;t<e.scorecards.criteriaList.length;t++){var o=e.scorecards.criteriaList[t];"Pass/Fail"!=o.ctype&&o.selectedRadio&&""!==o.selectedRadio&&(document.getElementById(o.criteria_id+"_radioOption_"+o.selectedRadio).checked=!0)}},500)},e.pdfRenderTimeout)})},0)},e.isIEOrEdge=function(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)||!!document.documentMode||!!window.StyleMedia},e.getScale=function(){return e.scorecards.criteriaList.length<=39?2:e.scorecards.criteriaList.length>39&&e.scorecards.criteriaList.length<=53?1.5:1.3},e.showHideCommentReplies=function(t){e.commentDetails.forEach(function(o){!0!==o.showResponses||!0!==t||e.showResponseComment?!1===t&&e.responseOpenComment===o.comment_id?(e.showResponseComment=void 0,o.showResponses=!0):o.replies&&o.replies.length>0&&(o.showResponses=t):(e.responseOpenComment=o.comment_id,o.showResponses=t)})},e.placeIcon=function(t,o,a,i,r){var n=document.getElementsByTagName("vg-scrub-bar")[0].clientWidth,s=document.getElementById("player_width"),l=(s.clientWidth,t*(n/e.totalTime)+45),c="marker_"+a+"_"+o,d="";d+="<img title= '"+r.replace(/'/g,"")+"'",d+="id='"+c+"'",d+="class='"+a+"'",d+="src='../img/"+i+"'",d+="onclick=angular.element(this).scope().commentPostion_play('comment_"+o+"',"+t+") ",d+="onmouseover=angular.element(this).scope().highlight_comment('comment_"+o+"') ",d+="onmouseout=angular.element(this).scope().unhighlight_comment('comment_"+o+"') ",d+="/>",s.innerHTML+=d;var u=document.getElementById(c);u.style.position="absolute",u.style.marginLeft=l+"px",u.style.zIndex="50"},e.commentPostion_play=function(t,o,a){console.log("commentPostion_play is called...",t),console.log("commentPostion_play is called...",o),e.API.seekTime(o,!1),e.API.play()},e.highlight_comment=function(e){document.getElementById(e);$("#"+e).css("border","3px solid rgb(31, 64, 125)")},e.unhighlight_comment=function(e){document.getElementById(e);$("#"+e).css("border","1px solid rgb(31, 64, 125)")},e.changeSource=function(){e.config.sources=e.media[1].sources,e.config.tracks=void 0,e.config.preload=!0},e.preloading=!1,e.showAdvFilter=!1,e.advancedFilterConfig={maxQuantity:5},e.extendUrlParams=function(t){"s"===t.vars.filtertype&&(e.simpleSearchFilter=t.vars.filter),e.urlParams=t.vars,e.drp_start=moment(e.urlParams.start_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),e.drp_end=moment(e.urlParams.end_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),angular.extend(e,t.vars),delete t.vars,angular.extend(e,t)},e.getInitialUrlParams=void f.determineInitializationMethod(e).then(function(t){e.advFilterDefinitions=f.getAdvFilterDefinitions(),e.advFilterDefinitions.length>0&&void 0!==e.advFilterDefinitions[0].selected_column&&(e.showAdvFilter=!0),e.extendUrlParams(t),e.loadReportBasedOnQueryString()}),e.addFilterDefinition=function(){f.addFilterDefinition(!1),e.advFilterDefinitions=f.getAdvFilterDefinitions()},e.updateOperators=function(t,o,a){f.updateOperators(t,o,a),e.advFilterDefinitions=f.getAdvFilterDefinitions()},e.applyFilterParams=function(){var t=f.applyFilter(e);return!!t&&(e.extendUrlParams(t),!0)},e.applyFilter=function(){e.horsemanFlag=!1;var t=e.applyFilterParams();for(var o in e.audio)e.audio[o].pause();var i=["$destroy","$locationChangeStart","$locationChangeSuccess"];for(var r in a.$$listeners)-1===i.indexOf(r)&&delete a.$$listeners[r];e.audio=void 0,e.scoreIncludes.length>0&&(e.urlParams.status=e.scoreIncludes),e.isScoreEditInProgress=!1,t&&e.loadReportBasedOnQueryString()},e.filterReset=function(){i&&i.filtertype&&g.search({report:"call_detail_scorecard"}),f.resetAdvFilter(),e.advFilterDefinitions=f.getAdvFilterDefinitions(),e.showAdvFilter=!1,e.simpleFilterText="",e.filtertype="s",e.filter="",e.filterApplied&&(e.applyFilter(),e.filterApplied=!1)},e.removeFilterDefinition=function(t){f.removeFilterDefinition(t),e.advFilterDefinitions=f.getAdvFilterDefinitions()},e.validateInput=function(e){f.validateInput(e)},e.increaseAudioInitializationCount=function(){++e.audioInitializationCount},e.getinfodetails=function(t,o,i){i?(s.getCallsDetailsInfo(a.userId,o).then(function(o){var a=o.data.json,i=a[0].dni,r=i.length,n=a[0].source_data,s=n.length,l=a[0].indicator_scores,c=l.length;if(_.each(a,function(e){e.singlerec=1}),void 0!==a[0]){if(s>0?(e.hasExtendedData=!0,"NoInfo"!=n[0].call_data&&(n[0].call_data="object"!=typeof n[0].call_data?JSON.parse(n[0].call_data):n[0].call_data),"NoInfo"===n[0].call_data?e.caller_info[t]={consumer1:{first_name:"No Information"}}:(e.caller_info[t]=n[0].call_data.reverse_phone_append?n[0].call_data.reverse_phone_append:n[0].call_data,e.caller_info[t].source=n[0].call_data.reverse_phone_append?"acxiom":"white pages")):e.hasExtendedData=!0,c>0)for(var d in e.ind_scores[t]=[],l)e.ind_scores[t][l[d].indicator_name]=l[d].score_value;if(r>0&&void 0!==i[0]){e.dnidata[t]=a[0].dni[0];var u=e.dnidata[t].referring.match(new RegExp(".+?[^/:](?=[?/]|$)"));null!==u&&(e.dnidata[t].referring=u[0])}}}),e.getcallcomments(a.userId,o),e.call_tagslength[o]="",e.call_tags[o]=[],e.getcalltags(a.userId,o)):e.comment.text=[]},e.call_commentslength=[],e.call_comments=[],e.getcallcomments=function(t,o){s.getCallsComments(t,o).then(function(t){var a=t.data.json;_.each(a,function(e){e.comment_created_formatted=moment(e.comment_created).format("MM-DD-YYYY h:mm:ss a"),e.singlerec=1}),e.call_id=o,e.call_comments[o]=_.filter(a,function(e){return null===e.comment_parent_id}),e.call_commentslength[o]=void 0!==e.call_comments[o]?e.call_comments[o].length:0,e.call_responses=_.filter(a,function(e){return null!==e.comment_parent_id}),e.call_responseslength=void 0!==e.call_responses?e.call_responses.length:0})},e.getcalltags=function(t,o){s.fetchCallsTags(a.userId,o).then(function(t){var i=t.data.json,r=[];void 0!==i&&(_.each(i,function(t){t.singlerec=1;var o={};o.id=t.tag_id,o.text=t.tag_name,r.push(o.id),t.permission>e.userAccess.tag&&(t.locked="locked")}),e.selCallTags[o]=r,e.call_id=o,e.call_tagslength[o]=i.length,e.call_tags[o]=i),s.fetchTags(a.userId,o).then(function(t){var a=t.data.json;e.selTags=[],void 0!==a&&(_.each(a,function(t){t.singlerec=1,e.selTags.push(t.tag_id),$("#calltagselect"+o).append('<option value="'+t.tag_id+'" >'+t.tag_name+"</option>")}),e.call_id=o,e.tagslength=a.length,e.tags=a)})})},e.postcomment=function(t,o){var i={comment:{call_id:o,ct_user_id:a.userId,comment_text:e.comment.text[o],comment_created:null,is_from_report:!0,comment_modified:null,comment_parent_id:null,comment_active:!0}};s.setCallsComments(i,a.userId).then(function(t){t.data.json;""===t.data.err?(l.notify({title:"Update Comments",text:"Successfully added comment",type:"success"}),e.comment.text[o]="",e.getcallcomments(a.userId,o)):l.notify({title:"Update Comments",text:t.data.err,type:"error"})})},e.newtagvalue=e.oldtagvalue="",e.postcalltag=function(t,o,i){var r={},n=[];if(r.addmultiple=i,r.call_id=e.call_id,r.ct_user_id=a.userId,r.currentOUId=a.currentOUId,i)currentTags=$("#calltagselect"+o).select2("data"),_.each(currentTags,function(t,o){n.push({tag:{call_id:e.call_id,ct_user_id:a.userId,org_unit_id:a.currentOUId,tag_id:parseInt(currentTags[o].id),tag_text:currentTags[o].text.trim(),tag_created:null}})}),r.calltags=n,s.setCallsTags(r,a.userId).then(function(t){t.data.json;""===t.data.err?(l.notify({title:"Update Call Tags",text:"Successfully updated call tags",type:"success"}),e.call_tagslength[o]=n.length):l.notify({title:"Update Call Tags",text:t.data.err,type:"error"})});else{var c=_.pluck(e.tags,"tag_name");c=c.map(function(e){return e.toLowerCase()});var d=_.filter(c,function(t){return t==e.noResultsTag.trim().toLowerCase()});if(""===e.newtagvalue?e.oldtagvalue="":e.oldtagvalue=e.newtagvalue,e.newtagvalue=e.noResultsTag.trim(),e.newtagvalue===e.oldtagvalue)return;if(d.length>0)return l.notify({title:"Update Call Tags",text:"This Tag already exists",type:"error"}),!1;n.push({tag:{call_id:e.call_id,ct_user_id:a.userId,org_unit_id:a.currentOUId,tag_id:null,tag_text:e.noResultsTag.trim(),tag_created:null}}),r.calltags=n,s.setCallsTags(r,a.userId).then(function(t){var o=t.data.json;if(""===t.data.err){l.notify({title:"Update Call Tags",text:"Successfully added call tag",type:"success"}),currentTags=$("#calltagselect"+e.call_id).select2("data");var a=[],i=[];_.each(currentTags,function(t){t.singlerec=1,a.push(t.id),i.push({call_id:e.call_id,tag_id:t.id,tag_name:t.text,locked:t.locked?"locked":"unlocked"})}),a.push(o.tag_id),i.push({call_id:e.call_id,tag_id:o.tag_id,tag_name:o.tag_name,locked:!1}),e.selCallTags[e.call_id]=a,e.call_tagslength[e.call_id]=i.length,e.call_tags[e.call_id]=i}else l.notify({title:"Update Comments",text:t.data.err,type:"error"})})}},e.userCanDeleteComment=function(t){return!e.isReadonly||parseInt(a.userId)===t},e.deletecomment=function(t,o,i){s.deleteCallsComments(o,a.userId).then(function(t){t.data.json;""===t.data.err?(l.notify({title:"Delete Comments",text:"Successfully deleted comment",type:"success"}),e.getcallcomments(a.userId,i)):l.notify({title:"Delete Comments",text:t.data.err,type:"error"})})}}]).controller("ScoreNotificationsController",["$uibModal","$scope","$rootScope","$filter","SelectedScorecard","$location","$window","$bootbox","ScoreCardService","pinesNotifications","ScoreNotificationsWebService",function(e,t,o,a,i,r,n,s,l,c,d){t.score_card_rule=[{name:"A call has been scored for me",value:"scored"},{name:"A call I scored has been reviewed",value:"reviewed"}],t.actionOptions=[{name:"Send email alert to",value:"email"},{name:"Send SMS to",value:"sms"}],t.notificationActions=[],t.addNewStep=!0,t.addNotification={},t.addNotification.actionOptions={},t.addNotification.phone_number={},t.addNotification.email={},t.addNotification.email[0]=o.userEmail,t.addNotification.score_card_rule={};var u=!0;function p(){d.getNotifcationsList(o.userId).then(function(e){"error"!==e.data.status&&(e.data.json.length>0?e.data.json.forEach(function(e){t.notificationActions.push({id:e.score_card_action_id,savedflag:!0}),t.addNotification.actionOptions[e.score_card_action_id]=e.score_card_action,t.addNotification.score_card_rule[e.score_card_action_id]=e.score_card_rule,"email"===e.score_card_action&&(t.addNotification.email[e.score_card_action_id]=""==e.score_card_action_target?o.userEmail:e.score_card_action_target),"sms"===e.score_card_action&&(t.addNotification.phone_number[e.score_card_action_id]=e.score_card_action_target)}):t.notificationActions.push({id:0,savedflag:!1}))}),console.log(" $scope.addNotification==",t.addNotification)}t.loadScoreNotifications=function(){p()},t.changeActionOption=function(e){t.addNotification.email[e]=o.userEmail},t.removeScoreNotifications=function(e,o,a){s.confirm("Are you sure you want to delete this Notification Action?",function(i){i&&(1==o?d.deleteScoreNotification(e).then(function(e){"error"!=e.data.status&&c.notify({title:"Score Notifications",text:"Notification Action deleted successfully",type:"success"}),t.notificationActions=[],p()}):0==a&&1==t.notificationActions.length?t.clearScoreNotificationAction(e):(t.notificationActions.splice(a,1),c.notify({title:"Score Notifications",text:"Notification Action deleted successfully",type:"success"})))})},t.clearScoreNotificationAction=function(e){t.addNotification.score_card_rule[e]=[],t.addNotification.actionOptions[e]=[],t.addNotification.email[e]=o.userEmail,t.addNotification.phone_number[e]=""},t.addNewScoreNotifications=function(e){var a;a={id:(e=parseInt(e))+1,savedflag:!1},t.notificationActions.push(a),t.addNotification.score_card_rule[e+1]=[],t.addNotification.actionOptions[e+1]=[],t.addNotification.email[e+1]=o.userEmail,t.addNotification.phone_number[e+1]=""},t.saveScoreNotifications=function(e,a){u=!0,t.notificationActions.forEach(function(e){if(e.ct_user_id=o.userId,e.created_by=o.userId,e.updated_by=o.userId,(void 0!=t.addNotification.score_card_rule[e.id]||void 0!=t.addNotification.actionOptions[e.id]||void 0==t.addNotification.phone_number[e.id]||""!=t.addNotification.score_card_rule[e.id]||""!=t.addNotification.actionOptions[e.id]||""==t.addNotification.phone_number[e.id])&&(void 0!=t.addNotification.score_card_rule[e.id]&&""!=t.addNotification.score_card_rule[e.id]||(u=!1,c.notify({title:"Score Notifications",text:"Rule field is required",type:"error"})),void 0!=t.addNotification.actionOptions[e.id]&&""!=t.addNotification.actionOptions[e.id]||(u=!1,c.notify({title:"Score Notifications",text:"Rule_Option field is required",type:"error"})),"sms"==t.addNotification.actionOptions[e.id]&&(void 0===t.addNotification.phone_number[e.id]||""==t.addNotification.phone_number[e.id]?(u=!1,c.notify({title:"Score Notifications",text:"Phone number field is required",type:"error"})):void 0!=t.addNotification.phone_number[e.id]&&t.addNotification.phone_number[e.id].replace(/[_]/g,"").length>0&&14!==t.addNotification.phone_number[e.id].replace(/[_]/g,"").length&&(u=!1,c.notify({title:"Score Notifications",text:"Phone number field is Invalid",type:"error"}))),"email"==t.addNotification.actionOptions[e.id])){void 0===t.addNotification.email[e.id]||""==t.addNotification.email[e.id]?(u=!1,c.notify({title:"Score Notifications",text:"Email field is required",type:"error"})):""==t.addNotification.email[e.id]&&void 0==t.addNotification.email[e.id]||/^[-._a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,7})$/.test(t.addNotification.email[e.id])||(u=!1,c.notify({title:"Score Notifications",text:"Email field is Invalid",type:"error"}))}e.score_card_rule=t.addNotification.score_card_rule[e.id],e.score_card_action=t.addNotification.actionOptions[e.id],"email"===t.addNotification.actionOptions[e.id]&&(e.score_card_action_target=t.addNotification.email[e.id]),"sms"==t.addNotification.actionOptions[e.id]&&(e.score_card_action_target=t.addNotification.phone_number[e.id])}),1==u&&d.createScoreNotifications(o.userId,t.notificationActions).then(function(e){"error"!=e.data.status&&(c.notify({title:"Score Notifications",text:"Notification Actions saved successfully",type:"success"}),o.uibModalInstance.close())})}}]),angular.module("theme.calloverview",["ui.select2","angularUtils.directives.dirPagination","api-param"]).factory("CallTrackingWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getLookerUrl:function(e){var t={method:"POST",url:r.baseURL()+"/v1/looker",headers:r.headerConfig().headers,data:e};return o(t)}};return n}]).directive("setHeight",["$window",function(e){return function(t,o){var a=angular.element(e);t.getWindowDimensions=function(){return{h:a.innerHeight()}},t.$watch(t.getWindowDimensions,function(e,a){t.windowHeight=e.h,o.css("height",e.h-135+"px")},!0),a.bind("resize",function(){t.$apply()})}}]).controller("CallsTrackingController",["$scope","$sce","$http","$window","$rootScope","$routeParams","progressLoader","CallTrackingWebService","pinesNotifications","$timeout","$compile","$q","$bootbox","$uibModal","$location",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g){8!==parseInt(i.billingId)&&194!==parseInt(i.billingId)&&7414!==parseInt(i.billingId)&&(a.location.href="#/access-denied"),e.looker_filters={},$(window).on("message",function(t){t.originalEvent.source===$("#looker")[0].contentWindow&&(eventData=JSON.parse(t.originalEvent.data),"dashboard:filters:changed"==eventData.type&&(console.log(eventData.dashboard.dashboard_filters),e.looker_filters=eventData.dashboard.dashboard_filters))}),e.isCompare=!1,e.report="call_overview";var f={dashboard_id:r.report_id?r.report_id:10,host:g.host(),timezone:i.timezone,filters:e.looker_filters};e.showCompare=9!==parseInt(f.dashboard_id),e.applyFilter=function(){n.start();var o={dashboard_id:e.isCompare?7:10,host:g.host(),timezone:i.timezone,filters:e.looker_filters};s.getLookerUrl(o).then(function(o){console.log("result.data.json",JSON.stringify(o.data.json)),e.lookerUrl=t.trustAsResourceUrl(o.data.json),n.set(100),n.end()})},s.getLookerUrl(f).then(function(o){e.lookerUrl=t.trustAsResourceUrl(o.data.json)})}]),angular.module("theme.cfcontroller",[]).service("CFModel",["$rootScope","$http",function(e,t){"use strict";var o=function(){this.all=[],this.dimensions=[],this.format=d3.time.format("%x")};return o.prototype.fetch=function(){var e=this;if(!this.url)throw new Error("You must specify a url on the class");return t.get(e.url).success(function(t){e.all=e.parse(t)})},o.prototype.get=function(e){return _.find(this.all,function(t){return t.id===e})},o.prototype.parse=function(e){return e},o.prototype.resetAllDimensions=function(){_.each(this.dimensions,function(e){e.filterAll()})},o.prototype.runFilters=function(e){var t=this;this.filterData=e,_.each(this.dataSets,function(e,o){t.resetAllDimensions(),t.applyFilters(e),t[o]=t.byName.bottom(1/0)}),_.each(this.groups,function(e,o){t[o]=e.all()})},o.prototype.applyFilters=function(e){var t=this;e=e||[],_.each(this.filters,function(o,a){_.contains(e,a)||o.bind(t)()})},o.prototype.count=function(){return this.all.length},o.prototype.anyItemFallsWithinRange=function(e,t){if(0===t.length)return!0;if(0===e.length)return!1;for(var o=0;o<e.length;o++)if(this.fallsWithinRange(e[o],t))return!0;return!1},o.prototype.fallsWithinRange=function(e,t){return e>=t[0]&&e<=t[1]},new o}]).service("CFCallFlow",["CFModel",function(e,t){"use strict";var o=function(){this.url=t+"/assets/demo/call_flow.json"};return(o.prototype=Object.create(e)).constructor=o,o}]).controller("CFController",["$scope","$rootScope","$location","$q","CFCallFlow",function(e,t,o,a,i){"use strict";return e.cfcallflow=i,e.cfcallflow}]),angular.module("org-unit",["disableAll","theme.services","ui.bootstrap","breadcrumb","whitelabel","ui.select2","campaigns-builder","ngTagsInput"]).directive("tooltip",function(){return{link:function(e,t,o,a){void 0!==a&&a.hover(function(){a.tooltip("show")},function(){a.tooltip("hide")})}}}).factory("OrgUnitWebService",["$q","$rootScope","$http","$window","$location",function(e,t,o,a,i){"use strict";var r={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getGroupsExportReport:function(e,t){return o.get(this.getBaseURL()+"/v1/orgunit/groups/ouId/"+t+"/userAccess/"+e,this.getJsonConfig())},getUsersExportReport:function(e,t){return o.get(this.getBaseURL()+"/v1/user/users/ouId/"+t+"/userAccess/"+e,this.getJsonConfig())},getBaseURL:function(){return t.url+":"+t.port},getOULevel:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/level/"+e,this.getJsonConfig())},getconversationalanalytics:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/CAStatus/"+e,this.getJsonConfig())},getFeatureSettings:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/feature/"+e,this.getJsonConfig())},getDefaultCustomParams:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/CallFlow/customParams/"+e,this.getJsonConfig())},getspamguard:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/spamguard/"+e,this.getJsonConfig())},getrecordcall:function(e){return o.get(this.getBaseURL()+"/v1//",+e,this.getJsonConfig())},getvoicepromts:function(e){return o.get(this.getBaseURL()+"/v1/callflowrecording/"+e+"/prompt",this.getJsonConfig())},getwhisper:function(e){return o.get(this.getBaseURL()+"/v1/callflowrecording/"+e+"/whisper",this.getJsonConfig())},getcustomsource:function(e){return o.get(this.getBaseURL()+"/v1/customSource/"+e,this.getJsonConfig())},getCallFlow:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callFlow/"+e,this.getJsonConfig())},getCallActions:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callAction/"+e,this.getJsonConfig())},getcallActionByActionId:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callAction/action/"+e,this.getJsonConfig())},getWebhooks:function(e){return o.get(this.getBaseURL()+"/v1/webhook/list/"+e,this.getJsonConfig())},removecallActions:function(e,t){var i={method:"DELETE",url:this.getBaseURL()+"/v1/defgroupsetting/callAction/"+e+"/"+t,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(i)},createDefaultCustomParams:function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/defgroupsetting/CallFlow/customParams/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},getStyle:function(e){return o.get(this.getBaseURL()+"/v1/useraccess/styleou/"+e,this.getJsonConfig())},getChildrenOUs:function(e){return o.defaults.useXDomain=!0,o.get(t.url+":"+t.port+"/v1/orgUnit?org_unit_parent_id="+e,this.getJsonConfig())},validateDniData:function(e,t,o){var a={},i=[],r=[],n=[],s=new RegExp(/^([a-z0-9]+|\*)([\-\.]{1}[a-z0-9]+)*\.([a-z]{1,5}|\*)(:[0-9]{1,5})?(\/.*)?$/i);if(0===e.destination_url.length&&t&&i.push("Host Domain is required"),0===e.dni_element.length&&t&&i.push("HTML Class is required"),e.destination_url.indexOf("*")>-1&&("*"!=e.destination_url.charAt(0)||"."!=e.destination_url.charAt(1))&&(r.push("Host Domain"),n.push("When using a wildcard at the beginning of a Host Domain, *.domain format is required. Example: *.logmycalls.com")),e.referrer&&o)if(s.test(e.referrer)){var l=e.referrer.split(".");2==l.length&&"*"==l[0]&&"*"!=l[1]&&(r.push("Referring Website"),n.push("Wrong domain format for Referring Website."))}else r.push("Referring Website"),n.push("Wrong domain format for Referring Website.");else!e.referrer&&t&&n.push("Referring Website field is required.");e.dni_element&&t&&("lmc_track"!=e.dni_element||"session"!=e.dni_type&&"source"!=e.dni_type||(r.push("Class"),n.push("The HTML Class ID 'lmc_track' is only allowed for URL-based DNI.")),"lmc_track"!=e.dni_element&&"url"==e.dni_type&&(r.push("Class"),n.push("The HTML Class ID 'lmc_track' is required for URL-based DNI.")),e.dni_element.indexOf(" ")>-1&&(r.push("Class"),n.push("The HTML ID Class must not contain spaces.")));e.destination_url,e.referrer,e.referrer_type,e.dni_element;return a.arrInvalidMessage=n,a.arrRequired=i,a},infoAboutOuAndChildren:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/linked/"+e,this.getJsonConfig())},deleteOU:function(e){return o.delete(this.getBaseURL()+"/v1/orgUnit/"+e+"/"+t.currentOUId,this.getJsonConfig())},getOrgUnitById:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/"+e,this.getJsonConfig())},getIndustries:function(){return o.get(this.getBaseURL()+"/v1/industry",this.getJsonConfig())},getTTS:function(e){return o.get(this.getBaseURL()+"/v1/callflow/getmedia/"+encodeURIComponent(e),this.getJsonConfig())},parseIndustries:function(e){var t,o,a,i,r={};return _.each(e,function(e){t=e.industry_group,o=e.industry_name,void 0===r[t]&&(r[t]={name:t,specific:[]}),"Other"!==t?r[t].specific.push({name:o,id:e.industry_id}):(a=e.industry_id,i=t)}),r.Other={name:i,specific:[]},r.Other.specific.push({name:"Other",id:a}),r},updateOrgUnit:function(e){var i={method:"PUT",url:t.url+":"+t.port+"/v1/orgUnit/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},createOrgUnit:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1/orgUnit/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},updateCallActions:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/callAction",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},enableconversationalanalytics:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/CAStatus/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},savedefCustomSource:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},enableSpamguard:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},saveDefaultGroupSetting:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/feature/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},defaultCreateCallFlow:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/CallFlow",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},defaultUpdateCallFlow:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/CallFlow",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},recordcall:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},playvoicepromt:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},playwhispermsg:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},customSource:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/customSource",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},saveCallActions:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/callAction",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},multiDeleteCustomSource:function(e){var t={method:"DELETE",url:this.getBaseURL()+"/v1/orgUnit/customsources",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)}};return r}]).factory("deleteAudioService",function(){"use strict";var e={};return{setValues:function(t,o){e[t]=o},getValues:function(){return e}}}).factory("OrgUnitLocal",["$q","$rootScope","$http","$window","$location","DynamicCssInsertion",function(e,t,o,a,i,r){"use strict";var n={getBaseURL:function(){return t.url+":"+t.port},getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getUserHighestOrgUnit:function(e){var t=this.getBaseURL()+"/v1/session/"+(e?"resetOu":"");return o.get(t,this.getJsonConfig())},getSessDataFromBackend:function(){console.log("running getSessDataFromBackend");var e=this.getBaseURL()+"/v1/session";o.get(e,this.getJsonConfig()).then(function(e){if("success"===e.data.result){console.log("ORG UNIT RESULT",e.data);var o=e.data.json;a.sessionStorage.token=o.access_token,t.levelOneOus=o.session.levelOneOus,a.sessionStorage.levelOneOus=JSON.stringify(o.session.levelOneOus),t.currentOUId=a.sessionStorage.currentOUId=o.session.ou_id,t.currentOUName=a.sessionStorage.currentOUName=o.session.ou_name,t.currentOULevel=a.sessionStorage.currentOULevel=0,t.topLevelOUId=a.sessionStorage.topLevelOUId=o.session.tl_id,t.userOULevel=a.sessionStorage.userOULevel=o.session.user_ou_level,t.highestOUId=a.sessionStorage.highestOUId=o.session.ou_id,t.highestOUName=a.sessionStorage.highestOUName=o.session.ou_name,t.userId=a.sessionStorage.userId=o.session.user_id,t.fullName=a.sessionStorage.fullName=o.session.first_name+" "+o.session.last_name,t.timezone=a.sessionStorage.timezone=o.session.timezone,t.billingId=a.sessionStorage.billingId=o.session.billing_id,t.billingOu=a.sessionStorage.billingOu=o.session.billing_ou,t.userEmail=a.sessionStorage.userEmail=o.session.email,t.score_call=a.sessionStorage.score_call=o.session.score_call,t.access_audio=a.sessionStorage.access_audio=o.session.access_audio,t.is_migrated=a.sessionStorage.is_migrated=o.session.is_migrated,t.download_audio_enabled=a.localStorage.download_audio_enabled=o.session.download_audio_enabled,t.roleId=a.sessionStorage.roleId=o.session.role_id,t.protect_caller_id=a.sessionStorage.protect_caller_id=o.session.protect_caller_id,t.orglist=a.sessionStorage.orglist=o.session.orglist,t.reports=o.session.reports,a.sessionStorage.reports=JSON.stringify(o.session.reports),t.prompts=o.session.prompts,t.voicemails=o.session.voicemails,t.whispers=o.session.whispers,a.sessionStorage.prompts=JSON.stringify(o.session.prompts),a.sessionStorage.voicemails=JSON.stringify(o.session.voicemails),a.sessionStorage.whispers=JSON.stringify(o.session.whispers),o.session.badge&&o.session.badge>0&&(t.activeConversation=o.session.badge),t.isSafari=a.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),t.bc_ous=[{id:t.highestOUId,name:t.highestOUName},{id:null,name:null},{id:null,name:null}],void 0!==o.session.support_token&&(t.supportToken=a.sessionStorage.supportToken=o.session.support_token),Object.keys(o.session.style).length>0?(t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.chatActive=a.sessionStorage.chatActive=o.session.style.chat_active,o.session.style.support_url||o.session.style.domain_name?t.supportURL=a.sessionStorage.supportURL=o.session.style.support_url:t.supportURL=a.sessionStorage.supportURL="https://knowledgebase.convirza.com"):(t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.supportURL=a.sessionStorage.supportURL="https://knowledgebase.convirza.com",t.chatActive=a.sessionStorage.chatActive=!0),t.feedbackURL=a.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+a.sessionStorage.uservoiceSSO,o.scope&&(t.scope=o.scope,a.sessionStorage.scope=JSON.stringify(o.scope),n.getUserAccess(o.scope)),console.log("Is pendo loaded 3: ",a.sessionStorage.loadedPendoScript),a.sessionStorage.loadedPendoScript&&"YES"===a.sessionStorage.loadedPendoScript&&(t.white_label_active?t.white_label_active&&!o.session.style.domain_name&&pendoInitializeOnLogin():(console.log("Pendo Loading"),pendoInitializeOnLogin())),void 0!==o.session.style.white_label_css&&Object.keys(o.session.style.white_label_css).length>0?r.whiteLabelCSSInject(o.session.style.white_label_css,o.session.style.org_logo,o.session.style.org_logo,!1):r.whiteLabelCSSInject(null,null,null,!1),a.sessionStorage.style=JSON.stringify(o.session.style),localStorage.setItem("sessionStorageData",JSON.stringify(a.sessionStorage))}else i.path("login")})},getSessDataForReportEngine:function(){console.log("running getSessDataFromBackend");var e=this.getBaseURL()+"/v1/session";o.get(e,this.getJsonConfig()).then(function(e){if("success"===e.data.result){console.log("ORG UNIT RESULT",e.data);var o=e.data.json;a.sessionStorage.token=o.access_token,t.levelOneOus=o.session.levelOneOus,a.sessionStorage.levelOneOus=JSON.stringify(o.session.levelOneOus),t.currentOUId=a.sessionStorage.currentOUId=o.session.ou_id,t.currentOUName=a.sessionStorage.currentOUName=o.session.ou_name,t.currentOULevel=a.sessionStorage.currentOULevel=0,t.topLevelOUId=a.sessionStorage.topLevelOUId=o.session.tl_id,t.userOULevel=a.sessionStorage.userOULevel=o.session.user_ou_level,t.highestOUId=a.sessionStorage.highestOUId=o.session.ou_id,t.highestOUName=a.sessionStorage.highestOUName=o.session.ou_name,t.userId=a.sessionStorage.userId=o.session.user_id,t.fullName=a.sessionStorage.fullName=o.session.first_name+" "+o.session.last_name,t.timezone=a.sessionStorage.timezone=o.session.timezone,t.billingId=a.sessionStorage.billingId=o.session.billing_id,t.billingOu=a.sessionStorage.billingOu=o.session.billing_ou}else i.path("login")})},getUserAccess:function(e){console.log(e);var o,r={};$.each(e,function(e,t){if(o=t,isNaN(t)){var a=t.split(":");o=a[0],3!==a.length||(isNaN(a[1])||isNaN(a[2])?r[e+"_record_list"]=[]:(r[e+"_total"]=a[1],r[e+"_threshold"]=a[2]))}r[e]=o}),a.sessionStorage.userAccess=JSON.stringify(r),t.userAccess=r,t.targetURL||(t.targetURL=window.location.href);var n=t.targetURL.split("#");""!=t.targetURL&&""!=n[1]&&"/login"!=n[1]?window.location.href=t.targetURL:i.path("/")},getSessDataFromLocal:function(){if(angular.isDefined(a.sessionStorage.currentOUId)){t.currentOUId=a.sessionStorage.currentOUId,t.currentOUName=a.sessionStorage.currentOUName,t.currentOULevel=a.sessionStorage.currentOULevel,t.highestOUId=a.sessionStorage.highestOUId,t.highestOUName=a.sessionStorage.highestOUName,t.topLevelOUId=a.sessionStorage.topLevelOUId,t.topLevelOUName=a.sessionStorage.topLevelOUName,t.fullName=a.sessionStorage.fullName,t.userOULevel=a.sessionStorage.userOULevel,t.userAccess=a.sessionStorage.userAccess?JSON.parse(a.sessionStorage.userAccess):[],t.userId=a.sessionStorage.userId,t.timezone=a.sessionStorage.timezone,t.billingId=a.sessionStorage.billingId,t.billingOu=a.sessionStorage.billingOu,t.userEmail=a.sessionStorage.userEmail,t.score_call=a.sessionStorage.score_call,t.access_audio=a.sessionStorage.access_audio,t.is_migrated=a.sessionStorage.is_migrated,t.download_audio_enabled="boolean"==typeof a.localStorage.download_audio_enabled?a.localStorage.download_audio_enabled:"true"===a.localStorage.download_audio_enabled.toLowerCase(),t.roleId=a.sessionStorage.roleId,t.protect_caller_id=a.sessionStorage.protect_caller_id,t.orglist=a.sessionStorage.orglist,t.reports=a.sessionStorage.reports?JSON.parse(a.sessionStorage.reports):[],t.levelOneOus=a.sessionStorage.levelOneOus?JSON.parse(a.sessionStorage.levelOneOus):[],t.prompts=a.sessionStorage.prompts&&"undefined"!=a.sessionStorage.prompts?JSON.parse(a.sessionStorage.prompts):[],t.voicemails=a.sessionStorage.voicemails&&"undefined"!=a.sessionStorage.voicemails?JSON.parse(a.sessionStorage.voicemails):[],t.whispers=a.sessionStorage.whispers&&"undefined"!=a.sessionStorage.whispers?JSON.parse(a.sessionStorage.whispers):[],a.sessionStorage.activeConversation&&a.sessionStorage.activeConversation>0&&(t.activeConversation=a.sessionStorage.activeConversation),a.sessionStorage.bc_ous?t.bc_ous=JSON.parse(a.sessionStorage.bc_ous):(t.bc_ous=[{id:t.highestOUId,name:t.highestOUName},{id:null,name:null},{id:null,name:null}],a.sessionStorage.bc_ous=JSON.stringify(t.bc_ous)),void 0!==a.sessionStorage.supportToken&&(t.supportToken=a.sessionStorage.supportToken),a.sessionStorage.scope&&(n.getUserAccess(JSON.parse(a.sessionStorage.scope)),t.scope=JSON.parse(a.sessionStorage.scope));var e=this.getBaseURL()+"/v1/session/style/"+t.currentOUId;o.get(e,this.getJsonConfig()).then(function(e){"success"===e.data.result&&(t.white_label_active=e.data.json.white_label_active,Object.keys(e.data.json).length>0?(e.data.json.support_url||e.data.json.domain_name?t.supportURL=a.sessionStorage.supportURL=e.data.json.support_url:t.supportURL=a.sessionStorage.supportURL="https://knowledgebase.convirza.com",t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.chatActive=a.sessionStorage.chatActive=e.data.json.chat_active):(t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.chatActive=a.sessionStorage.chatActive=!0,t.supportURL=a.sessionStorage.supportURL="https://knowledgebase.convirza.com"),console.log("Is pendo loaded 4: ",a.sessionStorage.loadedPendoScript),a.sessionStorage.loadedPendoScript&&"YES"===a.sessionStorage.loadedPendoScript&&(t.white_label_active?t.white_label_active&&!e.data.json.domain_name&&pendoInitializeOnLogin():(console.log("Pendo Loading"),pendoInitializeOnLogin())),t.feedbackURL=window.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+window.sessionStorage.uservoiceSSO,e.data.json.white_label_css&&Object.keys(e.data.json.white_label_css).length>0?r.whiteLabelCSSInject(e.data.json.white_label_css,e.data.json.org_logo,e.data.json.org_logo,!1):r.whiteLabelCSSInject(null,null,null,!1))})}},getSessDataFromLocalStorage:function(e){console.log("running getSessDataFromLocalStorage");var o=e;o&&o.token&&o.currentOUId&&o.userId?(a.sessionStorage.token=o.token,t.levelOneOus=JSON.parse(o.levelOneOus),a.sessionStorage.levelOneOus=JSON.stringify(o.levelOneOus),t.currentOUId=a.sessionStorage.currentOUId=o.currentOUId,t.currentOUName=a.sessionStorage.currentOUName=o.currentOUName,t.currentOULevel=a.sessionStorage.currentOULevel=o.currentOULevel,t.topLevelOUId=a.sessionStorage.topLevelOUId=o.topLevelOUId,t.userOULevel=a.sessionStorage.userOULevel=o.userOULevel,t.highestOUId=a.sessionStorage.highestOUId=o.highestOUId,t.highestOUName=a.sessionStorage.highestOUName=o.highestOUName,t.userId=a.sessionStorage.userId=o.userId,t.fullName=a.sessionStorage.fullName=o.fullName,t.timezone=a.sessionStorage.timezone=o.timezone,t.billingId=a.sessionStorage.billingId=o.billingId,t.billingOu=a.sessionStorage.billingOu=o.billingOu,t.userEmail=a.sessionStorage.userEmail=o.userEmail,t.score_call=a.sessionStorage.score_call=o.score_call,t.access_audio=a.sessionStorage.access_audio=o.access_audio,t.is_migrated=a.sessionStorage.is_migrated=o.is_migrated,t.download_audio_enabled=a.localStorage.download_audio_enabled=o.download_audio_enabled,t.roleId=a.sessionStorage.roleId=o.roleId,t.protect_caller_id=a.sessionStorage.protect_caller_id=o.protect_caller_id,t.orglist=a.sessionStorage.orglist=o.orglist,a.sessionStorage.prompts=o.prompts,a.sessionStorage.voicemails=o.voicemails,a.sessionStorage.whispers=o.whispers,t.prompts=JSON.parse(o.prompts),t.voicemails=JSON.parse(o.voicemails),t.whispers=JSON.parse(o.whispers),t.reports=JSON.parse(o.reports),a.sessionStorage.reports=JSON.stringify(o.reports),o.activeConversation&&o.activeConversation>0&&(t.activeConversation=a.sessionStorage.activeConversation=o.activeConversation),t.isSafari=a.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),o.bc_ous?(t.bc_ous=JSON.parse(o.bc_ous),a.sessionStorage.bc_ous=o.bc_ous):(t.bc_ous=[{id:t.highestOUId,name:t.highestOUName},{id:null,name:null},{id:null,name:null}],a.sessionStorage.bc_ous=JSON.stringify(t.bc_ous)),void 0!==o.supportToken&&(t.supportToken=a.sessionStorage.supportToken=o.supportToken),o.style?o.style=JSON.parse(o.style):o.style={},o.style&&Object.keys(o.style).length>0?(t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.chatActive=a.sessionStorage.chatActive=o.style.chat_active):(t.chatURL=a.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",t.chatActive=a.sessionStorage.chatActive=!0),t.feedbackURL=a.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+a.sessionStorage.uservoiceSSO,t.supportURL=a.sessionStorage.supportURL="https://knowledgebase.convirza.com",o.scope&&(n.getUserAccess(JSON.parse(o.scope)),t.scope=JSON.parse(o.scope)),o.style&&void 0!==o.style.white_label_css&&Object.keys(o.style.white_label_css).length>0?r.whiteLabelCSSInject(o.style.white_label_css,o.style.org_logo,o.style.org_logo,!1):r.whiteLabelCSSInject(null,null,null,!1)):i.path("login")},updateSessData:function(e,o,i){t.currentOUId=a.sessionStorage.currentOUId=e,t.currentOUName=a.sessionStorage.currentOUName=o,t.currentOULevel=a.sessionStorage.currentOULevel=i},getSessData:function(){var e=JSON.parse(localStorage.getItem("sessionStorageData")),o=a.sessionStorage.is_from_phantom;o="true"===o,console.log("IS FROM PHANTOM : ",o),angular.isDefined(a.sessionStorage.token)||i.path("login"),!angular.isDefined(a.sessionStorage.currentOUId)||angular.isDefined(t.currentOUId)||o?!angular.isDefined(a.sessionStorage.currentOUId)&&angular.isDefined(a.sessionStorage.token)&&null!==e&&angular.isDefined(e.currentOUId)&&!o?this.getSessDataFromLocalStorage(e):!angular.isDefined(a.sessionStorage.token)||angular.isDefined(a.sessionStorage.currentOUId)||null!=e||o?angular.isDefined(a.sessionStorage.token)&&o&&(console.log("Logged in app as support admin"),this.getSessDataForReportEngine()):this.getSessDataFromBackend():this.getSessDataFromLocal()},getLoggedInSessData:function(){var e=JSON.parse(localStorage.getItem("sessionStorageData")),o=a.sessionStorage.is_from_phantom;o="true"===o,console.log("IS FROM PHANTOM : ",o),angular.isDefined(a.sessionStorage.token)&&(!angular.isDefined(a.sessionStorage.currentOUId)||angular.isDefined(t.currentOUId)||o?angular.isDefined(a.sessionStorage.token)&&null!==e&&angular.isDefined(e.currentOUId)&&!o?this.getSessDataFromLocalStorage(e):!angular.isDefined(a.sessionStorage.token)||angular.isDefined(a.sessionStorage.currentOUId)||o?angular.isDefined(a.sessionStorage.token)&&o&&(console.log("Logged in app as support admin"),this.getSessDataForReportEngine()):this.getSessDataFromBackend():this.getSessDataFromLocal(),"loggedin"==t.loginState&&(location.href="#/"))}};return n}]).controller("OrgUnitController",["$scope","OrgUnitWebService","UserWebService","VoicePromptService","$rootScope","$routeParams","$http","pinesNotifications","$timeout","$q","$compile","OrgUnitLocal","$bootbox","$uibModal","$route","$location","$window","BreadcrumbWebService","DNIWebService","CampaignWebService","TagWebService","WhisperMessageService","voicemailPromptService","progressLoader","$filter",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b,w,y,S,C,A,T){"use strict";if(void 0===e.userAccess.callaction||e.userAccess.callaction<4?e.callActionComponent=!0:e.callActionComponent=!1,void 0===e.userAccess.dni||e.userAccess.dni<4?(e.dniComponent=!1,e.dni_status=!1,e.shareDni=!1):(e.dniComponent=!0,e.dni_status=!0),void 0===e.userAccess.voicemail||e.userAccess.voicemail<4?e.voicemailComponent=!1:e.voicemailComponent=!0,console.log("ia m new Path is ",f.path()),0!=i.is_migrated&&"false"!=i.is_migrated||(console.log("Path is ",f.path()),"/set-legacy-group"==f.path()?location.href="#/set-group":f.path("/set-legacy-group")),e.triggerBoth=!1,e.noResultsTag=null,e.dniReferrer=[{value:"new",text:"Add New"},{value:"*.*|null",text:"Any"},{value:"*.bing.com|null",text:"Bing"},{value:"*.google.*|paid",text:"Google (Paid)"},{value:"*.google.*|organic",text:"Google (Organic)"},{value:"*.yahoo.com|paid",text:"Yahoo (Paid)"},{value:"*.yahoo.com|organic",text:"Yahoo (Organic)"}],e.CurrentOUName=i.currentOUName,e.showSpamButton=!1,e.showCaButton=!1,e.enableSpam=!0,e.isAdmin=!0,e.enableConvAna=!0,e.scoreAccess=!1,e.postCallIVR=!1,e.userAccess&&e.userAccess.manualscorecard&&(e.scoreAccess=!0),e.userAccess&&e.userAccess.spamguard&&(e.showSpambutton=!0,e.enableSpam=!0),e.userAccess&&e.userAccess.postcallivr>4?e.postIvrAccess=!0:e.postIvrAccess=!1,e.userAccess&&e.userAccess.ca&&!e.userAccess.blocked_recording&&(e.showCaButton=!0,e.enableConvAna=!0),1!=i.roleId&&4!=i.roleId||(e.isAdmin=!1),e.isDeleteClicked=!1,e.shareDni=!1,e.recordcheck=!0,e.voicepromt=!0,e.whisperpromt=!0,e.destination_url="*.*",e.referrer="*.*|null",e.dni_element="CVZ",e.dni_ttl1="Select",e.dni_type="",e.custom_params="",e.dniSettingPresent=!1,e.spamSettingPresent=!1,e.CASettingPresent=!1,e.callflowSettingPresent=!0,e.CSSettingPresent=!0,e.playDisclaimer="before",e.recordCall=!0,e.voicePrompt1=!1,e.whisperPrompt1=!1,e.voicePromptTTSText="",e.whisperTTSText="",e.promptAudio=void 0,e.customSource_1="custom source",e.customsource=[],e.customsource="",e.ringto="",e.oneAtATime=!1,e.rinterval=72,e.callbackid=-1,i.currentOUName.length>50)var D=i.currentOUName.slice(0,50)+" groups "+moment().format("YYYY-MM-DD"),I=i.currentOUName.slice(0,50)+" users "+moment().format("YYYY-MM-DD");else D=i.currentOUName+" groups "+moment().format("YYYY-MM-DD"),I=i.currentOUName+" users "+moment().format("YYYY-MM-DD");e.disable_share_dni=!1,e.callActions=[];var N=["CS1","CS2","CS3","CS4","CS5"];e.names="",e.canModify=!0,e.CS1=null,e.CS2=null,e.CS3=null,e.CS4=null,e.CS5=null,e.isGroupDetailsOpen=!0;var k="";function R(t){if(delete e.ruleDropDown[t.toString()],delete e.addCallAction.callActionFormSubmitted[t.toString()],console.log(e.addCallAction),$.each(e.addCallAction,function(e,o){console.log(e,o),angular.isUndefined(o)||x(o[t.toString()])||"string"==typeof o||delete o[t.toString()]}),delete e.addCallAction.action_id[t],0===e.callActions.length){e.callActions=[],e.callActions.push({id:1}),e.addCallAction.email[1]=[],e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}function F(e,t){var o;return _.each(e,function(e,a){e===t&&(o=a)}),o}function x(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function L(e){return!!/^[0-9]+$/.test(e)}e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.TTSAgentIDVoicePromptSelected=!0,e.TTSoutComePromtSelected=!0,e.TTSsalesAmountVoiceSelected=!0,e.TTSvoicemailGreetingsSelected=!0,e.customSourceModel=[],e.customSourceSettings={enableSearch:!0,showCheckAll:!1,showUncheckAll:!1,dynamicTitle:!1,scrollable:!0,scrollableHeight:200,searchField:"custom_source_name"},e.showFeatureControl=!1,e.dniTypeList=[{id:"url",text:"URL"},{id:"source",text:"Source"}],e.dniParams=function(t){m.open({templateUrl:"assets/partials/dniParams.html",controller:"DNIModelController",size:t,resolve:{canModify:function(){return!0===e.canModify},callingController:function(){}}})},e.showFeatureControl=!1,e.openFeatureSection=function(o){o&&t.getFeatureSettings(i.currentOUId).then(function(t){if(e.showFeatureControl=!0,"success"===t.data.status){var o=t.data.json;o.defaultData.length>0?(e.enableConvAna=o.defaultData[0].conversation_analytics_status,e.enableSpam=o.defaultData[0].spam_guard_status,!0===e.dniComponent?e.shareDni=o.defaultData[0].share_with_subgroup:e.shareDni=!1,e.disable_share_dni=o.defaultData[0].disable_share_dni,e.share_group_name=o.defaultData[0].share_group_name,e.location_level_ou=o.defaultData[0].location_level_ou,e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1)):e.showSpambutton||(e.enableSpam=!1),$(".featureSettingProgressLoader").hide(),$("#featureSettingProgressLoader").css("opacity","1")}})},e.getGroupsHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","Industry","Phone","City","State/Province","Zip/Postal Code","Enable Conversation Analytics","Enable Spam Guard","Share DNI Settings","Host Domain","Referring Website","HTML Class","Repeat Interval (in hours)","Call Value","Activate Voicemail","Voicemail number of rings","Overflow number of rings","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Record Call","Call Recording Disclaimer","Voice Prompt","Whisper Message","Ring-to Phone Number","Instant Insights","Instant Insights Configuration","Call Actions"]},e.getCSVGroupData=function(o,a){var r="Export Groups";"csv"===o&&"both"===a&&(e.triggerBoth=!0,$("#userCSVExport").trigger("click"),r="Export Groups & Users"),s.notify({title:r,text:"Download is in process, it will be completed in few minutes",type:"info"}),e.groupsReportFileName=D+"."+o,A.start();var n={},l=c.defer();if(t.getGroupsExportReport(e.userAccess.orgunit,i.currentOUId).then(function(t){if("error"!=t.data.json){n=t.data.json;for(var a=[],r=0;r<n.length;r++){var s=n[r].phone;null!==s&&(s=s.replace("(","").replace(")","").replace(" ","").replace("-","").trim()),!1===n[r].record_call&&(n[r].call_recording_disclaimer=""),a.push({a:n[r].account,b:n[r].account_ouid,c:n[r].account_external_id,d:n[r].parent_group,e:n[r].parent_group_ouid,f:n[r].parent_group_external_id,g:n[r].group,h:n[r].group_ouid,i:n[r].group_external_id,j:n[r].industry,k:s,l:n[r].city,m:n[r].state_province,n:n[r].zip_postal_code,o:n[r].enable_conversation_analytics,p:n[r].enable_spam_guard,r:n[r].share_dni_settings,rr:n[r].host_domain,s:n[r].referring_website,t:n[r].html_class,u:n[r].repeat_interval,v:n[r].call_value,w:n[r].activate_voicemail,x:n[r].voicemail_rings,y:n[r].overflow_rings,z:n[r].custom_source_name1,aa:n[r].custom_source_name2,ab:n[r].custom_source_name3,ac:n[r].custom_source_name4,ad:n[r].custom_source_name5,ae:n[r].record_call,af:n[r].call_recording_disclaimer,ag:n[r].voice_prompt,ah:n[r].whisper_message,ai:n[r].ring_to_number,aj:n[r].is_post_call_ivr_enabled,ak:n[r].post_call_ivr_option,al:n[r].call_action})}if(A.set(50),l.resolve(a),!i.isSafari)return A.end(),l.promise;l.resolve(JSONToCSVConvertor(a,e.groupsReportFileName,!0,o))}}),!i.isSafari)return A.end(),l.promise},e.getUsersHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","First Name","Last Name","Email","External Id","Agent Ring-to","Agent ID","Role","Status","Access Audio","Score Calls","Group Access","Reporting Access"]},e.getCSVUserData=function(o,a){console.log(e.triggerBoth),e.triggerBoth||s.notify({title:"Export Users",text:"Download is in process, it will be completed in few minutes",type:"info"}),e.triggerBoth=!1,e.usersReportFileName=I+"."+o,A.start();var r={},n=c.defer();if(t.getUsersExportReport(e.userAccess.orgunit,i.currentOUId).then(function(e){if("error"!=e.data.json){r=e.data.json;for(var t=[],a=0;a<r.length;a++)t.push({a:r[a].account,b:r[a].account_ouid,c:r[a].account_external_id,d:r[a].parent_group,e:r[a].parent_group_ouid,f:r[a].parent_group_external_id,g:r[a].group,h:r[a].group_ouid,i:r[a].group_external_id,j:r[a].first_name,k:r[a].last_name,l:r[a].email,m:r[a].user_ext_id,n:r[a].agent_ring_to,o:r[a].agent_id,p:r[a].role,q:r[a].status,r:r[a].access_audio,s:r[a].score_call,t:r[a].group_access,u:r[a].report_access});if(A.set(50),n.resolve(t),!i.isSafari)return A.end(),n.promise;n.resolve(JSONToCSVConvertor(t,usersReportFileName,!0,o))}}),!i.isSafari)return A.end(),n.promise},i.$on("$locationChangeSuccess",function(){O()}),e.saveDefaultGroupSetting=function(){e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1);var o={defaultData:{org_unit_id:e.currentOUId,conversation_analytics_status:e.enableConvAna,spam_guard_status:e.enableSpam,share_with_subgroup:e.shareDni}};t.saveDefaultGroupSetting(o).then(function(e){"error"===e.data.result?s.notify({title:"Default Feature Settings",text:e.data.err,type:"error"}):s.notify({title:"Default Feature Settings",text:"Successfully Saved The Feature Settings",type:"success"})})},e.enableSave=function(t){"tag_call"===e.addCallAction.actionOptions[t]&&(e.callActionLoaded||(e.addCallAction.callActionFormSubmitted[t]=!1),e.callActionLoaded=!1)},e.showRemoveRule=function(e){var t=0;return $.each(e,function(e,o){x(o)||(t+=1)}),t>1},e.sizeOf=function(e){return Object.keys(e).length},e.setDefaultCallAction=function(t){e.addCallAction.actionOptions[t]="action0";var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[t]={0:{fields:Object.keys(o)}},e.addCallAction.rule[t]={0:{fields:"",operators:"",enum:"",join_type:""}},e.addCallAction.email[t]=[],e.addCallAction.remainingText[t]="1024 characters are remaining",e.addCallAction.phone[t]=[],e.addCallAction.tagList[t]=[],e.addCallAction.postEvent[t]=[],e.addCallAction.webhook[t]=[]},e.removeSelectedWhisperAudio=function(){void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,e.whisperURL=void 0,e.whisperTTSText="",e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!1},e.loadCallActionSection=function(o){if(o){var a="",i=1,r={};t.getCallActions(e.currentOUId).then(function(t){if(e.callActionLoaded=!0,"error"!=t.data.result&&t.data.json.length>0&&t.data.json[0].rules.length>0&&(e.callActions=[],t.data.json.forEach(function(t){e.addCallAction.rule[t.action_order]={},e.ruleDropDown[t.action_order]={};var o=Object.assign({},e.names.fields);switch(delete o["Ring to Phone Number"],t.rules.forEach(function(i,r){a="duration"==F(o,i.data_field)?"="==i.operator?"=":"!="==i.operator?"!=":F(e.names.Ct_operators_based_on_fields,i.operator):F(e.names.Ct_operators_based_on_fields,i.operator),"NONE"==i.join_type&&(i.join_type=""),"contains"!==i.operator&&"does not contain"!==i.operator&&"begins with"!==i.operator&&"ends with"!==i.operator||(a=i.operator),e.addCallAction.rule[t.action_order][r]={},e.ruleDropDown[t.action_order][r]={},e.addCallAction.rule[t.action_order][parseInt(r)+1]={},e.ruleDropDown[t.action_order][parseInt(r)+1]={},e.ruleDropDown[t.action_order][r].fields=Object.keys(o),e.ruleDropDown[t.action_order][r].operators=e.names.operators[F(o,i.data_field)],e.ruleDropDown[t.action_order][r].enum=e.names.enum[F(o,i.data_field)],e.ruleDropDown[t.action_order][r].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(r)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][r].fields=F(o,i.data_field),e.addCallAction.rule[t.action_order][r].operators=a,e.addCallAction.rule[t.action_order][r].enum=i.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][r].join_type=i.join_type,e.addCallAction.rule[t.action_order][parseInt(r)+1].join_type=""}),r={id:t.action_order},t.action){case"email_alert":for(var n=[],s=t.action_target.split(","),l=0;l<s.length;l++){var c={id:i,text:s[l]};n.push(c),i++}var d=t.action_target.replace(/,/g,"");d=d.replace(/ /g,""),e.addCallAction.remainingText[t.action_order]=1024-d.length+" characters are remaining",e.addCallAction.email[t.action_order]=n;break;case"sms_alert":e.addCallAction.phone[t.action_order]=t.action_target;break;case"tag_call":var u=[];t.action_target=t.action_target.split(","),angular.forEach(t.action_target,function(e,t){var o=e.trim();u.push(o)}),e.addCallAction.tagList[t.action_order]=u;break;case"post_event":e.addCallAction.postEvent[t.action_order]=t.action_target;break;case"webhook":e.addCallAction.webhook[t.action_order]=t.action_target;break;case"post_detail":e.addCallAction.sendCallDetails[t.action_order]=t.action_target;break;case"callback":e.addCallAction.callbackFlag[t.action_order]=t.action_target}e.addCallAction.action_id[t.action_order]=t.default_action_id,e.addCallAction.actionOptions[t.action_order]=t.action,"doubleclick"===t.action&&!1===e.dcSetting&&(e.addCallAction.actionOptions[t.action_order]=""),e.addCallAction.callActionFormSubmitted[t.action_order]=!0,e.callActions.push(r)})),x(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],console.log("target",o),e.ruleDropDown[1]={0:{fields:Object.keys(o)}},console.log(" $scope.ruleDropDown[1]",e.ruleDropDown[1]),e.addCallAction.email[1]=[],e.addCallAction.remainingText[1]="1024 characters are remaining",e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}$(".callActionSectionProgressLoader").hide(),$("#callActionSectionProgressLoader").css("opacity","1")})}},e.loadCallActions=function(o){e.addNewStep=!0,void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.showCallActions=!0;e.callActions=[],e.callActions.push({id:1}),e.addCallAction={},e.addCallAction.cfname="Test",e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.addCallAction.callActionFormSubmitted={},e.addCallAction.remainingText={},e.callActionTaggingOptions=[],e.customsources={},e.callActionWebhookOptions=[],e.ruleDropDown={},e.callActionLoaded=!1,t.getWebhooks(i.currentOUId).then(function(t){if(null===t.data.err||""===t.data.err){for(var o=[],a=0;a<t.data.json.length;a++)"active"===t.data.json[a].webhook_status&&o.push(t.data.json[a]);e.callActionWebhookOptions=o}}),y.getTags().then(function(t){if(console.log("tags:",t),""===t.data.err){e.callActionTaggingOptionsWatch=!1,e.callActionTaggingOptions=t.data.json;for(var o=0;o<t.data.json.length;o++)"callback"===t.data.json[o].tag_name&&(e.callbackid=t.data.json[o].tag_id);if(e.callbackid<0){var a={tag:{tag_name:"callback",org_unit_id:i.currentOUId}};w.createTag(a).then(function(e){console.log(e)})}}}),e.gaSetting=!0,w.getAnalytics().then(function(t){""===t.data.err&&t.data.json.length>0&&(t.data.json[0].all_routes||"inactive"===t.data.json[0].analytic_status)&&(e.gaSetting=!1)}),e.dcSetting=!1,w.callActionDC(i.currentOUId).then(function(t){"success"===t.data.result&&t.data.json.dc_enabled&&(console.log("Setting dcSetting to true"),e.doubleclick_id=t.data.json.doubleclick_id,e.dcSetting=!0)})},e.select2OptionsCS1={formatNoMatches:function(t){e.formatNoMatchesType="CS1",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS2={formatNoMatches:function(t){e.formatNoMatchesType="CS2";var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS3={formatNoMatches:function(t){e.formatNoMatchesType="CS3",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS4={formatNoMatches:function(t){e.formatNoMatchesType="CS4",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS5={formatNoMatches:function(t){e.formatNoMatchesType="CS5",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.postCallIVR_status="",e.outComePromtTTSText="",e.salesAmountVoiceTTSText="",e.call_Value="3",e.activate_voicemail_status=!1,e.dni_status=!1,e.voicemailGreetingsTTSText="",e.voicemail_rings_count="3",e.overflow_rings_count="3",e.AgentIDVoicePromptTTSText="",e.postIVRTypes=[{name:"Call Outcome (Conversion type)",value:1},{name:"Agent ID",value:2},{name:"Call Outcome and Agent ID",value:3}],e.postIVRType=e.postIVRTypes[0].value,e.dniChange=function(){e.dni_status||(e.destination_url="*.*",e.dni_element="CVZ_"+e.random6DigitNumber,e.dni_ttl="Select",e.dni_type="")},e.saveDefaultCallFlowSetting=function(){angular.element("#rinterval").removeClass("ng-invalid ng-dirty"),angular.element("#rinterval").addClass("ng-valid"),angular.element("#ringtonumber").removeClass("ng-invalid ng-dirty"),angular.element("#ringtonumber").addClass("ng-valid"),t.getDefaultCustomParams(i.currentOUId).then(function(t){"success"===t.data.status&&(e.custom_params=t.data.json[0].custom_params,console.log("Custom Param Source",e.custom_params))});var a,r,n=[],l=!1,c="",d="",u=null,p=null,m="",g="";e.TTSSelected?a=e.voicePromptTTSText:(a="file://"+e.voicePromptFileName,m=e.voicePromptText,c=e.voiceURL,u=e.voicePromptId),e.TTSWhisperSelected?r=e.whisperTTSText:(r="file://"+e.whisperFileName,g=e.whisperText,d=e.whisperURL,p=e.whisperId),r=void 0===r?"":r,_.each(N,function(t){null!==e[t]&&e[t].length>0&&n.push(parseInt(e[t]))});var f="";f=e.TTSvoicemailGreetingsSelected?e.voicemailGreetingsTTSText:"file://"+e.voicemailsFileName;!function(){var t="text",o="text",a="text",i=e.outComePromtTTSText,r=e.salesAmountVoiceTTSText,n=e.AgentIDVoicePromptTTSText,s=e.lengthOfAgentId;e.TTSoutComePromtSelected||(t="file",i="file://"+e.outComePromtFileName);e.TTSsalesAmountVoiceSelected||(o="file",r="file://"+e.salesAmountVoicePromptFileName);e.TTSAgentIDVoicePromptSelected||(a="file",n="file://"+e.AgentIDVoicePromptFileName);switch(e.postIVRType){case 1:e.postIVRData={postCallIvrEnable:e.postCallIVR,type:"conversion",post_call_ivr_id:1,prompts:[{type:"record_call_outcome",msgType:t,promt:i},{type:"record_a_sale",msgType:o,promt:r}]};break;case 2:e.postIVRData={postCallIvrEnable:e.postCallIVR,type:"agentID",post_call_ivr_id:2,prompts:[{type:"record_agent_id",msgType:a,noOfDigits:s,promt:n}]};break;case 3:e.postIVRData={postCallIvrEnable:e.postCallIVR,type:"conversionAgentID",post_call_ivr_id:3,prompts:[{type:"record_agent_id",msgType:a,noOfDigits:s,promt:n},{type:"record_call_outcome",msgType:t,promt:i},{type:"record_a_sale",msgType:o,promt:r}]}}}();if(e.referrer){var h=e.referrer.split("|");e.tempReferrer=h[0],e.referrer_type=h[1]}else e.tempReferrer="";e.referrer_type||(e.referrer_type=null);var v={callFlowData:{org_unit_id:e.currentOUId,call_Value:e.call_Value,activate_voicemail_status:e.activate_voicemail_status,voicemail_rings_count:e.voicemail_rings_count,voicemail_greeting_message:f,overflow_rings_count:e.overflow_rings_count,dni_status:e.dni_status,call_flow_recording_id:null,recordcall:e.recordCall,play_voice_prompt:e.voicePrompt1,play_whisper_message:e.whisperPrompt1,prompt_message:a,whisper_message:r,play_disclaimer:!0===e.recordCall?e.playDisclaimer:"before",repeat_interval_call:e.rinterval,voice_prompt_url:c,whisper_message_url:d,whisper_id:p,voice_prompt_id:u,whisper_message_name:g,prompt_message_name:m},dniSettingData:{org_unit_id:e.currentOUId,destination_url:e.destination_url,dni_type:e.dni_type,dni_element:e.dni_element,referrer:e.tempReferrer,referrer_type:e.referrer_type,ttl:e.dni_ttl,custom_params:e.custom_params},postCallIvrValue:e.postIVRData};e.ringtoNum&&(v.callFlowData.ringto=o.unMaskData(e.ringtoNum.toString())),void 0!==v.callFlowData.repeat_interval_call&&(v.callFlowData.repeat_interval_call>8760||0===v.callFlowData.repeat_interval_call)&&(l=!0,s.notify({title:"Tracking Number Settings",text:"Repeat Interval is invalid",type:"error"})),v.callFlowData.ringto&&v.callFlowData.ringto.length<=9&&(l=!0,angular.element("#ringtonumber").addClass("ng-invalid ng-dirty"),angular.element("#ringtonumber").removeClass("ng-valid"),s.notify({title:"Tracking Number Settings",text:"Ring-to Phone Number is invalid",type:"error"})),n.length>0&&(v.customSourceData={ids:n}),e.voicePrompt1&&!a&&(l=!0,s.notify({title:"Tracking Number Settings",text:"Voice Prompt field is required",type:"error"})),e.whisperPrompt1&&!r&&(l=!0,s.notify({title:"Tracking Number Settings",text:"Whisper Message field is required",type:"error"}));var b=t.validateDniData(v.dniSettingData,e.dni_status,e.showReferrerTextBox);return b.arrRequired.length?(e.showSaveButton(),void s.notify({title:"Default Tracking Number Settings",text:"'"+_.uniq(b.arrRequired).join(","),type:"error"})):b.arrInvalidMessage.length?(e.showSaveButton(),void s.notify({title:"Default Tracking Number Settings",text:"'"+_.uniq(b.arrInvalidMessage).join(","),type:"error"})):void(l||t.defaultCreateCallFlow(v).then(function(t){e.custom_params=v.dniSettingData.custom_params,"error"===t.data.result?s.notify({title:"Default Tracking Number Settings",text:t.data.err,type:"error"}):s.notify({title:"Default Tracking Number Settings",text:"Successfully Saved Tracking Number Settings",type:"success"})}))},e.openTrackingNumberSection=function(o){var a="";e.random6DigitNumber=Math.floor(9e5*Math.random()+1e5),console.log("RandomNumber: ",e.random6DigitNumber),o&&t.getCallFlow(i.currentOUId).then(function(t){if("success"===t.data.status){if(t.data.json.callFlowData.length>0){var o=t.data.json.callFlowData[0],r=(b=t.data.json.callFlowData[0].play_voice_prompt_first_text).substring(0,7);e.prompts=[];for(var n=0;n<i.prompts.length;n++)1==i.prompts[n].active&&e.prompts.push(i.prompts[n]);if(e.voicePrompt1=o.play_voice_prompt_first,"file://"==r){var s="";b=b.substring(b.lastIndexOf("/")+1,b.length);for(var l=0;l<i.prompts.length;l++){i.prompts[l].filename==b&&(s=i.prompts[l],e.TTSSelected=!1,e.hasValidVoiceURL=!0)}e.voicePromptText=s.name,e.voiceURL=s.url,e.voicePromptFileName=s.filename,e.voicePromptId=s.id}else e.voicePromptTTSText=b,e.TTSSelected=!0;var c=t.data.json.callFlowData[0].play_whisper_message_text,d=c.substring(0,7);e.whispers=[];for(n=0;n<i.whispers.length;n++)1==i.whispers[n].active&&e.whispers.push(i.whispers[n]);if(e.whisperPrompt1=o.play_whisper_message,"file://"==d){var u="";c=c.substring(c.lastIndexOf("/")+1,c.length);for(l=0;l<i.whispers.length;l++){i.whispers[l].filename==c&&(u=i.whispers[l],e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0)}e.whisperText=u.name,e.whisperURL=u.url,e.whisperFileName=u.filename,e.whisperId=u.id}else e.TTSWhisperSelected=!0,e.whisperTTSText=c;var p=t.data.json.callFlowData[0].voicemail_greeting_message?t.data.json.callFlowData[0].voicemail_greeting_message:"",m=p.substring(0,7);e.voicemails=[];for(n=0;n<i.voicemails.length;n++)1==i.voicemails[n].active&&e.voicemails.push(i.voicemails[n]);if(!0===e.voicemailComponent&&e.voicemails.length>0&&null!==p){var g=(b=p.split("//"))[1],f="",h="";if("file://"==m){for(l=0;l<i.voicemails.length;l++){i.voicemails[l].filename==g&&(i.voicemails[l].filename,f=i.voicemails[l].name,h=i.voicemails[l].url,e.TTSvoicemailGreetingsSelected=!1,e.hasValidVoicemailURL=!0)}e.voicemailsTTSText=f,e.voicemailsFileName=g,e.voicemailurl=h,e.voicemailsId=o.ce_call_flow_recording_id}else e.TTSvoicemailGreetingsSelected=!0,e.voicemailGreetingsTTSText=p}else e.activate_voicemail_status=!1,e.TTSvoicemailGreetingsSelected=!0,"file://"!=m&&(e.voicemailGreetingsTTSText=!t.data.json.callFlowData||null!==t.data.json.callFlowData[0].voicemail_greeting_message&&void 0!==t.data.json.callFlowData[0].voicemail_greeting_message?t.data.json.callFlowData[0].voicemail_greeting_message:""),e.voicemail_rings_count="3";e.call_Value=t.data.json.callFlowData[0].call_value,t.data.json.callFlowData[0].activate_voicemail?e.activate_voicemail_status=0!=e.voicemailComponent&&t.data.json.callFlowData[0].activate_voicemail:e.activate_voicemail_status=!1,t.data.json.callFlowData[0].voicemail_rings?e.voicemail_rings_count=t.data.json.callFlowData[0].voicemail_rings.toString():e.voicemail_rings_count="3",t.data.json.callFlowData[0].overflow_rings?e.overflow_rings_count=t.data.json.callFlowData[0].overflow_rings.toString():e.overflow_rings_count="3",!0===e.dniComponent?e.dni_status=t.data.json.defOrgComponentStatus[0].dni_status:e.dni_status=!1,void 0!==e.userAccess.postcallivr&&e.userAccess.postcallivr>4?e.postCallIVR=t.data.json.defOrgComponentStatus[0].postcallivr_status:e.postCallIVR=!1,e.recordCall=t.data.json.callFlowData[0].record_call,e.ringtoNum=t.data.json.callFlowData[0].ring_to_number,e.playDisclaimer=t.data.json.callFlowData[0].play_disclaimer,e.rinterval=t.data.json.callFlowData[0].repeat_interval_call}if(void 0!==e.userAccess.postcallivr&&e.userAccess.postcallivr>4&&t.data.json.postCallIVR&&t.data.json.postCallIVR.length>0){var v=t.data.json.postCallIVR;e.postIVRType=t.data.json.postCallIVR[0].post_call_ivr_option_id;for(n=0;n<v.length;n++)switch(v[n].voice_prompt){case"record_call_outcome":r=(b=v[n].voice_prompt_value).substring(0,7);if(e.TTSoutComePromtSelected=!0,"file://"==r){s="";b=b.substring(b.lastIndexOf("/")+1,b.length);for(l=0;l<i.prompts.length;l++){i.prompts[l].filename==b&&(s=i.prompts[l],e.TTSoutComePromtSelected=!1,e.hasValidoutComePromtURL=!0)}e.outComePromtText=s.name,e.outComePromtURL=s.url,e.outComePromtFileName=s.filename,e.outComePromtId=s.id}else e.TTSoutComePromtSelected=!0,e.outComePromtTTSText=b;break;case"record_a_sale":r=(b=v[n].voice_prompt_value).substring(0,7);if(e.TTSsalesAmountVoiceSelected=!0,"file://"==r){s="";b=b.substring(b.lastIndexOf("/")+1,b.length);for(l=0;l<i.prompts.length;l++){i.prompts[l].filename==b&&(s=i.prompts[l],e.hasValidsalesAmountVoiceURL=!0,e.TTSsalesAmountVoiceSelected=!1)}e.salesAmountVoicePromptText=s.name,e.salesAmountVoiceURL=s.url,e.salesAmountVoicePromptFileName=s.filename,e.salesAmountVoiceId=s.id}else e.TTSsalesAmountVoiceSelected=!0,e.salesAmountVoiceTTSText=b;break;case"record_agent_id":var b=v[n].voice_prompt_value;e.lengthOfAgentId=JSON.stringify(v[n].number_of_digits);r=b.substring(0,7);if(e.TTSAgentIDVoicePromptSelected=!0,"file://"==r){s="";b=b.substring(b.lastIndexOf("/")+1,b.length);for(l=0;l<i.prompts.length;l++){i.prompts[l].filename==b&&(s=i.prompts[l],e.TTSAgentIDVoicePromptSelected=!1,e.hasValidAgentIDVoicePromptURL=!0)}e.AgentIDVoicePromptText=s.name,e.AgentIDVoicePromptURL=s.url,e.AgentIDVoicePromptFileName=b}else e.TTSAgentIDVoicePromptSelected=!0,e.AgentIDVoicePromptTTSText=b}}else e.postIVRType=1,e.TTSoutComePromtSelected=!0,e.outComePromtTTSText="",e.TTSsalesAmountVoiceSelected=!0,e.salesAmountVoiceTTSText="",e.TTSAgentIDVoicePromptSelected=!0,e.AgentIDVoicePromptTTSText="",e.lengthOfAgentId="3";if(t.data.json.customSourceData.length>0&&_.each(t.data.json.customSourceData,function(t){e[t.custom_source_type]=t.custom_source_id.toString()}),t.data.json.dniSettingData.length>0){var w=t.data.json.dniSettingData[0].referrer;t.data.json.dniSettingData[0].referrer_type&&(w+="|"+t.data.json.dniSettingData[0].referrer_type),T("filter")(e.dniReferrer,w,!0).length<1&&e.dniReferrer.push({value:w,text:t.data.json.dniSettingData[0].referrer});var y=t.data.json.dniSettingData[0].referrer;t.data.json.dniSettingData[0].referrer_type&&(y+="|"+t.data.json.dniSettingData[0].referrer_type),e.dni_section=!1,e.dniSettingPresent=!0,e.destination_url=t.data.json.dniSettingData[0].destination_url,e.dni_type=t.data.json.dniSettingData[0].dni_type,e.dni_element=t.data.json.dniSettingData[0].dni_element,e.referrer=y,e.referrer_type=t.data.json.dniSettingData[0].referrer_type,e.dni_ttl=t.data.json.dniSettingData[0].ttl,e.custom_params=t.data.json.dniSettingData[0].custom_params}else console.log(e.dni_element),console.log("RandomNumber: ",e.random6DigitNumber),e.random6DigitNumber!==e.lastRandom&&(a=e.dni_element,console.log(a),"CVZ"===a&&(a+="_"+e.random6DigitNumber)),e.dni_element=a,console.log("Dni Element: ",e.dni_element),e.lastRandom=e.random6DigitNumber,console.log("Last Random: ",e.lastRandom);$(".trackingNumberProgressLoader").hide(),$("#trackingNumberProgressLoader").css("opacity","1")}})},e.openCustomeSourceSection=function(o){o&&t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5,$(".coustomSourceProgressLoader").hide(),$("#coustomSourceProgressLoader").css("opacity","1")})},e.multipleDelete=function(){console.log("inside multipleDelete custom_source_id"),console.log("$scope.customSourceModel",e.customSourceModel);var o=_.pluck(e.customSourceModel,"id"),a="";a+="Custom Source is associated with a tracking number. Are you sure you want to delete this Custom Source?",p.confirm(a,function(a){a&&(t.multiDeleteCustomSource({custom_sources:o}).then(function(o){console.log("delete result",o),s.notify({title:"Default Custom Source Settings",text:"Successfully deleted the custom source",type:"success"}),t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5;o=t.data.json;console.log("customSourceData==",o),o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5})}),e.customSourceModel=[])})},e.clearCustomSources=function(){e.customSourceModel=[]},_.each(N,function(t){e["customSourceMethods"+t]={onAddItem:function(o){e.addCustomSource(o,t)}}}),e.addCustomSource=function(o,a){var i={customSource:{custom_source_name:o,org_unit_id:e.currentOUId,custom_source_type:a}};t.customSource(i).then(function(o){o.data.json;""===o.data.err?(s.notify({title:"Default Custom Source Settings",text:"Successfully Created Custom Source",type:"success"}),void 0===e.customsources[e.formatNoMatchesType]&&(e.customsources[e.formatNoMatchesType]=[]),e.customsources[e.formatNoMatchesType].push({id:o.data.json.custom_source_id,name:e.noResultsTag}),t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5})):s.notify({title:"Update custom source",text:o.data.err,type:"error"})})},e.resetFeatureSetting=function(){e.enableConvAna=!0,e.enableSpam=!0,e.shareDni=!1,e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1),(e.disable_share_dni||e.location_level_ou)&&(e.shareDni=!1)},e.resetCallFlowSetting=function(t){e.rinterval=72,e.CS1=null,e.CS2=null,e.CS3=null,e.CS4=null,e.CS5=null,e.playDisclaimer="before",e.recordCall=!0,e.voicePrompt1=!1,e.whisperPrompt1=!1,e.ringtoNum=null,angular.element("#ringtonumber").removeClass("ng-invalid ng-dirty"),e.voicePromptTTSText="",e.whisperTTSText="",e.TTSSelected=!0,e.TTSWhipserSelected=!0,e.destination_url="*.*",e.referrer="*.*|null",console.log("Previous:",e.dni_element),e.dni_element="CVZ_"+e.random6DigitNumber,console.log("Current:",e.dni_element),e.dni_ttl="Select",e.dni_type="",e.custom_params="",e.showReferrerTextBox=!1,e.call_Value=null,e.activate_voicemail_status=!1,e.voicemail_rings_count="3",e.voicemailGreetingsTTSText="",e.overflow_rings_count="3",e.dni_status=!1,e.postCallIVR=!1,e.postIVRType=1,e.outComePromtTTSText="",e.salesAmountVoiceTTSText="",e.AgentIDVoicePromptTTSText="",e.lengthOfAgentId="",e.outComePromtAudio=void 0,e.outComePromtText="",e.outComePromtURL=void 0,e.TTSoutComePromtSelected=!0,e.hasValidoutComePromtURL=!1,e.salesAmountVoiceAudio=void 0,e.salesAmountVoicePromptText="",e.salesAmountVoiceURL=void 0,e.TTSsalesAmountVoiceSelected=!0,e.hasValidsalesAmountVoiceURL=!1,e.AgentIDVoicePromptAudio=void 0,e.AgentIDVoicePromptText="",e.AgentIDVoicePromptURL=void 0,e.TTSAgentIDVoicePromptSelected=!0,e.hasValidAgentIDVoicePromptURL=!1,e.greetingAudio=void 0,e.voicemailGreetingsTTSText="",e.voicemailurl=void 0,e.TTSvoicemailGreetingsSelected=!0,e.hasValidVoicemailURL=!1},e.loadNextValue=function(t,o,a,i){if("fields"==o){var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],e.ruleDropDown[a][i][o]=Object.keys(r)}else"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum=""));"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="")},e.removeRule=function(t,o){var a,i=Object.keys(e.addCallAction.rule[o]).map(function(e){return e});a=i.indexOf(t)===i.length-1,e.addCallAction.callActionFormSubmitted[o]=!1,delete e.ruleDropDown[o][t],delete e.addCallAction.rule[o][t];var r=Object.keys(e.ruleDropDown[o]).map(function(e){return e});if("join_type"===Object.keys(e.ruleDropDown[o][r[0]]).map(function(e){return e})[0]){if(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields){var n=Object.assign({},e.names.fields);delete n["Ring to Phone Number"],e.ruleDropDown[o]={0:{fields:Object.keys(n)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else""!==e.addCallAction.rule[o][r[0]].join_type&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type);a&&(e.addCallAction.rule[o][t]={},e.ruleDropDown[o][t]={},e.addCallAction.rule[o][t].join_type="",e.ruleDropDown[o][t].join_type=["AND","OR"])},e.select2Options=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-click="addTag(term)">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.trim()==t[r].text.trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="addTag(term);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return t},simple_tags:!0,allowClear:!0}},e.addTag=function(t){if(_.where(e.callActionTaggingOptions,{tag_name:this.noResultsTag.trim()}).length>0)return s.notify({title:"Update Tags",text:"This Tag already exists",type:"error"}),!1;var o={tag:{tag_name:e.noResultsTag.trim(),org_unit_id:i.currentOUId}};$(".select2-drop").hide(),w.createTag(o).then(function(t){e.callActionTaggingOptionsWatch=!0,""===t.data.err&&(s.notify({title:"Create Tags",text:"Successfully added the tag",type:"success"}),e.callActionTaggingOptions.push({tag_id:t.data.json.tag_id,tag_name:e.noResultsTag.trim(),org_unit_id:i.currentOUId}))})},e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&l(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.countElement=function(t,o){var a=[],i=e.addCallAction.email[t];if(void 0!==i){for(var r=0;r<i.length;r++)a.push(i[r].text);var n=a.join(",");n=n.replace(/,/g,"").replace(/ /g,""),e.addCallAction.remainingText[t]=1024-n.length+" characters are remaining",e.addCallAction.callActionFormSubmitted[t]=!1}},e.saveCallAction=function(o,a){var i=[],r=[],n={},l=1,c=1;e.errorEmail="",e.invalidNumber=!1,e.errors={},e.errors[o]={},e.invalidEmailIds=[];var d,u={id:(o=parseInt(o))+1};switch(e.addCallAction.actionOptions[o]){case"email_alert":var p=[];void 0===(n=e.addCallAction.email[o])&&(n=[]);for(var m=0;m<n.length;m++){angular.isUndefined(n[m].text)||!n[m].text.length||/^[_a-zA-Z0-9]*['a-zA-Z0-9]*[-a-zA-Z0-9]*[\.a-zA-Z0-9]*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})*(\.[a-zA-Z]{2,4})/.test(n[m].text.trim())||(i.push(n[m].text),e.invalidEmailIds.push(n[m].text)),p.push(n[m].text.trim())}var g=_.uniq(p).join(",");(g=g.replace(/,/g,"")).length>1024&&(e.errorEmail="No of characters should not be greater than 1024"),n=_.uniq(p),e.addCallAction.email[o]=[];for(var f=Math.floor(1e3+9e3*Math.random()),h=0;h<n.length;h++){var v={id:h+1+f,text:n[h]};e.addCallAction.email[o].push(v)}e.addCallAction.remainingText[o]=1024-g.length+" characters are remaining";break;case"sms_alert":var b=angular.copy(e.addCallAction.phone[o]);if(b)10!=b.replace(/[()_\-\s]/gi,"").length&&(e.invalidNumber=!0,i.push("Phone Number"));n=e.addCallAction.phone[o];break;case"tag_call":n=e.addCallAction.tagList[o];break;case"post_event":n=e.addCallAction.postEvent[o];break;case"webhook":n=e.addCallAction.webhook[o];break;case"post_detail":n=e.addCallAction.sendCallDetails[o];break;case"callback":n=e.callbackid.toString();break;case"doubleclick":n=void 0!==e.doubleclick_id?e.doubleclick_id:null;break;case"analytic":n=null}if(angular.isArray(n)&&(n=n.join(", ")),x(e.addCallAction.rule[o])&&1===c&&(r.push("Rule"),c+=1),_.each(e.addCallAction.rule[o],function(t,a){(!x(t)&&void 0!==t.fields||!x(t)&&!x(t.join_type))&&((x(t.fields)||x(t.enum)||x(t.operators))&&(x(t.enum)&&(e.errors[o][a]=!0),1===c&&(r.push("Rule"),c+=1)),x(t.enum)||"referring source"!=t.fields||"contains"!=t.operators&&"does not contain"!=t.operators||(t.enum.startsWith("*.")||t.enum.endsWith(".*"))&&(1===l&&(i.push("WildCard only Support With is/is not for referring source."),l+=1),e.errors[o][a]=!0),x(t.enum)||("duration"==t.fields&&!L(t.enum)||"caller id"==t.fields&&(!L(t.enum)||t.enum.length>10))&&(1===l&&(i.push("Rule Value"),l+=1),e.errors[o][a]=!0))}),angular.isArray(n)?x(n)&&r.push("Action"):""!==n&&void 0!==n||r.push("Action"),"action0"==e.addCallAction.actionOptions[o]&&r.push("Action Target"),r.length||i.length||e.errorEmail.length)return r.length&&(d="Field Is Required.",r.length>1&&(d="Fields Are Required."),s.notify({title:"Default Call Action Settings",text:"'"+r.join(", ")+"' "+d,type:"error"})),e.errorEmail.length>0&&s.notify({title:"Default Call Action Settings",text:e.errorEmail,type:"error"}),e.invalidEmailIds.length>0?(d="Invalid email address entered. Please fix highlighted errors and re-save",s.notify({title:"Default Call Action Settings",text:"'"+e.invalidEmailIds.join(", ")+"' "+d,type:"error"})):i.length&&(d="Field Is Invalid.",i.length>1&&(d="Fields Are Invalid."),s.notify({title:"Default Call Action Settings",text:"'"+i.join(", ")+"' "+d,type:"error"})),$(".invalidTag").closest("li").addClass("invalidList"),i=[],r=[],!1;var w={provisioned_route_id:e.addCallAction.provisioned_route_id,default_action_id:e.addCallAction.action_id[o],action_order:o,rules:function(t){var o=[],a="";for(var i in t){"contains"===t[i].operators||"does not contain"===t[i].operators||"begins with"===t[i].operators||"ends with"===t[i].operators?t[i].operators:e.names.Ct_operators[t[i].operators],a="NONE",t[i].join_type.length&&(a=t[i].join_type),t[i].fields&&o.push({data_field:e.names.fields[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a})}return o}(e.addCallAction.rule[o]),action:e.addCallAction.actionOptions[o],action_target:n,org_unit_id:e.currentOUId};e.addNewStep=!1,void 0===w.default_action_id?t.saveCallActions(w).then(function(t){if(e.addNewStep=!0,"success"===t.data.status){if(e.addCallAction.callActionFormSubmitted[o]=!0,s.notify({title:"Default Call Action Settings",text:"Successfully Saved Call Action Settings",type:"success"}),e.addCallAction.action_id[o]=t.data.json.insertId,a){e.callActions.push(u),e.addCallAction.actionOptions[u.id]="action0";var i=Object.assign({},e.names.fields);delete i["Ring to Phone Number"],e.ruleDropDown[o+1]={0:{fields:Object.keys(i)}},e.addCallAction.email[o+1]=[],e.addCallAction.rule[o+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else s.notify({title:"Default Call Action Settings",text:t.data.err.data,type:"error"})}):t.updateCallActions(w).then(function(t){if(e.addNewStep=!0,"success"===t.data.status){if(e.addCallAction.callActionFormSubmitted[o]=!0,s.notify({title:"Update Call Action Settings",text:"Successfully Updated Call Action Settings",type:"success"}),a){e.callActions.push(u),e.addCallAction.actionOptions[u.id]="action0";var i=Object.assign({},e.names.fields);delete i["Ring to Phone Number"],e.ruleDropDown[o+1]={0:{fields:Object.keys(i)}},e.addCallAction.rule[o+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else s.notify({title:"Update Call Action Settings",text:t.data.err.data,type:"error"})})},n.get("assets/demo/call_actions.json").then(function(t){e.names=t.data,console.log("$scope.names",e.names),e.loadCallActions(e.currentOUId)}),e.tagAdded=function(t,o){var a=1;if(void 0!==e.addCallAction.email[t]&&e.addCallAction.email[t].length>1){var i=e.addCallAction.email[t].indexOf(o)-1;a=e.addCallAction.email[t][i].id+1}o.id=a},e.addNewCallAction=function(t){var o;if(o={id:(t=parseInt(t))+1},e.addCallAction.callActionFormSubmitted[t]){e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.callActions.push(o),e.addCallAction.actionOptions[t+1]="action0";var a=Object.assign({},e.names.fields);delete a["Ring to Phone Number"],e.ruleDropDown[t+1]={0:{fields:Object.keys(a)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}else e.saveCallAction(t,!0)},e.addAction=function(){var t;e.ivrActions.length>=10?s.notify({title:"IVR call flows",text:"only 10 actions are allowed",type:"error"}):(t={action_order:9===e.ivrActions.length?0:e.ivrActions.length+1,action:"",value:"",voiceprompt:!1,whisper:!1,webhook:!1,recordCall:!0,playDisclaimer:"before",voicepromptURL:"",voicepromptId:"",name:"Forward to phone number",ringtonum:""},e.ivrActions.push(t))},e.changeReferrer=function(){"new"===e.referrer?(e.showReferrerTextBox=!0,e.referrer=""):""!==e.referrer&&void 0!==e.referrer||(e.showReferrerTextBox=!1,e.referrer="")},e.removeCallAction=function(o){var a=!0;$.each(e.callActions,function(i,r){a&&r.id===o&&(angular.isUndefined(e.addCallAction.action_id[o])?(e.callActions.splice(i,1),R(r.id),a=!1):p.confirm("Are you sure you want to delete this Call Action?",function(n){n&&t.removecallActions(e.addCallAction.action_id[o],e.currentOUId).then(function(t){"error"!==t.data.result?(s.notify({title:"Default Call Action Settings",text:"Successfully Deleted Call Action",type:"success"}),e.callActions.splice(i,1),R(r.id),a=!1):s.notify({title:"Default Call Action Settings",text:"Error In Deleting Call Action",type:"success"})})}))})},t.getIndustries().then(function(o){var a;try{a=o.data.json}catch(e){a=[]}e.industryList=t.parseIndustries(a)}),e.user={name:"awesome user"},e.removeSelectedVoiceAudio=function(t){switch(t){case"voicePromt":void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,e.voiceURL=void 0,e.voicePromptTTSText="",e.TTSSelected=!0,e.hasValidVoiceURL=!1;break;case"voicemailGreetings":void 0!==e.greetingAudio&&e.greetingAudio.pause(),e.greetingAudio=void 0,e.voicemailGreetingsText="",e.VoiceMailGreetingURL=void 0,e.TTSvoicemailGreetingsSelected=!0,e.hasValidvoicemailGreetingsURL=!1,e.hasValidVoicemailURL=!1;break;case"outComePromt":void 0!==e.outComePromtAudio&&e.outComePromtAudio.pause(),e.outComePromtAudio=void 0,e.outComePromtText="",e.outComePromtURL=void 0,e.TTSoutComePromtSelected=!0,e.hasValidoutComePromtURL=!1;break;case"salesAmountVoice":void 0!==e.salesAmountVoiceAudio&&e.salesAmountVoiceAudio.pause(),e.salesAmountVoiceAudio=void 0,e.salesAmountVoicePromptText="",e.salesAmountVoiceURL=void 0,e.TTSsalesAmountVoiceSelected=!0,e.hasValidsalesAmountVoiceURL=!1;break;case"AgentIDVoicePrompt":void 0!==e.AgentIDVoicePromptAudio&&e.AgentIDVoicePromptAudio.pause(),e.AgentIDVoicePromptAudio=void 0,e.AgentIDVoicePromptText="",e.AgentIDVoicePromptURL=void 0,e.TTSAgentIDVoicePromptSelected=!0,e.hasValidAgentIDVoicePromptURL=!1}},e.isVoiceModalOpen=!1,e.disableVoiceClick=function(){e.isVoiceModalOpen=!0},e.showVoiceModal=function(t){e.promtElement=t,m.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){e.isVoiceModalOpen=!1;for(var t=0;t<a.prompts.length;t++)if(!0===a.prompts[t].selectedprompt)switch(e.promtElement){case"voicePromt":e.voicePromptText=a.prompts[t].name,e.voicePromptFileName=a.prompts[t].filename,e.voicePromptId=a.prompts[t].id,e.voiceURL=a.prompts[t].url,e.promptAudio=void 0,e.prompts=a.prompts,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.voicePromptTTSText="";break;case"outComePromt":e.outComePromtText=a.prompts[t].name,e.outComePromtFileName=a.prompts[t].filename,e.outComePromtId=a.prompts[t].id,e.outComePromtURL=a.prompts[t].url,e.outComePromtAudio=void 0,e.prompts=a.prompts,e.TTSoutComePromtSelected=!1,e.hasValidoutComePromtURL=!0,e.outComePromtTTSText="";break;case"salesAmountVoice":e.salesAmountVoicePromptText=a.prompts[t].name,e.salesAmountVoicePromptFileName=a.prompts[t].filename,e.salesAmountVoicePromptId=a.prompts[t].id,e.salesAmountVoiceURL=a.prompts[t].url,e.salesAmountVoiceAudio=void 0,e.prompts=a.prompts,e.hasValidsalesAmountVoiceURL=!0,e.TTSsalesAmountVoiceSelected=!1,e.salesAmountVoiceTTSText="";break;case"AgentIDVoicePrompt":e.AgentIDVoicePromptText=a.prompts[t].name,e.AgentIDVoicePromptFileName=a.prompts[t].filename,e.AgentIDVoicePromptId=a.prompts[t].id,e.AgentIDVoicePromptURL=a.prompts[t].url,e.AgentIDVoicePromptAudio=void 0,e.prompts=a.prompts,e.hasValidAgentIDVoicePromptURL=!0,e.TTSAgentIDVoicePromptSelected=!1,e.AgentIDVoicePromptTTSText=""}},function(){e.isVoiceModalOpen=!1,console.log("Modal dismissed at: "+new Date)})},e.isWhisperModalOpen=!1,e.disableWhisperClick=function(){e.isWhisperModalOpen=!0},e.showWhisperModal=function(t){m.open({templateUrl:"assets/partials/assignWhisper.html",controller:"whisperModal",size:t,backdrop:"static",keyboard:!1}).result.then(function(){e.isWhisperModalOpen=!1;for(var t=i.whispers,o=0;o<t.length;o++)!0===t[o].selectedwhisper&&(e.whisperText=t[o].name,e.whisperFileName=t[o].filename,e.whisperId=t[o].id,e.whisperURL=t[o].url,e.whisperAudio=void 0,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0);e.whispers=S.whispers,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.whisperTTSText=""},function(){e.isWhisperModalOpen=!1,console.log("Modal dismissed at: "+new Date)})},e.showVoicemailModal=function(t){e.voicemailElement=t,O(),m.open({templateUrl:"assets/partials/assignVoicemail.html",controller:"voicemailModel",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<C.voicemails.length;t++)!0===C.voicemails[t].selectedvoicemail&&(e.voicemailsTTSText=C.voicemails[t].name,e.voicemailsFileName=C.voicemails[t].filename,e.voicemailsId=C.voicemails[t].id,e.voicemailurl=C.voicemails[t].url,e.hasValidVoiceURL=!0,e.TTSvoicemailGreetingsSelected=!0,e.promptAudio=void 0);e.voicemails=C.voicemails,e.TTSvoicemailGreetingsSelected=!1,e.hasValidVoicemailURL=!0,e.voicemailGreetingsTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.playVoiceAudio=function(o){void 0===e.promptAudio||e.promptAudio.paused?void 0!==e.promptAudio&&e.promptAudio.paused?e.promptAudio.play():void 0!==e.voicePromptTTSText&&e.voicePromptTTSText.length>0?(e.promptAudio=new Audio,e.onTTS_VP_Request=!0,t.getTTS(e.voicePromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.promptAudio.src=o,e.promptAudio.paused?e.promptAudio.play():e.promptAudio.pause(),e.promptAudio.play()}e.onTTS_VP_Request=void 0})):(e.promptAudio=new Audio(o),e.promptAudio.play()):e.promptAudio.pause()},e.playVoiceAudioPromt=function(t,o){switch(o){case"voicemailGreetings":void 0===e.greetingAudio||e.greetingAudio.paused?void 0!==e.greetingAudio&&e.greetingAudio.paused?e.greetingAudio.play():void 0!==e.voicemailGreetingsTTSText&&e.voicemailGreetingsTTSText.length>0?(e.greetingAudio=new Audio,e.onTTS_VP_Request=!0,w.getTTS(e.voicemailGreetingsTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.greetingAudio.src=o,e.greetingAudio.paused?e.greetingAudio.play():e.greetingAudio.pause()}e.onTTS_VP_Request=void 0})):(e.greetingAudio=new Audio(t),e.greetingAudio.play()):e.greetingAudio.pause();break;case"outComePromt":void 0===e.outComePromtAudio||e.outComePromtAudio.paused?void 0!==e.outComePromtAudio&&e.outComePromtAudio.paused?e.outComePromtAudio.play():void 0!==e.outComePromtTTSText&&e.outComePromtTTSText.length>0?(e.outComePromtAudio=new Audio,e.onTTS_VP_Request=!0,w.getTTS(e.outComePromtTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.outComePromtAudio.src=o,e.outComePromtAudio.paused?e.outComePromtAudio.play():e.outComePromtAudio.pause()}e.onTTS_VP_Request=void 0})):(e.outComePromtAudio=new Audio(t),e.outComePromtAudio.play()):e.outComePromtAudio.pause();break;case"salesAmountVoice":void 0===e.salesAmountVoiceAudio||e.salesAmountVoiceAudio.paused?void 0!==e.salesAmountVoiceAudio&&e.salesAmountVoiceAudio.paused?e.salesAmountVoiceAudio.play():void 0!==e.salesAmountVoiceTTSText&&e.salesAmountVoiceTTSText.length>0?(e.salesAmountVoiceAudio=new Audio,e.onTTS_VP_Request=!0,w.getTTS(e.salesAmountVoiceTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.salesAmountVoiceAudio.src=o,e.salesAmountVoiceAudio.paused?e.salesAmountVoiceAudio.play():e.salesAmountVoiceAudio.pause()}e.onTTS_VP_Request=void 0})):(e.salesAmountVoiceAudio=new Audio(t),e.salesAmountVoiceAudio.play()):e.salesAmountVoiceAudio.pause();break;case"AgentIDVoicePrompt":void 0===e.AgentIDVoicePromptAudio||e.AgentIDVoicePromptAudio.paused?void 0!==e.AgentIDVoicePromptAudio&&e.AgentIDVoicePromptAudio.paused?e.AgentIDVoicePromptAudio.play():void 0!==e.AgentIDVoicePromptTTSText&&e.AgentIDVoicePromptTTSText.length>0?(e.AgentIDVoicePromptAudio=new Audio,e.onTTS_VP_Request=!0,w.getTTS(e.AgentIDVoicePromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.AgentIDVoicePromptAudio.src=o,e.AgentIDVoicePromptAudio.paused?e.AgentIDVoicePromptAudio.play():e.AgentIDVoicePromptAudio.pause()}e.onTTS_VP_Request=void 0})):(e.AgentIDVoicePromptAudio=new Audio(t),e.AgentIDVoicePromptAudio.play()):e.AgentIDVoicePromptAudio.pause()}},e.playWhisperAudio=function(o){void 0===e.whisperAudio||e.whisperAudio.paused?void 0!==e.whisperAudio&&e.whisperAudio.paused?e.whisperAudio.play():void 0!==e.whisperTTSText&&e.whisperTTSText.length>0?(e.whisperAudio=new Audio,e.onTTS_WH_Request=!0,t.getTTS(e.whisperTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.whisperAudio.src=o,e.whisperAudio.play()}e.onTTS_WH_Request=void 0})):(e.whisperAudio=new Audio(o),e.whisperAudio.play()):e.whisperAudio.pause()},e.chkSpclChar=function(e,t,o){var a=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;a.test(e)?(s.notify({title:t,text:"Special characters are not allowed",type:"error"}),o(e.replace(a,""))):o(e)},e.voiceTextChange=function(t){switch(e.promtElement=t,e.promtElement){case"voicePromt":e.promptAudio=void 0,void 0===e.voicePromptTTSText||0===e.voicePromptTTSText.length?(e.hasValidVoiceURL=!1,e.TTSSelected=!0):e.chkSpclChar(e.voicePromptTTSText,"Voice Prompt",function(t){e.voicePromptTTSText=t,e.hasValidVoiceURL=!0,e.TTSSelected=!0});break;case"voicemailGreetings":e.greetingAudio=void 0,void 0===e.voicemailGreetingsTTSText||0===e.voicemailGreetingsTTSText.length?(e.hasValidvoicemailGreetingsURL=!1,e.TTSvoicemailGreetingsSelected=!0):e.chkSpclChar(e.voicemailGreetingsTTSText,"Voicemail Greetings",function(t){e.voicemailGreetingsTTSText=t,e.hasValidvoicemailGreetingsURL=!0,e.TTSvoicemailGreetingsSelected=!0});break;case"outComePromt":e.outComePromtAudio=void 0,void 0===e.outComePromtTTSText||0===e.outComePromtTTSText.length?(e.hasValidoutComePromtURL=!1,e.TTSoutComePromtSelected=!0):e.chkSpclChar(e.outComePromtTTSText,"Voice prompt for Call outcome",function(t){e.outComePromtTTSText=t,e.hasValidoutComePromtURL=!0,e.TTSoutComePromtSelected=!0});break;case"salesAmountVoice":e.salesAmountVoiceAudio=void 0,void 0===e.salesAmountVoiceTTSText||0===e.salesAmountVoiceTTSText.length?(e.hasValidsalesAmountVoiceURL=!1,e.TTSsalesAmountVoiceSelected=!0):e.chkSpclChar(e.salesAmountVoiceTTSText,"Sale amount voice prompt",function(t){e.salesAmountVoiceTTSText=t,e.hasValidsalesAmountVoiceURL=!0,e.TTSsalesAmountVoiceSelected=!0});break;case"AgentIDVoicePrompt":e.AgentIDVoicePromptAudio=void 0,void 0===e.AgentIDVoicePromptTTSText||0===e.AgentIDVoicePromptTTSText.length?(e.hasValidAgentIDVoicePromptURL=!1,e.TTSAgentIDVoicePromptSelected=!0):e.chkSpclChar(e.AgentIDVoicePromptTTSText,"Agent ID voice prompt",function(t){e.AgentIDVoicePromptTTSText=t,e.hasValidAgentIDVoicePromptURL=!0,e.TTSAgentIDVoicePromptSelected=!0})}},e.whisperTextChange=function(){e.whisperAudio=void 0,void 0===e.whisperTTSText||0===e.whisperTTSText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):e.chkSpclChar(e.whisperTTSText,"Whisper Message",function(t){e.whisperTTSText=t,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0})},e.audioIsPlaying=function(t){return"whisper"!=t&&void 0!==e.whisperAudio&&!e.whisperAudio.paused&&!e.whisperAudio.ended||("prompt"!=t&&void 0!==e.promptAudio&&!e.promptAudio.paused&&!e.promptAudio.ended||("ivr"!=t&&void 0!==e.ivrAudio&&!e.ivrAudio.paused&&!e.ivrAudio.ended||("greeting"!=t&&void 0!==e.greetingAudio&&!e.greetingAudio.paused&&!e.greetingAudio.ended||("calloutcome"!=t&&void 0!==e.outComePromtAudio&&!e.outComePromtAudio.paused&&!e.outComePromtAudio.ended||("agentid"!=t&&void 0!==e.AgentIDVoicePromptAudio&&!e.AgentIDVoicePromptAudio.paused&&!e.AgentIDVoicePromptAudio.ended||"sale"!=t&&void 0!==e.salesAmountVoiceAudio&&!e.salesAmountVoiceAudio.paused&&!e.salesAmountVoiceAudio.ended)))))};var O=function(){void 0!==e.whisperAudio&&(e.whisperAudio.pause(),e.whisperAudio=void 0),void 0!==e.promptAudio&&(e.promptAudio.pause(),e.promptAudio=void 0),void 0!==e.ivrAudio&&(e.ivrAudio.pause(),e.ivrAudio=void 0)};e.audioIsDownloading=function(){return void 0!==e.whisperAudio&&void 0!==e.onTTS_WH_Request||(void 0!==e.promptAudio&&void 0!==e.onTTS_VP_Request||void 0!==e.ivrAudio&&void 0!==e.onTTS_IVR_Request)},e.$watch("noResultsTag",function(t,o){t&&t!==o&&l(function(){var t=$(".select2-no-results");console.log(t.contents()),d(t.contents())(e)})},!0),e.customoptiontemplate={formatNoMatches:function(t){console.log("Term: "+t);var o='<a ng-click="postcallcustom()">Add tag:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.inactive=!0,e.changeStatus=function(){e.inactive=!e.inactive},e.determineDisabilityDeleteBtn=function(){e.canDeleteOU=!1,parseInt(i.currentOUId)!==parseInt(i.topLevelOUId)&&7===parseInt(i.userAccess.orgunit)&&(e.canDeleteOU=!0)},e.determineDisabilityDeleteBtn(),e.deleteThisOU=function(){var o;e.isDeleteClicked=!0,7===parseInt(i.userAccess.orgunit)?i.currentOUId!==i.highestOUId?t.infoAboutOuAndChildren(i.currentOUId).then(function(a){if(e.isDeleteClicked=!1,"error"!==a.status){var r=a.data.json;console.log("Second=======================================",r),o=["Deleting this Group will delete <br>","(",r.userCount,") Users, <br>","(",r.orgUnitCount,") Groups, <br>","(",r.campaignCount,") Campaigns, <br>","(",r.callFlowCount,") Call Flows, <br>","(",r.webhookCount,") Webhooks, <br>","(",r.dniCount,") Dni Settings, <br>","(",r.tagCount,") Tags, <br>","(",r.reservedCount,") Reserve Numbers, <br>","(",r.reservedPremiumCount,") Premium Reserve Numbers, <br>","(",r.scoreCardCount,") Scorecards<br>","and any integrations associated with this group and all sub-groups. ","All active phone numbers associated with this group will be released from ","your account. Are you sure you want to proceed? Type 'yes' to proceed."].join(""),p.prompt(o,function(e){var o;"yes"==(e=null===e?"":e).toLowerCase()?t.deleteOU(i.currentOUId).then(function(e){if("can't delete top level ou"!==e.data.err)if(e.data.err)s.notify({title:"Delete Group",text:"Server error in attempt to delete OU",type:"error"});else{if(s.notify({title:"Group",text:i.currentOUName+" deleted.",type:"info"}),o=e.data.json)return t.getOULevel(o.org_unit_id);s.notify({title:"Delete Group",text:"No parent data supplied by server.",type:"error"})}else s.notify({title:"Delete Group",text:"Attempt to delete top level Group not permitted.",type:"error"})}).then(function(e){if(e&&e.data.json&&e.data.json.ouLevel){o.ouLevel=e.data.json.ouLevel,i.bc_ous[i.currentOULevel].id=null,i.bc_ous[i.currentOULevel].name=null,u.updateSessData(o.org_unit_id,o.org_unit_name,i.currentOULevel-1),i.currentOULevel=o.ouLevel;parseInt(i.currentOULevel);v.getOUData(o.org_unit_id).success(function(e){i.selectedOU={id:o.org_unit_id,level:o.ouLevel},1==o.ouLevel&&v.loadLevel1(i.highestOUId),2==o.ouLevel&&v.loadLevel2(i.currentOUId),i.selectedOU={id:o.org_unit_id,level:o.ouLevel},g.reload()})}else s.notify({title:"Delete Group",text:"Error getting Group's level.",type:"error"})}):s.notify({title:"Delete Group",text:"User didn't respond 'yes', so no Group was deleted.",type:"info"})})}else console.log("error getting info about OU and its children")}):s.notify({title:"Permissions",text:"You can't delete a top level Group",type:"error"}):s.notify({title:"Permissions",text:"You dont have permission to delete a Group",type:"error"})},e.formSubmit=!1;var U=r.add?"add":"update";t.getOrgUnitById(i.currentOUId).then(function(t){setTimeout(function(){var o=t.data.json[0];e.companyName=o.org_unit_name,e.orgIdExternal=o.org_unit_ext_id,e.phone=o.phone_number,e.city=o.city,e.industry=o.industry_id,e.zip=o.zip,e.parentCompany=o.parent_id,e.state=o.state,$(".groupDetailsProgressLoader").hide(),$("#groupDetailsProgressLoader").css("opacity","1")},500)}),e.saveOrg=function(){if(e.ouForm.$valid){e.companyName=e.companyName.trim();var o={orgUnit:{org_unit_name:e.companyName,org_unit_ext_id:e.orgIdExternal,phone_number:e.phone,city:e.city,industry_id:e.industry,zip:e.zip,state:e.state,billing_id:h.sessionStorage.billingId}};"add"===U&&e.ouForm.$valid?(o.orgUnit.org_unit_parent_id=i.currentOUId,t.createOrgUnit(o).then(function(t){e.formSubmit=!1;s.notify({title:"Company Details",text:o.orgUnit.org_unit_name+" created under "+i.currentOUName,type:"success"})})):"update"===U&&e.ouForm.$valid&&(o.orgUnit.org_unit_id=i.currentOUId,i.currentOUName===i.highestOUName&&(i.highestOUName=i.currentOUName=o.orgUnit.org_unit_name,i.levelOneOus[0].name=i.currentOUName),i.currentOUName===o.orgUnit.org_unit_name?k=o.orgUnit.org_unit_name+" updated.":(k=i.currentOUName+"  (now "+o.orgUnit.org_unit_name+") updated.",i.currentOUName=o.orgUnit.org_unit_name),t.updateOrgUnit(o).then(function(t){if(e.formSubmit=!1,console.log(t),"error"===t.data.result)s.notify({title:"Company Details",text:t.data.err,type:"error"});else{i.$emit("current-ou-updated",{id:parseInt(i.currentOUId),level:parseInt(i.currentOULevel),billing_id:parseInt(i.billing_id),parent_id:parseInt(i.parent_id)});var a=JSON.parse(localStorage.getItem("sessionStorageData"));a.currentOUName=i.currentOUName,a.highestOUName=i.highestOUName,a.levelOneOus=JSON.parse(a.levelOneOus),a.levelOneOus[0].name=i.currentOUName,a.levelOneOus=JSON.stringify(a.levelOneOus),localStorage.setItem("sessionStorageData",JSON.stringify(a)),s.notify({title:"Company Details",text:k,type:"success"});var r={org_unit_id:o.orgUnit.org_unit_id,org_unit_name:o.orgUnit.org_unit_name,type:"group"};e.$emit("campaignOrGroupUpdateSms",{campaignOrGroupObject:r})}}))}else s.notify({title:"Company Details",text:"Please fix invalid fields before saving organization details.",type:"error"})},e.showSubmit=function(){setTimeout(function(){e.submitted1=!1},100)},e.showSaveButton=function(){setTimeout(function(){e.formSubmit1=!1},100)}}]).controller("SubOrgUnitController",["$scope","OrgUnitWebService","$rootScope","$routeParams","pinesNotifications","OrgUnitLocal","$bootbox","$route","$filter","BreadcrumbWebService","$window","DynamicCssInsertion","paginationService",function(e,t,o,a,i,r,n,s,l,c,d,u,p){e.isReadonly=!1,e.userAccess&&e.userAccess.orgunit<7&&(e.isReadonly=!0),e.canAddSub=!1,o.userOULevel=parseInt(o.userOULevel),o.currentOULevel=parseInt(o.currentOULevel),0===o.userOULevel&&o.currentOULevel<2?e.canAddSub=!0:1==o.userOULevel&&o.currentOULevel<1&&(e.canAddSub=!0),e.subgroups=[],e.currentPage=1,e.pageSize=100,e.locNewRow=0,e.arrRequired=[],e.arrInvalid=[],e.specificErrors=[],e.actionHeader=["Actions"],e.subUserHeaders=["OUID","Group Name","External ID","Industry","Phone","City","State/Province","Zip/Postal Code"],e.isDeleteClicked=!1,e.isSubGroupOpen=!0,e.addsubgroupInProcess=!1,t.getChildrenOUs(o.currentOUId).success(function(t){for(var o in t.json)e.subgroups.push(t.json[o]);e.totalSubGroupsRows=e.subgroups.length,$(".subGroupProgressLoader").hide(),$("#subGroupProgressLoader").css("opacity","1"),$(".table>tbody>tr>td").css("border-top","1px solid #e9ecf0")}).error(function(e){console.log("err fetching children"),console.log(e)}),e.industries=[],t.getIndustries().then(function(t){for(var o in t.data.json)e.industries.push({value:t.data.json[o].industry_id,text:t.data.json[o].industry_group+": "+t.data.json[o].industry_name})}),e.showIndustry=function(t){if(t.industry_id){if(e.industries.length){var o=l("filter")(e.industries,{value:t.industry_id},!0);return o.length?o[0].text:"Not set"}return t.industry_id||"Not set"}},e.showState=function(t){if(t.state){if(e.states.length){var o=l("filter")(e.states,{value:t.state});return o.length?o[0].text:"Not set"}return t.state||"Not set"}},e.cancelAdd=function(t,o,a){if(o)a.$cancel();else{var i=p.getCurrentPage("pg-subgroups");i>1&&(t=100*(i-1)+t),e.subgroups.splice(t,1),e.locNewRow=0}e.locNewRow=0},e.deleteOU=function(a,r){var s;e.isDeleteClicked=!0,console.log(a),console.log(r),7===parseInt(o.userAccess.orgunit)?r!==o.highestOUId?t.infoAboutOuAndChildren(r).then(function(o){if("error"!==o.status){var l=o.data.json;console.log("First=======================================",l),s=["Deleting this Group will delete <br>","(",l.userCount,") Users, <br>","(",l.orgUnitCount,") Groups, <br>","(",l.campaignCount,") Campaigns, <br>","(",l.callFlowCount,") Tracking Numbers, <br>","(",l.webhookCount,") Webhooks, <br>","(",l.dniCount,") Dni Settings, <br>","(",l.tagCount,") Tags, <br>","(",l.reservedCount,") Reserve Numbers, <br>","(",l.reservedPremiumCount,") Premium Reserve Numbers, <br>","(",l.scoreCardCount,") Scorecards<br>","and any integrations associated with this group and all sub-groups. ","All active phone numbers associated with this group will be released from ","your account. Are you sure you want to proceed? Type 'yes' to proceed."].join(""),n.prompt(s,function(o){var n;(e.isDeleteClicked=!1,"yes"==(o=null===o?"":o).toLowerCase())?t.deleteOU(r).then(function(o){if("can't delete top level ou"!==o.data.err)if(o.data.err)i.notify({title:"Delete Group",text:"Server error in attempt to delete OU",type:"error"});else{i.notify({title:"Group",text:"Group deleted.",type:"info"});var r=p.getCurrentPage("pg-subgroups");if(r>1&&(a=100*(r-1)+a),e.subgroups.splice(a,1),n=o.data.json,e.totalSubGroupsRows=e.subgroups.length,n)return t.getOULevel(n.org_unit_id);i.notify({title:"Delete Group",text:"No parent data supplied by server.",type:"error"})}else i.notify({title:"Delete Group",text:"Attempt to delete top level Group not permitted.",type:"error"})}).then(function(e){e&&e.data.json&&e.data.json.ouLevel||i.notify({title:"Delete Group",text:"Error getting Group's level.",type:"error"})}):i.notify({title:"Delete Group",text:"User didn't respond 'yes', so no Group was deleted.",type:"info"})})}else console.log("error getting info about OU and its children")}):i.notify({title:"Permissions",text:"You can't delete a top level Group",type:"error"}):i.notify({title:"Permissions",text:"You dont have permission to delete a Group",type:"error"})},e.addSubgroup=function(){var t;if((e.addsubgroupInProcess=!0,e.subgroups.length)&&(!(t=e.locNewRow>0?e.subgroups[e.locNewRow]:e.subgroups[e.subgroups.length-1]).org_unit_name&&!t.org_unit_id))return void i.notify({title:"Subgroups",text:"Save currently added subgroup before adding another.",type:"info"});if(e.inserted={org_unit_name:"",org_unit_ext_id:"",industry_id:"",phone_number:"",city:"",state:"",zip:""},e.subgroups.length>99){var o=p.getCurrentPage("pg-subgroups");e.locNewRow=100*o-1,e.subgroups.length<=e.locNewRow&&(e.locNewRow=e.subgroups.length),e.subgroups.splice(e.locNewRow,0,e.inserted)}else e.subgroups.push(e.inserted)},e.saveSubgroup=function(a,r,n,s){a.org_unit_name=a.org_unit_name.trim();var l={orgUnit:{org_unit_name:a.org_unit_name,org_unit_ext_id:a.org_unit_ext_id,phone_number:a.phone_number,city:a.city,industry_id:a.industry_id,zip:a.zip,state:a.state,billing_id:d.sessionStorage.billingId}};r?(l.orgUnit.org_unit_id=r,l.orgUnit.org_unit_parent_id=o.currentOUId,e.isReadonly=!0,t.updateOrgUnit(l).then(function(t){if(e.isReadonly=!1,"success"===t.data.result){i.notify({title:"Sub-groups",text:"Sub-group "+l.orgUnit.org_unit_name+" is updated successfully.",type:"success"});var o={org_unit_id:l.orgUnit.org_unit_id,org_unit_name:l.orgUnit.org_unit_name,type:"group"};e.$emit("campaignOrGroupUpdateSms",{campaignOrGroupObject:o})}else e.error=t,i.notify({title:"Sub-groups",text:t.data.err,type:"error"}),setTimeout(function(){n.$show()},100)})):(e.isReadonly=!0,l.orgUnit.org_unit_parent_id=o.currentOUId,t.createOrgUnit(l).then(function(t){if(console.log(t),e.isReadonly=!1,e.addsubgroupInProcess=!1,"success"===t.data.status){n.$cancel();var r={id:parseInt(t.data.json.insertId),name:a.org_unit_name,tName:a.org_unit_name.substr(0,30),parent:parseInt(o.currentOUId),checked:!1};o.groupInfo.push(r);var c=p.getCurrentPage("pg-subgroups");c>1&&(s=100*(c-1)+s),e.subgroups[s].org_unit_id=t.data.json.insertId,i.notify({title:"Sub-groups",text:"Sub-group "+l.orgUnit.org_unit_name+" is created successfully.",type:"success"}),e.totalSubGroupsRows=e.subgroups.length}else e.error=t,i.notify({title:"Sub-groups",text:t.data.err,type:"error"}),setTimeout(function(){n.$show()},100)}))},e.validateData=function(t,o,a){var r;if("string"==typeof t&&(t=t.trim()),o=o.trim(),!t&&"Zip"!=o&&"Phone"!=o&&(e.arrRequired.push(o),"Industry"!=o))return"   ";if("Zip"==o&&t&&!/^[a-z0-9 ]+$/i.test(t))return i.notify({title:"Sub-groups",text:"Zip is invalid",type:"error"}),"   ";if("Phone"==o&&t&&!/^[0-9-() ]{14}$/.test(t))return i.notify({title:"Sub-groups",text:"Phone is invalid",type:"error"}),"   ";if("Industry"==o){if(e.arrRequired.length){r="field is required.",e.arrRequired.length>1&&(r="fields are required."),i.notify({title:"Sub-groups",text:"'"+e.arrRequired.join(", ")+"' "+r,type:"error"});var n=e.arrRequired.indexOf("Industry");return e.arrInvalid=[],e.arrRequired=[],n>-1?"   ":""}if(e.arrInvalid.length)return r="field is invalid.",e.arrInvalid.length>1&&(r="fields are invalid."),i.notify({title:"Sub-groups",text:"'"+e.arrInvalid.join(", ")+"' "+r,type:"error"}),e.specificErrors.length&&i.notify({title:"Sub-groups",text:"'"+e.specificErrors.join(", ")+"'",type:"error"}),e.arrRequired=[],e.arrInvalid=[],e.specificErrors=[],""}},e.scrollToTop=function(){d.scrollTo(0,0)},e.setCurrentOU=function(e,a){var i=parseInt(o.currentOULevel)+1;c.getOUData(e).success(function(r){o.bc_ous[i]={id:e,name:a},o.selectedOU={id:e,level:i},1==i&&c.loadLevel1(o.highestOUId),2==i&&c.loadLevel2(o.currentOUId),o.selectedOU={id:e,level:i},t.getStyle(e).then(function(e){"success"===e.data.result&&(o.chatURL=d.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",Object.keys(e.data.json).length>0?(o.white_label_active=d.sessionStorage.white_label_active=e.data.json.white_label_active,o.chatActive=d.sessionStorage.chatActive=e.data.json.chat_active):(o.white_label_active=d.sessionStorage.white_label_active=!1,o.chatActive=d.sessionStorage.chatActive=!0),o.feedbackURL=window.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+window.sessionStorage.uservoiceSSO,o.supportURL=d.sessionStorage.supportURL="https://knowledgebase.convirza.com",u.whiteLabelCSSInject(e.data.json.white_label_css,e.data.json.org_logo,e.data.json.org_logo,!1))}),o.currentOUId=d.sessionStorage.currentOUId=e,o.currentOUName=d.sessionStorage.currentOUName=a,o.currentOULevel=d.sessionStorage.currentOULevel=i,s.reload()}).error(function(e){console.log("err fetching Org"),console.log(e)})},e.states=[{subgroup:"US",value:"AK",text:"Alaska"},{subgroup:"US",value:"HI",text:"Hawaii"},{subgroup:"US",value:"CA",text:"California"},{subgroup:"US",value:"NV",text:"Nevada"},{subgroup:"US",value:"OR",text:"Oregon"},{subgroup:"US",value:"WA",text:"Washington"},{subgroup:"US",value:"AZ",text:"Arizona"},{subgroup:"US",value:"CO",text:"Colorado"},{subgroup:"US",value:"ID",text:"Idaho"},{subgroup:"US",value:"MT",text:"Montana"},{subgroup:"US",value:"NE",text:"Nebraska"},{subgroup:"US",value:"NM",text:"New Mexico"},{subgroup:"US",value:"ND",text:"North Dakota"},{subgroup:"US",value:"UT",text:"Utah"},{subgroup:"US",value:"WY",text:"Wyoming"},{subgroup:"US",value:"AL",text:"Alabama"},{subgroup:"US",value:"AR",text:"Arkansas"},{subgroup:"US",value:"IL",text:"Illinois"},{subgroup:"US",value:"IA",text:"Iowa"},{subgroup:"US",value:"KS",text:"Kansas"},{subgroup:"US",value:"KY",text:"Kentucky"},{subgroup:"US",value:"LA",text:"Louisiana"},{subgroup:"US",value:"MN",text:"Minnesota"},{subgroup:"US",value:"MS",text:"Mississippi"},{subgroup:"US",value:"MO",text:"Missouri"},{subgroup:"US",value:"OK",text:"Oklahoma"},{subgroup:"US",value:"SD",text:"South Dakota"},{subgroup:"US",value:"TX",text:"Texas"},{subgroup:"US",value:"TN",text:"Tennessee"},{subgroup:"US",value:"WI",text:"Wisconsin"},{subgroup:"US",value:"CT",text:"Connecticut"},{subgroup:"US",value:"DE",text:"Delaware"},{subgroup:"US",value:"FL",text:"Florida"},{subgroup:"US",value:"GA",text:"Georgia"},{subgroup:"US",value:"IN",text:"Indiana"},{subgroup:"US",value:"ME",text:"Maine"},{subgroup:"US",value:"MD",text:"Maryland"},{subgroup:"US",value:"MA",text:"Massachusetts"},{subgroup:"US",value:"MI",text:"Michigan"},{subgroup:"US",value:"NH",text:"New Hampshire"},{subgroup:"US",value:"NJ",text:"New Jersey"},{subgroup:"US",value:"NY",text:"New York"},{subgroup:"US",value:"NC",text:"North Carolina"},{subgroup:"US",value:"OH",text:"Ohio"},{subgroup:"US",value:"PA",text:"Pennsylvania"},{subgroup:"US",value:"RI",text:"Rhode Island"},{subgroup:"US",value:"SC",text:"South Carolina"},{subgroup:"US",value:"VT",text:"Vermont"},{subgroup:"US",value:"VA",text:"Virginia"},{subgroup:"US",value:"WV",text:"West Virginia"},{subgroup:"Canada",value:"AB",text:"Alberta"},{subgroup:"Canada",value:"BC",text:"British Columbia"},{subgroup:"Canada",value:"MB",text:"Manitoba"},{subgroup:"Canada",value:"NB",text:"New Brunswick"},{subgroup:"Canada",value:"NF",text:"Newfoundland"},{subgroup:"Canada",value:"NT",text:"Northwest Territories"},{subgroup:"Canada",value:"NS",text:"Nova Scotia"},{subgroup:"Canada",value:"ON",text:"Ontario"},{subgroup:"Canada",value:"PE",text:"Prince Edward Island"},{subgroup:"Canada",value:"QC",text:"Quebec"},{subgroup:"Canada",value:"SK",text:"Saskatchewan"},{subgroup:"Canada",value:"YT",text:"Yukon"}],$(window).scroll(function(){window.pageYOffset>5e3&&$(window).trigger("resize")}),$(window).scroll(function(){window.pageYOffset;$("button").css({height:"34px"})})}]),angular.module("old-org-unit",["disableAll","theme.services","ui.bootstrap","breadcrumb","whitelabel","ui.select2","campaigns-builder","ngTagsInput"]).factory("OldOrgUnitWebService",["$q","$rootScope","$http","$window","$location",function(e,t,o,a,i){"use strict";var r={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getGroupsExportReport:function(e,t){return o.get(this.getBaseURL()+"/v1/orgunit/groups/ouId/"+t+"/userAccess/"+e,this.getJsonConfig())},getUsersExportReport:function(e,t){return o.get(this.getBaseURL()+"/v1/user/users/ouId/"+t+"/userAccess/"+e,this.getJsonConfig())},getBaseURL:function(){return t.url+":"+t.port},getOULevel:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/level/"+e,this.getJsonConfig())},getconversationalanalytics:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/CAStatus/"+e,this.getJsonConfig())},getFeatureSettings:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/feature/"+e,this.getJsonConfig())},getDefaultCustomParams:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/CallFlow/customParams/"+e,this.getJsonConfig())},getspamguard:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/spamguard/"+e,this.getJsonConfig())},getrecordcall:function(e){return o.get(this.getBaseURL()+"/v1//",+e,this.getJsonConfig())},getvoicepromts:function(e){return o.get(this.getBaseURL()+"/v1/callflowrecording/"+e+"/prompt",this.getJsonConfig())},getwhisper:function(e){return o.get(this.getBaseURL()+"/v1/callflowrecording/"+e+"/whisper",this.getJsonConfig())},getcustomsource:function(e){return o.get(this.getBaseURL()+"/v1/customSource/"+e,this.getJsonConfig())},getCallFlow:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callFlow/"+e,this.getJsonConfig())},getCallActions:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callAction/"+e,this.getJsonConfig())},getcallActionByActionId:function(e){return o.get(this.getBaseURL()+"/v1/defgroupsetting/callAction/action/"+e,this.getJsonConfig())},getWebhooks:function(e){return o.get(this.getBaseURL()+"/v1/webhook/list/"+e,this.getJsonConfig())},removecallActions:function(e,t){var i={method:"DELETE",url:this.getBaseURL()+"/v1/defgroupsetting/callAction/"+e+"/"+t,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(i)},createDefaultCustomParams:function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/defgroupsetting/CallFlow/customParams/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},getStyle:function(e){return o.get(this.getBaseURL()+"/v1/useraccess/styleou/"+e,this.getJsonConfig())},getChildrenOUs:function(e){return o.defaults.useXDomain=!0,o.get(t.url+":"+t.port+"/v1/orgUnit?org_unit_parent_id="+e,this.getJsonConfig())},validateDniData:function(e,t){var o={},a=[],i=[],r=[],n=new RegExp(/^([a-z0-9]+|\*)([\-\.]{1}[a-z0-9]+)*\.([a-z]{1,5}|\*)(:[0-9]{1,5})?(\/.*)?$/i);if(0===e.destination_url.length&&a.push("Host Domain is required"),0===e.dni_element.length&&a.push("HTML Class is required"),e.destination_url.indexOf("*")>-1&&("*"!=e.destination_url.charAt(0)||"."!=e.destination_url.charAt(1))&&(i.push("Host Domain"),r.push("When using a wildcard at the beginning of a Host Domain, *.domain format is required. Example: *.logmycalls.com")),e.referrer&&t)if(n.test(e.referrer)){var s=e.referrer.split(".");2==s.length&&"*"==s[0]&&"*"!=s[1]&&(i.push("Referring Website"),r.push("Wrong domain format for Referring Website."))}else i.push("Referring Website"),r.push("Wrong domain format for Referring Website.");else e.referrer||r.push("Referring Website field is required.");e.dni_element&&("lmc_track"!=e.dni_element||"session"!=e.dni_type&&"source"!=e.dni_type||(i.push("Class"),r.push("The HTML Class ID 'lmc_track' is only allowed for URL-based DNI.")),"lmc_track"!=e.dni_element&&"url"==e.dni_type&&(i.push("Class"),r.push("The HTML Class ID 'lmc_track' is required for URL-based DNI.")),e.dni_element.indexOf(" ")>-1&&(i.push("Class"),r.push("The HTML ID Class must not contain spaces.")));e.destination_url,e.referrer,e.referrer_type,e.dni_element;return o.arrInvalidMessage=r,o.arrRequired=a,o},infoAboutOuAndChildren:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/linked/"+e,this.getJsonConfig())},deleteOU:function(e){return o.delete(this.getBaseURL()+"/v1/orgUnit/"+e+"/"+t.currentOUId,this.getJsonConfig())},getOrgUnitById:function(e){return o.get(this.getBaseURL()+"/v1/orgUnit/"+e,this.getJsonConfig())},getIndustries:function(){return o.get(this.getBaseURL()+"/v1/industry",this.getJsonConfig())},getTTS:function(e){return o.get(this.getBaseURL()+"/v1/callflow/getmedia/"+encodeURIComponent(e),this.getJsonConfig())},parseIndustries:function(e){var t,o,a,i,r={};return _.each(e,function(e){t=e.industry_group,o=e.industry_name,void 0===r[t]&&(r[t]={name:t,specific:[]}),"Other"!==t?r[t].specific.push({name:o,id:e.industry_id}):(a=e.industry_id,i=t)}),r.Other={name:i,specific:[]},r.Other.specific.push({name:"Other",id:a}),r},updateOrgUnit:function(e){var i={method:"PUT",url:t.url+":"+t.port+"/v1/orgUnit/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},createOrgUnit:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1/orgUnit/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},updateCallActions:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/callAction",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},enableconversationalanalytics:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/CAStatus/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},savedefCustomSource:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},enableSpamguard:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},saveDefaultGroupSetting:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/feature/",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},defaultCreateCallFlow:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/CallFlow",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},defaultUpdateCallFlow:function(e){var t={method:"PUT",url:this.getBaseURL()+"/v1/defgroupsetting/CallFlow",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},recordcall:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},playvoicepromt:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},playwhispermsg:function(e,t){var i={method:"POST",url:this.getBaseURL()+"/v1//",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(i)},customSource:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/customSource",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},saveCallActions:function(e){var t={method:"POST",url:this.getBaseURL()+"/v1/defgroupsetting/callAction",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},multiDeleteCustomSource:function(e){var t={method:"DELETE",url:this.getBaseURL()+"/v1/orgUnit/customsources",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)}};return r}]).controller("OldOrgUnitController",["$scope","OldOrgUnitWebService","UserWebService","VoicePromptService","$rootScope","$routeParams","$http","pinesNotifications","$timeout","$q","$compile","LogoutService","OrgUnitLocal","$bootbox","$uibModal","$route","$location","$window","BreadcrumbWebService","DNIWebService","CampaignWebService","TagWebService","WhisperMessageService","progressLoader","$filter",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b,w,y,S,C,A,T){"use strict";void 0===e.userAccess.callaction||e.userAccess.callaction<4?e.callActionComponent=!0:e.callActionComponent=!1,void 0===e.userAccess.dni||e.userAccess.dni<4?e.dniComponent=!0:e.dniComponent=!1,console.log("ia m old Path is ",h.path()),1!=i.is_migrated&&"true"!=i.is_migrated||(console.log("Path is ",h.path()),"/set-group"==h.path()?location.href="#/set-legacy-group":h.path("/set-group")),e.triggerBoth=!1,e.noResultsTag=null,e.dniReferrer=[{value:"new",text:"Add New"},{value:"*.*|null",text:"Any"},{value:"*.bing.com|null",text:"Bing"},{value:"*.google.*|paid",text:"Google (Paid)"},{value:"*.google.*|organic",text:"Google (Organic)"},{value:"*.yahoo.com|paid",text:"Yahoo (Paid)"},{value:"*.yahoo.com|organic",text:"Yahoo (Organic)"}],void 0===v.sessionStorage.userAccess&&u.logout(),e.CurrentOUName=i.currentOUName,e.showSpamButton=!1,e.showCaButton=!1,e.enableSpam=!0,e.isAdmin=!0,e.enableConvAna=!0,e.scoreAccess=!1,e.userAccess&&e.userAccess.manualscorecard&&(e.scoreAccess=!0),e.userAccess&&e.userAccess.spamguard&&(e.showSpambutton=!0,e.enableSpam=!0),e.userAccess&&e.userAccess.ca&&(e.showCaButton=!0,e.enableConvAna=!0),1!=i.roleId&&4!=i.roleId||(e.isAdmin=!1),e.isDeleteClicked=!1,e.shareDni=!1,e.recordcheck=!0,e.voicepromt=!0,e.whisperpromt=!0,e.destination_url="*.*",e.referrer="*.*|null",e.dni_element="CVZ",e.dni_ttl1="Select",e.dni_type="",e.custom_params="",e.dniSettingPresent=!1,e.spamSettingPresent=!1,e.CASettingPresent=!1,e.callflowSettingPresent=!0,e.CSSettingPresent=!0,e.playDisclaimer="before",e.recordCall=!0,e.voicePrompt1=!1,e.whisperPrompt1=!1,e.voicePromptTTSText="",e.whisperTTSText="",e.promptAudio=void 0,e.customSource_1="custom source",e.customsource=[],e.customsource="",e.ringto="",e.oneAtATime=!1,e.rinterval=72,e.callbackid=-1;var D=i.currentOUName+" groups "+moment().format("YYYY-MM-DD"),I=i.currentOUName+" users "+moment().format("YYYY-MM-DD");e.disable_share_dni=!1,e.callActions=[];var N=["CS1","CS2","CS3","CS4","CS5"];e.names="",e.canModify=!0,e.CS1=null,e.CS2=null,e.CS3=null,e.CS4=null,e.CS5=null,e.isGroupDetailsOpen=!0;var k="";function R(t){if(delete e.ruleDropDown[t.toString()],delete e.addCallAction.callActionFormSubmitted[t.toString()],console.log(e.addCallAction),$.each(e.addCallAction,function(e,o){console.log(e,o),angular.isUndefined(o)||x(o[t.toString()])||"string"==typeof o||delete o[t.toString()]}),delete e.addCallAction.action_id[t],0===e.callActions.length){e.callActions=[],e.callActions.push({id:1}),e.addCallAction.email[1]=[],e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}function F(e,t){var o;return _.each(e,function(e,a){e===t&&(o=a)}),o}function x(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function L(e){return!!/^[0-9]+$/.test(e)}e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.customSourceModel=[],e.customSourceSettings={enableSearch:!0,showCheckAll:!1,showUncheckAll:!1,dynamicTitle:!1,scrollable:!0,scrollableHeight:200,searchField:"custom_source_name"},e.showFeatureControl=!1,e.dniTypeList=[{id:"url",text:"URL"},{id:"source",text:"Source"}],e.dniParams=function(t){g.open({templateUrl:"assets/partials/dniParams.html",controller:"DNIModelController",size:t,resolve:{canModify:function(){return!0===e.canModify},callingController:function(){}}})},e.showFeatureControl=!1,e.openFeatureSection=function(o){o&&t.getFeatureSettings(i.currentOUId).then(function(t){if(e.showFeatureControl=!0,"success"===t.data.status){var o=t.data.json;o.defaultData.length>0?(e.enableConvAna=o.defaultData[0].conversation_analytics_status,e.enableSpam=o.defaultData[0].spam_guard_status,e.shareDni=o.defaultData[0].share_with_subgroup,e.disable_share_dni=o.defaultData[0].disable_share_dni,e.share_group_name=o.defaultData[0].share_group_name,e.location_level_ou=o.defaultData[0].location_level_ou,e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1)):(e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1))}})},e.getGroupsHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","Industry","Phone","City","State/Province","Zip/Postal Code","Enable Conversation Analytics","Enable Spam Guard","Share DNI Settings","Host Domain","Referring Website","HTML Class","Repeat Interval (in hours)","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Record Call","Call Recording Disclaimer","Voice Prompt","Whisper Message","Ring-to Phone Number","Call Actions"]},e.getCSVGroupData=function(o,a){var r="Export Groups";"csv"===o&&"both"===a&&(e.triggerBoth=!0,$("#userCSVExport").trigger("click"),r="Export Groups & Users"),s.notify({title:r,text:"Download is in process, it will be completed in few minutes",type:"info"}),e.groupsReportFileName=D+"."+o,A.start();var n={},l=c.defer();if(t.getGroupsExportReport(e.userAccess.orgunit,i.currentOUId).then(function(t){if("error"!=t.data.json){n=t.data.json;for(var a=[],r=0;r<n.length;r++){var s=n[r].phone;null!==s&&(s=s.replace("(","").replace(")","").replace(" ","").replace("-","").trim()),!1===n[r].record_call&&(n[r].call_recording_disclaimer=""),a.push({a:n[r].account,b:n[r].account_ouid,c:n[r].account_external_id,d:n[r].parent_group,e:n[r].parent_group_ouid,f:n[r].parent_group_external_id,g:n[r].group,h:n[r].group_ouid,i:n[r].group_external_id,j:n[r].industry,k:s,l:n[r].city,m:n[r].state_province,n:n[r].zip_postal_code,o:n[r].enable_conversation_analytics,p:n[r].enable_spam_guard,q:n[r].share_dni_settings,r:n[r].host_domain,s:n[r].referring_website,t:n[r].html_class,u:n[r].repeat_interval,v:n[r].custom_source_name1,w:n[r].custom_source_name2,x:n[r].custom_source_name3,y:n[r].custom_source_name4,z:n[r].custom_source_name5,aa:n[r].record_call,ab:n[r].call_recording_disclaimer,ac:n[r].voice_prompt,ad:n[r].whisper_message,ae:n[r].ring_to_number,af:n[r].call_action})}if(A.set(50),l.resolve(a),!i.isSafari)return A.end(),l.promise;l.resolve(JSONToCSVConvertor(a,e.groupsReportFileName,!0,o))}}),!i.isSafari)return A.end(),l.promise},i.$on("$locationChangeSuccess",function(){O()}),e.getUsersHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","First Name","Last Name","Email","External Id","Agent Ring-to","Agent ID","Role","Status","Access Audio","Score Calls","Reporting Access","Group Access"]},e.getCSVUserData=function(o,a){console.log(e.triggerBoth),e.triggerBoth||s.notify({title:"Export Users",text:"Download is in process, it will be completed in few minutes",type:"info"}),e.triggerBoth=!1,e.usersReportFileName=I+"."+o,A.start();var r={},n=c.defer();if(t.getUsersExportReport(e.userAccess.orgunit,i.currentOUId).then(function(e){if("error"!=e.data.json){r=e.data.json;for(var t=[],a=0;a<r.length;a++)t.push({a:r[a].account,b:r[a].account_ouid,c:r[a].account_external_id,d:r[a].parent_group,e:r[a].parent_group_ouid,f:r[a].parent_group_external_id,g:r[a].group,h:r[a].group_ouid,i:r[a].group_external_id,j:r[a].first_name,k:r[a].last_name,l:r[a].email,m:r[a].user_ext_id,n:r[a].agent_ring_to,o:r[a].agent_id,p:r[a].role,q:r[a].status,r:r[a].access_audio,s:r[a].score_call,t:r[a].report_access,u:r[a].group_access});if(A.set(50),n.resolve(t),!i.isSafari)return A.end(),n.promise;n.resolve(JSONToCSVConvertor(t,usersReportFileName,!0,o))}}),!i.isSafari)return A.end(),n.promise},e.saveDefaultGroupSetting=function(){e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1);var o={defaultData:{org_unit_id:e.currentOUId,conversation_analytics_status:e.enableConvAna,spam_guard_status:e.enableSpam,share_with_subgroup:e.shareDni}};t.saveDefaultGroupSetting(o).then(function(e){"error"===e.data.result?s.notify({title:"Default Feature Settings",text:e.data.err,type:"error"}):s.notify({title:"Default Feature Settings",text:"Successfully Saved The Feature Settings",type:"success"})})},e.enableSave=function(t){"tag_call"===e.addCallAction.actionOptions[t]&&(e.callActionLoaded||(e.addCallAction.callActionFormSubmitted[t]=!1),e.callActionLoaded=!1)},e.showRemoveRule=function(e){var t=0;return $.each(e,function(e,o){x(o)||(t+=1)}),t>1},e.sizeOf=function(e){return Object.keys(e).length},e.setDefaultCallAction=function(t){e.addCallAction.actionOptions[t]="action0";var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[t]={0:{fields:Object.keys(o)}},e.addCallAction.rule[t]={0:{fields:"",operators:"",enum:"",join_type:""}},e.addCallAction.email[t]=[],e.addCallAction.remainingText[t]="1024 characters are remaining",e.addCallAction.phone[t]=[],e.addCallAction.tagList[t]=[],e.addCallAction.postEvent[t]=[],e.addCallAction.webhook[t]=[]},e.removeSelectedWhisperAudio=function(){void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,e.whisperURL=void 0,e.whisperTTSText="",e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!1},e.loadCallActionSection=function(o){if(o){var a="",i=1,r={};t.getCallActions(e.currentOUId).then(function(t){if(e.callActionLoaded=!0,"error"!=t.data.result&&t.data.json.length>0&&t.data.json[0].rules.length>0&&(e.callActions=[],t.data.json.forEach(function(t){e.addCallAction.rule[t.action_order]={},e.ruleDropDown[t.action_order]={};var o=Object.assign({},e.names.fields);switch(delete o["Ring to Phone Number"],t.rules.forEach(function(i,r){a="duration"==F(o,i.data_field)?"="==i.operator?"=":"!="==i.operator?"!=":F(e.names.Ct_operators_based_on_fields,i.operator):F(e.names.Ct_operators_based_on_fields,i.operator),"NONE"==i.join_type&&(i.join_type=""),"contains"!==i.operator&&"does not contain"!==i.operator&&"begins with"!==i.operator&&"ends with"!==i.operator||(a=i.operator),e.addCallAction.rule[t.action_order][r]={},e.ruleDropDown[t.action_order][r]={},e.addCallAction.rule[t.action_order][parseInt(r)+1]={},e.ruleDropDown[t.action_order][parseInt(r)+1]={},e.ruleDropDown[t.action_order][r].fields=Object.keys(o),e.ruleDropDown[t.action_order][r].operators=e.names.operators[F(o,i.data_field)],e.ruleDropDown[t.action_order][r].enum=e.names.enum[F(o,i.data_field)],e.ruleDropDown[t.action_order][r].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(r)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][r].fields=F(o,i.data_field),e.addCallAction.rule[t.action_order][r].operators=a,e.addCallAction.rule[t.action_order][r].enum=i.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][r].join_type=i.join_type,e.addCallAction.rule[t.action_order][parseInt(r)+1].join_type=""}),r={id:t.action_order},t.action){case"email_alert":for(var n=[],s=t.action_target.split(","),l=0;l<s.length;l++){var c={id:i,text:s[l]};n.push(c),i++}var d=t.action_target.replace(/,/g,"");d=d.replace(/ /g,""),e.addCallAction.remainingText[t.action_order]=1024-d.length+" characters are remaining",e.addCallAction.email[t.action_order]=n;break;case"sms_alert":e.addCallAction.phone[t.action_order]=t.action_target;break;case"tag_call":var u=[];t.action_target=t.action_target.split(","),angular.forEach(t.action_target,function(e,t){var o=e.trim();u.push(o)}),e.addCallAction.tagList[t.action_order]=u;break;case"post_event":e.addCallAction.postEvent[t.action_order]=t.action_target;break;case"webhook":e.addCallAction.webhook[t.action_order]=t.action_target;break;case"post_detail":e.addCallAction.sendCallDetails[t.action_order]=t.action_target;break;case"callback":e.addCallAction.callbackFlag[t.action_order]=t.action_target}e.addCallAction.action_id[t.action_order]=t.default_action_id,e.addCallAction.actionOptions[t.action_order]=t.action,"doubleclick"===t.action&&!1===e.dcSetting&&(e.addCallAction.actionOptions[t.action_order]=""),e.addCallAction.callActionFormSubmitted[t.action_order]=!0,e.callActions.push(r)})),x(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.email[1]=[],e.addCallAction.remainingText[1]="1024 characters are remaining",e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}})}},e.loadCallActions=function(o){e.addNewStep=!0,void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.showCallActions=!0;e.callActions=[],e.callActions.push({id:1}),e.addCallAction={},e.addCallAction.cfname="Test",e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.addCallAction.callActionFormSubmitted={},e.addCallAction.remainingText={},e.callActionTaggingOptions=[],e.customsources={},e.callActionWebhookOptions=[],e.ruleDropDown={},e.callActionLoaded=!1,t.getWebhooks(i.currentOUId).then(function(t){if(null===t.data.err||""===t.data.err){for(var o=[],a=0;a<t.data.json.length;a++)"active"===t.data.json[a].webhook_status&&o.push(t.data.json[a]);e.callActionWebhookOptions=o}}),S.getTags().then(function(t){if(console.log("tags:",t),""===t.data.err){e.callActionTaggingOptionsWatch=!1,e.callActionTaggingOptions=t.data.json;for(var o=0;o<t.data.json.length;o++)"callback"===t.data.json[o].tag_name&&(e.callbackid=t.data.json[o].tag_id);if(e.callbackid<0){var a={tag:{tag_name:"callback",org_unit_id:i.currentOUId}};y.createTag(a).then(function(e){console.log(e)})}}}),e.gaSetting=!0,y.getAnalytics().then(function(t){""===t.data.err&&t.data.json.length>0&&(t.data.json[0].all_routes||"inactive"===t.data.json[0].analytic_status)&&(e.gaSetting=!1)}),e.dcSetting=!1,y.callActionDC(i.currentOUId).then(function(t){"success"===t.data.result&&t.data.json.dc_enabled&&(console.log("Setting dcSetting to true"),e.doubleclick_id=t.data.json.doubleclick_id,e.dcSetting=!0)})},e.select2OptionsCS1={formatNoMatches:function(t){e.formatNoMatchesType="CS1",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS2={formatNoMatches:function(t){e.formatNoMatchesType="CS2";var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS3={formatNoMatches:function(t){e.formatNoMatchesType="CS3",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS4={formatNoMatches:function(t){e.formatNoMatchesType="CS4",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.select2OptionsCS5={formatNoMatches:function(t){e.formatNoMatchesType="CS5",console.log("Term: "+t);var o='<a ng-click="addCustomSource()">Add Custom source:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.saveDefaultCallFlowSetting=function(){angular.element("#rinterval").removeClass("ng-invalid ng-dirty"),angular.element("#rinterval").addClass("ng-valid"),angular.element("#ringtonumber").removeClass("ng-invalid ng-dirty"),angular.element("#ringtonumber").addClass("ng-valid"),t.getDefaultCustomParams(i.currentOUId).then(function(t){"success"===t.data.status&&(e.custom_params=t.data.json[0].custom_params,console.log("Custom Param Source",e.custom_params))});var a,r,n,l=[],c=!1,d="",u="",p=null,m=null,g="",f="";e.TTSSelected?a=e.voicePromptTTSText:(a="file://"+(n=T("filter")(e.prompts,function(t){return t.id===e.voicePromptId})[0]).filename,g=n.name,d=n.url,p=e.voicePromptId);e.TTSWhisperSelected?r=e.whisperTTSText:(r="file://"+(n=T("filter")(e.whispers,function(t){return t.id===e.whisperId})[0]).filename,f=n.name,u=n.url,m=e.whisperId);r=void 0===r?"":r,_.each(N,function(t){null!==e[t]&&e[t].length>0&&l.push(parseInt(e[t]))});var h=e.referrer.split("|");e.tempReferrer=h[0],e.referrer_type=h[1],e.referrer_type||(e.referrer_type=null);var v={callFlowData:{org_unit_id:e.currentOUId,recordcall:e.recordCall,play_voice_prompt:e.voicePrompt1,play_whisper_message:e.whisperPrompt1,prompt_message:a,whisper_message:r,play_disclaimer:e.playDisclaimer,repeat_interval_call:e.rinterval,voice_prompt_url:d,whisper_message_url:u,whisper_id:m,voice_prompt_id:p,whisper_message_name:f,prompt_message_name:g},dniSettingData:{org_unit_id:e.currentOUId,destination_url:e.destination_url,dni_type:e.dni_type,dni_element:e.dni_element,referrer:e.tempReferrer,referrer_type:e.referrer_type,ttl:e.dni_ttl,custom_params:e.custom_params}};console.log("saveData=",v.dniSettingData.custom_params),e.ringtoNum&&(v.callFlowData.ringto=o.unMaskData(e.ringtoNum.toString())),console.log("saveData.callFlowData.ringto",v.callFlowData.ringto),void 0!==v.callFlowData.repeat_interval_call&&(v.callFlowData.repeat_interval_call>8760||0===v.callFlowData.repeat_interval_call)&&(c=!0,angular.element("#rinterval").addClass("ng-invalid ng-dirty"),angular.element("#rinterval").removeClass("ng-valid"),s.notify({title:"Tracking Number Settings",text:"Repeat Interval is invalid",type:"error"})),void 0===v.callFlowData.ringto?c=!1:v.callFlowData.ringto.length<=9&&(c=!0,angular.element("#ringtonumber").addClass("ng-invalid ng-dirty"),angular.element("#ringtonumber").removeClass("ng-valid"),s.notify({title:"Tracking Number Settings",text:"Ring-to Phone Number is invalid",type:"error"})),l.length>0&&(v.customSourceData={ids:l}),e.voicePrompt1&&!a&&(c=!0,s.notify({title:"Tracking Number Settings",text:"Voice Prompt field is required",type:"error"})),e.whisperPrompt1&&!r&&(c=!0,s.notify({title:"Tracking Number Settings",text:"Whisper Message field is required",type:"error"}));var b=t.validateDniData(v.dniSettingData,e.showReferrerTextBox);return b.arrRequired.length?(e.showSaveButton(),void s.notify({title:"Default Tracking Number Settings",text:"'"+_.uniq(b.arrRequired).join(","),type:"error"})):b.arrInvalidMessage.length?(e.showSaveButton(),void s.notify({title:"Default Tracking Number Settings",text:"'"+_.uniq(b.arrInvalidMessage).join(","),type:"error"})):void(c||t.defaultCreateCallFlow(v).then(function(t){e.custom_params=v.dniSettingData.custom_params,"error"===t.data.result?s.notify({title:"Default Tracking Number Settings",text:t.data.err,type:"error"}):s.notify({title:"Default Tracking Number Settings",text:"Successfully Saved The Tracking Number Settings",type:"success"})}))},e.openTrackingNumberSection=function(o){var a="";e.random6DigitNumber=Math.floor(9e5*Math.random()+1e5),console.log("RandomNumber: ",e.random6DigitNumber),o&&t.getCallFlow(i.currentOUId).then(function(t){if("success"===t.data.status){if(t.data.json.callFlowData.length>0){var o=t.data.json.callFlowData[0],i=t.data.json.callFlowData[0].play_voice_prompt_first_text;"file://"==i.substring(0,7)?(e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.voicePromptText=o.prompt_message_name,e.voiceURL=o.voice_prompt_url,e.voicePromptId=o.voice_prompt_id):(e.TTSSelected=!0,e.voicePromptTTSText=i);var r=t.data.json.callFlowData[0].play_whisper_message_text;"file://"==r.substring(0,7)?(e.TTSWhisperSelected=!1,e.whisperText=o.whisper_message_name,e.whisperURL=o.whisper_message_url,e.hasValidWhisperURL=!0,e.whisperId=o.whisper_id):(e.TTSWhisperSelected=!0,e.whisperTTSText=r),e.recordCall=t.data.json.callFlowData[0].record_call,e.voicePrompt1=t.data.json.callFlowData[0].play_voice_prompt_first,e.whisperPrompt1=t.data.json.callFlowData[0].play_whisper_message,e.ringtoNum=t.data.json.callFlowData[0].ring_to_number,e.playDisclaimer=t.data.json.callFlowData[0].play_disclaimer,e.rinterval=t.data.json.callFlowData[0].repeat_interval_call}if(t.data.json.customSourceData.length>0&&_.each(t.data.json.customSourceData,function(t){e[t.custom_source_type]=t.custom_source_id.toString()}),console.log(t.data.json),t.data.json.dniSettingData.length>0){var n=t.data.json.dniSettingData[0].referrer;t.data.json.dniSettingData[0].referrer_type&&(n+="|"+t.data.json.dniSettingData[0].referrer_type),T("filter")(e.dniReferrer,n,!0).length<1&&e.dniReferrer.push({value:n,text:t.data.json.dniSettingData[0].referrer});var s=t.data.json.dniSettingData[0].referrer;t.data.json.dniSettingData[0].referrer_type&&(s+="|"+t.data.json.dniSettingData[0].referrer_type),e.dni_section=!1,e.dniSettingPresent=!0,e.destination_url=t.data.json.dniSettingData[0].destination_url,e.dni_type=t.data.json.dniSettingData[0].dni_type,e.dni_element=t.data.json.dniSettingData[0].dni_element,e.referrer=s,e.referrer_type=t.data.json.dniSettingData[0].referrer_type,e.dni_ttl=t.data.json.dniSettingData[0].ttl,e.custom_params=t.data.json.dniSettingData[0].custom_params}else console.log(e.dni_element),console.log("RandomNumber: ",e.random6DigitNumber),e.random6DigitNumber!==e.lastRandom&&(a=e.dni_element,console.log(a),"CVZ"===a&&(a+="_"+e.random6DigitNumber)),e.dni_element=a,console.log("Dni Element: ",e.dni_element),e.lastRandom=e.random6DigitNumber,console.log("Last Random: ",e.lastRandom)}})},e.openCustomeSourceSection=function(o){o&&t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5})},e.multipleDelete=function(){console.log("inside multipleDelete custom_source_id"),console.log("$scope.customSourceModel",e.customSourceModel);var o=_.pluck(e.customSourceModel,"id"),a="";a+="Custom Source is associated with a tracking number. Are you sure you want to delete this Custom Source?",m.confirm(a,function(a){a&&(t.multiDeleteCustomSource({custom_sources:o}).then(function(o){console.log("delete result",o),s.notify({title:"Default Custom Source Settings",text:"Successfully deleted the custom source",type:"success"}),t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5;o=t.data.json;console.log("customSourceData==",o),o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5})}),e.customSourceModel=[])})},e.clearCustomSources=function(){e.customSourceModel=[]},_.each(N,function(t){e["customSourceMethods"+t]={onAddItem:function(o){e.addCustomSource(o,t)}}}),e.addCustomSource=function(o,a){var i={customSource:{custom_source_name:o,org_unit_id:e.currentOUId,custom_source_type:a}};t.customSource(i).then(function(o){o.data.json;""===o.data.err?(s.notify({title:"Default Custom Source Settings",text:"Successfully Created Custom Source",type:"success"}),void 0===e.customsources[e.formatNoMatchesType]&&(e.customsources[e.formatNoMatchesType]=[]),e.customsources[e.formatNoMatchesType].push({id:o.data.json.custom_source_id,name:e.noResultsTag}),t.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;for(var a in console.log("customSourceData==",o),o)o[a].org_unit_id==e.currentOUId?o[a].disabled=!1:o[a].disabled=!0;o=_.groupBy(o,function(e){return e.custom_source_type}),console.log("customSourceData== CS1--",o),e.CS1Options=o.CS1,e.CS2Options=o.CS2,e.CS3Options=o.CS3,e.CS4Options=o.CS4,e.CS5Options=o.CS5})):s.notify({title:"Update custom source",text:o.data.err,type:"error"})})},e.resetFeatureSetting=function(){e.enableConvAna=!0,e.enableSpam=!0,e.shareDni=!1,e.showSpambutton||(e.enableSpam=!1),e.showCaButton||(e.enableConvAna=!1),(e.disable_share_dni||e.location_level_ou)&&(e.shareDni=!1)},e.resetCallFlowSetting=function(t){e.rinterval=72,e.CS1=null,e.CS2=null,e.CS3=null,e.CS4=null,e.CS5=null,e.playDisclaimer="before",e.recordCall=!0,e.voicePrompt1=!1,e.whisperPrompt1=!1,e.ringtoNum=null,e.voicePromptTTSText="",e.whisperTTSText="",e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.destination_url="*.*",e.referrer="*.*|null",console.log("Previous:",e.dni_element),e.dni_element="CVZ_"+e.random6DigitNumber,console.log("Current:",e.dni_element),e.dni_ttl="Select",e.dni_type="",e.custom_params="",e.showReferrerTextBox=!1},e.loadNextValue=function(t,o,a,i){"fields"==o?e.ruleDropDown[a][i][o]=Object.keys(e.names.fields):"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum="")),"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="")},e.removeRule=function(t,o){var a,i=Object.keys(e.addCallAction.rule[o]).map(function(e){return e});a=i.indexOf(t)===i.length-1,e.addCallAction.callActionFormSubmitted[o]=!1,delete e.ruleDropDown[o][t],delete e.addCallAction.rule[o][t];var r=Object.keys(e.ruleDropDown[o]).map(function(e){return e});if("join_type"===Object.keys(e.ruleDropDown[o][r[0]]).map(function(e){return e})[0]){if(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields){var n=Object.assign({},e.names.fields);delete n["Ring to Phone Number"],e.ruleDropDown[o]={0:{fields:Object.keys(n)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else""!==e.addCallAction.rule[o][r[0]].join_type&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type);a&&(e.addCallAction.rule[o][t]={},e.ruleDropDown[o][t]={},e.addCallAction.rule[o][t].join_type="",e.ruleDropDown[o][t].join_type=["AND","OR"])},e.select2Options=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-click="addTag(term)">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.trim()==t[r].text.trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="addTag(term);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return t},simple_tags:!0,allowClear:!0}},e.addTag=function(t){if(_.where(e.callActionTaggingOptions,{tag_name:this.noResultsTag.trim()}).length>0)return s.notify({title:"Update Tags",text:"This Tag already exists",type:"error"}),!1;var o={tag:{tag_name:e.noResultsTag.trim(),org_unit_id:i.currentOUId}};$(".select2-drop").hide(),y.createTag(o).then(function(t){e.callActionTaggingOptionsWatch=!0,""===t.data.err&&(s.notify({title:"Create Tags",text:"Successfully added the tag",type:"success"}),e.callActionTaggingOptions.push({tag_id:t.data.json.tag_id,tag_name:e.noResultsTag.trim(),org_unit_id:i.currentOUId}))})},e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&l(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.countElement=function(t,o){var a=[],i=e.addCallAction.email[t];if(void 0!==i){for(var r=0;r<i.length;r++)a.push(i[r].text);var n=a.join(",");n=n.replace(/,/g,"").replace(/ /g,""),e.addCallAction.remainingText[t]=1024-n.length+" characters are remaining",e.addCallAction.callActionFormSubmitted[t]=!1}},e.saveCallAction=function(o,a){var i=[],r=[],n={},l=1,c=1;e.errorEmail="",e.invalidNumber=!1,e.errors={},e.errors[o]={},e.invalidEmailIds=[];var d,u={id:(o=parseInt(o))+1};switch(e.addCallAction.actionOptions[o]){case"email_alert":var p=[];void 0===(n=e.addCallAction.email[o])&&(n=[]);for(var m=0;m<n.length;m++){angular.isUndefined(n[m].text)||!n[m].text.length||/^[_a-zA-Z0-9]*['a-zA-Z0-9]*[-a-zA-Z0-9]*[\.a-zA-Z0-9]*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})*(\.[a-zA-Z]{2,4})/.test(n[m].text.trim())||(i.push(n[m].text),e.invalidEmailIds.push(n[m].text)),p.push(n[m].text.trim())}var g=_.uniq(p).join(",");(g=g.replace(/,/g,"")).length>1024&&(e.errorEmail="No of characters should not be greater than 1024"),n=_.uniq(p),e.addCallAction.email[o]=[];for(var f=Math.floor(1e3+9e3*Math.random()),h=0;h<n.length;h++){var v={id:h+1+f,text:n[h]};e.addCallAction.email[o].push(v)}e.addCallAction.remainingText[o]=1024-g.length+" characters are remaining";break;case"sms_alert":var b=angular.copy(e.addCallAction.phone[o]);if(b)10!=b.replace(/[()_\-\s]/gi,"").length&&(e.invalidNumber=!0,i.push("Phone Number"));n=e.addCallAction.phone[o];break;case"tag_call":n=e.addCallAction.tagList[o];break;case"post_event":n=e.addCallAction.postEvent[o];break;case"webhook":n=e.addCallAction.webhook[o];break;case"post_detail":n=e.addCallAction.sendCallDetails[o];break;case"callback":n=e.callbackid.toString();break;case"doubleclick":n=void 0!==e.doubleclick_id?e.doubleclick_id:null;break;case"analytic":n=null}if(angular.isArray(n)&&(n=n.join(", ")),x(e.addCallAction.rule[o])&&1===c&&(r.push("Rule"),c+=1),_.each(e.addCallAction.rule[o],function(t,a){(!x(t)&&void 0!==t.fields||!x(t)&&!x(t.join_type))&&((x(t.fields)||x(t.enum)||x(t.operators))&&(x(t.enum)&&(e.errors[o][a]=!0),1===c&&(r.push("Rule"),c+=1)),x(t.enum)||"referring source"!=t.fields||"contains"!=t.operators&&"does not contain"!=t.operators||(t.enum.startsWith("*.")||t.enum.endsWith(".*"))&&(1===l&&(i.push("WildCard only Support With is/is not for referring source."),l+=1),e.errors[o][a]=!0),x(t.enum)||("duration"==t.fields&&!L(t.enum)||"caller id"==t.fields&&(!L(t.enum)||t.enum.length>10))&&(1===l&&(i.push("Rule Value"),l+=1),e.errors[o][a]=!0))}),angular.isArray(n)?x(n)&&r.push("Action"):""!==n&&void 0!==n||r.push("Action"),"action0"==e.addCallAction.actionOptions[o]&&r.push("Action Target"),r.length||i.length||e.errorEmail.length)return r.length&&(d="Field Is Required.",r.length>1&&(d="Fields Are Required."),s.notify({title:"Default Call Action Settings",text:"'"+r.join(", ")+"' "+d,type:"error"})),e.errorEmail.length>0&&s.notify({title:"Default Call Action Settings",text:e.errorEmail,type:"error"}),e.invalidEmailIds.length>0?(d="Invalid email address entered. Please fix highlighted errors and re-save",s.notify({title:"Default Call Action Settings",text:"'"+e.invalidEmailIds.join(", ")+"' "+d,type:"error"})):i.length&&(d="Field Is Invalid.",i.length>1&&(d="Fields Are Invalid."),s.notify({title:"Default Call Action Settings",text:"'"+i.join(", ")+"' "+d,type:"error"})),$(".invalidTag").closest("li").addClass("invalidList"),i=[],r=[],!1;var w={provisioned_route_id:e.addCallAction.provisioned_route_id,default_action_id:e.addCallAction.action_id[o],action_order:o,rules:function(t){var o=[],a="";for(var i in t){"contains"===t[i].operators||"does not contain"===t[i].operators||"begins with"===t[i].operators||"ends with"===t[i].operators?t[i].operators:e.names.Ct_operators[t[i].operators],a="NONE",t[i].join_type.length&&(a=t[i].join_type),t[i].fields&&o.push({data_field:e.names.fields[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a})}return o}(e.addCallAction.rule[o]),action:e.addCallAction.actionOptions[o],action_target:n,org_unit_id:e.currentOUId};e.addNewStep=!1,void 0===w.default_action_id?t.saveCallActions(w).then(function(t){if(e.addNewStep=!0,"success"===t.data.status){if(e.addCallAction.callActionFormSubmitted[o]=!0,s.notify({title:"Default Call Action Settings",text:"Successfully Saved Call Action Settings",type:"success"}),e.addCallAction.action_id[o]=t.data.json.insertId,a){e.callActions.push(u),e.addCallAction.actionOptions[u.id]="action0";var i=Object.assign({},e.names.fields);delete i["Ring to Phone Number"],e.ruleDropDown[o+1]={0:{fields:Object.keys(i)}},e.addCallAction.email[o+1]=[],e.addCallAction.rule[o+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else s.notify({title:"Default Call Action Settings",text:t.data.err.data,type:"error"})}):t.updateCallActions(w).then(function(t){if(e.addNewStep=!0,"success"===t.data.status){if(e.addCallAction.callActionFormSubmitted[o]=!0,s.notify({title:"Update Call Action Settings",text:"Successfully Updated Call Action Settings",type:"success"}),a){e.callActions.push(u),e.addCallAction.actionOptions[u.id]="action0";var i=Object.assign({},e.names.fields);delete i["Ring to Phone Number"],e.ruleDropDown[o+1]={0:{fields:Object.keys(i)}},e.addCallAction.rule[o+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}else s.notify({title:"Update Call Action Settings",text:t.data.err.data,type:"error"})})},n.get("assets/demo/old_call_actions.json").then(function(t){e.names=t.data,e.loadCallActions(e.currentOUId)}),e.tagAdded=function(t,o){var a=1;if(void 0!==e.addCallAction.email[t]&&e.addCallAction.email[t].length>1){var i=e.addCallAction.email[t].indexOf(o)-1;a=e.addCallAction.email[t][i].id+1}o.id=a},e.addNewCallAction=function(t){var o;if(o={id:(t=parseInt(t))+1},e.addCallAction.callActionFormSubmitted[t]){e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.callActions.push(o),e.addCallAction.actionOptions[t+1]="action0";var a=Object.assign({},e.names.fields);delete a["Ring to Phone Number"],e.ruleDropDown[t+1]={0:{fields:Object.keys(a)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}else e.saveCallAction(t,!0)},e.addAction=function(){var t;e.ivrActions.length>=10?s.notify({title:"IVR call flows",text:"only 10 actions are allowed",type:"error"}):(t={action_order:9===e.ivrActions.length?0:e.ivrActions.length+1,action:"",value:"",voiceprompt:!1,whisper:!1,webhook:!1,recordCall:!0,playDisclaimer:"before",voicepromptURL:"",voicepromptId:"",name:"Forward to phone number",ringtonum:""},e.ivrActions.push(t))},e.changeReferrer=function(){"new"===e.referrer?(e.showReferrerTextBox=!0,e.referrer=""):""!==e.referrer&&void 0!==e.referrer||(e.showReferrerTextBox=!1,e.referrer="")},e.removeCallAction=function(o){var a=!0;$.each(e.callActions,function(i,r){a&&r.id===o&&(angular.isUndefined(e.addCallAction.action_id[o])?(e.callActions.splice(i,1),R(r.id),a=!1):m.confirm("Are you sure you want to delete this Call Action?",function(n){n&&t.removecallActions(e.addCallAction.action_id[o],e.currentOUId).then(function(t){"error"!==t.data.result?(s.notify({title:"Default Call Action Settings",text:"Successfully Deleted Call Action",type:"success"}),e.callActions.splice(i,1),R(r.id),a=!1):s.notify({title:"Default Call Action Settings",text:"Error In Deleting Call Action",type:"success"})})}))})},t.getIndustries().then(function(o){var a;try{a=o.data.json}catch(e){a=[]}e.industryList=t.parseIndustries(a)}),e.user={name:"awesome user"},e.removeSelectedVoiceAudio=function(){void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,e.voiceURL=void 0,e.voicePromptTTSText="",e.TTSSelected=!0,e.hasValidVoiceURL=!1},e.showVoiceModal=function(t){O(),g.open({templateUrl:"assets/partials/assignPrompt.html",controller:"oldVoiceModal",size:t,backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<i.prompts.length;t++)!0===i.prompts[t].selectedprompt&&(e.voicePromptText=i.prompts[t].name,e.voicePromptFileName=i.prompts[t].filename,e.voicePromptId=i.prompts[t].id,e.voiceURL=i.prompts[t].url,e.hasValidVoiceURL=!0,e.TTSSelected=!0,e.promptAudio=void 0);e.prompts=i.prompts,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.voicePromptTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.showWhisperModal=function(t){O(),g.open({templateUrl:"assets/partials/assignWhisper.html",controller:"oldWhisperModal",size:t,backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<i.whispers.length;t++)!0===i.whispers[t].selectedwhisper&&(e.whisperText=i.whispers[t].name,e.whisperFileName=i.whispers[t].filename,e.whisperId=i.whispers[t].id,e.whisperURL=i.whispers[t].url,e.whisperAudio=void 0,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0);e.whispers=i.whispers,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.whisperTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.playVoiceAudio=function(o){void 0===e.promptAudio||e.promptAudio.paused?void 0!==e.promptAudio&&e.promptAudio.paused?e.promptAudio.play():void 0!==e.voicePromptTTSText&&e.voicePromptTTSText.length>0?(e.promptAudio=new Audio,e.onTTS_VP_Request=!0,t.getTTS(e.voicePromptTTSText).then(function(t){if(t.data){var o="data:audio/mp3;base64,"+t.data.json;e.promptAudio.src=o,e.promptAudio.paused?e.promptAudio.play():e.promptAudio.pause()}e.onTTS_VP_Request=void 0})):(e.promptAudio=new Audio(o),e.promptAudio.play()):e.promptAudio.pause()},e.playWhisperAudio=function(o){void 0===e.whisperAudio||e.whisperAudio.paused?void 0!==e.whisperAudio&&e.whisperAudio.paused?e.whisperAudio.play():void 0!==e.whisperTTSText&&e.whisperTTSText.length>0?(e.whisperAudio=new Audio,e.onTTS_WH_Request=!0,t.getTTS(e.whisperTTSText).then(function(t){if(t.data){var o="data:audio/mp3;base64,"+t.data.json;e.whisperAudio.src=o,e.whisperAudio.play()}e.onTTS_WH_Request=void 0})):(e.whisperAudio=new Audio(o),e.whisperAudio.play()):e.whisperAudio.pause()},e.chkSpclChar=function(e,t,o){var a=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;a.test(e)?(s.notify({title:t,text:"Special characters are not allowed",type:"error"}),o(e.replace(a,""))):o(e)},e.voiceTextChange=function(){e.promptAudio=void 0,void 0===e.voicePromptTTSText||0===e.voicePromptTTSText.length?(e.hasValidVoiceURL=!1,e.TTSSelected=!0):e.chkSpclChar(e.voicePromptTTSText,"Voice Prompt",function(t){e.voicePromptTTSText=t,e.hasValidVoiceURL=!0,e.TTSSelected=!0})},e.whisperTextChange=function(){console.log("canModify",e.canModify),console.log("$scope.hasValidWhisperURL",e.hasValidWhisperURL),e.whisperAudio=void 0,void 0===e.whisperTTSText||0===e.whisperTTSText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):e.chkSpclChar(e.whisperTTSText,"Whisper Message",function(t){e.whisperTTSText=t,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0})},e.audioIsPlaying=function(t){return"whisper"!=t&&void 0!==e.whisperAudio&&!e.whisperAudio.paused&&!e.whisperAudio.ended||("prompt"!=t&&void 0!==e.promptAudio&&!e.promptAudio.paused&&!e.promptAudio.ended||"ivr"!=t&&void 0!==e.ivrAudio&&!e.ivrAudio.paused&&!e.ivrAudio.ended)};var O=function(){void 0!==e.whisperAudio&&(e.whisperAudio.pause(),e.whisperAudio=void 0),void 0!==e.promptAudio&&(e.promptAudio.pause(),e.promptAudio=void 0),void 0!==e.ivrAudio&&(e.ivrAudio.pause(),e.ivrAudio=void 0)};e.audioIsDownloading=function(){return void 0!==e.whisperAudio&&void 0!==e.onTTS_WH_Request||(void 0!==e.promptAudio&&void 0!==e.onTTS_VP_Request||void 0!==e.ivrAudio&&void 0!==e.onTTS_IVR_Request)},e.$watch("noResultsTag",function(t,o){t&&t!==o&&l(function(){var t=$(".select2-no-results");console.log(t.contents()),d(t.contents())(e)})},!0),e.customoptiontemplate={formatNoMatches:function(t){console.log("Term: "+t);var o='<a ng-click="postcallcustom()">Add tag:"'+t+'"</a>';return e.$$phase||e.$apply(function(){e.noResultsTag=t}),o}},e.inactive=!0,e.changeStatus=function(){e.inactive=!e.inactive},e.determineDisabilityDeleteBtn=function(){e.canDeleteOU=!1,parseInt(i.currentOUId)!==parseInt(i.topLevelOUId)&&7===i.userAccess.orgunit&&(e.canDeleteOU=!0)},e.determineDisabilityDeleteBtn(),e.deleteThisOU=function(){var o;e.isDeleteClicked=!0,7===i.userAccess.orgunit?i.currentOUId!==i.highestOUId?t.infoAboutOuAndChildren(i.currentOUId).then(function(a){if(e.isDeleteClicked=!1,"error"!==a.status){var r=a.data.json;console.log("Second=======================================",r),o=["Deleting this Group will delete <br>","(",r.userCount,") Users, <br>","(",r.orgUnitCount,") Groups, <br>","(",r.campaignCount,") Campaigns, <br>","(",r.callFlowCount,") Call Flows, <br>","(",r.webhookCount,") Webhooks, <br>","(",r.dniCount,") Dni Settings, <br>","(",r.tagCount,") Tags, <br>","(",r.reservedCount,") Reserve Numbers, <br>","(",r.reservedPremiumCount,") Premium Reserve Numbers, <br>","and any integrations associated with this group and all sub-groups. ","All active phone numbers associated with this group will be released from ","your account. Are you sure you want to proceed? Type 'yes' to proceed."].join(""),m.prompt(o,function(e){var o;"yes"==(e=null===e?"":e).toLowerCase()?t.deleteOU(i.currentOUId).then(function(e){if("can't delete top level ou"!==e.data.err)if(e.data.err)s.notify({title:"Delete Group",text:"Server error in attempt to delete OU",type:"error"});else{if(s.notify({title:"Group",text:i.currentOUName+" deleted.",type:"info"}),o=e.data.json)return t.getOULevel(o.org_unit_id);s.notify({title:"Delete Group",text:"No parent data supplied by server.",type:"error"})}else s.notify({title:"Delete Group",text:"Attempt to delete top level Group not permitted.",type:"error"})}).then(function(e){if(e&&e.data.json&&e.data.json.ouLevel){o.ouLevel=e.data.json.ouLevel,i.bc_ous[i.currentOULevel].id=null,i.bc_ous[i.currentOULevel].name=null,p.updateSessData(o.org_unit_id,o.org_unit_name,i.currentOULevel-1),i.currentOULevel=o.ouLevel;parseInt(i.currentOULevel);b.getOUData(o.org_unit_id).success(function(e){i.selectedOU={id:o.org_unit_id,level:o.ouLevel},1==o.ouLevel&&b.loadLevel1(i.highestOUId),2==o.ouLevel&&b.loadLevel2(i.currentOUId),i.selectedOU={id:o.org_unit_id,level:o.ouLevel},f.reload()})}else s.notify({title:"Delete Group",text:"Error getting Group's level.",type:"error"})}):s.notify({title:"Delete Group",text:"User didn't respond 'yes', so no Group was deleted.",type:"info"})})}else console.log("error getting info about OU and its children")}):s.notify({title:"Permissions",text:"You can't delete a top level Group",type:"error"}):s.notify({title:"Permissions",text:"You dont have permission to delete a Group",type:"error"})},e.formSubmit=!1;var U=r.add?"add":"update";t.getOrgUnitById(i.currentOUId).then(function(t){setTimeout(function(){var o=t.data.json[0];e.companyName=o.org_unit_name,e.orgIdExternal=o.org_unit_ext_id,e.phone=o.phone_number,e.city=o.city,e.industry=o.industry_id,e.zip=o.zip,e.parentCompany=o.parent_id,e.state=o.state},500)}),e.saveOrg=function(){if(e.ouForm.$valid){var o={orgUnit:{org_unit_name:e.companyName,org_unit_ext_id:e.orgIdExternal,phone_number:e.phone,city:e.city,industry_id:e.industry,zip:e.zip,state:e.state,billing_id:v.sessionStorage.billingId}};"add"===U&&e.ouForm.$valid?(o.orgUnit.org_unit_parent_id=i.currentOUId,t.createOrgUnit(o).then(function(t){e.formSubmit=!1;s.notify({title:"Company Details",text:o.orgUnit.org_unit_name+" created under "+i.currentOUName,type:"success"})})):"update"===U&&e.ouForm.$valid&&(o.orgUnit.org_unit_id=i.currentOUId,k=i.currentOUName===o.orgUnit.org_unit_name?o.orgUnit.org_unit_name+" updated.":i.currentOUName+"  (now "+o.orgUnit.org_unit_name+") updated.",t.updateOrgUnit(o).then(function(t){e.formSubmit=!1,console.log(t),"error"===t.data.result?s.notify({title:"Company Details",text:t.data.err,type:"error"}):s.notify({title:"Company Details",text:k,type:"success"})}))}else s.notify({title:"Company Details",text:"Please fix invalid fields before saving organization details.",type:"error"})},e.showSubmit=function(){setTimeout(function(){e.submitted1=!1},100)},e.showSaveButton=function(){setTimeout(function(){e.formSubmit1=!1},100)}}]).controller("OldSubOrgUnitController",["$scope","OldOrgUnitWebService","$rootScope","$routeParams","pinesNotifications","OrgUnitLocal","$bootbox","$route","$filter","BreadcrumbWebService","$window","DynamicCssInsertion","paginationService",function(e,t,o,a,i,r,n,s,l,c,d,u,p){e.isReadonly=!1,e.userAccess&&e.userAccess.orgunit<7&&(e.isReadonly=!0),e.canAddSub=!1,o.userOULevel=parseInt(o.userOULevel),o.currentOULevel=parseInt(o.currentOULevel),0===o.userOULevel&&o.currentOULevel<2?e.canAddSub=!0:1==o.userOULevel&&o.currentOULevel<1&&(e.canAddSub=!0),e.subgroups=[],e.currentPage=1,e.pageSize=100,e.locNewRow=0,e.arrRequired=[],e.arrInvalid=[],e.specificErrors=[],e.actionHeader=["Actions"],e.subUserHeaders=["OUID","Group Name","External ID","Industry","Phone","City","State/Province","Zip/Postal Code"],e.isDeleteClicked=!1,e.isSubGroupOpen=!0,e.addsubgroupInProcess=!1,t.getChildrenOUs(o.currentOUId).success(function(t){for(var o in t.json)e.subgroups.push(t.json[o])}).error(function(e){console.log("err fetching children"),console.log(e)}),e.industries=[],t.getIndustries().then(function(t){for(var o in t.data.json)e.industries.push({value:t.data.json[o].industry_id,text:t.data.json[o].industry_group+": "+t.data.json[o].industry_name})}),e.showIndustry=function(t){if(t.industry_id){if(e.industries.length){var o=l("filter")(e.industries,{value:t.industry_id},!0);return o.length?o[0].text:"Not set"}return t.industry_id||"Not set"}},e.showState=function(t){if(t.state){if(e.states.length){var o=l("filter")(e.states,{value:t.state});return o.length?o[0].text:"Not set"}return t.state||"Not set"}},e.cancelAdd=function(t,o,a){if(o)a.$cancel();else{var i=p.getCurrentPage("pg-subgroups");i>1&&(t=100*(i-1)+t),e.subgroups.splice(t,1),e.locNewRow=0}e.locNewRow=0},e.deleteOU=function(a,r){var s;e.isDeleteClicked=!0,console.log(a),console.log(r),7===o.userAccess.orgunit?r!==o.highestOUId?t.infoAboutOuAndChildren(r).then(function(o){if("error"!==o.status){var l=o.data.json;console.log("First=======================================",l),s=["Deleting this Group will delete <br>","(",l.userCount,") Users, <br>","(",l.orgUnitCount,") Groups, <br>","(",l.campaignCount,") Campaigns, <br>","(",l.callFlowCount,") Tracking Numbers, <br>","(",l.webhookCount,") Webhooks, <br>","(",l.dniCount,") Dni Settings, <br>","(",l.tagCount,") Tags, <br>","(",l.reservedCount,") Reserve Numbers, <br>","(",l.reservedPremiumCount,") Premium Reserve Numbers, <br>","(",l.scoreCardCount,") Scorecards<br>","and any integrations associated with this group and all sub-groups. ","All active phone numbers associated with this group will be released from ","your account. Are you sure you want to proceed? Type 'yes' to proceed."].join(""),n.prompt(s,function(o){var n;(e.isDeleteClicked=!1,"yes"==(o=null===o?"":o).toLowerCase())?t.deleteOU(r).then(function(o){if("can't delete top level ou"!==o.data.err)if(o.data.err)i.notify({title:"Delete Group",text:"Server error in attempt to delete OU",type:"error"});else{i.notify({title:"Group",text:"Group deleted.",type:"info"});var r=p.getCurrentPage("pg-subgroups");if(r>1&&(a=100*(r-1)+a),e.subgroups.splice(a,1),n=o.data.json)return t.getOULevel(n.org_unit_id);i.notify({title:"Delete Group",text:"No parent data supplied by server.",type:"error"})}else i.notify({title:"Delete Group",text:"Attempt to delete top level Group not permitted.",type:"error"})}).then(function(e){e&&e.data.json&&e.data.json.ouLevel||i.notify({title:"Delete Group",text:"Error getting Group's level.",type:"error"})}):i.notify({title:"Delete Group",text:"User didn't respond 'yes', so no Group was deleted.",type:"info"})})}else console.log("error getting info about OU and its children")}):i.notify({title:"Permissions",text:"You can't delete a top level Group",type:"error"}):i.notify({title:"Permissions",text:"You dont have permission to delete a Group",type:"error"})},e.addSubgroup=function(){var t;if((e.addsubgroupInProcess=!0,e.subgroups.length)&&(!(t=e.locNewRow>0?e.subgroups[e.locNewRow]:e.subgroups[e.subgroups.length-1]).org_unit_name&&!t.org_unit_id))return void i.notify({title:"Subgroups",text:"Save currently added subgroup before adding another.",type:"info"});if(e.inserted={org_unit_name:"",org_unit_ext_id:"",industry_id:"",phone_number:"",city:"",state:"",zip:""},e.subgroups.length>99){var o=p.getCurrentPage("pg-subgroups");e.locNewRow=100*o-1,e.subgroups.length<=e.locNewRow&&(e.locNewRow=e.subgroups.length),e.subgroups.splice(e.locNewRow,0,e.inserted)}else e.subgroups.push(e.inserted)},e.saveSubgroup=function(a,r,n,s){a.org_unit_name=a.org_unit_name.trim();var l={orgUnit:{org_unit_name:a.org_unit_name,org_unit_ext_id:a.org_unit_ext_id,phone_number:a.phone_number,city:a.city,industry_id:a.industry_id,zip:a.zip,state:a.state,billing_id:d.sessionStorage.billingId}};r?(l.orgUnit.org_unit_id=r,l.orgUnit.org_unit_parent_id=o.currentOUId,e.isReadonly=!0,t.updateOrgUnit(l).then(function(t){e.isReadonly=!1,"success"===t.data.result?i.notify({title:"Sub-groups",text:"Sub-group "+l.orgUnit.org_unit_name+" was updated successfully.",type:"success"}):(e.error=t,i.notify({title:"Sub-groups",text:t.data.err,type:"error"}),setTimeout(function(){n.$show()},100))})):(e.isReadonly=!0,l.orgUnit.org_unit_parent_id=o.currentOUId,t.createOrgUnit(l).then(function(t){if(console.log(t),e.isReadonly=!1,e.addsubgroupInProcess=!1,"success"===t.data.status){n.$cancel();var r={id:parseInt(t.data.json.insertId),name:a.org_unit_name,tName:a.org_unit_name.substr(0,30),parent:parseInt(o.currentOUId),checked:!1};o.groupInfo.push(r);var c=p.getCurrentPage("pg-subgroups");c>1&&(s=100*(c-1)+s),e.subgroups[s].org_unit_id=t.data.json.insertId,i.notify({title:"Sub-groups",text:"Sub-group "+l.orgUnit.org_unit_name+" was created successfully.",type:"success"})}else e.error=t,i.notify({title:"Sub-groups",text:t.data.err,type:"error"}),setTimeout(function(){n.$show()},100)}))},e.validateData=function(t,o,a){var r;if("string"==typeof t&&(t=t.trim()),o=o.trim(),!t&&"Zip"!=o&&"Phone"!=o&&(e.arrRequired.push(o),"Industry"!=o))return"   ";if("Zip"==o&&t&&!/^[a-z0-9 ]+$/i.test(t))return i.notify({title:"Sub-groups",text:"Zip is invalid",type:"error"}),"   ";if("Phone"==o&&t&&!/^[0-9-() ]{14}$/.test(t))return i.notify({title:"Sub-groups",text:"Phone is invalid",type:"error"}),"   ";if("Industry"==o){if(e.arrRequired.length){r="field is required.",e.arrRequired.length>1&&(r="fields are required."),i.notify({title:"Sub-groups",text:"'"+e.arrRequired.join(", ")+"' "+r,type:"error"});var n=e.arrRequired.indexOf("Industry");return e.arrInvalid=[],e.arrRequired=[],n>-1?"   ":""}if(e.arrInvalid.length)return r="field is invalid.",e.arrInvalid.length>1&&(r="fields are invalid."),i.notify({title:"Sub-groups",text:"'"+e.arrInvalid.join(", ")+"' "+r,type:"error"}),e.specificErrors.length&&i.notify({title:"Sub-groups",text:"'"+e.specificErrors.join(", ")+"'",type:"error"}),e.arrRequired=[],e.arrInvalid=[],e.specificErrors=[],""}},e.scrollToTop=function(){d.scrollTo(0,0)},e.setCurrentOU=function(e,a){var i=parseInt(o.currentOULevel)+1;c.getOUData(e).success(function(r){o.bc_ous[i]={id:e,name:a},o.selectedOU={id:e,level:i},1==i&&c.loadLevel1(o.highestOUId),2==i&&c.loadLevel2(o.currentOUId),o.selectedOU={id:e,level:i},t.getStyle(e).then(function(e){"success"===e.data.result&&(o.chatURL=d.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",Object.keys(e.data.json).length>0?(o.white_label_active=d.sessionStorage.white_label_active=e.data.json.white_label_active,o.chatActive=d.sessionStorage.chatActive=e.data.json.chat_active):(o.white_label_active=d.sessionStorage.white_label_active=!1,o.chatActive=d.sessionStorage.chatActive=!0),o.feedbackURL=window.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+window.sessionStorage.uservoiceSSO,o.supportURL=d.sessionStorage.supportURL="https://knowledgebase.convirza.com",u.whiteLabelCSSInject(e.data.json.white_label_css,e.data.json.org_logo,e.data.json.org_logo,!1))}),o.currentOUId=d.sessionStorage.currentOUId=e,o.currentOUName=d.sessionStorage.currentOUName=a,o.currentOULevel=d.sessionStorage.currentOULevel=i,s.reload()}).error(function(e){console.log("err fetching Org"),console.log(e)})},e.states=[{subgroup:"US",value:"AK",text:"Alaska"},{subgroup:"US",value:"HI",text:"Hawaii"},{subgroup:"US",value:"CA",text:"California"},{subgroup:"US",value:"NV",text:"Nevada"},{subgroup:"US",value:"OR",text:"Oregon"},{subgroup:"US",value:"WA",text:"Washington"},{subgroup:"US",value:"AZ",text:"Arizona"},{subgroup:"US",value:"CO",text:"Colorado"},{subgroup:"US",value:"ID",text:"Idaho"},{subgroup:"US",value:"MT",text:"Montana"},{subgroup:"US",value:"NE",text:"Nebraska"},{subgroup:"US",value:"NM",text:"New Mexico"},{subgroup:"US",value:"ND",text:"North Dakota"},{subgroup:"US",value:"UT",text:"Utah"},{subgroup:"US",value:"WY",text:"Wyoming"},{subgroup:"US",value:"AL",text:"Alabama"},{subgroup:"US",value:"AR",text:"Arkansas"},{subgroup:"US",value:"IL",text:"Illinois"},{subgroup:"US",value:"IA",text:"Iowa"},{subgroup:"US",value:"KS",text:"Kansas"},{subgroup:"US",value:"KY",text:"Kentucky"},{subgroup:"US",value:"LA",text:"Louisiana"},{subgroup:"US",value:"MN",text:"Minnesota"},{subgroup:"US",value:"MS",text:"Mississippi"},{subgroup:"US",value:"MO",text:"Missouri"},{subgroup:"US",value:"OK",text:"Oklahoma"},{subgroup:"US",value:"SD",text:"South Dakota"},{subgroup:"US",value:"TX",text:"Texas"},{subgroup:"US",value:"TN",text:"Tennessee"},{subgroup:"US",value:"WI",text:"Wisconsin"},{subgroup:"US",value:"CT",text:"Connecticut"},{subgroup:"US",value:"DE",text:"Delaware"},{subgroup:"US",value:"FL",text:"Florida"},{subgroup:"US",value:"GA",text:"Georgia"},{subgroup:"US",value:"IN",text:"Indiana"},{subgroup:"US",value:"ME",text:"Maine"},{subgroup:"US",value:"MD",text:"Maryland"},{subgroup:"US",value:"MA",text:"Massachusetts"},{subgroup:"US",value:"MI",text:"Michigan"},{subgroup:"US",value:"NH",text:"New Hampshire"},{subgroup:"US",value:"NJ",text:"New Jersey"},{subgroup:"US",value:"NY",text:"New York"},{subgroup:"US",value:"NC",text:"North Carolina"},{subgroup:"US",value:"OH",text:"Ohio"},{subgroup:"US",value:"PA",text:"Pennsylvania"},{subgroup:"US",value:"RI",text:"Rhode Island"},{subgroup:"US",value:"SC",text:"South Carolina"},{subgroup:"US",value:"VT",text:"Vermont"},{subgroup:"US",value:"VA",text:"Virginia"},{subgroup:"US",value:"WV",text:"West Virginia"},{subgroup:"Canada",value:"AB",text:"Alberta"},{subgroup:"Canada",value:"BC",text:"British Columbia"},{subgroup:"Canada",value:"MB",text:"Manitoba"},{subgroup:"Canada",value:"NB",text:"New Brunswick"},{subgroup:"Canada",value:"NF",text:"Newfoundland"},{subgroup:"Canada",value:"NT",text:"Northwest Territories"},{subgroup:"Canada",value:"NS",text:"Nova Scotia"},{subgroup:"Canada",value:"ON",text:"Ontario"},{subgroup:"Canada",value:"PE",text:"Prince Edward Island"},{subgroup:"Canada",value:"QC",text:"Quebec"},{subgroup:"Canada",value:"SK",text:"Saskatchewan"},{subgroup:"Canada",value:"YT",text:"Yukon"}],$(window).scroll(function(){window.pageYOffset>5e3&&$(window).trigger("resize")}),$(window).scroll(function(){window.pageYOffset;$("button").css({height:"34px"})})}]),angular.module("subscriptions",["disableAll","api-param"]).factory("SubscriptionWebService",["$q","$rootScope","$http","$window","ApiParam",function(e,t,o,a,i){"use strict";var r={getJsonConfig:function(){return{headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}}},getUsages:function(e){return o({methods:"GET",url:i.baseURL()+"/v1/billing/usage/"+e.ouId,headers:i.headerConfig().headers})},getSummary:function(e){return o({methods:"GET",url:i.baseURL()+"/v1/billing/summary/"+e,headers:i.headerConfig().headers})},getBilling:function(e){return o({methods:"GET",url:i.baseURL()+"/v1/billing/"+e,headers:i.headerConfig().headers})},upBilling:function(e){var t={method:"PUT",url:i.baseURL()+"/v1/billing",headers:i.headerConfig().headers,data:e};return o(t)},getSubscriptionInformation:function(e){return o.get(i.baseURL()+"/v1/zuora/getSubscriptionInformationAction/"+e,i.headerConfig())},getBillingHistory:function(e){return o.get(i.baseURL()+"/v1/zuora/getBillingHistoryAction/"+e,i.headerConfig())},getInvoicePdfFile:function(e){return o({method:"GET",url:i.baseURL()+"/v1/zuora/getInvoiceFileAction/"+e,responseType:"arraybuffer",headers:i.headerConfig().headers}).success(function(e){var t=new Blob([e],{type:"application/pdf"}),o=URL.createObjectURL(t);window.open(o)})}};return r}]).controller("SubscriptionController",["$scope","SubscriptionWebService","$rootScope","$global",function(e,t,o,a){"use strict";e.isReadonly=!!(o.userAccess&&o.userAccess.user<5),e.zohoId="cp-14040",e.callTotal=0,e.campTotal=0,e.campActive=0,e.trkNumTotal=0,e.trkNumActive=0,e.minTotal=0,e.preNumTotal=0,e.preNumActive=0,e.trkNumReserved=0,e.minPreTotal=0,e.anaNumTotal=0,e.usrTotal=0,e.resNum=0,e.showresNum=!1,e.longDistanceMinutes=0,e.longDistanceComponentIds=[932,934,936,938],o.$watch("rightbar",function(a){a&&(e.billing_node=o.billing_id===o.currentOUId,e.admin=!!(o.userAccess&&o.userAccess.billing>=7),t.getSummary(o.currentOUId).success(function(t){if(e.longDistanceMinutes=0,"error"!==t.result)if(e.allow_admin=!1!==t.json.allow_admin||t.json.allow_admin,void 0!==t.json.billing_id&&(e.billing_node=t.json.org_unit_id===t.json.billing_id),e.si=t.json,e.si.account_name&&e.si.account_name.length>20&&(e.si.account_name=e.si.account_name.substring(0,17)+"..."),e.si.billing_account_id&&(e.si.activation_date=e.si.activation_date?moment(e.si.activation_date).format("MMM D, YYYY"):"N/A",e.si.prev_invoice_date=e.si.prev_invoice_date?moment(e.si.prev_invoice_date).format("MMM D, YYYY"):"N/A",e.si.payment_date=e.si.payment_date?moment(e.si.payment_date).format("MMM D, YYYY"):"N/A",e.si.cycle_end=e.si.cycle_end?moment(e.si.cycle_end).format("MMM D, YYYY"):"N/A"),t.json.count){for(var o=0;o<t.json.count.length;o++){var a=t.json.count[o];switch(a.component_name){case"Calls":e.callTotal=a.count_total;break;case"Campaign":e.campTotal=parseInt(a.count_total)+parseInt(a.secondary_total),e.campActive=a.count_total;break;case"Numbers":e.trkNumActive=a.count_total,e.trkNumReserved=a.secondary_total;break;case"Users":e.usrTotal=a.count_total;break;case"Minutes":e.minTotal=a.count_total;break;case"Premium Numbers":e.preNumActive=a.count_total,e.preNumTotal=parseInt(a.count_total)+parseInt(a.secondary_total);break;case"Premium Minutes":e.minPreTotal=a.count_total;break;case"Analyzed Numbers":e.anaNumTotal=parseInt(a.count_total)+parseInt(a.secondary_total);break;case"Reserved Numbers":e.showresNum=!0,e.resNum=parseInt(a.count_total)}e.longDistanceComponentIds.indexOf(a.component_id)>-1&&(e.longDistanceMinutes=e.longDistanceMinutes+parseFloat(a.count_total))}e.trkNumTotal=parseInt(e.trkNumActive)+parseInt(e.trkNumReserved),parseInt(e.usrTotal)<0&&(e.usrTotal=0)}else console.log("no count totals")}).error(function(e){console.log("Error",e)}))}),e.toggleAdmin=function(e){var a={billing:{org_unit_id:o.currentOUId,allow_admin:e}};t.upBilling(a).then(function(e){"error"!==e.data.result?console.log("Successfully updated access restriction"):console.log("Failed to update access restriction")})}}]),angular.module("theme.ui-modals",[]).controller("ModalsDemoController",["$scope","$uibModal","$bootbox","$log",function(e,t,o,a){"use strict";e.items=["item1","item2","item3"],e.open=function(o){t.open({templateUrl:"myModalContent.html",controller:function(e,t,o){e.items=o,e.selected={item:e.items[0]},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}},size:o,resolve:{items:function(){return e.items}}}).result.then(function(t){e.selected=t},function(){a.info("Modal dismissed at: "+new Date)})},e.openDemoModal=function(e){t.open({templateUrl:"demoModalContent.html",controller:function(e,t){e.cancel=function(){t.dismiss("cancel")}},size:e})},e.openAlert=function(){o.alert("Hello world!")},e.openAlertWithCallback=function(){o.alert("Hello world!",function(){alert("You clicked OK!")})},e.openConfirm=function(){o.confirm("Are you sure?",function(e){alert("Confirm result: "+e)})},e.openPrompt=function(){o.prompt("What is your name?",function(e){null===e?alert("Prompt dismissed"):alert("Hi "+e+"!")})},e.openDialog=function(){o.dialog({message:"I am a custom dialog",title:"Custom title",buttons:{success:{label:"Success!",className:"btn-success",callback:function(){alert("great success")}},danger:{label:"Danger!",className:"btn-danger",callback:function(){alert("uh oh, look out!")}},main:{label:"Click ME!",className:"btn-primary",callback:function(){alert("Primary button")}}}})}}]),angular.module("theme.ui-modals",[]).controller("addEmailList",["$scope","$uibModal","$bootbox","$log",function(e,t,o,a){e.open=function(o){t.open({templateUrl:"addEmailList.html",controller:function(e,t,o){e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}},size:o,resolve:{items:function(){return e.items}}})}}]),angular.module("dashboard_report_widgets",["theme.report_service","timehelper"]).controller("DashboardWidgetController",["$scope","ReportDataWebService","$rootScope","DateRangeFiller","NumberFormat",function(e,t,o,a,i){e.kShortener=i.kShortener,e.getZeroedDataSet=function(){return _.map(_.range(1,8).reverse(),function(t){return e.createEmptyDay(moment().subtract("days",t).format("YYYY-MM-DD"))})},e.createEmptyDay=function(e){return{answered_count:0,conversion_count:0,conversion_sum:0,duration_sum:0,lead_count:0,lead_sum:0,sales_inquiry_count:0,sales_inquiry_sum:0,total_calls:0,unique_calls:0,date:e}},e.isReadonly=!0,e.userAccess&&e.userAccess.campaign>5&&(e.isReadonly=!1);var r=0;e.$watch("userAccess",function(t,o){o!==t&&0===r&&(r=1,e.userAccess&&e.userAccess.campaign>5&&(e.isReadonly=!1))});var n=moment().subtract(7,"day").format("YYYY-MM-DD"),s=moment().subtract(1,"days").endOf("day").format("YYYY-MM-DD");t.getDashboardData(o.currentOUId,n,s).then(function(t){if(t.err)console.log("no dashboard widget data avail");else{t.data.json.aggregated_data.length||(t.data.json.aggregated_data=e.getZeroedDataSet());var o=t.data.json.aggregated_data;_.each(o,function(e){e.total_calls=parseInt(e.total_calls),e.unique_calls=parseInt(e.unique_calls),e.answered_count=parseInt(e.answered_count),e.duration_sum=parseInt(e.duration_sum),e.conversion_count=parseInt(e.conversion_count),e.lead_count=parseInt(e.lead_count),e.all_marker=1});var i=crossfilter(o),r=i.dimension(function(e){return e.all_marker}).group().reduce(w,y,b);e.dataWidgetVals=r.top(1)[0].value,e.dataWidgetVals.avg_call_duration={},e.dataWidgetVals.avg_call_duration.seconds=_.zeroIfNaN(Math.round(e.dataWidgetVals.total_duration/e.dataWidgetVals.total_calls%60)),e.dataWidgetVals.avg_call_duration.minutes=_.zeroIfNaN(Math.floor(e.dataWidgetVals.total_duration/e.dataWidgetVals.total_calls/60)),e.dataWidgetVals.conversion_rate=Math.floor(100*_.zeroIfNaN(e.dataWidgetVals.total_converted/e.dataWidgetVals.total_calls)),e.dataWidgetVals.perc_leads_of_calls=Math.floor(100*_.zeroIfNaN(e.dataWidgetVals.total_leads/e.dataWidgetVals.total_calls));var l=i.dimension(function(e){return moment(e.date).format("MMMM D, YYYY")}).group().reduce(w,y,b),c=_.map(l.top(1/0),function(e){return{date:e.key,answered:e.value.answered,total_calls:e.value.total_calls,total_converted:e.value.total_converted,total_duration:e.value.total_duration,total_leads:e.value.total_duration,unique_calls:e.value.unique_calls}}),d=_.sortBy(c,function(e){return moment(e.date).unix()}),u=_.chain(d).pluck("date").map(function(e){return moment(e,"MMMM D, YYYY").format("YYYY-MM-DD")}).value(),p=a.fillInDays(u,n,s,"YYYY-MM-DD"),m=_.map(p,function(t){var o=moment(t,"YYYY-MM-DD").format("MMMM D, YYYY");return e.createEmptyDay(o)});d=d.concat(m),d=_.sortBy(d,function(e){return moment(e.date).unix()});var g=_.map(d,function(e){return[1e3*moment(e.date).unix(),parseInt(e.total_calls)]}),f=_.map(d,function(e){return[1e3*moment(e.date).unix(),parseInt(e.unique_calls)]}),h=_.map(g,function(e){return[e[0],moment.unix(e[0]/1e3).format("MMM-D")]}),v=_.map(f,function(e){return[e[0],moment.unix(e[0]/1e3).format("MMM-D")]});e.plotStatsData=[{data:g,label:"Calls by Day"}],e.plotStatsOptions={series:{lines:{show:!0,lineWidth:1.5,fill:.1},points:{show:!0}},colors:["#b3bcc7"],xaxis:{autoscaleMargin:.1,mode:"time",timeformat:"%b-%d",ticks:h},yaxis:{min:0},legend:{labelBoxBorderColor:"transparent"},tooltip:!0,tooltipOpts:{defaultTheme:!1,content:"Count: %y"},grid:{labelMargin:10,hoverable:!0,clickable:!0,borderWidth:0}},e.plotRevenueData=[{data:f,label:"Unique Calls"}],e.plotRevenueOptions={series:{bars:{show:!0,barWidth:764e5,lineWidth:1,align:"center"}},colors:["#b3bcc7"],xaxis:{mode:"time",format:"%b-%d",ticks:v},yaxis:{min:0},legend:{labelBoxBorderColor:"transparent"},tooltip:!0,tooltipOpts:{defaultTheme:!1,content:"Count: %y"},grid:{labelMargin:10,hoverable:!0,clickable:!0,borderWidth:0}}}function b(){return{total_calls:0,unique_calls:0,answered:0,total_converted:0,total_leads:0,total_duration:0}}function w(e,t){return e.total_calls+=t.total_calls,e.unique_calls+=t.unique_calls,e.answered+=t.answered_count,e.total_duration+=t.duration_sum,e.total_converted+=t.conversion_count,e.total_leads+=t.lead_count,e}function y(e,t){return e.total_calls-=t.total_calls,e.unique_calls-=t.unique_calls,e.answered-=t.answered_count,e.total_duration-=t.duration_sum,e.total_converted-=t.conversion_count,e.total_leads-=t.lead_count,e}})}]),angular.module("theme.pages-support",[]).factory("supportWebService",["$http","ApiParam","$q","$rootScope","$window","$location",function(e,t,o,a,i,r){"use strict";var n={sendRequest:function(o){var a={method:"POST",url:t.baseURL()+"/v1/support/ticket",headers:{"content-type":"application/json",Authorization:"bearer "+i.sessionStorage.token},data:o};return e(a)}};return n}]).controller("supportController",["$scope","$rootScope","$global","$window","supportWebService","pinesNotifications","$location","UserWebService",function(e,t,o,a,i,r,n,s){"use strict";o.set("fullscreen",!0),e.$on("$destroy",function(){o.set("fullscreen",!1)}),e.email_regex=/^[_a-zA-Z0-9]*['a-zA-Z0-9]*[-a-zA-Z0-9]*[\.a-zA-Z0-9]*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})*(\.[a-zA-Z]{2,4})/,e.supportRequest={email:t.userEmail},console.log(t),e.sendSupportRequest=function(){e.supportRequest.email.trim().split(" ").length>1?r.notify({title:"Support Form",text:"'Email' field is invalid.",type:"error"}):(e.supportRequest.account_id=void 0===e.supportRequest.account_id?"":e.supportRequest.account_id,e.supportRequest.phone_number=void 0===e.supportRequest.phone_number?"":s.unMaskData(e.supportRequest.phone_number.toString()),i.sendRequest(e.supportRequest).then(function(o){e.supportRequest={name:" ",email:t.userEmail,message:" "},"success"===o.data.status?r.notify({title:"Support",text:"Thank You for contacting Convirza. We will get back to you soon.",type:"success"}):r.notify({title:"Support",text:o.data,type:"error"})}))}}]),angular.module("themesApp",["toggle-switch","ui.bootstrap","ui.select2","ngGrid","xeditable","flow","theme.services","theme.directives","theme.navigation-controller","theme.notifications-controller","theme.messages-controller","theme.colorpicker-controller","theme.ui-modals","theme.ui-tables-basic","logout","theme.form-components","theme.form-directives","theme.form-validation","theme.form-inline","theme.form-uploads","theme.tables-ng-grid","theme.tables-editable","theme.charts-flot","theme.charts-inline","theme.pages-controllers","theme.pages-signup","theme.pages-support","theme.dashboard","theme.callsdetails","theme.calloverview","theme.conversations","theme.cfareports","theme.scorecards","theme.select-score-detail","theme.cfcontroller","theme.templates","theme.template-overrides","ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ngMaterial","smDateTimeRangePicker","call-flows","ngIdle","campaigns-builder","old-campaigns-builder","callers-blacklist","users-builder","org-unit","old-org-unit","breadcrumb","georoute-builder","old-georoute-builder","tag-builder","dni","theme.call_flow","theme.report_service","activitystream-builder","infinite-scroll","webhook","caller_privacy","dataappend","subscriptions","doubleclick","googleanalytics","dashboard_report_widgets","api-param","admin-session","timehelper","report-param","numForm","whitelabel","call-flow-settings","turn/stickyTableHeader2","turn/stickyTableHeader3","group_activity","group_activity_webservices","scheduled_reports","scheduled_plans","scheduled_report_webservices","distributionList","distribution_list_webservices","scheldue_url_formatter","filter_helper","campaign_list","ngTagsInput","campaign_list_webservices","angularjs-dropdown-multiselect","angularjs-dropdown-multiselect-v2","angularjs-dropdown-multiselect-v3","angularjs-dropdown-multiselect-v4","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","textAngular"]).config(["$logProvider",function(e){angular.injector(["ngCookies"]).invoke(["$cookies",function(t){var o=t.get("name");e.debugEnabled("development"===o)}])}]).config(["$httpProvider",function(e){e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}]).config(["paginationTemplateProvider",function(e){e.setPath("../views/dirPagination.tpl.html")}]).config(["tagsInputConfigProvider",function(e){e.setDefaults("tagsInput",{placeholder:""}),e.setActiveInterpolation("tagsInput",{placeholder:!0})}]).config(["IdleProvider","KeepaliveProvider",function(e,t){e.idle(5),e.timeout(3600),t.interval(2)}]).factory("loggerService",function(){"use strict";return{logAction:function(e,t){return!0}}}).factory("errorInterceptor",["$q","$cookies","$location",function(e,t,o){return{response:function(t){return t.status,t||e.when(t)},responseError:function(a){return a&&401===a.status&&(console.log("got a :",a.status),window.sessionStorage.removeItem("token"),delete window.sessionStorage.token,t.remove("ct_token"),o.path("login")),e.reject(a)}}}]).config(["$httpProvider",function(e){e.interceptors.push("errorInterceptor")}]).filter("truncate_campaignGroupName",function(){return function(e,t){if(!e)return"";if("campaign_name"!==t&&"org_unit_name"!==t&&"campaign"!==t&&"group"!==t&&"camp_name"!==t)return e;var o=30;if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;var a=(e=e.substr(0,o)).lastIndexOf(" ");return-1!=a&&(e=e.substr(0,a)),e+" "}}).filter("truncate_campGroupName",function(){return function(e){if(!e)return"";var t=30;if(!(t=parseInt(t,10)))return e;if(e.length<=t)return e;var o=(e=e.substr(0,t)).lastIndexOf(" ");return-1!=o&&(e=e.substr(0,o)),e+" "}}).filter("truncate_smsCampGroupName",function(){return function(e){if(!e)return"";var t=30;return(t=parseInt(t))?e.length<=t?e:(e=e.substr(0,t))+" ":e}}).factory("smsWebService",["$http","ApiParam",function(e,t){"use strict";var o={sendMessage:function(o){var a={method:"POST",url:t.baseURL()+"/v1/conversation/sendMessage",headers:t.headerConfig().headers,data:o};return e(a)},getChatHistory:function(o){return e.defaults.useXDomain=!0,e.get(t.baseURL()+"/v1/conversation/chatHistory/"+o,t.headerConfig())},setConversationStatus:function(o,a){return e.defaults.useXDomain=!0,e.put(t.baseURL()+"/v1/conversation/status/",{conversation_id:o,conversation_status:a},t.headerConfig())},getLiveMessages:function(o){return e.defaults.useXDomain=!0,e.get(t.baseURL()+"/v1/conversation/live-sms?ids="+o,t.headerConfig())}};return o}]).filter("chatHeading",function(){return function(e){var t=e.org_unit_name,o=e.labelUpdate;return(t+=o&&""!==o?"-"+o:"").length>34?t.substring(0,34)+"...":t}}).controller("MainController",["$scope","$global","$timeout","$cookies","$interval","progressLoader","$location","loggerService","$window","$rootScope","OrgUnitLocal","LogoutService","AdminSession","SupportAdminWebService","Idle","ApiParam","$http","$document","pinesNotifications","ConversationWebService","smsWebService",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b,w,y){"use strict";c.loginState="nologin";var S,C=null;S=a.get("is_from_phantom"),l.sessionStorage.is_from_phantom=S||!1,console.log("MAIN TOKEN",l.sessionStorage.token),angular.isDefined(l.sessionStorage.token)?console.log("Skipping cookie lookup",l.sessionStorage.token):(console.log("getting token from cookie"),C=a.get("ct_token"),console.log("token",C),C&&(console.log("Found token - setting to",C),l.sessionStorage.token=C)),e.isMaximize=!0,e.chatboxClass=[],e.conversationData=[],e.time=moment().format("MM-DD-YY HH:mm A"),e.countChatWindow=[],e.countAdd=0,e.chatWindowLoading=!1,e.isPreviewMode=!1,e.style_fixedHeader=t.get("fixedHeader"),e.style_headerBarHidden=t.get("headerBarHidden"),e.style_layoutBoxed=t.get("layoutBoxed"),e.style_fullscreen=t.get("fullscreen"),e.style_leftbarCollapsed=t.get("leftbarCollapsed"),e.style_leftbarCollapsed=t.get("leftbarCollapsed"),e.style_leftbarShown=t.get("leftbarShown"),e.style_rightbarCollapsed=t.get("rightbarCollapsed"),e.style_isSmallScreen=!1,e.style_showSearchCollapsed=t.get("showSearchCollapsed"),e.style_layoutHorizontal=t.get("layoutHorizontal"),e.events=[],e.oldLabelChat=null;a.get("name");var A=[],T=[];"true"===n.search().preview&&(e.isPreviewMode=!0),c.url=a.get("restapiurl"),c.socketUrl=a.get("socketUrl"),c.port=a.get("port"),c.dniHost=a.get("dniHost"),console.log("getting token from cookie"),C=a.get("ct_token"),console.log("token",C),C&&(console.log("Found token - setting to",C),l.sessionStorage.token=C,e.isLoggedIn=!0,c.loginState="loggedin"),l.sessionStorage.white_label_active&&(c.white_label_active=l.sessionStorage.white_label_active),e.$on("IdleStart",function(){}),e.$on("IdleWarn",function(e,t){}),e.$on("IdleTimeout",function(){e.isLoggedIn=!1,u.logout()}),e.$on("IdleEnd",function(){}),e.switchAdmin=function(){a.remove("ct_token"),m.switchToAdmin(c.supportToken,l.sessionStorage.token).then(function(e){c.token=l.sessionStorage.token=e.data.token,a.put("ct_token",l.sessionStorage.token),c.user_id=e.data.userId,c.roleId=l.sessionStorage.roleId=e.data.data.role_id,p.setAdminType(e.data.data.role_id),n.path("/admin-access")})},e.hideSearchBar=function(){t.set("showSearchCollapsed",!1)},e.hideHeaderBar=function(){t.set("headerBarHidden",!0)},e.showHeaderBar=function(e){e.stopPropagation(),t.set("headerBarHidden",!1)},e.toggleLeftBar=function(){if(e.style_isSmallScreen)return t.set("leftbarShown",!e.style_leftbarShown);t.set("leftbarCollapsed",!e.style_leftbarCollapsed)},e.showSubscription=!1,e.toggleRightBar=function(){t.set("rightbarCollapsed",!e.style_rightbarCollapsed),c.rightbar=t.get("rightbarCollapsed"),e.showSubscription=e.style_rightbarCollapsed},e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},50)},e.$on("globalStyles:changed",function(t,o){e["style_"+o.key]=o.value}),e.$on("globalStyles:maxWidth767",function(a,i){o(function(){e.style_isSmallScreen=i,i?t.set("leftbarCollapsed",!1):t.set("leftbarShown",!1)})}),e.$on("$viewContentLoaded",function(e){l.ga&&l.ga("send","pageview",{page:n.url()})}),e.showBreadCrumb=!0,e.isLoggedIn=l.sessionStorage.token;var D;e.isLoggedIn;function I(){if("loggedin"==c.loginState&&e.conversationData.length>0){var t="";angular.forEach(e.conversationData,function(e){t+=""===t?e.conver.conversation_id:","+e.conver.conversation_id}),y.getLiveMessages(t).then(function(t){if(t.data&&""==t.data.err&&t.data.json&&!_.isEmpty(t.data.json)){var o=t.data.json;angular.forEach(e.conversationData,function(e){if(o[e.conver.conversation_id]){var t=o[e.conver.conversation_id].split("@sep@");angular.forEach(t,function(t){t=JSON.parse(t),-1===_.findIndex(e.conver.messages,function(e){return e.sms_id==Number(t.sms_id)})&&(t.sms_id=Number(t.sms_id),t.time=moment(t.time).tz(c.timezone).format("MM-DD-YY hh:mm A"),e.conver.messages.push(t),e.conver.newMessage=!0)})}})}})}}e.logIn=function(){e.isLoggedIn=!0},e.logger=function(e,t){s.logAction(e,t)},e.rightbarAccordionsShowOne=!1,e.rightbarAccordions=[{open:!0},{open:!0},{open:!0},{open:!0},{open:!0},{open:!0},{open:!0}],e.$on("$locationChangeStart",function(e){"/login"===n.path()&&t.set("rightbarCollapsed",!1),"/login"===n.path()&&l.sessionStorage.token&&(console.log("Err... no reason to go back to login page if you're already logged in."),e.preventDefault())}),e.$on("$routeChangeStart",function(t,o,i){var s=a.get("ct_token");s||delete l.sessionStorage.token,s&&"views/login.html"!=o.$$route.templateUrl||(e.conversationData=[]);A.push(n.search()),T.push(n.path());n.search();if(2===parseInt(c.roleId)&&["/set-group","/set-legacy-group"].indexOf(n.path())>-1&&(location.href="#/access-denied"),3===parseInt(c.roleId)&&["/set-campaign-builder","/set-legacy-campaign-builder","/set-campaign","/set-group","/set-legacy-group","/set-blacklist","/set-dni","/set-location","/set-legacy-location","/set-tags","/set-webhook","/set-caller-privacy","/set-acquisio","/set-append","/set-doubleclick","/set-ga","/set-dist","/set-scheduled","/scheduled-plans","/set-schedule-builder"].indexOf(n.path())>-1&&(location.href="#/access-denied"),void 0===l.sessionStorage.token||"/signup"!==n.path()&&"/login"!==n.path()&&"/login-admin"!==n.path()&&"/thankyou"!==n.path()){if(!l.sessionStorage.token&&("/signup"===n.path()||"/login"===n.path()||"/login-admin"===n.path()||"/thankyou"===n.path()))return}else n.path("/");r.start(),r.set(50),e.isLoggedIn=l.sessionStorage.token}),e.tagAlreadyOnPage=!1,e.$on("$routeChangeSuccess",function(e){r.end()}),e.connectSocket=function(){},e.$on("logout",function(){}),e.initializeChatConnection=function(){},e.disconnectSocket=function(){},e.onChatWindowClicked=function(t){var o=$("#"+t.conver.conversation_id)[0];t.conver.newMessage&&void 0!=t.conver.newMessage&&1==t.conver.newMessage&&(o.scrollHeight<=o.clientHeight&&e.onScrollMessageRead(t,o),t.conver.newMessage=!1)},e.startSMSInterval=function(){e.stopSMSInterval(),D=i(I,8e3)},e.stopSMSInterval=function(){i.cancel(D)},e.$on("closeChatArchive",function(t,o){e.closeChat(o)}),e.$on("campaignOrGroupUpdateSms",function(t,o){e.conversationData.length>0&&e.conversationData.forEach(function(e){"campaign"==o.campaignOrGroupObject.type?e.conver.campaign_id==o.campaignOrGroupObject.campaign_id&&(e.conver.campaign_name=o.campaignOrGroupObject.campaign_name):e.conver.org_unit_id==o.campaignOrGroupObject.org_unit_id&&(e.conver.org_unit_name=o.campaignOrGroupObject.org_unit_name)})}),e.$on("chatWindowOpen",function(t,o){var a;e.canModify=!1,c.userAccess.sms&&7===parseInt(c.userAccess.sms)&&(e.canModify=!0),1==e.countChatWindow.length?o.conver.chatBoxClass="chatbox":2==e.countChatWindow.length?o.conver.chatBoxClass="chatboxTWO":3==e.countChatWindow.length?o.conver.chatBoxClass="chatboxThree":4==e.countChatWindow.length?o.conver.chatBoxClass="chatboxFour":o.conver.chatBoxClass="chatbox",o.conver.tracking_number=o.conver.tracking.toString().replace(/(\d\d\d)(\d\d\d)(\d\d\d\d)/,"($1) $2-$3"),o.conver.caller_id=o.conver.source.toString().replace(/(\d\d\d)(\d\d\d)(\d\d\d\d)/,"($1) $2-$3"),o.conver.isMaximize=!0,o.conver.isOpenLabel=!1,o.conver.formData={typingText:""},o.conver.sendSmsEnable=!0,o.conver.messages=[],o.conver.labelUpdate=o.conver.label,e.canModify&&o.conver.labelUpdate&&o.conver.labelUpdate.length>0?o.conver.isDisabledSpan="button-label":o.conver.isDisabledSpan="button-label-disable",o.conver.arrowClassLabel="fa fa-chevron-down",o.conver.chatWindowLoading=!0,e.conversationData.length>=4?(a=e.conversationData.splice(0,0,o),e.conversationData.forEach(function(t,o){1==o?e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxTWO":e.conversationData[o].conver.chatBoxClass="minimizeChatTwo":2==o?e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxThree":e.conversationData[o].conver.chatBoxClass="minimizeChatThree":(3==o&&(e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxFour":e.conversationData[o].conver.chatBoxClass="minimizeChatFour"),o>=4&&(e.conversationData[o].conver.chatBoxClass="hideChat"))})):a=e.conversationData.push(o),1===e.conversationData.length&&e.startSMSInterval(),y.getChatHistory(o.conver.conversation_id).then(function(t){if(t.data&&"success"==t.data.status&&""==t.data.err){angular.forEach(e.conversationData,function(e){e&&e.conver.conversation_id===o.conver.conversation_id&&(e.conver.messages=t.data.json,e.conver.chatWindowLoading=!1)});var i=o.conver.chatBoxClass;setTimeout(function(){var e=$("."+i+" .main-window")[0].scrollHeight;$("."+i+" .main-window").animate({scrollTop:e})},100),angular.forEach(e.conversationData,function(t){if(t&&t.conver.conversation_id===o.conver.conversation_id){var a=$("#"+t.conver.conversation_id)[0];a.addEventListener("scroll",function(){e.onScrollMessageRead(t,a),e.onChatWindowClicked(t)})}})}else b.notify({title:"SMS",text:t.data.err,type:"error"}),e.conversationData[a-1].conver.chatWindowLoading=!1})}),e.closeChat=function(t){e.conversationData.splice(t,1),0===e.conversationData.length&&e.stopSMSInterval(),e.countChatWindow.splice(t,1),e.conversationData.forEach(function(t,o){0==o?e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatbox":e.conversationData[o].conver.chatBoxClass="minimizeChat":1==o?e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxTWO":e.conversationData[o].conver.chatBoxClass="minimizeChatTwo":2==o?e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxThree":e.conversationData[o].conver.chatBoxClass="minimizeChatThree":3==o&&(e.conversationData[o].conver.isMaximize?e.conversationData[o].conver.chatBoxClass="chatboxFour":e.conversationData[o].conver.chatBoxClass="minimizeChatFour")})},e.toggleMiniMaxChat=function(t){0==t?e.conversationData[t].conver.isMaximize?e.conversationData[t].conver.chatBoxClass="minimizeChat":e.conversationData[t].conver.chatBoxClass="chatbox":1==t?e.conversationData[t].conver.isMaximize?e.conversationData[t].conver.chatBoxClass="minimizeChatTwo":e.conversationData[t].conver.chatBoxClass="chatboxTWO":2==t?e.conversationData[t].conver.isMaximize?e.conversationData[t].conver.chatBoxClass="minimizeChatThree":e.conversationData[t].conver.chatBoxClass="chatboxThree":e.conversationData[t].conver.isMaximize?e.conversationData[t].conver.chatBoxClass="minimizeChatFour":e.conversationData[t].conver.chatBoxClass="chatboxFour",e.conversationData[t].conver.isMaximize?e.conversationData[t].conver.isMaximize=!1:e.conversationData[t].conver.isMaximize=!0},e.onScrollMessageRead=function(e,t){t.scrollTop>t.scrollHeight-t.offsetHeight?c.activeConversations.forEach(function(t){e.conver.conversation_id===t.conversation_id&&t.conversation_status==c.conversationStatus.UNREAD&&(t.conversation_status=c.conversationStatus.READ,y.setConversationStatus(e.conver.conversation_id,c.conversationStatus.READ))}):t.scrollHeight<=t.clientHeight&&c.activeConversations.forEach(function(t){e.conver.conversation_id===t.conversation_id&&t.conversation_status==c.conversationStatus.UNREAD&&(t.conversation_status=c.conversationStatus.READ,y.setConversationStatus(e.conver.conversation_id,c.conversationStatus.READ))})},e.sendMessage=function(t,o){if(o&&o.formData.typingText&&""!=o.formData.typingText&&!o.chatWindowLoading&&e.canModify&&e.conversationData[t].conver.sendSmsEnable)if(e.conversationData[t].conver.sendSmsEnable=!1,sessionStorage.userId){var a={conversation_id:o.conversation_id,ct_user_id:sessionStorage.userId,message:o.formData.typingText,tracking_number:o.tracking_number.replace(/[&\/\\#,+()$~%'":*?<>{}|-]/g,"").replace(/ +/g,"").toString(),caller_id:o.caller_id.replace(/[&\/\\#,+()$~%'":*?<>{}|-]/g,"").replace(/ +/g,"").toString()};y.sendMessage(a).then(function(a){if(a.data&&"success"==a.data.status&&""==a.data.err){var i={message:o.formData.typingText,type:"outgoing",time:moment().tz(c.timezone).format("MM-DD-YY HH:mm A")};e.conversationData[t].conver.messages.push(i),e.conversationData[t].conver.formData.typingText="",e.conversationData[t].conver.sendSmsEnable=!0;var r=e.conversationData[t].conver.chatBoxClass;setTimeout(function(){var e=$("."+r+" .main-window")[0].scrollHeight;$("."+r+" .main-window").animate({scrollTop:e})},30),e.convertingActiveConversation(o.conversation_id)}else e.conversationData[t].conver.sendSmsEnable=!0,b.notify({title:"SMS",text:a.data.err&&""!==a.data.err?a.data.err:"Failed while sending sms.",type:"error"})})}else e.conversationData[t].conver.sendSmsEnable=!0,b.notify({title:"SMS",text:"Failed while sending sms.",type:"error"})},e.toggleOpenLabel=function(t){e.conversationData[t].conver.labelUpdate=e.conversationData[t].conver.label,e.conversationData[t].conver.isOpenLabel?(e.conversationData[t].conver.isOpenLabel=!1,e.conversationData[t].conver.arrowClassLabel="fa fa-chevron-down"):(e.conversationData[t].conver.isOpenLabel=!0,e.conversationData[t].conver.arrowClassLabel="fa fa-chevron-up"),e.conversationData[t].conver.labelUpdate&&e.conversationData[t].conver.labelUpdate.length>0&&(e.isDisabledSpan="button-label")},e.convertingActiveConversation=function(e){var t=_.find(c.activeConversations,function(t){return t.conversation_id==e});t.conversation_status=c.conversationStatus.REPLIED;var o=_.findIndex(c.activeConversations,function(t){return t.conversation_id==e});c.activeConversations.splice(o,1),sessionStorage.userEmail&&sessionStorage.fullName&&(t.agent_email_id=sessionStorage.userEmail,t.agent_name=sessionStorage.fullName),c.conversations.unshift(t),c.$broadcast("message-sent"),c.$broadcast("conversation-moved"),console.log(c.activeConversations,"activeConversation >>>>",t),console.log(c.conversations,"conversations <<<<<")},e.cancelUpdate=function(t){e.conversationData[t].conver.labelUpdate=e.conversationData[t].conver.label,e.conversationData[t].conver.isOpenLabel=!1,e.conversationData[t].conver.arrowClassLabel="fa fa-chevron-down"},e.updateLabel=function(t,o){if(e.canModify)if(null!=e.oldLabelChat&&""!=e.oldLabelChat||null!=o.labelUpdate&&""!=o.labelUpdate){if(o.conversation_id){var a={conversation_id:o.conversation_id,conversation_status:o.conversation_status,label:o.labelUpdate};w.updateLabel(a).then(function(i){c.$broadcast("labelUpdate",a),"success"===i.data.status?(b.notify({title:"Conversation",text:"Label updated successfully",type:"success"}),e.oldLabelChat=null,e.conversationData[t].conver.label=o.labelUpdate):(b.notify({title:"Conversation",text:"Failed while updating conversation label. "+i.data.err,type:"error"}),e.conversationData[t].conver.labelUpdate=o.label)})}else b.notify({title:"Conversation",text:"Failed while updating conversation label.",type:"error"}),e.conversationData[t].conver.labelUpdate=o.label;e.conversationData[t].conver.isOpenLabel=!1,e.conversationData[t].conver.arrowClassLabel="fa fa-chevron-down"}else{b.notify({title:"Conversation",text:"Failed while updating conversation label. Label text should not be empty.",type:"error"})}},e.runTimeChange=function(t,o){e.oldLabelChat=e.conversationData[t].conver.label,e.newLabelChat=o,null==e.conversationData[t].conver.label&&0==o.length?e.conversationData[t].conver.isDisabledSpan="button-label-disable":e.conversationData[t].conver.isDisabledSpan="button-label"}}]).config(["IdleProvider","KeepaliveProvider",function(e,t){e.idle(300),e.timeout(3600),t.interval(2)}]).config(["$provide","$routeProvider",function(e,t){"use strict";t.when("/",{templateUrl:"views/index.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/login",{templateUrl:"views/login.html"}).when("/login-admin",{templateUrl:"views/login-admin.html"}).when("/admin-access",{templateUrl:"views/admin-access.html"}).when("/signup",{templateUrl:"views/signup.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getLoggedInSessData()}]}}).when("/forgotpassword",{templateUrl:"views/forgotpassword.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getLoggedInSessData()}]}}).when("/resetpassword",{templateUrl:"views/resetpassword.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getLoggedInSessData()}]}}).when("/thankyou",{templateUrl:"views/thankyou.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getLoggedInSessData()}]}}).when("/support",{templateUrl:"views/support.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/access-denied",{templateUrl:"views/access-denied.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/activity-stream",{templateUrl:"views/activity-stream.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/acq-call-flows4",{templateUrl:"views/acq-call-flows4.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/calls-callback",{templateUrl:"views/calls-callback.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/calls-details",{templateUrl:"views/calls-details.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/profile",{templateUrl:"views/profile.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-alerts",{templateUrl:"views/set-alerts.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-api",{templateUrl:"views/set-api.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-append",{templateUrl:"views/set-append.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-blacklist",{templateUrl:"views/set-blacklist.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-doubleclick",{templateUrl:"views/set-doubleclick.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-dni",{templateUrl:"views/set-dni.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-ga",{templateUrl:"views/set-ga.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-group",{templateUrl:"views/set-group.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-legacy-group",{templateUrl:"views/set-legacy-group.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-location",{templateUrl:"views/set-location.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-legacy-location",{templateUrl:"views/set-legacy-location.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-notifications",{templateUrl:"views/set-notifications.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-tags",{templateUrl:"views/set-tags.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-webhook",{templateUrl:"views/set-webhook.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-webhook-builder",{templateUrl:"views/set-webhook-builder.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-caller-privacy",{templateUrl:"views/set-caller-privacy.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/form-ckeditor",{templateUrl:"views/form-ckeditor.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/form-wizard",{templateUrl:"views/form-wizard.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-campaign-builder",{templateUrl:"views/set-campaign-builder.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-legacy-campaign-builder",{templateUrl:"views/set-legacy-campaign-builder.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-campaign",{templateUrl:"views/set-campaign.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/scheduled-plans",{templateUrl:"views/scheduled-plans.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-schedule-builder",{templateUrl:"views/set-schedule-builder.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/call-overview",{templateUrl:"views/call-overview.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/charts-svg",{templateUrl:"views/charts-svg.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/settings-call-flow",{templateUrl:"views/settings-call-flow.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/cfa-reports",{templateUrl:"views/cfa-reports.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/activity-group",{templateUrl:"views/activity-group.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-score-card",{templateUrl:"views/set-score-card.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-select-score",{templateUrl:"views/set-select-score.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-scheduled",{templateUrl:"views/set-scheduled.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-dist",{templateUrl:"views/set-dist.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-acquisio",{templateUrl:"views/set-acquisio.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/set-whitelabel",{templateUrl:"views/set-whitelabel.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).when("/sms-conversations",{templateUrl:"views/sms-conversations.html",resolve:{userScope:["OrgUnitLocal",function(e){return e.getSessData()}]}}).otherwise({redirectTo:"/"})}]).config(["$routeProvider",function(e){"use strict"}]).run(["Idle",function(e){e.watch()}]),function(e){if(!e)throw"timehelper.js needs angular loaded before itself to function.";e.module("timehelper",[]).factory("DateRangeFiller",function(){var e={fillInDays:function(e,t,o,a){if(!Array.isArray(e))throw"incorrect DateRangeFiller first param";if(!moment(t,a).isValid||!moment(o,a).isValid)throw"inside DateRangeFiller, one of these are invalid... intendedStartDate "+t.toString()+" intendedEndDate "+o.toString()+" dateForm "+a.toString();if(moment(t,a)>moment(o,a))throw"TimeHelperJs: ERROR, why is your end date previous to your start date? - error in DateRangeFiller invocation";if(_.any(e,function(e){var i=moment(e,a);return i<moment(t,a)||i>moment(o,a)}))throw"TimeHelperJs: ERROR, your given date set is out of bounds of the intended start date for filling in";var i=_.map(e,function(e){return e}),r=[],n=e;if(t===o)return r.push(t),r;_.contains(n,t)||n.unshift(t),_.contains(n,o)||n.push(o);for(var s=n[0],l=n[1],c=1,d=0;d<n.length;d++)if(moment(s,a).add(1,"day").format(a)===l){if(r.push(s),s=l,l===o)return r.push(l),_.difference(r,i);l=n[c+=1]}else r.push(s),s=moment(s,a).add(1,"day").format(a),d-=1}};return e})}(angular),angular.module("datetime-timezoned",[]).factory("DateTimeTimeZoned",[function(){var e={},t="YYYY-MM-DD HH:mm:ss";return e.createFakeDateNowInTimezone=function(e){var o=moment.tz(e).format(t);return new Date(o)},e.fakeLocalDateToRealGMT_JSONformat=function(e,o){if(!e){if(console.log("parameter null in DateTimeTimeZoned.fakeLocalDateToRealGMT_JSONformat"),!o)throw"Missing timezone in DateTimeTimeZoned.fakeLocalDateToRealGMT_JSONformat";return null}var a=moment(e).format(t),i=moment.tz(a,o);return new Date(i.toString()).toJSON()},e.createFakeDateFromAlreadyTimeZonedStr=function(e){return moment(e).toDate()},e}]),function(e){function t(e){return e}function o(e,t){for(var o=0,a=t.length,i=new Array(a);o<a;++o)i[o]=e[t[o]];return i}C.version="1.3.7",C.permute=o;var a=C.bisect=i(t);function i(e){function t(t,o,a,i){for(;a<i;){var r=a+i>>>1;o<e(t[r])?i=r:a=r+1}return a}return t.right=t,t.left=function(t,o,a,i){for(;a<i;){var r=a+i>>>1;e(t[r])<o?a=r+1:i=r}return a},t}function r(e){function t(e,t,a){for(var i=a-t,r=1+(i>>>1);--r>0;)o(e,r,i,t);return e}function o(t,o,a,i){for(var r,n=t[--i+o],s=e(n);(r=o<<1)<=a&&(r<a&&e(t[i+r])>e(t[i+r+1])&&r++,!(s<=e(t[i+r])));)t[i+o]=t[i+r],o=r;t[i+o]=n}return t.sort=function(e,t,a){for(var i,r=a-t;--r>0;)i=e[t],e[t]=e[t+r],e[t+r]=i,o(e,1,r,t);return e},t}function n(e){var t=r(e);return function(o,a,i,r){var n,s,l,c=new Array(r=Math.min(i-a,r));for(s=0;s<r;++s)c[s]=o[a++];if(t(c,0,r),a<i){n=e(c[0]);do{e(l=o[a])>n&&(c[0]=l,n=e(t(c,0,r)[0]))}while(++a<i)}return c}}function s(e){return function(t,o,a){for(var i=o+1;i<a;++i){for(var r=i,n=t[i],s=e(n);r>o&&e(t[r-1])>s;--r)t[r]=t[r-1];t[r]=n}return t}}function l(e){var t=s(e);function o(a,i,r){return(r-i<c?t:function(t,a,i){var r,n=(i-a)/6|0,s=a+n,l=i-1-n,c=a+i-1>>1,d=c-n,u=c+n,p=t[s],m=e(p),g=t[d],f=e(g),h=t[c],v=e(h),_=t[u],b=e(_),w=t[l],y=e(w);m>f&&(r=p,p=g,g=r,r=m,m=f,f=r);b>y&&(r=_,_=w,w=r,r=b,b=y,y=r);m>v&&(r=p,p=h,h=r,r=m,m=v,v=r);f>v&&(r=g,g=h,h=r,r=f,f=v,v=r);m>b&&(r=p,p=_,_=r,r=m,m=b,b=r);v>b&&(r=h,h=_,_=r,r=v,v=b,b=r);f>y&&(r=g,g=w,w=r,r=f,f=y,y=r);f>v&&(r=g,g=h,h=r,r=f,f=v,v=r);b>y&&(r=_,_=w,w=r,r=b,b=y,y=r);var S=g,C=f,A=_,T=b;t[s]=p,t[d]=t[a],t[c]=h,t[u]=t[i-1],t[l]=w;var D=a+1,I=i-2,N=C<=T&&C>=T;if(N)for(var k=D;k<=I;++k){var R=t[k],F=e(R);if(F<C)k!==D&&(t[k]=t[D],t[D]=R),++D;else if(F>C)for(;;){var x=e(t[I]);if(!(x>C)){if(x<C){t[k]=t[D],t[D++]=t[I],t[I--]=R;break}t[k]=t[I],t[I--]=R;break}I--}}else for(var k=D;k<=I;k++){var R=t[k],F=e(R);if(F<C)k!==D&&(t[k]=t[D],t[D]=R),++D;else if(F>T)for(;;){var x=e(t[I]);if(!(x>T)){x<C?(t[k]=t[D],t[D++]=t[I],t[I--]=R):(t[k]=t[I],t[I--]=R);break}if(--I<k)break}}if(t[a]=t[D-1],t[D-1]=S,t[i-1]=t[I+1],t[I+1]=A,o(t,a,D-1),o(t,I+2,i),N)return t;if(D<s&&I>l){for(var L;(L=e(t[D]))<=C&&L>=C;)++D;for(;(x=e(t[I]))<=T&&x>=T;)--I;for(var k=D;k<=I;k++){var R=t[k],F=e(R);if(F<=C&&F>=C)k!==D&&(t[k]=t[D],t[D]=R),D++;else if(F<=T&&F>=T)for(;;){var x=e(t[I]);if(!(x<=T&&x>=T)){x<C?(t[k]=t[D],t[D++]=t[I],t[I--]=R):(t[k]=t[I],t[I--]=R);break}if(--I<k)break}}}return o(t,D,I+1)})(a,i,r)}return o}a.by=i,(C.heap=r(t)).by=r,(C.heapselect=n(t)).by=n,(C.insertionsort=s(t)).by=s,(C.quicksort=l(t)).by=l;var c=32,d=f,u=f,p=f,m=function(e,t){var o=e.length;for(;o<t;)e[o++]=0;return e},g=function(e,t){if(t>32)throw new Error("invalid array width!");return e};function f(e){for(var t=new Array(e),o=-1;++o<e;)t[o]=0;return t}function h(e){return[0,e.length]}function v(){return null}function _(){return 0}function b(e){return e+1}function w(e){return e-1}function y(e){return function(t,o){return t+ +e(o)}}function S(e){return function(t,o){return t-e(o)}}function C(){var e={add:I,remove:function(){for(var e=A(s,s),t=[],o=0,a=0;o<s;++o)p[o]?e[o]=a++:t.push(o);f.forEach(function(e){e(0,[],t)}),D.forEach(function(t){t(e)});for(var r,o=0,a=0;o<s;++o)(r=p[o])&&(o!==a&&(p[a]=r,i[a]=i[o]),++a);i.length=a;for(;s>a;)p[--s]=0},dimension:function(e){var d,I,N,k,R,F={filter:function(e){return null==e?W():Array.isArray(e)?q(e):"function"==typeof e?G(e):B(e)},filterExact:B,filterRange:q,filterFunction:G,filterAll:W,top:function(e){var t,o=[],a=j;for(;--a>=$&&e>0;)p[t=I[a]]||(o.push(i[t]),--e);return o},bottom:function(e){var t,o=[],a=$;for(;a<j&&e>0;)p[t=I[a]]||(o.push(i[t]),--e),a++;return o},group:J,groupAll:function(){var e=J(v),t=e.all;return delete e.all,delete e.top,delete e.order,delete e.orderNatural,delete e.size,e.value=function(){return t()[0].value},e},dispose:Z,remove:Z},x=~c&-~c,L=~x,O=l(function(e){return N[e]}),U=h,P=[],M=[],$=0,j=0;C.unshift(V),C.push(E),D.push(Y),c|=x,(u>=32?!x:c&(1<<u)-1)&&(p=g(p,u<<=1));function V(t,a,i){N=t.map(e),k=O(function(e){for(var t=A(e,e),o=-1;++o<e;)t[o]=o;return t}(i),0,i),N=o(N,k);var r,n=U(N),l=n[0],c=n[1];if(R)for(r=0;r<i;++r)R(N[r],r)||(p[k[r]+a]|=x);else{for(r=0;r<l;++r)p[k[r]+a]|=x;for(r=c;r<i;++r)p[k[r]+a]|=x}if(!a)return d=N,I=k,$=l,void(j=c);var u=d,m=I,g=0,f=0;for(d=new Array(s),I=A(s,s),r=0;g<a&&f<i;++r)u[g]<N[f]?(d[r]=u[g],I[r]=m[g++]):(d[r]=N[f],I[r]=k[f++]+a);for(;g<a;++g,++r)d[r]=u[g],I[r]=m[g];for(;f<i;++f,++r)d[r]=N[f],I[r]=k[f]+a;n=U(d),$=n[0],j=n[1]}function E(e,t,o){P.forEach(function(e){e(N,k,t,o)}),N=k=null}function Y(e){for(var t,o=0,a=0;o<s;++o)p[t=I[o]]&&(o!==a&&(d[a]=d[o]),I[a]=e[t],++a);for(d.length=a;a<s;)I[a++]=0;var i=U(d);$=i[0],j=i[1]}function z(e){var t=e[0],o=e[1];if(R)return R=null,H(function(e,a){return t<=a&&a<o}),$=t,j=o,F;var a,i,r,n=[],s=[];if(t<$)for(a=t,i=Math.min($,o);a<i;++a)p[r=I[a]]^=x,n.push(r);else if(t>$)for(a=$,i=Math.min(t,j);a<i;++a)p[r=I[a]]^=x,s.push(r);if(o>j)for(a=Math.max(t,j),i=o;a<i;++a)p[r=I[a]]^=x,n.push(r);else if(o<j)for(a=Math.max($,o),i=j;a<i;++a)p[r=I[a]]^=x,s.push(r);return $=t,j=o,f.forEach(function(e){e(x,n,s)}),F}function B(e){return z((U=function(e,t){return function(o){var a=o.length;return[e.left(o,t,0,a),e.right(o,t,0,a)]}}(a,e))(d))}function q(e){return z((U=function(e,t){var o=t[0],a=t[1];return function(t){var i=t.length;return[e.left(t,o,0,i),e.left(t,a,0,i)]}}(a,e))(d))}function W(){return z((U=h)(d))}function G(e){return U=h,H(R=e),$=0,j=s,F}function H(e){var t,o,a,i=[],r=[];for(t=0;t<s;++t)!(p[o=I[t]]&x)^(a=e(d[t],t))&&(a?(p[o]&=L,i.push(o)):(p[o]|=x,r.push(o)));f.forEach(function(e){e(x,i,r)})}function J(e){var o={top:function(e){var t=c(q(),0,a.length,e);return u.sort(t,0,t.length)},all:q,reduce:W,reduceCount:G,reduceSum:function(e){return W(y(e),S(e),_)},order:H,orderNatural:function(){return H(t)},size:function(){return F},dispose:J,remove:J};M.push(o);var a,l,c,u,h,C,N,k=8,R=T(k),F=0,O=v,U=v,$=!0;function j(t,o,r,n){var c,d,u,_,b,w,y=a,S=A(F,R),C=h,D=N,I=F,x=0,P=0;for($&&(C=D=v),a=new Array(F),F=0,l=I>1?m(l,s):A(s,R),I&&(u=(d=y[0]).key);P<n&&!((_=e(t[P]))>=_);)++P;for(;P<n;){for(d&&u<=_?(b=d,w=u,S[x]=F,(d=y[++x])&&(u=d.key)):(b={key:_,value:D()},w=_),a[F]=b;!(_>w||(l[c=o[P]+r]=F,p[c]&L||(b.value=C(b.value,i[c])),++P>=n));)_=e(t[P]);M()}for(;x<I;)a[S[x]=F]=y[x++],M();if(F>x)for(x=0;x<r;++x)l[x]=S[l[x]];function M(){++F===R&&(S=g(S,k<<=1),l=g(l,k),R=T(k))}c=f.indexOf(O),F>1?(O=E,U=z):(1===F?(O=Y,U=B):(O=v,U=v),l=null),f[c]=O}function V(){if(F>1){for(var e=F,t=a,o=A(e,e),i=0,r=0;i<s;++i)p[i]&&(o[l[r]=l[i]]=1,++r);for(a=[],F=0,i=0;i<e;++i)o[i]&&(o[i]=F++,a.push(t[i]));if(F>1)for(var i=0;i<r;++i)l[i]=o[l[i]];else l=null;f[f.indexOf(O)]=F>1?(U=z,O=E):1===F?(U=B,O=Y):U=O=v}else if(1===F){for(var i=0;i<s;++i)if(p[i])return;a=[],F=0,f[f.indexOf(O)]=O=U=v}}function E(e,t,o){if(e!==x&&!$){var r,n,s,c;for(r=0,s=t.length;r<s;++r)p[n=t[r]]&L||((c=a[l[n]]).value=h(c.value,i[n]));for(r=0,s=o.length;r<s;++r)(p[n=o[r]]&L)===e&&((c=a[l[n]]).value=C(c.value,i[n]))}}function Y(e,t,o){if(e!==x&&!$){var r,n,s,l=a[0];for(r=0,s=t.length;r<s;++r)p[n=t[r]]&L||(l.value=h(l.value,i[n]));for(r=0,s=o.length;r<s;++r)(p[n=o[r]]&L)===e&&(l.value=C(l.value,i[n]))}}function z(){var e,t;for(e=0;e<F;++e)a[e].value=N();for(e=0;e<s;++e)p[e]&L||((t=a[l[e]]).value=h(t.value,i[e]))}function B(){var e,t=a[0];for(t.value=N(),e=0;e<s;++e)p[e]&L||(t.value=h(t.value,i[e]))}function q(){return $&&(U(),$=!1),a}function W(e,t,a){return h=e,C=t,N=a,$=!0,o}function G(){return W(b,w,_)}function H(e){function t(t){return e(t.value)}return c=n(t),u=r(t),o}function J(){var e=f.indexOf(O);return e>=0&&f.splice(e,1),(e=P.indexOf(j))>=0&&P.splice(e,1),(e=D.indexOf(V))>=0&&D.splice(e,1),o}return arguments.length<1&&(e=t),f.push(O),P.push(j),D.push(V),j(d,I,0,s),G().orderNatural()}function Z(){M.forEach(function(e){e.dispose()});var e=C.indexOf(V);for(e>=0&&C.splice(e,1),(e=C.indexOf(E))>=0&&C.splice(e,1),(e=D.indexOf(Y))>=0&&D.splice(e,1),e=0;e<s;++e)p[e]&=L;return c&=L,F}return V(i,0,s),E(i,0,s),F},groupAll:function(){var e,t,o,a,r={reduce:d,reduceCount:u,reduceSum:function(e){return d(y(e),S(e),_)},value:function(){n&&(function(){var o;for(e=a(),o=0;o<s;++o)p[o]||(e=t(e,i[o]))}(),n=!1);return e},dispose:m,remove:m},n=!0;function l(o,a){var r;if(!n)for(r=a;r<s;++r)p[r]||(e=t(e,i[r]))}function c(a,r,s){var l,c,d;if(!n){for(l=0,d=r.length;l<d;++l)p[c=r[l]]||(e=t(e,i[c]));for(l=0,d=s.length;l<d;++l)p[c=s[l]]===a&&(e=o(e,i[c]))}}function d(e,i,s){return t=e,o=i,a=s,n=!0,r}function u(){return d(b,w,_)}function m(){var e=f.indexOf(c);return e>=0&&f.splice(e),(e=C.indexOf(l))>=0&&C.splice(e),r}return f.push(c),C.push(l),l(i,0),u()},size:function(){return s}},i=[],s=0,c=0,u=8,p=d(0),f=[],C=[],D=[];function I(t){var o=s,a=t.length;return a&&(i=i.concat(t),p=m(p,s+=a),C.forEach(function(e){e(t,o,a)})),e}return arguments.length?I(arguments[0]):e}function A(e,t){return(t<257?d:t<65537?u:p)(e)}function T(e){return 8===e?256:16===e?65536:4294967296}"undefined"!=typeof Uint8Array&&(d=function(e){return new Uint8Array(e)},u=function(e){return new Uint16Array(e)},p=function(e){return new Uint32Array(e)},m=function(e,t){if(e.length>=t)return e;var o=new e.constructor(t);return o.set(e),o},g=function(e,t){var o;switch(t){case 16:o=u(e.length);break;case 32:o=p(e.length);break;default:throw new Error("invalid array width!")}return o.set(e),o}),e.crossfilter=C}("undefined"!=typeof exports&&exports||this),angular.module("charts.barchart",[]).service("barchart",function(){return{BarChart:function(e,t,o,a){var i,r,n,s,l,c,d={};d.maxBarWidth=t;var u=40,p=15,m=120,g=5,f=18,h=function(e){return e.key},v=function(e){return parseFloat(e.value)},_=function(e,t){return n(t)},b=function(e,t){return _(e,t)+n.rangeBand()/2};function w(){s=d3.select("#"+o.context.id).append("svg").attr("width",t+m+u).attr("height",f+a*p),(l=s.append("g").attr("transform","translate("+(m-g)+","+f+")")).selectAll("text").data(i).enter().append("text").attr("y",b).attr("stroke","none").attr("fill","black").attr("dy",".35em").attr("text-anchor","end").text(h),(c=s.append("g").attr("transform","translate("+m+","+f+")")).selectAll("rect").data(i).enter().append("rect").attr("y",_).attr("height",n.rangeBand()).attr("width",function(e){return r(v(e))}).attr("stroke","white").attr("fill","#428bca").on("click",function(t){var o=h(t).replace("#","");e(o)}),c.selectAll("text").data(i).enter().append("text").attr("x",function(e){return r(v(e))}).attr("y",b).attr("dx",3).attr("dy",".35em").attr("text-anchor","start").attr("fill","black").attr("stroke","none").text(function(e){return d3.round(v(e),2)}),c.append("line").attr("y1",0).attr("y2",n.rangeExtent()[1]).style("stroke","#000")}return d.update=function(e){i=e.sort(function(e,t){return v(t)<v(e)?-1:v(t)>v(e)?1:h(t)<h(e)?-1:h(t)>h(e)?1:0}),n=d3.scale.ordinal().domain(d3.range(0,i.length)).rangeBands([0,i.length*p]),r=d3.scale.linear().domain([0,d3.max(i,v)]).range([0,t])},d.init=function(e,t){d.update(e),d.maxBarWidth=t,w()},d.redraw=function(t){d.update(t),c.selectAll("rect").data(i).enter().append("rect").attr("y",_).attr("height",n.rangeBand()).attr("width",function(e){return r(v(e))}).attr("stroke","white").attr("fill","steelblue").on("click",function(t){var o=h(t).replace("#","");e(o)}),c.selectAll("rect").data(i).transition().attr("y",_).attr("height",n.rangeBand()).attr("width",function(e){return r(v(e))}),c.selectAll("rect").data(i).exit().transition().remove(),c.selectAll("text").data(i).enter().append("text").attr("x",function(e){return r(v(e))}).attr("y",b).attr("dx",3).attr("dy",".35em").attr("text-anchor","start").attr("fill","black").attr("stroke","black").text(function(e){return d3.round(v(e),2)}),c.selectAll("text").data(i).transition().attr("x",function(e){return r(v(e))}).attr("y",b).attr("dx",3).attr("dy",".35em").attr("text-anchor","start").attr("fill","black").attr("stroke","none").text(function(e){return d3.round(v(e),2)}),c.selectAll("text").data(i).exit().transition().remove(),l.selectAll("text").data(i).enter().append("text").attr("y",b).attr("stroke","none").attr("fill","black").attr("dy",".35em").attr("text-anchor","end").text(h),l.selectAll("text").data(i).transition().attr("y",b).attr("stroke","none").attr("fill","black").attr("dy",".35em").attr("text-anchor","end").text(h),l.selectAll("text").data(i).exit().transition().remove(),c.append("line").attr("y1",0).attr("y2",n.rangeExtent()[1]).style("stroke","#000")},d}}}),function(e){var t=function(e){this.value={h:1,s:1,b:1,a:1},this.setColor(e)};t.prototype={constructor:t,setColor:function(t){t=t.toLowerCase();var o=this;e.each(i.stringParsers,function(e,a){var r=a.re.exec(t),n=r&&a.parse(r),s=a.space||"rgba";return!n||(o.value="hsla"===s?i.RGBtoHSB.apply(null,i.HSLtoRGB.apply(null,n)):i.RGBtoHSB.apply(null,n),!1)})},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt(100*(1-e),10)/100},toRGB:function(e,t,o,a){var i,r,n,s,l;return e||(e=this.value.h,t=this.value.s,o=this.value.b),e=(e*=360)%360/60,i=r=n=o-(l=o*t),i+=[l,s=l*(1-Math.abs(e%2-1)),0,0,s,l][e=~~e],r+=[s,l,l,s,0,0][e],n+=[0,0,s,l,l,s][e],{r:Math.round(255*i),g:Math.round(255*r),b:Math.round(255*n),a:a||this.value.a}},toHex:function(e,t,o,a){var i=this.toRGB(e,t,o,a);return"#"+(1<<24|parseInt(i.r)<<16|parseInt(i.g)<<8|parseInt(i.b)).toString(16).substr(1)},toHSL:function(e,t,o,a){e||(e=this.value.h,t=this.value.s,o=this.value.b);var i=(2-t)*o,r=t*o;return r/=i>0&&i<=1?i:2-i,i/=2,r>1&&(r=1),{h:e,s:r,l:i,a:a||this.value.a}}};var o=0,a=function(t,a){o++,this.element=e(t).attr("data-colorpicker-guid",o);var r=a.format||this.element.data("color-format")||"hex";this.format=i.translateFormats[r],this.isInput=this.element.is("input"),this.component=!!this.element.is(".color")&&this.element.find(".input-group-addon"),this.picker=e(i.template).attr("data-colorpicker-guid",o).appendTo("body").on("mousedown.colorpicker",e.proxy(this.mousedown,this)),this.isInput?this.element.on({"focus.colorpicker":e.proxy(this.show,this),"keyup.colorpicker":e.proxy(this.update,this)}):this.component?this.component.on({"click.colorpicker":e.proxy(this.show,this)}):this.element.on({"click.colorpicker":e.proxy(this.show,this)}),"rgba"!==r&&"hsla"!==r||(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update(),e(e.proxy(function(){this.element.trigger("create",[this])},this))};a.prototype={constructor:a,show:function(t){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),e(window).on("resize.colorpicker",e.proxy(this.place,this)),this.isInput||t&&(t.stopPropagation(),t.preventDefault()),e(document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color})},update:function(){var e=this.isInput?this.element.prop("value"):this.element.data("color");void 0!==e&&null!==e||(e="#ffffff"),this.color=new t(e),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},hide:function(){this.picker.hide(),e(window).off("resize",this.place),e(document).off({mousedown:this.hide}),this.isInput||(this.component&&""!==this.element.find("input").val()&&this.element.find("input").prop("value",this.format.call(this)).trigger("change"),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hidePicker",color:this.color})},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},destroy:function(){e(".colorpicker[data-colorpicker-guid="+this.element.attr("data-colorpicker-guid")+"]").remove(),this.element.removeData("colorpicker").removeAttr("data-colorpicker-guid").off(".colorpicker"),!1!==this.component&&this.component.off(".colorpicker"),this.element.trigger("destroy",[this])},setValue:function(e){this.isInput?this.element.prop("value",e):(this.element.find("input").val(e),this.element.data("color",e)),this.update(),this.element.trigger({type:"changeColor",color:this.color})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation(),t.preventDefault();var o=e(t.target).closest("div");if(!o.is(".colorpicker")){if(o.is(".colorpicker-saturation"))this.slider=e.extend({},i.sliders.saturation);else if(o.is(".colorpicker-hue"))this.slider=e.extend({},i.sliders.hue);else{if(!o.is(".colorpicker-alpha"))return!1;this.slider=e.extend({},i.sliders.alpha)}var a=o.offset();this.slider.knob=o.find("i")[0].style,this.slider.left=t.pageX-a.left,this.slider.top=t.pageY-a.top,this.pointer={left:t.pageX,top:t.pageY},e(document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((e.pageX||this.pointer.left)-this.pointer.left))),o=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((e.pageY||this.pointer.top)-this.pointer.top)));if(this.slider.knob.left=t+"px",this.slider.knob.top=o+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,t/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,o/100),this.previewColor(),this.isInput)try{this.element.val(this.format.call(this)).trigger("change")}catch(e){this.element.val(this.color.toHex()).trigger("change")}else try{this.element.find("input").val(this.format.call(this)).trigger("change")}catch(e){this.element.find("input").val(this.color.toHex()).trigger("change")}return this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},e.fn.colorpicker=function(t,o){return this.each(function(){var i=e(this),r=i.data("colorpicker"),n="object"==typeof t&&t;r?"string"==typeof t&&r[t](o):"destroy"!==t&&i.data("colorpicker",r=new a(this,e.extend({},e.fn.colorpicker.defaults,n)))})},e.fn.colorpicker.defaults={},e.fn.colorpicker.Constructor=a;var i={translateFormats:{rgb:function(){var e=this.color.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.color.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hsl:function(){var e=this.color.toHSL();return"hsl("+Math.round(360*e.h)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%)"},hsla:function(){var e=this.color.toHSL();return"hsla("+Math.round(360*e.h)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%,"+e.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(e,t,o,a){var i,r;return e/=255,t/=255,o/=255,{h:((0===(r=(i=Math.max(e,t,o))-Math.min(e,t,o))?null:i===e?(t-o)/r:i===t?(o-e)/r+2:(e-t)/r+4)+360)%6*60/360||1,s:0===r?0:r/i,b:i,a:a||1}},HueToRGB:function(e,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?e+(t-e)*o*6:2*o<1?t:3*o<2?e+(t-e)*(2/3-o)*6:e},HSLtoRGB:function(e,t,o,a){var r;t<0&&(t=0);var n=2*o-(r=o<=.5?o*(1+t):o+t-o*t),s=e+1/3,l=e,c=e-1/3;return[Math.round(255*i.HueToRGB(n,r,s)),Math.round(255*i.HueToRGB(n,r,l)),Math.round(255*i.HueToRGB(n,r,c)),a||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery),angular.module("theme.colorpicker-controller",[]).controller("ColorPickerController",["$scope","$global",function(e,t){"use strict";e.headerStylesheet="header-midnightblue.css",e.sidebarStylesheet="sidebar-gray.css",e.headerBarHidden=t.get("headerBarHidden"),e.layoutFixed=t.get("layoutBoxed"),e.headerFixed=t.get("fixedHeader"),e.layoutHorizontal=t.get("layoutHorizontal"),e.setHeaderStyle=function(t,o){o.preventDefault(),o.stopPropagation(),e.headerStylesheet=t},e.setSidebarStyle=function(t,o){o.preventDefault(),o.stopPropagation(),e.sidebarStylesheet=t},e.$watch("headerFixed",function(e){void 0!==e&&t.set("fixedHeader",e)}),e.$watch("layoutFixed",function(e){t.set("layoutBoxed",e)}),e.$watch("layoutHorizontal",function(e){t.set("layoutHorizontal",e)}),e.$on("globalStyles:changed:layoutBoxed",function(t,o){e.layoutFixed=o}),e.$on("globalStyles:changed:layoutHorizontal",function(t,o){e.layoutHorizontal=o})}]),function(e){e.module("white-label-directives",[]).directive("fontSelector",function(){return{restrict:"E",require:"ngModel",template:['<select class="form-control" ng-model="selectedFont">','<option value="" ng-selected="true" ng-disabled="true"> --Select--</option> ','<option ng-repeat="fs in fontSelections" style="font-family: \'{{fs.cssFontFamily}}\'">',"{{fs.displayText}}","</option>","</select>"].join(""),scope:{selectedFont:"=ngModel",fontSelections:"="}}})}(angular),angular.module("white-label-directives").directive("hexcode",function(){return{require:"ngModel",link:function(e,t,o,a){a.$parsers.unshift(function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?(a.$setValidity("hexcode",!0),e):void a.$setValidity("hexcode",!1)})}}}),angular.module("whitelabel",["white-label-directives","api-param","ui.bootstrap.modal","theme.form-directives"]).controller("WhitelabelColorsLogoController",["$timeout","$scope","$rootScope","$location","WhiteLabelWebService","pinesNotifications","$uibModal","$window","DynamicCssInsertion","OrgUnitWebService",function(e,t,o,a,i,r,n,s,l,c){if(t.DEFAULT_ORG_LOGO_URL="",t.support_url=null,t.chat_active=!1,t.isLoadingApi=!0,t.welcome_text="",o.highestOUId!==o.billingId||t.userAccess.white<6)location.href="#/access-denied";else{t.org_log=!1,t.initialize=function(){t.fillFormValues()};var d=!1;t.resetDefault=function(e){d=!0,e.preventDefault(),t.white_label_css={fonts:t.getDefaultFontThemeSettings(),colors_one:t.getDefaultColorThemeSettingsOne(),colors_two:t.getDefaultColorThemeSettingsTwo()},t.org_logo=t.DEFAULT_ORG_LOGO_URL,t.removeImageInFileUpload()},t.removeImageInFileUpload=function(){e(function(){var e=$("a.fileinput-exists");e.length&&"none"!==e.css("display")&&e.click()},1)},t.fillFormValues=function(){console.log("fillFormValues called"),i.getAllButEmailWhiteLabelInfo(o.currentOUId).then(function(e){var a;t.isLoadingApi=!1,void 0!==e.data&&void 0!==e.data.json&&Object.keys(e.data.json).length>0?(console.log("Using defined style found"),a=e.data.json[0]||t.getDefaultWhiteLabelServerData(),t.org_logo=a.org_logo,t.white_label_bool=a.white_label_active,_.extend(t,a),t.white_label_css&&t.white_label_css.fonts&&t.white_label_css.colors_one&&t.white_label_css.colors_two||(t.white_label_css={fonts:t.getDefaultFontThemeSettings(),colors_one:t.getDefaultColorThemeSettingsOne(),colors_two:t.getDefaultColorThemeSettingsTwo()})):(t.white_label_css=t.defaultCss(),t.white_label_bool=!1,console.log("Using default values",t.white_label_css)),t.org_logo||(t.org_logo=t.DEFAULT_ORG_LOGO_URL),!1===t.white_label_bool&&(console.log("is false - using OUID",o.currentOUId),i.getStyle(o.currentOUId).then(function(e){console.log("Getting CSS to apply",e.data);var o=e.data.json;o.org_logo=o.org_logo?o.org_logo:t.DEFAULT_ORG_LOGO_URL,console.log("setting logo to ",t.org_logo,o.org_logo),l.whiteLabelCSSInject(o.white_label_css,o.org_logo,o.org_logo,!0)}))})},t.saveWhitelabelActiveToggle=function(){t.isLoadingApi=!1;var e=new FormData;e.append("org_unit_id",o.currentOUId),e.append("white_label_active",t.white_label_bool),console.log("white_label_bool",t.white_label_bool),i.saveAllButEmailWhitelabelSettings(e).then(function(e){void 0!==e.data&&void 0!==e.data.result&&"error"!==e.data.result?(r.notify({title:"Whitelabel Activity",text:"Whitelabel is now "+(t.white_label_bool?"active":"inactive")+".",type:"success"}),t.applyStyle()):r.notify({title:"Whitelabel Activity",text:"Error: "+JSON.stringify(e.data.err),type:"error"})})},t.saveDomainAndSupport=function(){if(t.isLoadingApi=!1,t.domainSupportForm.$valid){t.domain_name&&(t.domain_name=t.domain_name.toLowerCase()),void 0===t.support_url||null===t.support_url?t.support_url=null:0===t.support_url.length&&(t.support_url=null),void 0!==t.welcome_text&&null!==t.welcome_text&&0!==t.welcome_text.length||(t.welcome_text="Just log in! Your day is about to get better.");var e=new FormData;e.append("org_unit_id",o.currentOUId),e.append("domain_name",t.domain_name||null),e.append("support_url",t.support_url||null),e.append("chat_active",t.chat_active||!1),e.append("welcome_text",t.welcome_text),i.saveAllButEmailWhitelabelSettings(e).then(function(e){"success"!==e.data.result||e.data.err?"error"===e.data.result&&'Problem saving whitelabel settings: error: duplicate key value violates unique constraint "org_white_label_domain_name_key"'==e.data.err?r.notify({title:"Domains and Support",text:"Error: This subdomain is already in use. Please enter a unique value.",type:"error"}):r.notify({title:"Domains and Support",text:"Error: "+JSON.stringify(e.data.err),type:"error"}):(r.notify({title:"Domains and Support",text:"Whitelabel settings for Domains and Support have been updated.",type:"success"}),t.applyStyle())},function(e){r.notify({title:"Domains and Support",text:"Error: "+JSON.stringify(e.data),type:"error"})})}else r.notify({title:"Domains and Support",text:"Whoops. At least one of your forms is invalid.",type:"error"})},t.injectDefaultStyling=function(){var e=_.extend({},t.generateCssForFormName({colors_one:t.getDefaultColorThemeSettingsOne(),colors_two:t.getDefaultColorThemeSettingsTwo(),fonts:t.getDefaultFontThemeSettings()}));l.whiteLabelCSSInject(e,t.DEFAULT_ORG_LOGO_URL,t.DEFAULT_ORG_LOGO_URL,!1)},t.previewColor=function(){if(t.themeSettingsForm.$valid){var e=_.extend({},t.generateCssForFormName(t.white_label_css,!0)),a=$("#img_pre").children().attr("src");void 0!==a||d||(a=$("#current_logo").attr("src")),void 0===a?c.getOrgUnitById(o.currentOUId).then(function(t){var r=o.currentOUId;d&&t.data.json[0].org_unit_parent_id&&t.data.json[0].org_unit_parent_id>0&&(r=t.data.json[0].org_unit_parent_id),i.getStyle(r).then(function(o){a=o.data.json.org_logo,d&&null===t.data.json[0].org_unit_parent_id&&(a="/assets/img/cfa-logo2.png"),l.whiteLabelCSSInject(e,a,a,!0),n.open({templateUrl:"assets/partials/preview.html",controller:"WhitelabelPreviewController",size:"lg",backdrop:"static",keyboard:!1})})}):(l.whiteLabelCSSInject(e,a,a,!0),n.open({templateUrl:"assets/partials/preview.html",controller:"WhitelabelPreviewController",size:"lg",backdrop:"static",keyboard:!1}))}else r.notify({title:"Colors and Theme",text:"Whoops. At least one of your forms is invalid.",type:"error"})},t.saveColorsLogoTheme=function(){if(t.themeSettingsForm.$valid){var e=new FormData,a=document.getElementById("org-logo");if(a&&a.files[0]){if("image/jpeg"!==a.files[0].type&&"image/png"!==a.files[0].type)return void r.notify({title:"Colors and Theme",text:"Whoops. The Logo image must be of file type JPG or PNG",type:"error"});if(a.files[0].size>2097152)return void r.notify({title:"Colors and Theme",text:"Whoops. The Logo image must be smaller than 2 MB",type:"error"});e.append("file",a.files[0])}else t.org_logo===t.DEFAULT_ORG_LOGO_URL&&e.append("org_logo",null);e.append("org_unit_id",o.currentOUId);var n=_.extend({},t.generateCssForFormName(t.white_label_css));_.each(n,function(e){_.each(e,function(e){delete e.$$hashKey})}),e.append("white_label_css",JSON.stringify(n)),i.saveAllButEmailWhitelabelSettings(e).then(function(e){if("success"!==e.data.result||e.data.err)r.notify({title:"Colors and Logo",text:"Error: "+JSON.stringify(e.data.err),type:"error"});else{r.notify({title:"Colors and Logo",text:"Whitelabel settings for Colors and Logo have been updated.",type:"success"}),t.applyStyle(),d=!1;var o=$("#img_pre").children().attr("src");console.log(o),o&&(t.org_logo=o),t.removeImageInFileUpload()}},function(e){r.notify({title:"Colors and Logo",text:"Error: "+JSON.stringify(e),type:"error"})})}else r.notify({title:"Colors and Theme",text:"Whoops. At least one of your forms is invalid.",type:"error"})},t.applyStyle=function(){i.getStyle(o.currentOUId).then(function(e){"success"!==e.data.result?r.notify({title:"Domains and Support",text:"Error: "+e.err,type:"error"}):(o.chatURL=s.sessionStorage.chatURL="https://support.convirza.com/customer/portal/chats/new",Object.keys(e.data.json).length>0?(o.white_label_active=s.sessionStorage.white_label_active=e.data.json.white_label_active,e.data.json.support_url||e.data.json.domain_name?o.supportURL=s.sessionStorage.supportURL=e.data.json.support_url:o.supportURL=s.sessionStorage.supportURL="https://knowledgebase.convirza.com",o.chatActive=s.sessionStorage.chatActive=e.data.json.chat_active,o.welcometext=s.sessionStorage.welcometext=e.data.json.welcome_text):(o.white_label_active=s.sessionStorage.white_label_active=!1,o.supportURL=s.sessionStorage.supportURL="https://knowledgebase.convirza.com",o.chatActive=s.sessionStorage.chatActive=!0,o.welcometext=s.sessionStorage.welcometext="Just log in! Your day is about to get better."),console.log(o.supportURL),l.whiteLabelCSSInject(e.data.json.white_label_css,e.data.json.org_logo,e.data.json.org_logo,!1),e.data.json.white_label_css&&void 0!==e.data.json.white_label_css&&Object.keys(e.data.json.white_label_css)&&e.data.json.org_logo&&t.white_label_bool&&(t.org_logo=e.data.json.org_logo))})},t.getDefaultWhiteLabelServerData=function(){return{chat_active:!1,chat_url:null,domain_name:null,org_logo:null,support_url:null,white_label_active:!1,welcome_text:"",white_label_css:{colors_one:t.getDefaultColorThemeSettingsOne(),colors_two:t.getDefaultColorThemeSettingsTwo(),fonts:t.getDefaultFontThemeSettings()}}},t.getDefaultColorThemeSettingsOne=function(){return[{formName:"Header Background",value:"#575757"},{formName:"Header Text",value:"#aaaaaa"},{formName:"Accent 1 Background",value:"#1f407d"},{formName:"Accent 1 Text",value:"#ffffff"}]},t.getDefaultColorThemeSettingsTwo=function(){return[{formName:"Navigation Background",value:"#575757"},{formName:"Navigation Text",value:"#f4f3ea"},{formName:"Navigation Highlight",value:"#e36c25"},{formName:"Navigation Text Hover",value:"#e0e0e0"},{formName:"Sub Nav Background",value:"#494949"}]},t.getDefaultFontThemeSettings=function(){return[{formName:"Font",value:"Helvetica"}]},t.generateCssForFormName=function(e,t){var o={"Header Background":["header.navbar-inverse,","nav.navbar { background-color: <%= value %>; }","header li.dropdown { border: 0px solid <%= value %> !important; }","#rightmenu-trigger { border: 0px solid <%= value %> !important; }","#leftmenu-trigger { border: 1px solid <%= value %> !important;}"],"Navigation Background":["#page-container,","nav#page-leftbar,",".focusedform,","#sidebar ul,","#fillerOnPreview { background-color: <%= value %>; }"],"Header Text":[".navbar-inverse .navbar-nav>li>a {color: <%= value %>;}"],Font:["h4,","h3,",".bc-main,",".bc-drawer-item,","#page-heading h1,","btn,",".btn,","text,","#sidebar,",".panel,",".row,","footer,",".tiles-heading,",".panel-group,",".btn-info,",".btn-default,",".btn-sm,",".btn-danger,",".btn-primary,",".fileinput-new,",".fileinput-exists,","select,","input,",".ui-pnotify-text,",".ui-pnotify-title,",".control-label,","btn[type=submit],",".hidden-xs,","input[type=file],",".dropdown-menu,",".btn-midnightblue-alt,","h3.popover-title,","div.popover-content,",".navbar-inverse .navbar-nav>li>a,",".panel-heading h4 {font-family: <%= value %> !important;}","body {font-family: <%= value %>;}"],"Sub Nav Background":["#sidebar ul,","#sidebar ul li a,","#sidebar .divider,","#sidebar .divider:hover,","body.collapse-leftbar #search.keep-open > a,",".navbar-inverse .navbar-nav > .active > a,",".navbar-inverse .navbar-nav > .open > a,",".navbar-inverse .navbar-nav > .active > a:focus,",".navbar-inverse .navbar-nav > .open > a:focus,",".navbar-inverse .navbar-nav > .active > a:hover,",".navbar-inverse .navbar-nav > .open > a:hover { background-color: <%= value %> !important;}","header .toolbar .dropdown,","header #headerbardropdown,","header #rightmenu-trigger { border: 1px solid <%= value %>; }","header #leftmenu-trigger { border: 1px solid <%= value %>; }","@media (min-width: 768px) {","#horizontal-navbar.large-icons-nav .navbar-nav li ul { background-color: <%= value %>; }","#horizontal-navbar.large-icons-nav .navbar-nav li ul li a:hover { background: <%= value %>; color: #ffffff; } }","@media (max-width: 480px) {","ul.toolbar {background-color: <%= value %>;} }"],"Navigation Text":["#sidebar li a,","#sidebar ul li.active:not(.open) > a,","#sidebar ul li a {color: <%= value %>;}","body.collapse-leftbar #search.keep-open > a:hover {background: <%= value %>;}","@media (min-width: 768px) {","#horizontal-navbar.large-icons-nav .navbar-nav li ul li a { color: <%= value %>;} }"],"Navigation Highlight":["#sidebar a:hover,","body.collapse-leftbar #sidebar > li:hover,","body.collapse-leftbar #sidebar > li.keep-open { background-color: <%= value %>!important;}","a,","a:hover,",".btn-link:hover,",".btn-link:focus {color: <%= value %>;}","#sidebar > li.active > a { background-color: <%= value %>;}"],"Navigation Text Hover":["#sidebar a:hover,","#sidebar a:hover i,","body.collapse-leftbar #sidebar > li:hover > a,","body.collapse-leftbar #sidebar > li:hover > a i,","body.collapse-leftbar #sidebar > li.keep-open > a,","body.collapse-leftbar #sidebar > li.keep-open > a i,","#sidebar ul li.active a:hover,","nav.navbar .navbar-toggle,","nav.navbar .navbar-toggle:hover,","nav.navbar .navbar-toggle:focus { color: <%= value %> !important;}"],"Accent 1 Text":["#sidebar > li.active > a,","body.collapse-leftbar #sidebar > li.active:hover > a,",".btn-midnightblue:hover,",".btn-midnightblue:focus,",".btn-midnightblue:active,",".btn-midnightblue.active,",".open > .dropdown-toggle.btn-midnightblue,",".btn-midnightblue {color: <%= value %>;}"],"Accent 1 Background":[".timeline-midnightblue .timeline-body:after{ border-right-color:<%= value %> !important}",".info-tiles.tiles-midnightblue .tiles-body,",".timeline-midnightblue .timeline-body { background-color: <%= value %> !important;}",".panel-midnightblue .panel-heading,",".panel-inverse .panel-heading,",".btn-midnightblue { background-color:<%= value %> !important; border-color:<%= value %> ;}",".info-tiles.tiles-midnightblue:hover .tiles-heading { background-color:<%= value %>; }",".info-tiles.tiles-midnightblue .tiles-heading { background-color: <%= lighterVal %>; }",".info-tiles.tiles-midnightblue:hover .tiles-body,",".info-tiles.tiles-midnightblue:hover .tiles-body-alt {background:<%= darkerVal %>;}",".btn-midnightblue:hover,",".btn-midnightblue:focus,",".btn-midnightblue.active,",".open > .dropdown-toggle.btn-midnightblue {background-color: <%= darkerVal %>;}",".btn-midnightblue:hover,",".btn-midnightblue:focus,",".btn-midnightblue:active,",".open > .dropdown-toggle.btn-midnightblue {border-color: <%= darkerVal %>;}"]};return t&&_.each(o,function(e,t,o){o[t]=e.map(function(e){return"@media"!==e.substr(0,6)?".preview "+e:e})}),_.each(o,function(e,t,o){"Accent 1 Background"!==t?o[t]=_.template(e.join("")):"Accent 1 Background"===t&&(o[t]=function(t){return function(e,t){function o(e,t){var o=parseInt(e.slice(1),16),a=t<0?0:255,i=t<0?-1*t:t,r=o>>16,n=o>>8&255,s=255&o;return"#"+(16777216+65536*(Math.round((a-r)*i)+r)+256*(Math.round((a-n)*i)+n)+(Math.round((a-s)*i)+s)).toString(16).slice(1)}return _.template(e)(_.extend(t,{lighterVal:o(t.value,.1),darkerVal:o(t.value,-.2)}))}(e.join(""),t)})}),_.each(e,function(e,t,a){a[t]=_.map(e,function(e){return e.css=o[e.formName]({value:e.value}),e})}),e},t.defaultCss=function(){return{fonts:[{formName:"Font",value:"Helvetica",css:"h4,h3, .bc-main, .bc-drawer-item,#page-heading h1,btn,.btn,text,#sidebar,.panel,.row,footer,.tiles-heading,.panel-group,.btn-info,.btn-default,.btn-sm,.btn-danger,.btn-primary,.fileinput-new,.fileinput-exists,select,input,.ui-pnotify-text,.ui-pnotify-title,.control-label,btn[type=submit],.hidden-xs,input[type=file],.dropdown-menu,.btn-midnightblue-alt,h3.popover-title,div.popover-content,.panel-heading h4 {}body {}"}],colors:[{formName:"Header Background",value:"#575757",css:"header.navbar-inverse,nav.navbar { background-color: #575757; }header li.dropdown { border: 0px solid #575757 !important; } #rightmenu-trigger { border: 0px solid #575757 !important; }#leftmenu-trigger { border: 1px solid #575757 !important;}"},{formName:"Header Text",value:"#aaaaaa",css:".navbar-inverse .navbar-nav>li>a {color: #aaaaaa;}"},{formName:"Navigation Background",value:"#575757",css:"#page-container,nav#page-leftbar,.focusedform,#sidebar ul, #fillerOnPreview { background-color: #575757; }"},{formName:"Navigation Text",value:"#f4f3ea",css:"#sidebar li a, #sidebar ul li.active:not(.open) > a, #sidebar ul li a {color: #f4f3ea;}body.collapse-leftbar #search.keep-open > a:hover {background: #f4f3ea;}@media (min-width: 768px) {#horizontal-navbar.large-icons-nav .navbar-nav li ul li a { color: #f4f3ea;} }"},{formName:"Navigation Highlight",value:"#e36c25",css:"#sidebar a:hover,body.collapse-leftbar #sidebar > li:hover,body.collapse-leftbar #sidebar > li.keep-open { background-color: #e36c25!important;}a,a:hover,.btn-link:hover,.btn-link:focus {color: #e36c25;}#sidebar > li.active > a { background-color: #e36c25;}"},{formName:"Navigation Text Hover",value:"#e0e0e0",css:"#sidebar a:hover,#sidebar a:hover i,body.collapse-leftbar #sidebar > li:hover > a,body.collapse-leftbar #sidebar > li:hover > a i,body.collapse-leftbar #sidebar > li.keep-open > a,body.collapse-leftbar #sidebar > li.keep-open > a i,#sidebar ul li.active a:hover,nav.navbar .navbar-toggle,nav.navbar .navbar-toggle:hover,nav.navbar .navbar-toggle:focus { color: #e0e0e0 !important;}"},{formName:"Sub Nav Background",value:"#494949",css:"#sidebar ul,#sidebar ul li a,#sidebar .divider,#sidebar .divider:hover,body.collapse-leftbar #search.keep-open > a,.navbar-inverse .navbar-nav > .active > a,.navbar-inverse .navbar-nav > .open > a,.navbar-inverse .navbar-nav > .active > a:focus,.navbar-inverse .navbar-nav > .open > a:focus,.navbar-inverse .navbar-nav > .active > a:hover,.navbar-inverse .navbar-nav > .open > a:hover { background-color: #494949 !important;}header .toolbar .dropdown,header #headerbardropdown,header #rightmenu-trigger { border: 1px solid #494949; }header #leftmenu-trigger { border: 1px solid #494949; }@media (min-width: 768px) {#horizontal-navbar.large-icons-nav .navbar-nav li ul { background-color: #494949; }#horizontal-navbar .large-icons-nav .navbar-nav li ul li a:hover { background: #494949; color: #ffffff; } }@media (max-width: 480px) {ul.toolbar {background-color: #494949;} }"},{formName:"Accent 1 Background",value:"#1f407d",css:".timeline-midnightblue .timeline-body:after{ border-right-color:#1f407d !important}.info-tiles .tiles-midnightblue .tiles-body,.timeline-midnightblue .timeline-body { background-color: #1f407d !important;}.panel-midnightblue .panel-heading,.panel-inverse .panel-heading,.btn-midnightblue { background-color:#1f407d !important; border-color:#1f407d ;}.info-tiles.tiles-midnightblue:hover .tiles-heading { background-color:#1f407d; }.info-tiles.tiles-midnightblue .tiles-heading { background-color: #35538a; }.info-tiles.tiles-midnightblue:hover .tiles-body,.info-tiles.tiles-midnightblue:hover .tiles-body-alt {background:#193364;}.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue.active,.open > .dropdown-toggle .btn-midnightblue {background-color: #193364;}.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue:active,.open > .dropdown-toggle .btn-midnightblue {border-color: #193364;}"},{formName:"Accent 1 Text",value:"#ffffff",css:"#sidebar > li.active > a,body.collapse-leftbar #sidebar > li.active:hover > a,.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue:active,.btn-midnightblue.active,.open > .dropdown-toggle.btn-midnightblue,.btn-midnightblue {color: #ffffff;}"}]}},t.initialize(),t.themez={a:0,b:0,c:0},t.setTheme=function(e){return 1===t.themez.a&&1===t.themez.b&&1===t.themez.c&&"a"===e?(t.white_label_css={fonts:[{formName:"Font",value:"Helvetica"}],colors_one:[{formName:"Header Background",value:"#4b8661"},{formName:"Header Text",value:"#e22f4a"},{formName:"Accent 1 Background",value:"#1d4b2b"},{formName:"Accent 1 Text",value:"#ffffff"}],colors_two:[{formName:"Navigation Background",value:"#7eb989"},{formName:"Navigation Text",value:"#256a22"},{formName:"Navigation Highlight",value:"#ffffff"},{formName:"Navigation Text Hover",value:"#00ffc9"},{formName:"Sub Nav Background",value:"#652a2a"}]},t.org_logo=t.DEFAULT_ORG_LOGO_URL,void(t.themez={a:0,b:0,c:0})):3==t.themez.c?(t.white_label_css={fonts:[{formName:"Font",value:"Helvetica"}],colors_one:[{formName:"Header Background",value:"#4b8661"},{formName:"Header Text",value:"#e22f4a"},{formName:"Accent 1 Background",value:"#1d4b2b"},{formName:"Accent 1 Text",value:"#ffffff"}],colors_two:[{formName:"Navigation Background",value:"#7eb989"},{formName:"Navigation Text",value:"#256a22"},{formName:"Navigation Highlight",value:"#ffffff"},{formName:"Navigation Text Hover",value:"#00ffc9"},{formName:"Sub Nav Background",value:"#652a2a"}]},t.org_logo=t.DEFAULT_ORG_LOGO_URL,void(t.themez={a:0,b:0,c:0})):void++t.themez[e]}}}]).controller("WhitelabelPreviewController",["$scope","$rootScope","$location","WhiteLabelWebService","pinesNotifications","$window","$uibModalInstance",function(e,t,o,a,i,r,n){e.cancelPreview=function(){n.dismiss("cancel")}}]),angular.module("white-label-directives").factory("WhiteLabelCSS",function(){}),angular.module("whitelabel").factory("WhiteLabelWebService",["$http","ApiParam","$window",function(e,t,o){var a={getAllButEmailWhiteLabelInfo:function(o){if(!o||isNaN(o))throw"non number type passed into WhiteLabelWebService.getAllButEmailWhiteLabelInfo";return e.get(t.baseURL()+"/v1/whitelabel/"+o,t.headerConfig())},saveAllButEmailWhitelabelSettings:function(a){var i={transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:"bearer "+o.sessionStorage.token}};return e.post(t.baseURL()+"/v1/whitelabel",a,i)},getEmailTemplateInfo:function(o,a){if(!o||isNaN(o))throw"non number for orgUnitId passed into WhiteLabelWebService.getEmailTemplateInfo";if(!a||isNaN(a))throw"non number for emailId passed into WhiteLabelWebService.getEmailTemplateInfo";return e.get(t.baseURL()+"/v1/emailtemplate/"+o+"/"+a,t.headerConfig())},getStyle:function(a){var i={headers:{"Content-Type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return e.get(t.baseURL()+"/v1/useraccess/styleou/"+a,i)},getDefaultStyle:function(){var a={headers:{"Content-Type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return e.get(t.baseURL()+"/v1/useraccess/style",a)},saveEmailWhitelabelSettings:function(a,i){var r={method:i,url:t.baseURL()+"/v1/emailtemplate",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:a};return e(r)}};return a}]),angular.module("whitelabel").controller("WhitelabelEmailsCtrl",["$scope","$rootScope","WhiteLabelWebService","pinesNotifications",function(e,t,o,a){e.manualScoreCardEmail=!1,t.highestOUId!==t.billingId||e.userAccess.white<6?location.href="#/access-denied":(e.userAccess&&void 0!==e.userAccess.manualscorecard&&e.userAccess.manualscorecard>=4&&(e.manualScoreCardEmail=!0),Object.keys(CKEDITOR.instances).length&&(CKEDITOR=void 0,window.loadUpCkEditor&&window.loadUpCkEditor(),window.strInsPluginReload&&window.strInsPluginReload(),window.loadCkEditorLang&&window.loadCkEditorLang()),e.initialize=function(){e.selectedTabName="newUser",e.fillFormValues(1)},e.onTabSelect=function(t,o){e.selectedTabName=t,e.fillFormValues(o)},e.fillFormValues=function(a){o.getEmailTemplateInfo(t.currentOUId,a).then(function(t){if(t&&t.data&&t.data.json&&t.data.json[0]&&t.data.json[0].master_id>0){e[e.selectedTabName]=t.data.json[0],e[e.selectedTabName].fetched=!0,CKEDITOR.config.strinsert_strings.splice(0,CKEDITOR.config.strinsert_strings.length);for(var o=0;o<t.data.json[0].dynamic_field.length;o++)CKEDITOR.config.strinsert_strings.push(["[["+t.data.json[0].dynamic_field[o]+"]]",t.data.json[0].field_display[o],t.data.json[0].field_display[o]]);t.data.json[0].html_copy?CKEDITOR.instances[e.selectedTabName].setData(t.data.json[0].html_copy,null):CKEDITOR.instances[e.selectedTabName].setData(t.data.json[0].html_template,null),e[e.selectedTabName].email_from||e.getDefaultEmailFrom(),e[e.selectedTabName].reply_to||e.getDefaultReplyTo(),e[e.selectedTabName].subject||e.getDefaultSubject(),"notifications"===e.selectedTabName&&(e.notifications.event_label||(e.notifications.event_label="provisioned_route_name"),e.notifications.campaign_name||(e.notifications.campaign_name="campaign_name"),e.notifications.campaign_source||(e.notifications.campaign_source="channel"))}else t.data.json&&t.data.json[0]&&CKEDITOR.instances[e.selectedTabName].setData(t.data.json[0].html_template,null),e.getDefaultEmailTemplateData()})},e.getDefaultEmailTemplateData=function(){e[e.selectedTabName]||(e[e.selectedTabName]={}),e.getDefaultEmailFrom(),e.getDefaultReplyTo(),e.getDefaultSubject(),"notifications"===e.selectedTabName&&(e[e.selectedTabName].event_label="provisioned_route_name",e[e.selectedTabName].campaign_name="campaign_name",e[e.selectedTabName].campaign_source="channel")},e.getDefaultEmailFrom=function(){e[e.selectedTabName].email_from="no-reply@messages.services"},e.getDefaultReplyTo=function(){e[e.selectedTabName].reply_to="no-reply@messages.services"},e.getDefaultSubject=function(){e[e.selectedTabName].subject="Welcome User","updatePass"===e.selectedTabName&&(e[e.selectedTabName].subject="Password Updated"),"notifications"===e.selectedTabName&&(e[e.selectedTabName].subject="Convirza Notification"),"recordings"===e.selectedTabName&&(e[e.selectedTabName].subject="Call Recording"),"ScoreCompleted"===e.selectedTabName&&(e[e.selectedTabName].subject="Score Completed Notification"),"ScoreReviwed"===e.selectedTabName&&(e[e.selectedTabName].subject="Score Reviewed Notification")},e.notifications={},e.eventLabeloptions=[{name:"Group Name",value:"org_unit_name"},{name:"Campaign Name",value:"campaign_name"},{name:"Call Flow Name",value:"provisioned_route_name"},{name:"Event Criteria",value:"event_criteria"},{name:"Ad Source",value:"channel"}],e.saveEmailTemplate=function(i){var r=[];if(/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|ca|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|services|aaaaaaa[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.test(e[e.selectedTabName].reply_to)||r.push("Reply To email address"),e[e.selectedTabName].ga_active&&(/^ua-\d{4,9}-\d{1,4}$/i.test(e[e.selectedTabName].tracking_id)||r.push("Tracking ID")),r.length)a.notify({title:"Email Validation Error",text:"Please enter a valid "+r.join(", and  "),type:"error"});else{e[e.selectedTabName].html_copy=CKEDITOR.instances[e.selectedTabName].getData();var n={email_template:{master_id:i,org_unit_id:t.currentOUId,subject:e[e.selectedTabName].subject,reply_to:e[e.selectedTabName].reply_to,email_from:""!==e[e.selectedTabName].email_from?e[e.selectedTabName].email_from:null,html_copy:e[e.selectedTabName].html_copy,ga_active:null!==e.notifications.ga_active&&void 0!==e.notifications.ga_active&&e.notifications.ga_active}};"notifications"===e.selectedTabName&&(n.email_template.ga_id=e.notifications.ga_id,n.org_google_analytic={org_unit_id:t.currentOUId,tracking_id:e.notifications.tracking_id,event_label:e.notifications.event_label,campaign_source:e.notifications.campaign_source,campaign_name:e.notifications.campaign_name,custom_metric:e.notifications.custom_metric,ga_active:null!==e.notifications.ga_active&&void 0!==e.notifications.ga_active&&e.notifications.ga_active,static_string:"v=1&t=event&ec=email&cm=email&ea=open&ni=1"},e.notifications.ga_id&&(n.org_google_analytic.ga_id=e.notifications.ga_id));var s="POST";e[e.selectedTabName].email_id>0&&(n.email_template.email_id=e[e.selectedTabName].email_id,s="PUT"),o.saveEmailWhitelabelSettings(n,s).then(function(t){"success"===t.data.result?(a.notify({title:"Email Template",text:"Email Template saved successfully.",type:"success"}),e[e.selectedTabName]=void 0,e.fillFormValues(i)):a.notify({title:"Email Template Error",text:"Error: Email Template not saved successfully.",type:"error"})})}},e.resetDefaultEmailTemplate=function(a,i){e[e.selectedTabName]&&o.getEmailTemplateInfo(t.currentOUId,i).then(function(t){CKEDITOR.instances[e.selectedTabName].setData(t.data.json[0].html_template,null),e[e.selectedTabName].email_id=t.data.json[0].email_id,e.getDefaultEmailTemplateData(),"notifications"==e.selectedTabName&&(e[e.selectedTabName].ga_active=!1,e[e.selectedTabName].tracking_id=null,e[e.selectedTabName].custom_metric=null,e[e.selectedTabName].event_label="provisioned_route_name",e[e.selectedTabName].campaign_name="campaign_name",e[e.selectedTabName].campaign_source="channel")})},CKEDITOR.config.strinsert_strings=[],CKEDITOR.config.strinsert_strings.push(["[[First Name]]","First Name","First Name"]),e.initialize())}]),angular.module("whitelabel").factory("DynamicCssInsertion",function(){var e={whiteLabelCSSInject:function(e,t,o,a){var i="";null!==t&&void 0!==t&&""!==t||(t="/assets/img/cfa-logo2.png"),i+=(a?" .preview ":"")+".navbar-brand { background:url('"+t+"') no-repeat left/ auto auto !important; background-size:contain !important; }\n",o&&(i+=(a?" .preview ":"")+".login-logo { background:url('"+o+"') no-repeat center center; position:relative; top: -10px; }\n"),(null===e||void 0===e||""===e||Object.keys(e).length<1)&&(e={fonts:[{formName:"Font",value:"Helvetica",css:"h4,h3, .bc-main, .bc-drawer-item,#page-heading h1,btn,.btn,text,#sidebar,.panel,.row,footer,.tiles-heading,.panel-group,.btn-info,.btn-default,.btn-sm,.btn-danger,.btn-primary,.fileinput-new,.fileinput-exists,select,input,.ui-pnotify-text,.ui-pnotify-title,.control-label,btn[type=submit],.hidden-xs,input[type=file],.dropdown-menu,.btn-midnightblue-alt,h3.popover-title,div.popover-content,.panel-heading h4 {}body {}"}],colors:[{formName:"Header Background",value:"#575757",css:"header.navbar-inverse,nav.navbar { background-color: #575757; }header li.dropdown { border: 0px solid #575757 !important; } #rightmenu-trigger { border: 0px solid #575757 !important; }#leftmenu-trigger { border: 1px solid #575757 !important;}"},{formName:"Header Text",value:"#aaaaaa",css:".navbar-inverse .navbar-nav>li>a {color: #aaaaaa;}"},{formName:"Navigation Background",value:"#575757",css:"#page-container,nav#page-leftbar,.focusedform,#sidebar ul, #fillerOnPreview { background-color: #575757; }"},{formName:"Navigation Text",value:"#f4f3ea",css:"#sidebar li a, #sidebar ul li.active:not(.open) > a, #sidebar ul li a {color: #f4f3ea;}body.collapse-leftbar #search.keep-open > a:hover {background: #f4f3ea;}@media (min-width: 768px) {#horizontal-navbar.large-icons-nav .navbar-nav li ul li a { color: #f4f3ea;} }"},{formName:"Navigation Highlight",value:"#e36c25",css:"#sidebar a:hover,body.collapse-leftbar #sidebar > li:hover,body.collapse-leftbar #sidebar > li.keep-open { background-color: #e36c25!important;}a,a:hover,.btn-link:hover,.btn-link:focus {color: #e36c25;}#sidebar > li.active > a { background-color: #e36c25;}"},{formName:"Navigation Text Hover",value:"#e0e0e0",css:"#sidebar a:hover,#sidebar a:hover i,body.collapse-leftbar #sidebar > li:hover > a,body.collapse-leftbar #sidebar > li:hover > a i,body.collapse-leftbar #sidebar > li.keep-open > a,body.collapse-leftbar #sidebar > li.keep-open > a i,#sidebar ul li.active a:hover,nav.navbar .navbar-toggle,nav.navbar .navbar-toggle:hover,nav.navbar .navbar-toggle:focus { color: #e0e0e0 !important;}"},{formName:"Sub Nav Background",value:"#494949",css:"#sidebar ul,#sidebar ul li a,#sidebar .divider,#sidebar .divider:hover,body.collapse-leftbar #search.keep-open > a,.navbar-inverse .navbar-nav > .active > a,.navbar-inverse .navbar-nav > .open > a,.navbar-inverse .navbar-nav > .active > a:focus,.navbar-inverse .navbar-nav > .open > a:focus,.navbar-inverse .navbar-nav > .active > a:hover,.navbar-inverse .navbar-nav > .open > a:hover { background-color: #494949 !important;}header .toolbar .dropdown,header #headerbardropdown,header #rightmenu-trigger { border: 1px solid #494949; }header #leftmenu-trigger { border: 1px solid #494949; }@media (min-width: 768px) {#horizontal-navbar.large-icons-nav .navbar-nav li ul { background-color: #494949; }#horizontal-navbar .large-icons-nav .navbar-nav li ul li a:hover { background: #494949; color: #ffffff; } }@media (max-width: 480px) {ul.toolbar {background-color: #494949;} }"},{formName:"Accent 1 Background",value:"#1f407d",css:".timeline-midnightblue .timeline-body:after{ border-right-color:#1f407d !important}.info-tiles.tiles-midnightblue .tiles-body,.timeline-midnightblue .timeline-body { background-color: #1f407d !important;}.panel-midnightblue .panel-heading,.panel-inverse .panel-heading,.btn-midnightblue { background-color:#1f407d !important; border-color:#1f407d ;}.info-tiles.tiles-midnightblue:hover .tiles-heading { background-color:#1f407d; }.info-tiles.tiles-midnightblue .tiles-heading { background-color: #35538a; }.info-tiles.tiles-midnightblue:hover .tiles-body,.info-tiles.tiles-midnightblue:hover .tiles-body-alt {background:#193364;}.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue.active,.open > .dropdown-toggle .btn-midnightblue {background-color: #193364;}.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue:active,.open > .dropdown-toggle .btn-midnightblue {border-color: #193364;}"},{formName:"Accent 1 Text",value:"#ffffff",css:"#sidebar > li.active > a,body.collapse-leftbar #sidebar > li.active:hover > a,.btn-midnightblue:hover,.btn-midnightblue:focus,.btn-midnightblue:active,.btn-midnightblue.active,.open > .dropdown-toggle.btn-midnightblue,.btn-midnightblue {color: #ffffff;}"}]}),_.each(e,function(e){_.each(e,function(e){i+=e.css+"\n"})});var r=document.createElement("style");r.innerHTML=i,document.body.appendChild(r)}};return e}),function(){function e(t,o,a){return e.getDataTableInfo=function(e){console.log("GET DATA TABLE INFO CALLED WITH:",e);var t=$.param(e);console.log("URLParam: ",t);var i=encodeURIComponent(JSON.stringify(e));return console.log(i),o.get(a.baseURL()+"/v1/report/callFlowSettings?"+t,a.headerConfig())},e.ivrSettings=function(e){return o.get(a.baseURL()+"/v1/report/ivrSettings/"+e,a.headerConfig())},e.percentSettings=function(e){return o.get(a.baseURL()+"/v1/report/percentSettings/"+e,a.headerConfig())},e.getAllOus=function(){return o.get(a.baseURL()+"/v1/orgUnit/getGroupsByAccessLevel?user_id="+t.userId+"&role="+t.roleId,a.headerConfig())},e}angular.module("callflow-report-settings-webservices",["api-param"]).factory("CallFlowSettingsReportWebService",e),e.$inject=["$rootScope","$http","ApiParam"]}(),function(){function e(t,o,a){return e.groupActivitySummary=function(e){return o.get(a.baseURL()+"/v1/report/groupActivities?count=true&"+e,a.headerConfig())},e.getDataTableInfo=function(e){return o.get(a.baseURL()+"/v1/report/groupActivities?"+e,a.headerConfig())},e.getAllOus=function(){return o.get(a.baseURL()+"/v1/orgUnit/getGroupsByAccessLevel?user_id="+t.userId+"&role="+t.roleId,a.headerConfig())},e}angular.module("group_activity_webservices",["api-param"]).factory("GroupActivitySettingsReportWebservices",e),e.$inject=["$rootScope","$http","ApiParam"]}(),function(){function e(t,o,a){return e.getCampaigns=function(e,t,i,r,n){return o.defaults.useXDomain=!0,o.get(a.baseURL()+"/v1/campaign/ouid/"+e+"/userAccess/"+t+"/"+encodeURIComponent(i)+"?page="+r+"&filter="+n,a.headerConfig())},e.getCampaignsCallFlowReport=function(e,i){return o.defaults.useXDomain=!0,o.get(a.baseURL()+"/v1/campaign/reportData/ouid/"+i+"/userAccess/"+e+"/"+encodeURIComponent(t.timezone),a.headerConfig())},e.getCampaignsCallFlow=function(e){return o.get(a.baseURL()+"/v1/campaignCallflow?campaign_id="+e,a.headerConfig())},e.getAllCampaignsCallFlow=function(e){var t={method:"POST",url:a.baseURL()+"/v1/campaignCallflow/all",headers:a.headerConfig().headers,data:e};return o(t)},e.removeCallFlow=function(e){var t={method:"PUT",url:a.baseURL()+"/v1/provisionedroute/delete",headers:a.headerConfig().headers,data:e};return o(t)},e.setCampaignStatus=function(e){var t={method:"PUT",url:a.baseURL()+"/v1/campaign/status",headers:a.headerConfig().headers,data:e};return o(t)},e}angular.module("campaign_list_webservices",["api-param"]).factory("CampaignListWebservices",e),e.$inject=["$rootScope","$http","ApiParam"]}(),angular.module("sandboxing",[]).controller("whatever",["$scope",function(e){e.columnCollection=["column1","column2","column3","column4","column5","column6"],e.rowCollection=Array.apply(null,{length:200}).map(function(){return e.columnCollection.map(function(e,t){return"foo "+t})})}]),angular.module("campaigns-builder",["angularFileUpload","kendo.directives","ui.select2","toggle-switch","angularUtils.directives.dirPagination","api-param","report-components","datetime-timezoned","ngTagsInput","theme.form-directives"]).directive("file","tooltip",function(){return{scope:{file:"="},link:function(e,t,o,a){t.bind("change",function(t){var o=t.target.files[0];e.file=o?o.name:void 0,e.$apply()}),a.hover(function(){a.tooltip("show")},function(){a.tooltip("hide")})}}}).factory("CampaignWebService",["$q","$timeout","$http","$window","$rootScope","$upload","ApiParam",function(e,t,o,a,i,r,n){"use strict";var s={getCampaigns:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone)+"/pageSize/"+t,n.headerConfig())},getCampaign:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/"+e+"/"+encodeURIComponent(i.timezone)+"?page="+t,n.headerConfig())},getCampaignsReport:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/reportData/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone),n.headerConfig())},saveBulkCallActions:function(e){var t={method:"POST",url:n.baseURL()+"/v1/callAction/bulk",headers:n.headerConfig().headers,data:e};return o(t)},getCampaignsCallFlowReport:function(e,t){return o.defaults.useXDomain=!0,t?o.get(n.baseURL()+"/v1/campaign/reportData/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone)+"?camp_id="+t,n.headerConfig()):o.get(n.baseURL()+"/v1/campaign/reportData/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone),n.headerConfig())},getCampaignCallflows:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaignCallflow",headers:n.headerConfig().headers,data:e};return o(t)},showCall:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaign",headers:n.headerConfig().headers,data:nc};return o(t)},createCampaign:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaign",headers:n.headerConfig().headers,data:e};return o(t)},createNumberPool:function(e){var t={method:"POST",url:n.baseURL()+"/v1/numberpool",headers:n.headerConfig().headers,data:e};return o(t)},updateNumberPool:function(e,t){var a={method:"PUT",url:n.baseURL()+"/v1/numberpool/"+t,headers:n.headerConfig().headers,data:e};return o(a)},updateCampaign:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/campaign/",headers:n.headerConfig().headers,data:e};return o(t)},setCampaignStatus:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/campaign/status",headers:n.headerConfig().headers,data:e};return o(t)},getPhoneNumbers:function(e,t,a){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/city/"+e+"/state/"+t+"/npa/"+a,n.headerConfig())},getReservedNumbers:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/reserved/"+i.currentOUId,n.headerConfig())},getPhoneNumber:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/number/"+e,n.headerConfig())},createCallFlow:function(e){var t={method:"POST",url:n.baseURL()+"/v1/provisionedroute",headers:n.headerConfig().headers,data:e};return o(t)},saveCallFlow:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/provisionedroute",headers:n.headerConfig().headers,data:e};return o(t)},getGeoCity:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/geolookup/cities/"+e,n.headerConfig())},getGeoZip:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/zip/"+e,n.headerConfig())},getDefaultData:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/defgroupsetting/populatecallflow/"+e,n.headerConfig())},getGeoArea:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/npa/"+e,n.headerConfig())},getCompUsers:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/user/campaignUser/"+e,n.headerConfig())},getCampOwners:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/user/campaignOwner/"+i.currentOUId+"/"+t,n.headerConfig())},getChannels:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/channel",n.headerConfig())},getprovRouteCallFlow:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflow/provisionedroute/"+e,n.headerConfig())},getAllAudios:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+e,n.headerConfig())},getVoicemails:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+e+"/voicemail",n.headerConfig())},getVoicePrompts:function(e){var t=i.currentOUId;return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+t+"/prompt",n.headerConfig())},getWhispers:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+e+"/whisper",n.headerConfig())},getTags:function(){return o.get(n.baseURL()+"/v1/tag/"+i.currentOUId,n.headerConfig())},getCustomSources:function(){return o.get(n.baseURL()+"/v1/customsource/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.campaign,n.headerConfig())},getWebhooks:function(){var e=i.currentOUId;return o.get(n.baseURL()+"/v1/webhook/list/"+e,n.headerConfig())},createTag:function(e){var t={method:"POST",url:n.baseURL()+"/v1/tag",headers:n.headerConfig().headers,data:e};return o(t)},createCustomSource:function(e){var t={method:"POST",url:n.baseURL()+"/v1/customsource",headers:n.headerConfig().headers,data:e};return o(t)},uploadVoicePrompt:function(e){var t;if(i.percentage=0,e&&e.length)for(var o=0;o<e.length;o++){var a=e[o];t=r.upload({url:n.baseURL()+"/v1/provisionedroute/prompt",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{name:a.name,org_unit_id:i.currentOUId},file:a}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return t},uploadWhisper:function(e){var t;if(i.percentage=0,e&&e.length)for(var o=0;o<e.length;o++){var a=e[o];t=r.upload({url:n.baseURL()+"/v1/provisionedroute/whisper",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{name:a.name,org_unit_id:i.currentOUId},file:a}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return t},uploadAudio:function(e,t){var o;if(i.percentage=0,e&&e.length)for(var a=0;a<e.length;a++){var s=e[a];o=r.upload({url:n.baseURL()+"/v1/callflowrecording/upload",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{org_unit_id:i.currentOUId,message_type:t},file:s}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return o},saveCallActions:function(e){var t={method:"POST",url:n.baseURL()+"/v1/callAction",headers:n.headerConfig().headers,data:e};return o(t)},updateCallActions:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/callAction",headers:n.headerConfig().headers,data:e};return o(t)},getcallActions:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callAction/byRoute/"+e,n.headerConfig())},removecallActions:function(e){var t={method:"DELETE",url:n.baseURL()+"/v1/callAction/"+e,headers:n.headerConfig().headers};return o(t)},callActionDC:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/doubleclick/callAction/"+e,n.headerConfig())},getThirdPartyNumbers:function(e,t){var a={method:"GET",url:n.baseURL()+"/v1/shoutpoint/rcState/"+encodeURIComponent(t)+"/"+e,headers:n.headerConfig().headers};return o(a)},removeCallFlow:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/provisionedroute/delete",headers:n.headerConfig().headers,data:e};return o(t)},saveBlackList:function(e){var t={method:"POST",url:n.baseURL()+"/v1/blacklist",headers:n.headerConfig().headers,data:e};return o(t)},getBlackList:function(e){var t={method:"GET",url:n.baseURL()+"/v1/blacklist/ouid/"+e,headers:n.headerConfig().headers};return o(t)},deleteAudioFile:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/callflowrecording/delete",headers:n.headerConfig().headers,data:e};return o(t)},getGeoLocations:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/location/ouid/"+i.currentOUId+"/"+encodeURIComponent(i.timezone),n.headerConfig())},getTTS:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflow/getmedia/"+encodeURIComponent(e),n.headerConfig())},getAnalytics:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/analytic/ouid/"+i.currentOUId+"/includeParentAnalytics/"+!0,n.headerConfig())},getSetCallerId:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflow/provisionedroutecallerIDs",n.headerConfig())},validateDniData:function(e,t){var o=[],a=[],i=new RegExp(/^([a-z0-9]+|\*)([\-\.]{1}[a-z0-9]+)*\.([a-z]{1,5}|\*)(:[0-9]{1,5})?(\/.*)?$/i);if(e.destination_url.indexOf("*")>-1&&("*"!=e.destination_url.charAt(0)||"."!=e.destination_url.charAt(1))&&(o.push("Host Domain"),a.push("When using a wildcard at the beginning of a Host Domain, *.domain format is required. Example: *.logmycalls.com")),e.referrer&&t)if(i.test(e.referrer)){var r=e.referrer.split(".");2==r.length&&"*"==r[0]&&"*"!=r[1]&&(o.push("Referring Website"),a.push("Wrong domain format for Referring Website."))}else o.push("Referring Website"),a.push("Wrong domain format for Referring Website.");e.dni_element&&("lmc_track"!=e.dni_element||"session"!=e.dni_type&&"source"!=e.dni_type||(o.push("Class"),a.push("The HTML Class ID 'lmc_track' is only allowed for URL-based DNI.")),"lmc_track"!=e.dni_element&&"url"==e.dni_type&&(o.push("Class"),a.push("The HTML Class ID 'lmc_track' is required for URL-based DNI.")),e.dni_element.indexOf(" ")>-1&&(o.push("Class"),a.push("The HTML ID Class must not contain spaces.")));e.destination_url,e.referrer,e.referrer_type,e.dni_element;return a},checkOutboundCallerId:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/provisionedroute/"+e,n.headerConfig())},checkOutboundCallerIdByCampaignID:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/provisionedroute/checkOutboundCallerIdByCampaignID/campaignID/"+e,n.headerConfig())},checkLDM:function(e){var t={method:"POST",url:n.baseURL()+"/v1/ldm",headers:n.headerConfig().headers,data:e};return o(t)}};return s}]).factory("voicemailPromptService",["$rootScope","CampaignWebService",function(e,t){"use strict";var o=[];if(!e.voicemails||e.voicemails&&e.voicemails.length<1)t.getVoicemails(e.currentOUId).then(function(e){if("error"!=e.data.result&&(o=e.data.json).length)for(var t=0;t<o.length;t++)o[t].selectedvoicemail=!1});else if((o=e.voicemails).length)for(var a=0;a<o.length;a++)o[a].selectedvoicemail=!1;return{getvoicemails:function(){return o},setvoicemails:function(e){o=e}}}]).controller("voicemailModel",["$scope","$rootScope","$window","$uibModalInstance","voicemailPromptService","CampaignWebService","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){var l=$("#filecontrol");if(e.upload={},e.upload.showme=[],e.voicemails=[],JSON.parse(o.sessionStorage.voicemails).length>0)for(var c=JSON.parse(o.sessionStorage.voicemails),d=0;d<c.length;d++)1==c[d].active&&(e.voicemails.push(c[d]),t.voicemails.push(c[d]));else t.voicemails="";e.isFileSelected=function(){return!!e.upload.files},e.useSelectedvoicemail=function(e){},e.savevoicemail=function(e,t){angular.extend(e,{id:t})},e.addvoicemail=function(){e.inserted={id:e.voicemails.length+1,name:"",status:null,group:null},e.voicemails.push(e.inserted)},e.removevoicemail=function(a){var i={id:e.voicemails[a].id};e.playvoiceaudio(a,e.voicemails[a].url,"pause"),s.confirm("Are you sure you want to delete this Voicemail Message?",function(s){s?r.deleteAudioFile(i).then(function(r){if($("body").addClass("modal-open"),"error"!=r.data.result){for(var s=JSON.parse(o.sessionStorage.voicemails),l=0;l<s.length;l++)s[l].id==i.id&&(s[l].active=!1);o.sessionStorage.voicemails=JSON.stringify(s),t.voicemails=s,n.notify({title:"voicemail Message",text:"voicemail Message deleted successfully",type:"success"}),e.voicemails.splice(a,1),e.upload.showme[a]=!1}else n.notify({title:"voicemail Message",text:"Error Deleting voicemail Message",type:"error"})}):setTimeout(function(){$("body").addClass("modal-open")},100)})},e.uploadFile=function(){var a=e.upload.files;if(e.fileIsUploading=!0,fileExtension=a[0].name.substr((Math.max(0,a[0].name.lastIndexOf("."))||1/0)+1),"mp3"!=fileExtension&&"wav"!=fileExtension&&"mp4"!=fileExtension)return e.fileIsUploading=!1,n.notify({title:"Voicemail Upload Message",text:"Invalid file type.",type:"error"}),!1;r.uploadAudio(a,"voicemail").then(function(a){e.fileIsUploading=!1,"error"!=a.data.result?(e.inserted={id:e.voicemails.length+1,name:a.data.json.call_flow_recording.url.filename,url:a.data.json.call_flow_recording.url.url,status:null,group:null},e.upload.files=null,r.getVoicemails(t.currentOUId).then(function(a){if("error"!=a.data.result){e.voicemails=a.data.json;var i=JSON.parse(o.sessionStorage.voicemails),r=e.voicemails[e.voicemails.length-1];if(r.active=!0,i.push(r),o.sessionStorage.voicemails=JSON.stringify(i),t.voicemails=i,e.voicemails)for(var n=0;n<e.voicemails.length;n++)e.voicemails[n].selectedvoicemail=!1}}),e.param=null,l.replaceWith(l=l.clone(!0))):e.error="Invalid email or password"})},e.removeotherchecks=function(t){for(var o=0;o<e.voicemails.length;o++)o!==t&&(e.voicemails[o].selectedvoicemail=!1);i.voicemails=e.voicemails},e.playvoiceaudio=function(t,o,a){var i;for(var r in void 0===e.audio&&(e.audio=[]),void 0===e.audio[t]&&(e.audio[t]=new Audio(o),e.audio[t].addEventListener("ended",function(){e.upload.showme[t]=!1})),e.audio)r!=t&&(e.audio[r].pause(),e.audio[r].currentTime&&(e.audio[r].currentTime=0),e.upload.showme[r]=!1);switch(a){case"play":e.audio[t].play();break;case"pause":e.audio[t].pause();break;case"rewind":e.audio[t].pause(),i=e.audio[t].currentTime,e.audio[r].currentTime&&(e.audio[t].currentTime=i-5,e.audio[t].play());break;case"forward":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=e.audio[t].currentTime+5,e.audio[t].play())}},e.ok=function(){var t,o=!1;if(e.voicemails)for(t=0;t<e.voicemails.length;t++)e.voicemails[t].selectedvoicemail&&(o=!0);if(o){if(e.audio)for(t=0;t<e.audio.length;t++)void 0!==e.audio[t]&&e.audio[t].pause();a.close()}else n.notify({title:"voicemail Message",text:"Please select a voicemail Message",type:"error"})},e.cancel=function(){if(e.audio)for(d=0;d<e.audio.length;d++)void 0!==e.audio[d]&&e.audio[d].pause();a.dismiss("cancel")}}]).factory("VoicePromptService",["$rootScope","CampaignWebService",function(e,t){"use strict";var o=[];if(!e.prompts||e.prompts&&e.prompts.length<1)t.getVoicePrompts(e.currentOUId).then(function(e){if("error"!=e.data.result&&(o=e.data.json).length)for(var t=0;t<o.length;t++)o[t].selectedprompt=!1});else if((o=e.prompts).length)for(var a=0;a<o.length;a++)o[a].selectedprompt=!1;return{getPrompts:function(){return o},setPrompts:function(e){o=e}}}]).factory("WhisperMessageService",["$rootScope","CampaignWebService",function(e,t){"use strict";var o=[];if(!e.whispers||e.whispers&&e.whispers.length<1)t.getWhispers(e.currentOUId).then(function(e){if("error"!=e.data.result&&(o=e.data.json).length)for(var t=0;t<o.length;t++)o[t].selectedwhisper=!1});else if((o=e.whispers).length)for(var a=0;a<o.length;a++)o[a].selectedwhisper=!1;return{getWhispers:function(){return o},setWhispers:function(e){o=e}}}]).controller("voiceModal",["$scope","$rootScope","$window","$uibModalInstance","VoicePromptService","CampaignWebService","OrgUnitWebService","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s,l){var c=$("#filecontrol");if(e.upload={},e.upload.showme=[],e.prompts=[],JSON.parse(o.sessionStorage.prompts).length>0)for(var d=JSON.parse(o.sessionStorage.prompts),u=0;u<d.length;u++)1==d[u].active&&(e.prompts.push(d[u]),t.prompts.push(d[u]));else t.prompts=[];e.isFileSelected=function(){return!!e.upload.files},e.useSelectedPrompt=function(e){},e.savePrompt=function(e,t){angular.extend(e,{id:t})},e.addPrompt=function(){e.inserted={id:e.prompts.length+1,name:"",status:null,group:null},e.prompts.push(e.inserted)},e.removePrompt=function(a){var i={id:e.prompts[a].id};e.playvoiceaudio(a,e.prompts[a].url,"pause"),l.confirm("Are you sure you want to delete this Prompt Message?",function(n){n?r.deleteAudioFile(i).then(function(r){if($("body").addClass("modal-open"),"error"!=r.data.result){for(var n=JSON.parse(o.sessionStorage.prompts),l=0;l<n.length;l++)n[l].id==i.id&&(n[l].active=!1);o.sessionStorage.prompts=JSON.stringify(n),t.prompts=n,e.prompts.splice(a,1),s.notify({title:"Voice Prompt Message",text:"Voice Prompt Message deleted successfully",type:"success"}),e.upload.showme[a]=!1}else s.notify({title:"Voice Prompt Message",text:"Error Deleting Voice Prompt Message",type:"error"})}):setTimeout(function(){$("body").addClass("modal-open")},100)})},e.uploadFile=function(){var a=e.upload.files;if(e.fileIsUploading=!0,fileExtension=a[0].name.substr((Math.max(0,a[0].name.lastIndexOf("."))||1/0)+1),"mp3"!=fileExtension&&"wav"!=fileExtension&&"mp4"!=fileExtension)return e.fileIsUploading=!1,s.notify({title:"Voice Prompt Upload",text:"Invalid File Type",type:"error"}),!1;r.uploadAudio(a,"prompt").then(function(a){e.fileIsUploading=!1,"error"!=a.data.status?(void 0!==e.prompts&&null!==e.prompts&&""!==e.prompts||(e.prompts=[]),e.inserted={id:e.prompts.length+1,name:a.data.json.call_flow_recording.url.filename,url:a.data.json.call_flow_recording.url.url,status:null,group:null},e.upload.files=null,r.getVoicePrompts(t.currentOUId).then(function(a){if("error"!=a.data.result){e.prompts=a.data.json;var r=JSON.parse(o.sessionStorage.prompts),n=e.prompts[e.prompts.length-1];if(n.active=!0,r.push(n),o.sessionStorage.prompts=JSON.stringify(r),t.voicemails=r,i.setPrompts(e.prompts),e.prompts)for(var s=0;s<e.prompts.length;s++)e.prompts[s].selectedprompt=!1}}),e.param=null,c.replaceWith(c=c.clone(!0))):e.error="Invalid email or password"})},e.removeotherchecks=function(t){for(var o=0;o<e.prompts.length;o++)o!==t&&(e.prompts[o].selectedprompt=!1);i.prompts=e.prompts},e.playvoiceaudio=function(t,o,a){var i;for(var r in void 0===e.audio&&(e.audio=[]),void 0===e.audio[t]&&(e.audio[t]=new Audio(o),e.audio[t].addEventListener("ended",function(){e.upload.showme[t]=!1})),e.audio)r!=t&&(e.audio[r].pause(),e.audio[r].currentTime&&(e.audio[r].currentTime=0),e.upload.showme[r]=!1);switch(a){case"play":e.audio[t].play();break;case"pause":e.audio[t].pause();break;case"rewind":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i-5,e.audio[t].play());break;case"forward":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i+5,e.audio[t].play())}},e.ok=function(){for(var t=!1,o=0;o<e.prompts.length;o++)e.prompts[o].selectedprompt&&(t=!0);if(t){if(e.audio)for(o=0;o<e.audio.length;o++)void 0!==e.audio[o]&&e.audio[o].pause();a.close()}else s.notify({title:"Voice Prompt Message",text:"Please select a Voice Prompt Message",type:"error"})},e.cancel=function(){if(e.audio)for(u=0;u<e.audio.length;u++)void 0!==e.audio[u]&&e.audio[u].pause();a.dismiss("cancel")}}]).controller("whisperModal",["$scope","$rootScope","$window","$uibModalInstance","WhisperMessageService","CampaignWebService","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){var l=$("#filecontrol");if(e.upload={},e.upload.showme=[],e.whispers=[],JSON.parse(o.sessionStorage.whispers).length>0)for(var c=JSON.parse(o.sessionStorage.whispers),d=0;d<c.length;d++)1==c[d].active&&(e.whispers.push(c[d]),t.whispers.push(c[d]));else t.whispers="";e.isFileSelected=function(){return!!e.upload.files},e.useSelectedWhisper=function(e){},e.saveWhisper=function(e,t){angular.extend(e,{id:t})},e.addWhisper=function(){e.inserted={id:e.whispers.length+1,name:"",status:null,group:null},e.whispers.push(e.inserted)},e.removeWhisper=function(a){var i={id:e.whispers[a].id};e.playvoiceaudio(a,e.whispers[a].url,"pause"),s.confirm("Are you sure you want to delete this Whisper Message?",function(s){s?r.deleteAudioFile(i).then(function(r){if($("body").addClass("modal-open"),"error"!=r.data.result){for(var s=JSON.parse(o.sessionStorage.whispers),l=0;l<s.length;l++)s[l].id==i.id&&(s[l].active=!1);o.sessionStorage.whispers=JSON.stringify(s),t.whispers=s,n.notify({title:"Whisper Message",text:"Whisper Message deleted successfully",type:"success"}),e.whispers.splice(a,1),e.upload.showme[a]=!1}else n.notify({title:"Whisper Message",text:"Error Deleting Whisper Message",type:"error"})}):setTimeout(function(){$("body").addClass("modal-open")},100)})},e.uploadFile=function(){var a=e.upload.files;if(e.fileIsUploading=!0,fileExtension=a[0].name.substr((Math.max(0,a[0].name.lastIndexOf("."))||1/0)+1),"mp3"!=fileExtension&&"wav"!=fileExtension&&"mp4"!=fileExtension)return e.fileIsUploading=!1,n.notify({title:"Voice Prompt Upload",text:"Invalid file type.",type:"error"}),!1;r.uploadAudio(a,"whisper").then(function(a){e.fileIsUploading=!1,"error"!=a.data.result?(e.inserted={id:e.whispers.length+1,name:a.data.json.call_flow_recording.url.filename,url:a.data.json.call_flow_recording.url.url,status:null,group:null},e.upload.files=null,r.getWhispers(t.currentOUId).then(function(a){if("error"!=a.data.result){e.whispers=a.data.json;var i=JSON.parse(o.sessionStorage.whispers),r=e.whispers[e.whispers.length-1];if(r.active=!0,i.push(r),o.sessionStorage.whispers=JSON.stringify(i),t.whispers=i,e.whispers)for(var n=0;n<e.whispers.length;n++)e.whispers[n].selectedwhisper=!1}}),e.param=null,l.replaceWith(l=l.clone(!0))):e.error="Invalid email or password"})},e.removeotherchecks=function(t){for(var o=0;o<e.whispers.length;o++)o!==t&&(e.whispers[o].selectedwhisper=!1);i.whispers=e.whispers},e.playvoiceaudio=function(t,o,a){var i;for(var r in void 0===e.audio&&(e.audio=[]),void 0===e.audio[t]&&(e.audio[t]=new Audio(o),e.audio[t].addEventListener("ended",function(){e.upload.showme[t]=!1})),e.audio)r!=t&&(e.audio[r].pause(),e.audio[r].currentTime&&(e.audio[r].currentTime=0),e.upload.showme[r]=!1);switch(a){case"play":e.audio[t].play();break;case"pause":e.audio[t].pause();break;case"rewind":e.audio[t].pause(),i=e.audio[t].currentTime,e.audio[r].currentTime&&(e.audio[t].currentTime=i-5,e.audio[t].play());break;case"forward":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i+5,e.audio[t].play())}},e.ok=function(){var t,o=!1;if(e.whispers)for(t=0;t<e.whispers.length;t++)e.whispers[t].selectedwhisper&&(o=!0);if(o){if(e.audio)for(t=0;t<e.audio.length;t++)void 0!==e.audio[t]&&e.audio[t].pause();a.close()}else n.notify({title:"Whisper Message",text:"Please select a Whisper Message",type:"error"})},e.cancel=function(){if(e.audio)for(d=0;d<e.audio.length;d++)void 0!==e.audio[d]&&e.audio[d].pause();a.dismiss("cancel")}}]).factory("SelectedCampaign",function(){"use strict";var e={Id:""};return{getId:function(){return e.Id},setId:function(t){e.Id=t}}}).factory("PhoneList",function(){"use strict";var e=[];return{addtoList:function(t){e.push(t)},getList:function(){return e},clearList:function(){e=[]}}}).controller("CampaignsTableController",["$scope","$rootScope","$filter","CampaignWebService","SelectedCampaign","$location","$window","$q","$bootbox","pinesNotifications","ApiParam",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";e.isLoadingApi=!0;e.campReportData,e.campaignIds=[],e.showCampaign=!1,e.showCampaignlist=!1,e.currentPage=1,e.pageSize=100,e.CurrentOUName=t.currentOUName,e.CurrentOUName.length>50?e.CurrentOUNameCSV=e.CurrentOUName.slice(0,50)+".csv":e.CurrentOUNameCSV=e.CurrentOUName+".csv",e.campaginCallFlowHeader=["Name","Campaign Start","Campaign End","Tracking Numbers","Status"],e.actionHeader=["Actions"],e.userId=parseInt(t.userId),t.isSafari=n.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.pageNumber=1;var u="bearer "+n.sessionStorage.token;e.collapse=!1,e.mainGridOptions={dataSource:{type:"json",transport:{read:{url:d.baseURL()+"/v1/campaign/ouid/"+t.currentOUId+"/userAccess/"+e.userAccess.campaign+"/"+encodeURIComponent(t.timezone),beforeSend:function(e){e.setRequestHeader("content-type","application/json"),e.setRequestHeader("Authorization",u)},complete:function(e){},dataType:"json"}},schema:{data:function(e){return e.json.campaigns},total:function(e){return e.json.total}},pageSize:30,serverPaging:!0,serverSorting:!0,serverFiltering:!0},pageable:!0,resizable:!0,columnMenu:!0,filterable:{extra:!1,operators:{string:{startswith:"Starts with",eq:"Is equal to",neq:"Is not equal to"}}},dataBound:function(e){this.expandRow(this.tbody.find("tr.k-master-row").first()),this.collapseRow(this.tbody.find("tr.k-master-row").first()),e.sender.items().each(function(){var t=$(this);0===e.sender.dataItem(t).quantity&&(t.find(".k-hierarchy-cell").html(),$(t).addClass("ready"),t.find(".k-hierarchy-cell").html(""))})},columns:[{field:"",headerTemplate:'<a class="k-icon k-i-expand" id="masterExpand" ng-click="masterexpand()"  aria-label="Expand" tabindex="-1"></a>',width:"50px"},{field:"organizational_unit_id",title:"OUID",filterable:!1,width:"120px"},{field:"organization_unit_name",title:"Group Name",filterable:!1,width:"120px"},{field:"name",title:"Campaign Name",width:"120px"},{field:"start_date",title:"Campaign Start",filterable:!1,width:"120px"},{field:"end_date",title:"Campaign End",filterable:!1,width:"120px"},{field:"quantity",title:"Tracking Number Quantity",filterable:!1,width:"120px"},{field:"status",title:"Campaign Status",filterable:!1,width:"120px",template:"<span class='status'>#= status#</span>"},{field:"campaign_id",title:"Actions",filterable:!1,sortable:!1,template:'<button class="btn btn-sm btn-primary" ng-click="editCampaign(dataItem)">Edit </button>&nbsp;<button class="btn btn-sm btn-danger" ng-click="archiveCampaign(dataItem)" >Archive</button>'}]},e.detailGridOptions=function(e){return{dataSource:{type:"json",transport:{read:{url:d.baseURL()+"/v1/campaignCallflow?campaign_id="+e.campaign_id,beforeSend:function(e){e.setRequestHeader("content-type","application/json"),e.setRequestHeader("Authorization",u)},complete:function(e){console.log(e.responseText)},dataType:"json"}},schema:{data:function(e){return e.json},total:function(e){return e.json.total}},pageSize:50,serverPaging:!0,serverSorting:!0,filter:{field:"campaign_id",operator:"eq",value:e.campaign_id}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"tracking_number",title:"Tracking Number"},{field:"callFlow_name",title:"Name"},{field:"ring_to_number",title:"RingToNumber"},{field:"spam_guard_status",title:"Spam Guard Protection",template:"# if(spam_guard_status) { #<img src='assets/img/spam.jpg' class='spam_gurad' alt='Spam'>#} #"},{field:"Ad_Source",title:"Ad Source"},{field:"status",title:"Status",template:"<span class='status'>#= status#</span>"},{field:"tracking_number",title:"Actions",template:'<button class="btn btn-sm btn-primary" ng-click="editCampaign(dataItem)">Edit </button>&nbsp;<button class="btn btn-sm btn-danger" ng-click="removeCallFlow(dataItem)" >Delete</button>'}]}},e.masterexpand=function(){var t=$("#grid").data("kendoGrid");0==e.collapse?($(".k-master-row").each(function(e){t.expandRow(this)}),$("#masterExpand").attr("class","k-icon k-i-collapse"),e.collapse=!0):($(".k-master-row").each(function(e){t.collapseRow(this)}),$("#masterExpand").attr("class","k-icon k-i-expand"),e.collapse=!1)},e.removeCallFlow=function(e){var t={provisioned_route:{ids:[e.call_flow_id]}};l.confirm("Are you sure you want to delete this Tracking Number?",function(e){e&&a.removeCallFlow(t).then(function(e){""===e.data.err?(c.notify({title:"Remove Tracking Number",text:"Tracking Number removed successfully.",type:"success"}),$route.reload()):c.notify({title:"Remove Tracking Number",text:e.data.err.data,type:"error"})})})},i.Id=null,e.editCampaign=function(e){r.path("/set-campaign-builder"),r.search("id",e.campaign_id)},e.archiveCampaign=function(o){console.log(r);var i=o.name,r=o.campaign_id,n={campaign:{id:r,status:"deleted",org_unit_id:t.currentOUId}},s="";s+="Are you sure you want to archive campaign - "+i+"?",l.confirm(s,function(t){t&&a.setCampaignStatus(n).then(function(t){if("success"===t.data.status){var o=_.findIndex(e.data.rows,function(e){return e[0]===index[0]});e.data.rows.splice(o,1),c.notify({title:"Campaign",text:i+" has been archived.",type:"success"})}else e.error=t})})},e.locate={locationheadings:["Id","Location","Address","City","State","Zip","Phone","Actions"],locations:[["1","LogMyCalls","1664 S. Dixie Dr.","Saint George","UT","84770","6809909123","Delete"],["2","Blue Moon Inn","25 Willow Ln.","Port Costa","CA","94569","9259465638","Delete"],["3","Walnut Creek branch","2705 Main St.","Walnut Creek","CA","94598","9255126685","Delete"],["4","Ocean Gate Shop","321 Mall Dr.","St. George","UT","84790","4356746700","Delete"],["5","South Kings branch","3110 S. Kings Hwy","Nob Hill","CA","94518","9255126225","Delete"]]},e.getHeader=function(){return["Account Name","Account ID","Group Name","Group ID","Group External ID","Group Status","Campaign Name","Campaign ID","Campaign External ID","Campaign Start","Campaign End","Campaign Status","Tracking Number Name","Tracking Number ID","Tracking Number","Ring-to Phone Number","DNI","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Spam Guard Status"]},e.getCSVData=function(o){var i={},r=s.defer();if(a.getCampaignsCallFlowReport(e.userAccess.campaign).then(function(a){if("error"!=a.data.json){i=a.data.json;for(var n=[],s=0;s<i.length;s++)n.push({a:i[s].account_name,b:i[s].account_id,c:i[s].group_name,d:i[s].group_id,e:i[s].group_external_id,f:i[s].group_status,g:i[s].campaign_name,h:i[s].campaign_id,i:i[s].campaign_external_id,j:i[s].start_date,k:i[s].end_date,l:i[s].campaign_status,m:i[s].tracking_name,n:i[s].tracking_id,o:i[s].tracking_number,p:i[s].ring_to_number,q:i[s].dni,r:i[s].ad_source,s:i[s].custom_source_name1,t:i[s].custom_source_name2,u:i[s].custom_source_name3,v:i[s].custom_source_name4,x:i[s].custom_source_name5,y:i[s].spam_guard});if(console.log(n),r.resolve(n),!t.isSafari)return r.promise;var l=e.CurrentOUName;r.resolve(JSONToCSVConvertor(n,l,!0,o))}}),!t.isSafari)return r.promise},e.exportPDF=function(){$(".buttons").hide();var t=new jsPDF("p","pt","a4");t.addHTML($("#campData"),function(){t.output("datauristring")}),setTimeout(function(){t.save(e.CurrentOUName+".pdf"),$(".buttons").show()},5e3)}}]).controller("CampaignFormController",["$scope","$timeout","$http","$uibModal","$location","CampaignWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route","DNIWebService","smDateTimePicker","$q","$bootbox",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f){"use strict";if(void 0===e.userAccess.voicemail||e.userAccess.voicemail<4?e.voicemailComponent=!1:e.voicemailComponent=!0,c.timezone){e.timezoneString=["AT","ET","CT","MT","MT","PT"][["America/Halifax","America/New_York","America/Chicago","America/Denver","America/Phoenix","America/Los_Angeles"].indexOf(c.timezone)],e.timezoneString||(c.timezone="America/New_York",e.timezoneString="ET")}else c.timezone="America/New_York",e.timezoneString="ET";if(0==c.is_migrated||"false"==c.is_migrated){var h=i.url().split("?");"/set-legacy-campaign-builder"==i.path()?location.href="#/set-campaign-builder?"+h[1]:(i.path("/set-legacy-campaign-builder"),void 0!=c.editClickId&&i.search("id",c.editClickId))}e.isCampaignDetailsOpen=!0,e.ownersPickList={},e.isTrackingNumbersOpen=!0,e.panelHeading=c.currentOUName,e.dateTime={},e.dateTime.startDate={},e.universalNow=moment.tz(c.timezone),e.dateTime.startDate.minDate=moment.tz(c.timezone),e.dateTime.startDate.opened=!1,e.dateTime.startDate.isMeridian=!0,e.startOnLoad=!0,e.dateTime.endDate={},e.dateTime.endDate.minDate=moment.tz(c.timezone),e.dateTime.endDate.date=void 0,e.dateTime.endDate.opened=!1,e.dateTime.endDate.isMeridian=!0,e.postCallIVR=!1,e.isLoadingApi=!0,e.userAccess.referral&&e.userAccess.referral>4?e.referralSubscription=!0:e.referralSubscription=!1,e.referralNumber=null,e.showReferral=!1,e.disableReferral=!1,e.savingCampaign=!1,e.initiatedAsReferral=!1,e.referralChecked=!1,e.toggleReferralCheckbox=function(){e.disableReferral||(e.referralChecked=!e.referralChecked,e.referralNumber=null)},e.referralClick=function(){e.referralNumber=null},e.toggleReferralContainer=function(t){if(e.showReferral){var o=document.getElementsByClassName("icheckbox_minimal-blue")[0];t?(document.getElementById("referral-container").style.opacity="1",o.style.cursor="pointer",e.disableReferral=!1):(document.getElementById("referral-container").style.opacity="0.5",o.style.cursor="not-allowed",e.disableReferral=!0)}},e.updateCallFlows=function(){r.getCampaign(e.Id,e.currentPage).then(function(t){var o=t.data.json.campaigns[0];console.log("INSIDE updateCallFlows IN campaign.js: Updating $scope.phoneNumbers with:",o),e.phoneNumbers=[];var a=[];"inactive"===o.status?e.campActive=!1:e.campActive=!0,o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var o="",i="",r="",n=!1,s=t.status.charAt(0).toUpperCase();t.status=s+t.status.substr(1),0===a.length?(a.push(t.id),n=!0):-1===a.indexOf(t.id)&&(n=!0,a.push(t.id)),t.channels[0]&&(o=t.channels[0].category,i=t.channels[0].sub_category,r=t.channels[0].id),t.phone_numbers[0].number,angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:o+":"+i,channelId:r,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:n}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:o+":"+i,channelId:r,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:n})}})})},e.getGroupsHeader=function(){return["Account","Account OUID","Account External ID","Parent Group","Parent Group OUID","Parent Group External ID","Group","Group OUID","Group External ID","Campaign ","Campaign External ID","Tracking Number","Tracking Number Name","Ring-to Phone Number","Tracking Number Type","Tracking Number Status","Call Value","Ad Source","Repeat Interval (in Hours)","Spam Guard","SMS","Play Disclaimer","Pre-call Webhook","Instant Insights","Instant Insights Configuration","Record Call","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","DNI","Host Domain","Referring Website","HTML Class","DNI Type","Custom Parameters","Voicemail","Voice Prompt","Whisper Message","Hunt Type"]},e.getCSVGroupData=function(){e.groupsReportFileName=e.name+"_Tracking Number Details_"+moment().format("YYYY-MM-DD")+".csv";var t={},o=g.defer();if(r.getCampaignsCallFlowReport(e.userAccess.campaign,e.campId).then(function(a){if("error"!=a.data.json){t=a.data.json;for(var i=[],r=0;r<t.length;r++){var n=t[r].tracking_number_type;i.push({a:t[r].account_name,b:t[r].account_id,c:t[r].account_exid,d:t[r].parent_group_name,e:t[r].parent_group_id,f:t[r].parent_group_external_id,g:t[r].group_name,h:t[r].group_id,i:t[r].group_external_id,j:t[r].campaign_name,k:t[r].campaign_external_id,l:t[r].tracking_number,m:t[r].tracking_name,t5:"Outbound"==n||"Voicemail"==n?" ":t[r].ring_to_number,n:t[r].tracking_number_type,o:t[r].tracking_number_status,p:"Outbound"==n||"Voicemail"==n?" ":t[r].call_value,q:t[r].ad_source,r:"Outbound"==n?" ":t[r].repeat_interval,s:t[r].spam_guard,s1:t[r].sms_enabled,t:"Voicemail"==n?" ":t[r].play_disclaimer,u:"Voicemail"==n?" ":t[r].pre_call_webhook,y16:"Voicemail"==n?" ":t[r].post_call_ivr_status,zq:"Voicemail"==n?" ":t[r].post_call_ivr,v:"Voicemail"==n?" ":t[r].record_call,w:t[r].custom_source_name1,x:t[r].custom_source_name2,y:t[r].custom_source_name3,z:t[r].custom_source_name4,x1:t[r].custom_source_name5,q2:"Outbound"==n||"Voicemail"==n?" ":t[r].dni,y3:"Outbound"==n||"Voicemail"==n?" ":t[r].host_domain,y4:"Outbound"==n||"Voicemail"==n?" ":t[r].referring_website,y5:"Outbound"==n||"Voicemail"==n?" ":t[r].html_class,y6d:"Outbound"==n||"Voicemail"==n?" ":t[r].dni_type,y7r:"Outbound"==n||"Voicemail"==n?" ":t[r].custom_parameters,g5:"Voicemail"==n?" ":1==e.voicemailComponent?t[r].voicemail:" ",y8:t[r].voice_prompt,y9:t[r].whisper_message,yu4:"Outbound"==n||"Voicemail"==n?" ":t[r].hunt_type})}if(console.log(i),o.resolve(i),!c.isSafari)return o.promise;o.resolve(JSONToCSVConvertor(i,reportName,!0,formate))}}),!c.isSafari)return o.promise},e.dniParams=function(t){a.open({templateUrl:"assets/partials/dniParams.html",controller:"DNIModelController",size:t,resolve:{canModify:function(){return 1==e.canModify},callingController:function(){return"campaign"}}})},e.editBlacklist=function(e){a.open({templateUrl:"assets/partials/editBlacklist.html",controller:"BlacklistModalController",size:e})};e.timeManual=!1,e.dateIsNotEditable=!1,e.endDateIsNotEditable=!1,e.endDateIsNotEditable2=!0,e.switchStatus=1,e.switchStatus2=1,e.switchStatus3=1,e.switchStatus4=1,e.switchStatus5=1,e.switchStatus6=1,e.currentPage=1,e.phoneNumbers=[],e.Id=i.search().id;var v,b=i.search().ou_id,w=i.search().level,y=i.search().billing_id,S=i.search().parent_id;void 0===b||angular.isNumber(b)||(c.currentOUId=b,c.$emit("current-ou-updated",{id:parseInt(b),level:parseInt(w),billing_id:parseInt(y),parent_id:parseInt(S)})),e.status=!1,e.selectedChannels=[],e.iStatus=!0,s.clearList(),e.campId="",e.selUsers=[],e.assSalesRep=[],e.Id?e.isNewCamp=!1:(e.isNewCamp=!0,e.dateTime.startDate.date=moment.tz(c.timezone)),e.pageChanged=function(t){e.currentPage=t},e.checkCallFlowIdUrl=function(e){c.$emit("loadCallFlowReceiver",e)},r.getCampOwners(c.currentOUId,e.Id).then(function(t){if("error"!=t.data.result){var o,a,i,r={};t.data.json.forEach(function(e){o=e.org_unit_name,a=e.username,i=e.ct_user_id,void 0===r[o]?r[o]={ouName:o,userList:[{id:i,name:a}]}:r[o].userList.push({id:i,name:a})}),e.ownersPickList=r}}),r.getCompUsers(c.currentOUId).then(function(o){if("error"!=o.data.result){var a,i,n,s={},d=[];if(o.data.json.all_users.forEach(function(e){a=e.org_unit_name,i=e.username,n=e.ct_user_id,void 0===s[a]?s[a]={ouName:a,userList:[{id:n,name:i}]}:s[a].userList.push({id:n,name:i})}),e.Id||null===o.data.json.added_users[0].users_list||(d=o.data.json.added_users[0].users_list.split(",")),e.assUserPickList=s,e.Id)return r.getCampaign(e.Id,e.currentPage);e.campActive=!0,e.isLoadingApi=!1,e.iStatus=!0,l.sessionStorage&&"4"!==l.sessionStorage.roleId&&!c.partnerConvirzaAdmin&&(e.assSalesRep=l.sessionStorage.userId),e.canModify=!0,t(function(){e.selUsers=d},100)}}).then(function(t){if(t){if(e.isLoadingApi=!1,"error"===t.data.result)return d.notify({title:"Campaign",text:t.data.err,type:"error"}),!1;if("error"!==t.data.result){console.log("Loading in Campaign",t.data.json);var o=t.data.json.campaigns[0],a=[],r=[];e.name=o.name,e.campId=o.campaign_id,e.campExtId=o.campaign_ext_id,v=o.status,e.totalDataRows=o.totalRows,null===v||"inactive"===v||"referral"===v?(e.campActive=!1,e.origCampStatus=!1,e.iStatus=!1,e.endDateIsNotEditable=!0):(e.campActive=!0,e.origCampStatus=!0,e.iStatus=!0),o.referral_number&&(e.showReferral=!0,e.loadingInCampaign=!0,e.referralNumber=o.referral_number,e.referralChecked=!0),e.dateTime.startDate.date=moment(o.start_date),e.dateTime.startDate.minDate=moment(o.start_date),null==o.end_date?(e.dateTime.endDate.date=void 0,e.endDateIsNotEditable2=!0):(e.dateTime.endDate.date=moment(o.end_date),e.dateTime.endDate.minDate=moment.tz(c.timezone)),e.campEnd=o.end_date,e.editOnLoad=!0,e.dateTime.startDate.date.isBefore(moment.tz(c.timezone))&&(e.dateIsNotEditable=!0),o.users.forEach(function(t){e.selUsers.push(t.id)});var n="";_.each(e.ownersPickList,function(e){0===n.length&&(n=_.where(e.userList,{id:o.owner_user_id}))}),n.length>0&&(e.assSalesRep=o.owner_user_id),(o.owner_user_id==l.sessionStorage.userId||e.userAccess.campaign>6)&&(e.canModify=!0);var s=0;if(o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var i="",n="",l="",d=!1;if(t.status){var p=t.status.charAt(0).toUpperCase();t.status=p+t.status.substr(1)}t.channels[0]&&(i=t.channels[0].category,n=t.channels[0].sub_category,l=t.channels[0].id),0===a.length?(a.push(t.id),d=!0):-1===a.indexOf(t.id)&&(d=!0,a.push(t.id)),t.phone_numbers[0].number?angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:i+":"+n,channelId:l,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id,route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:d}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:i+":"+n,channelId:l,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id,route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:d}):"Schedule"==t.route_type||"Percentage"==t.route_type?void 0!==t.pool&&t.pool.length>0&&-1===r.indexOf(t.pool[0].pool_id)?(r.push(t.pool[0].pool_id),e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:i+":"+n,channelId:l,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id,route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:d})):e.phoneNumbers.push({id:t.id,phonep:t.name,name:t.name,channels:i+":"+n,channelId:l,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id,route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:d}):void 0!==t.pool&&t.pool.length>0&&(r.push(t.pool[0].pool_id),e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:i+":"+n,channelId:l,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id,route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:d}))}if(++s==o.provisioned_routes.length&&u.current.params.prov_id){var m=parseInt(u.current.params.prov_id),g=_.find(e.phoneNumbers,function(e){return m===e.id});c.$emit("loadCallFlowReceiver",g),setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},150)}}),e.loadingInCampaign=!1,e.cfid=i.search().cfid,e.cfid){var p=_.findLastIndex(e.phoneNumbers,{id:parseInt(e.cfid)});p>-1&&e.checkCallFlowIdUrl(e.phoneNumbers[p])}}else"error"===t.data.result&&console.log("ERROR getCampaign CWS")}}),e.saveCampaign=function(){if(e.savingCampaign=!0,!e.name)return d.notify({title:"Campaign Details",text:"Campaign name should not be empty.",type:"error"}),void(e.savingCampaign=!1);if(!e.assSalesRep||!e.assSalesRep.toString().length)return d.notify({title:"Campaign Details",text:"Campaign owner should not be empty.",type:"error"}),void(e.savingCampaign=!1);if(e.dateTime.endDate.date&&moment(e.dateTime.startDate.date).isAfter(e.dateTime.endDate.date))return d.notify({title:"Campaign Details",text:"Campaign end date should not be before campaign start date.",type:"error"}),void(e.savingCampaign=!1);if(moment(e.dateTime.startDate.date).isBefore(e.universalNow.format("DD-MMMM-YYYY hh:mm A"))&&!e.dateIsNotEditable)return d.notify({title:"Campaign Details",text:"Campaign start date should not be before current time: "+e.universalNow.format("DD-MMMM-YYYY hh:mm A")+" ("+e.timezoneString+" )",type:"error"}),void(e.savingCampaign=!1);if(e.dateTime.endDate.date&&moment(e.dateTime.endDate.date).isBefore(e.universalNow.format("DD-MMMM-YYYY hh:mm A"))&&!e.endDateIsNotEditable&&(e.dateTime.endDate.date=e.universalNow),e.showReferral&&e.referralChecked){if(!e.referralNumber)return angular.element("#referralNumber").addClass("ng-invalid ng-dirty"),angular.element("#referralNumber").removeClass("ng-valid"),d.notify({title:"Referral Phone Number",text:"Referral phone number is not a valid phone number.",type:"error"}),void(e.savingCampaign=!1);var t=e.referralNumber.replace(/\D/g,"");if(10!==t.length)return angular.element("#referralNumber").addClass("ng-invalid ng-dirty"),angular.element("#referralNumber").removeClass("ng-valid"),d.notify({title:"Referral Phone Number",text:"The referral phone number specified is not a valid phone number. Please try again.",type:"error"}),void(e.savingCampaign=!1)}var o;o=e.campActive?"active":"inactive";var a={campaign:{name:e.name,org_unit_id:parseInt(c.currentOUId),external_id:e.campExtId?e.campExtId:"",status:o,start_date:e.dateTime.startDate.date?moment(e.dateTime.startDate.date).format("YYYY-MM-DD HH:mm"):null,end_date:e.dateTime.endDate.date?moment(e.dateTime.endDate.date).format("YYYY-MM-DD HH:mm"):null,timezone:c.timezone,owner_user_id:e.assSalesRep},referral:{pnumber:null}};e.showReferral&&e.referralChecked&&e.referralSubscription&&(a.referral.pnumber=t),e.Id?(a.campaign.id=parseInt(e.Id),e.campActive?r.updateCampaign(a).then(function(t){if(console.log("updateCampaign .result= ",t),e.formSubmit=!1,console.log("INSIDE saveCampaign IN campaign.js: Result of update:",t),""===t.data.err){e.Id=t.data.json.campaign.id,d.notify({title:"Update Campaign",text:"Campaign updated successfully.",type:"success"}),console.log("CALLING UPDATE Tracking Numbers"),e.updateCallFlows();var o={campaign_id:a.campaign.id,campaign_name:a.campaign.name,type:"campaign"};e.$emit("campaignOrGroupUpdateSms",{campaignOrGroupObject:o})}else d.notify({title:"Update Campaign",text:t.data.err,type:"error"});e.savingCampaign=!1}):r.checkOutboundCallerIdByCampaignID(e.Id).then(function(t){if(1==e.origCampStatus){if(parseInt(t.data.json[0].count)>0)var o="Are you sure you want to deactivate this Campaign as its tracking number/s are selected as a Caller ID in outbound route?";else o="Are you sure you want to deactivate this Campaign ?";f.confirm(o,function(t){t?(e.origCampStatus=!1,r.updateCampaign(a).then(function(t){if(console.log("updateCampaign .result= ",t),e.formSubmit=!1,console.log("INSIDE saveCampaign IN campaign.js: Result of update:",t),""===t.data.err){e.Id=t.data.json.campaign.id,d.notify({title:"Update Campaign",text:"Campaign updated successfully.",type:"success"}),console.log("CALLING UPDATE Tracking Numbers"),e.updateCallFlows();var o={campaign_id:a.campaign.id,campaign_name:a.campaign.name,type:"campaign"};e.$emit("campaignOrGroupUpdateSms",{campaignOrGroupObject:o})}else d.notify({title:"Update Campaign",text:t.data.err,type:"error"});e.savingCampaign=!1})):e.savingCampaign=!1})}else r.updateCampaign(a).then(function(t){if(console.log("updateCampaign .result= ",t),e.formSubmit=!1,console.log("INSIDE saveCampaign IN campaign.js: Result of update:",t),""===t.data.err){e.Id=t.data.json.campaign.id,d.notify({title:"Update Campaign",text:"Campaign updated successfully.",type:"success"}),console.log("CALLING UPDATE Tracking Numbers"),e.updateCallFlows();var o={campaign_id:a.campaign.id,campaign_name:a.campaign.name,type:"campaign"};e.$emit("campaignOrGroupUpdateSms",{campaignOrGroupObject:o})}else d.notify({title:"Update Campaign",text:t.data.err,type:"error"});e.savingCampaign=!1})})):(console.log("INSIDE saveCampaign IN campaign.js: Creating campaign with:",a),r.createCampaign(a).then(function(t){console.log("INSIDE saveCampaign IN campaign.js: Result of creation:",t),""===t.data.err?(n.Id=t.data.json.campaign.campaign_id,i.search("id",n.Id),e.Id=n.Id,d.notify({title:"Create Campaign",text:"Campaign created successfully.",type:"success"})):d.notify({title:"Create Campaign",text:t.data.err,type:"error"}),e.savingCampaign=!1}))},e.colorPicked="#fa4d4d",e.select2RemoteOptions={placeholder:"Search for a movie",minimumInputLength:3,width:"resolve",ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t,apikey:"8vzys3eka2s9hpvkh7wwzp7e"}},results:function(e,t){var o=10*t<e.total;return{results:e.movies,more:o}}},formatResult:function(e){var t="<table class='movie-result'><tr>";return void 0!==e.posters&&void 0!==e.posters.thumbnail&&(t+="<td class='movie-image'><img src='"+e.posters.thumbnail+"'/></td>"),t+="<td class='movie-info'><div class='movie-title'>"+e.title+"</div>",void 0!==e.critics_consensus?t+="<div class='movie-synopsis'>"+e.critics_consensus+"</div>":void 0!==e.synopsis&&(t+="<div class='movie-synopsis'>"+e.synopsis+"</div>"),t+="</td></tr></table>"},formatSelection:function(e){return e.title},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}},e.select2={multiple:!0,allowClear:!0},e.multiSelect1=[],e.multiSelect2=[],e.toggleCallFlow=function(){e.cfactive?e.originalcfactive=!1:e.originalcfactive=!0},e.activeToggle=function(){e.campActive?(e.dateTime.startDate.minDate=moment.tz(c.timezone),e.dateTime.startDate.date=moment.tz(c.timezone),e.dateIsNotEditable=!1,e.endDateIsNotEditable=!1,e.dateTime.endDate.minDate=moment.tz(c.timezone),e.dateTime.endDate.date=null,angular.element("#end-date-picker md-input-container").removeClass("md-input-has-value"),e.referralChecked=!1,e.referralNumber=null,e.origCampStatus=!1):(e.ignoreEndDateWatch=!0,e.dateTime.endDate.minDate=moment.tz(c.timezone),console.log("ACTIVE TOGGLE END DATE"),e.dateTime.endDate.date=moment.tz(c.timezone),e.endDateIsNotEditable=!0,e.dateIsNotEditable=!0,e.referralChecked=!1,e.referralNumber=null,e.origCampStatus=!0)},e.$watch("dateTime.startDate.date",function(t,o){e.formSubmit=!1,e.submitted=!1}),e.$watch("dateTime.endDate.date",function(t,o){e.dateTime.endDate.date&&angular.element("#end-date-picker md-input-container").addClass("md-input-has-value"),e.loadingInCampaign||(e.dateTime.endDate.date&&e.referralSubscription?(e.showReferral=!0,moment(e.dateTime.endDate.date).isBefore(moment.tz(c.timezone).format("DD-MMMM-YYYY hh:mm A"))&&!e.ignoreEndDateWatch?e.campActive&&e.toggleReferralContainer():e.toggleReferralContainer(!0)):!e.dateTime.endDate.date&&e.referralSubscription&&(e.showReferral=!1)),e.ignoreEndDateWatch&&(e.ignoreEndDateWatch=!1),e.formSubmit=!1,e.submitted=!1,e.dateTime.endDate.date?e.endDateIsNotEditable2=!1:e.endDateIsNotEditable2=!0}),e.dateTime.dateOptions={formatYear:"yy",startingDay:1},e.dateTime.format="dd-MMMM-yyyy",e.dateTime.timeStepH=1,e.dateTime.timeStepM=30,e.dateTime.timeOptions={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.dateTime.today=function(e){new Date},e.dateTime.clear=function(e){null},e.dateTime.toggleMinDate=function(e){e=e?null:new Date},e.dateTime.toggleMeridian=function(e){e=!e},e.dateTime.open=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0}}]).controller("DNIModelController",["$scope","$http","$uibModalInstance","$location","CampaignWebService","OrgUnitWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route","DNIWebService","canModify","callingController",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g){"use strict";e.dni={},e.canModify=m,e.callingController=g,"campaign"===g?p.getDniCustomParameters(c.currentOUId).then(function(t){if(e.dni.dni_org_unit_id=null,t.data.json[0].custom_params)e.dni.custom_params=t.data.json[0].custom_params,e.dni.dniOuId=t.data.json[0].dni_org_unit[0].org_unit_id,e.dni.dni_org_unit_id=t.data.json[0].dni_org_unit[0].dni_org_unit_id;else{var o={dniOrgUnit:{org_unit_id:c.currentOUId}};p.createDniOUData(o).then(function(t){e.dni.dni_org_unit_id=t.data.json.insertId})}}):r.getDefaultCustomParams(c.currentOUId).then(function(t){t.data.json[0].custom_params&&(e.dni.custom_params=t.data.json[0].custom_params)}),e.cancel=function(){o.dismiss("cancel")},e.saveParams=function(){var t=e.dni.custom_params,a={dniOrgUnit:{custom_params:t=void 0==t?"":(t=(t=(t=t.replace(/\s/g,"")).split(",")).filter(function(e){return""!==e})).join(","),org_unit_id:c.currentOUId}};"campaign"===g?p.updateDniOUData(a).then(function(o){e.dni.custom_params=t,d.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"})}):r.createDefaultCustomParams(a).then(function(o){e.dni.custom_params=t,d.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"})}),o.close()}}]).controller("BlacklistModalController",["$scope","$http","$uibModalInstance","$location","CampaignWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";i.getBlackList(l.currentOUId).then(function(t){console.log(t),"error"!=t.data.result&&(e.search={number:t.data.json})}),e.option={words:["1234567890"],color:"yellow"},e.highlightString=function(){$("#txtNumber").highlightTextarea("destroy");var t=[e.search.text];$("#txtNumber").highlightTextarea({words:t})},e.cancel=function(){o.dismiss("cancel")},e.validateModalBlaclistNumbers=function(){var t,o=e.search.number;""!==o&&void 0!==o&&(t=o.split(","));var a=!1,i=[];if(angular.isArray(t)&&(t.forEach(function(e){(e.length<10||isNaN(e)||e.length>10)&&i.push(e)}),i.length)){a=!0;var r="is invalid Phone Number.";i.length>1&&(r="are invalid Phone Number."),c.notify({title:"Blacklist Phone Number",text:"'"+i.join(", ")+"' "+r,type:"error"})}return a},e.saveBlacklist=function(){var t=e.search.number,a={blacklist:{org_unit_id:l.currentOUId,numbers:t}};e.validateModalBlaclistNumbers()||i.saveBlackList(a).then(function(e){console.log(e),"error"!=e.data.result&&(c.notify({title:"Blacklist Phone Number",text:"Successfully Saved BlackList",type:"success"}),o.close())})}}]).controller("PhoneNumbersEditableController",["$scope","UserWebService","TagWebService","$filter","$http","PhoneList","CampaignWebService","WebhookService","$location","$route","SelectedCampaign","$rootScope","pinesNotifications","locationWebService","$window","voicemailPromptService","VoicePromptService","WhisperMessageService","$uibModal","$timeout","DNIWebService","$compile","$bootbox","DateTimeTimeZoned","$q","OrgUnitWebService",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b,w,y,S,C,A,T,D){"use strict";$("body").addClass("showScroll"),e.showSpamButton=!1,e.disableSaveForSchedule={levelOne:!1,levelTwo:!1,levelThird:!1},e.overflowValidationHeader="Tracking Number Details",e.userAccess&&e.userAccess.spamguard&&(e.showSpambutton=!0),u.userAccess.sms&&7===parseInt(u.userAccess.sms)&&(e.showSMSbutton=!0),void 0===e.userAccess.voicemail||e.userAccess.voicemail<4?e.voicemailComponent=!1:e.voicemailComponent=!0,void 0===e.userAccess.dni||e.userAccess.dni<4?e.dniComponent=!1:e.dniComponent=!0;var I="";e.disablePlayBtn=function(e){var t=$(".playpadding"),o=angular.element(document.querySelector("#voicemail")),a=e.currentTarget,i=a.children[0];i.classList.add("fa-pause");var r=setInterval(function(){i.classList.contains("fa-pause")?(t.each(function(e,t){0==t.disabled&&t.classList.add("customDisabled")}),a.classList.remove("customDisabled"),o.removeClass("customDisabled")):(t.removeClass("customDisabled"),o.removeClass("customDisabled"),clearInterval(r))},100)},e.pauseCurrentPlayingAudio=function(){u.$emit("stopIvrAudios",{})},u.$on("stopIvrAudios",function(){e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio1&&e.ivrAudio1.pause(),e.whisperAudio&&e.whisperAudio.pause()}),e.shownotification=!1,e.invalidSchedules=0,e.$watch("shownotification",function(){e.shownotification&&(e.shownotification=!1,p.notify({title:"Overflow Number Message",text:"Overflow Number  Deleted Successfully",type:"success"}))}),e.isAdvancedTrackingNumbersOpen=!0,e.isAddTrackingNumbersOpen=!0,e.isCallActionsOpen=!0,e.days=[],e.scheduleInfo=[],e.scheduleEvents={onItemCustomSelect:function(t){e.checkCurrentSchedule(t)}},e.schedule=[],e.overflow="3",e.showAddSchedule=!0,e.showAddOverflow=function(o){void 0!==t.unMaskData(e.scheduleInfo[o].ringTo)&&10==t.unMaskData(e.scheduleInfo[o].ringTo).length?(e.scheduleInfo[o].isAddOverflow=!1,e.checkCurrentSchedule(o)):(e.scheduleInfo[o].isAddOverflow=!0,e.showAddSchedule=!0)},e.checkCurrentSchedule=function(o){if(_.each(e.scheduleInfo,function(o){0!==o.days.length&&""!==o.fromTime&&""!==o.toTime&&void 0!==t.unMaskData(o.ringTo)?e.showAddSchedule=!1:e.showAddSchedule=!0}),N(o)){e.showAddSchedule=!0,e.submitted1=!0,e.formSubmit1=!0,e.invalidSchedules++;var a=e.duplicateSchelduleID+1;1==a?a+="st":2==a?a+="nd":3==a?a+="rd":a>=4&&(a+="th"),p.notify({title:"Following a schedule",text:"Check for Overlaping Schedule For "+a+" Schedule",type:"error"})}else e.submitted1=!1,e.formSubmit1=!1};var N=function(t){e.duplicateScheldule=!1,e.duplicateSchelduleID=-1,e.scheduleTimeSlots.push("End of Day");var o="",a="";if(e.scheduleInfo[0].schedule<1)return!1;if(9999==t?(o=e.scheduleInfo[e.scheduleInfo.length-1],a=e.scheduleInfo.length-1):(o=e.scheduleInfo[t],a=t),!(e.scheduleInfo.length>1))return e.scheduleTimeSlots.splice(-1,1),!1;for(var i=0;i<e.scheduleInfo.length;i++)if(e.scheduleInfo[i].days&&e.scheduleInfo[i].days.length>0)for(var r=0;r<e.scheduleInfo[i].days.length;r++)for(var n=0;n<o.days.length;n++){if(e.extendScheduleDays[e.scheduleInfo[i].days[r].id].indexOf(o.days[n].id)>-1){var s=e.scheduleTimeSlots.indexOf(e.scheduleInfo[i].fromTime),l=e.scheduleTimeSlots.indexOf(e.scheduleInfo[i].toTime),c=e.scheduleTimeSlots.indexOf(o.fromTime),d=e.scheduleTimeSlots.indexOf(o.toTime);i!==a&&(c<l&&d>s||c<l&&c>=s||d<=l&&d>s)&&(e.duplicateScheldule=!0,e.duplicateSchelduleID=i)}if(e.extendScheduleDays[o.days[n].id].indexOf(e.scheduleInfo[i].days[r].id)>-1){s=e.scheduleTimeSlots.indexOf(e.scheduleInfo[i].fromTime),l=e.scheduleTimeSlots.indexOf(e.scheduleInfo[i].toTime),c=e.scheduleTimeSlots.indexOf(o.fromTime),d=e.scheduleTimeSlots.indexOf(o.toTime);i!==a&&(c<l&&d>s||c<l&&c>=s||d<=l&&d>s)&&(e.duplicateScheldule=!0,e.duplicateSchelduleID=i)}}return e.scheduleTimeSlots.splice(-1,1),e.duplicateScheldule?e.scheduleInfo[a].invalid=!0:void 0!==a&&(e.scheduleInfo[a].invalid=!1),e.duplicateScheldule};e.checkCurrentIVRSchedule=function(o,a,i){if(_.each(a,function(o){0!==o.days.length&&""!==o.fromTime&&""!==o.toTime&&void 0!==t.unMaskData(o.ringTo)?e.showAddSchedule=!1:e.showAddSchedule=!0}),k(o,a,i)){e.showAddSchedule=!0,e.submitted1=!0,e.formSubmit1=!0,e.invalidSchedules++;var r=e.duplicateSchelduleID+1;i+=1==i?"st":2==i?"nd":"rd",1==r?r+="st":2==r?r+="nd":3==r?r+="rd":r>=4&&(r+="th"),p.notify({title:i+" level IVR Form",text:"Check for Overlaping Schedule For "+r+" Schedule",type:"error"}),"1st"===i?e.isOverlappingSchedules.levelOne=!0:"2nd"===i?e.isOverlappingSchedules.levelTwo=!0:e.isOverlappingSchedules.levelThird=!0}else"1st"===i?e.isOverlappingSchedules.levelOne=!1:"2nd"===i?e.isOverlappingSchedules.levelTwo=!1:e.isOverlappingSchedules.levelThird=!1};var k=function(t,o,a){e.duplicateScheldule=!1,e.duplicateSchelduleID=-1,e.scheduleTimeSlots.push("End of Day");var i="",r="";if(o.length<1)return!1;if(9999==t?(i=o[o.length-1],r=o.length-1):(i=o[t],r=t),!(o.length>1))return e.scheduleTimeSlots.splice(-1,1),!1;for(var n=0;n<o.length;n++)if(o[n].days&&o[n].days.length>0)for(var s=0;s<o[n].days.length;s++)for(var l=0;l<i.days.length;l++){if(e.extendScheduleDays[o[n].days[s].id].indexOf(i.days[l].id)>-1){var c=e.scheduleTimeSlots.indexOf(o[n].fromTime),d=e.scheduleTimeSlots.indexOf(o[n].toTime),u=e.scheduleTimeSlots.indexOf(i.fromTime),p=e.scheduleTimeSlots.indexOf(i.toTime);n!==r&&(u<d&&p>c||u<d&&u>=c||p<=d&&p>c)&&(e.duplicateScheldule=!0,e.duplicateSchelduleID=n)}if(e.extendScheduleDays[i.days[l].id].indexOf(o[n].days[s].id)>-1){c=e.scheduleTimeSlots.indexOf(o[n].fromTime),d=e.scheduleTimeSlots.indexOf(o[n].toTime),u=e.scheduleTimeSlots.indexOf(i.fromTime),p=e.scheduleTimeSlots.indexOf(i.toTime);n!==r&&(u<d&&p>c||u<d&&u>=c||p<=d&&p>c)&&(e.duplicateScheldule=!0,e.duplicateSchelduleID=n)}}return e.scheduleTimeSlots.splice(-1,1),e.duplicateScheldule?o[r].invalid=!0:void 0!==r&&(o[r].invalid=!1),e.duplicateScheldule};e.checkForValidSchedules=function(){for(var t=0,o=e.scheduleInfo.length-1;o>=0;o--)N(o);return _.each(e.scheduleInfo,function(o){(o.invalid||0===o.days.length)&&e.scheduleInfo.length>1&&t++}),t},e.addSchedule=function(){e.showAddSchedule=!0;var o=!1;(_.each(e.scheduleInfo,function(e){o=0===e.days.length||""===e.fromTime||""===e.toTime||void 0===t.unMaskData(e.ringTo)}),o)?0!==e.checkForValidSchedules()&&p.notify({title:"Following a schedule",text:"Please check for invalid schedule",type:"error"}):e.scheduleInfo.push({id:void 0,scheduleId:e.scheduleInfo.length,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!0,overflowNumbers:[{overflowNumber:"",rings:e.defaultsRings,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1})},e.formationscheduleTimeSlots=function(t){e.scheduleInfo[t].scheduleEndTimeSlots=e.scheduleTimeSlots.slice(e.scheduleTimeSlots.indexOf(e.scheduleInfo[t].fromTime)+1,e.scheduleTimeSlots.length),e.scheduleInfo[t].scheduleEndTimeSlots.push("End of Day")},e.checkRingToNumberSchedule=function(e){return!e||("0"==t.unMaskData(e).charAt(0)||10!=t.unMaskData(e).length)},e.removeSchedule=function(t){C.confirm("Are you sure you want to delete this Schedule?",function(o){N(t)&&e.invalidSchedules--,o&&(e.scheduleInfo.splice(t,1),angular.forEach(e.scheduleInfo,function(t){e.disableRC=!1,1==t.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),1==e.selectedCallFlow.activateVoicemail&&(e.disableRC=!0)})),0===e.checkForValidSchedules()?(e.showAddSchedule=!1,e.submitted1=!1,e.formSubmit1=!1):(p.notify({title:"Following a schedule",text:"Please check for invalid schedule",type:"error"}),e.showAddSchedule=!0,e.submitted1=!0,e.formSubmit1=!0)})},e.settings={enableSearch:!1,scrollable:!0,scrollableHeight:200,smartButtonMaxItems:5,showCheckAll:!1,showUncheckAll:!1},e.scheduleInfo=[{scheduleId:0,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!1,overflowNumbers:[{overflowNumber:"",rings:e.defaultsRings,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1}],e.percentInfo=[{percentage:"",ringToNum:"",overflowNumbers:[{overflowNumber:"",rings:e.overflow,overflow_order:1}],simultaneousRings:!1,route_order:1,activateVoicemail:!1}],e.showCallFlow=!1,e.showCallActions=!1,e.showMultiPass=!1,e.selectedCallFlow={},e.postCallIVR=!1,e.postIVRTypes=[{name:"Call Outcome (Conversion type)",value:"conversion"},{name:"Agent ID",value:"agentID"},{name:"Call Outcome and Agent ID",value:"conversionAgentID"}],e.postIVRType=e.postIVRTypes[0].value,e.selectedCallFlow.showDNI=!0,e.browserAgentName="",e.addCallAction={},e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.remainingText={},e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.voicemail="1",e.overflow="3",e.customsourcesArray={CS1:[],CS2:[],CS3:[],CS4:[],CS5:[]},e.selectedCallFlow.spamActive=!1,e.selectedCallFlow.smsActive=!1,e.selectedCallFlow.smsFeature=!1,e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.multlevelivr={ivr:{}},e.TTSvoicemailGreetingsSelected=!0,e.TTSoutComePromtSelected=!0,e.TTSsalesAmountVoiceSelected=!0,e.TTSAgentIDVoicePromptSelected=!0,e.TTSIVRSelected=!0,e.voicetextIVRChanged=!1,e.hasValidTTSVoiceURL=!1,e.hasValidVoiceURL=!1,e.hadValidWhisperURL=!1,e.hasValidvoicemailGreetingsURL=!1,e.hasValidoutComePromtURL=!1,e.hasValidsalesAmountVoiceURL=!1,e.hasValidAgentIDVoicePromptURL=!1,e.TTGeoloLocationPromptSelected=!0,e.hasValidGeoloLocationPromptURL=!1,e.qCallFlow="",e.multiSelectedChannels=[],e.formSubmit=!1,e.formSubmit1=!1,e.selectedCallFlow={rinterval:72},e.callActionWebhookOptions=[],e.callActionTaggingOptions=[],e.locations=m.getLocations(),e.IsVisible=!1,e.customSourceType="",e.customSourceRow="",e.customSourceFrom="",e.selectedCallFlow.webhook="",e.isNumberPool=!1,e.selectedCallFlow.Overflow="3",e.overflowNumbers=[{overflowNumber:"",rings:e.selectedCallFlow.Overflow,overflow_order:1}],e.openOverflowBox=!1,e.hunt_option,e.selectedCallFlow.activateVoicemail=!1,e.isSimultaneousRing=!1,e.disableRC=!1,e.addPercentRow=function(t){e.percentInfo.push({percentage:t,ringToNum:"",overflowNumbers:[{overflowNumber:"",rings:3,overflow_order:1}],isSimultaneousRing:!1,openOverflowBox:!1,route_order:e.percentInfo[e.percentInfo.length-1].route_order+1,activateVoicemail:!1})},e.setOverflowRings=function(){_.map(e.overflowNumbers,function(t){t.rings=e.selectedCallFlow.Overflow})},e.ShowHide=function(){e.IsVisible=!e.IsVisible},e.disableRecordCall=function(t){if("PercentageBasedRoute"===e.selectedCallFlow.routetype){if(e.selectedCallFlow.playDisclaimer=void 0!==e.selectedCallFlow.playDisclaimer?e.selectedCallFlow.playDisclaimer:"before",void 0!==e.percentInfo){var o=[];e.disableRC=!1,e.selectedCallFlow.playDisclaimer=void 0!==e.selectedCallFlow.playDisclaimer?e.selectedCallFlow.playDisclaimer:"before",e.percentInfo[t].activateVoicemail=!e.percentInfo[t].activateVoicemail;var a=_.pluck(e.percentInfo,"activateVoicemail");_.filter(a.concat(a),function(e){return!0===e}).length>0&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),e.percentInfo[t].activateVoicemail=!e.percentInfo[t].activateVoicemail}}else if("schedule"===e.selectedCallFlow.routetype){o=[];e.disableRC=!1,e.selectedCallFlow.playDisclaimer=void 0!==e.selectedCallFlow.playDisclaimer?e.selectedCallFlow.playDisclaimer:"before",e.scheduleInfo[t]?e.scheduleInfo[t].activateVoicemail=!e.scheduleInfo[t].activateVoicemail:e.selectedCallFlow.activateVoicemail=!e.selectedCallFlow.activateVoicemail,o.push(e.selectedCallFlow.activateVoicemail);var i=_.pluck(e.scheduleInfo,"activateVoicemail");_.filter(i.concat(o),function(e){return!0===e}).length>0&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),e.scheduleInfo[t]?e.scheduleInfo[t].activateVoicemail=!e.scheduleInfo[t].activateVoicemail:e.selectedCallFlow.activateVoicemail=!e.selectedCallFlow.activateVoicemail}else e.selectedCallFlow.playDisclaimer=void 0!==e.selectedCallFlow.playDisclaimer?e.selectedCallFlow.playDisclaimer:"before",e.disableRC=!1,e.selectedCallFlow.activateVoicemail||(e.disableRC=!0,e.selectedCallFlow.recordCall=!0)},e.checkRingToNumberPercent=function(e){return!e||("0"==t.unMaskData(e).charAt(0)||10!=t.unMaskData(e).length)},e.disableNumberPool=function(){e.selectedCallFlow.quantity=e.selectedCallFlow.numberPool,e.selectedCallFlow.quantity>1&&(p.notify({title:"Number pool",text:"To make changes to number pool, please contact Customer Support at 855-889-3939 or email at support@convirza.com",type:"error"}),e.selectedCallFlow.numberPool=e.selectedCallFlow.quantity=1)};var R=m.getLocations();e.locations=R,e.showAddloc=!0,e.callbackid=-1,e.campaignBuilderHeader=["Tracking Number","Name","Ring-to Phone Number","Tracking Number Type","Ad Source","Spam Guard","SMS","Status"],e.multipleNumbersHeader=["Tracking Number","Name","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Call Value","Repeat Interval (hours)","Ring to","Record Call"],0!=u.is_migrated&&"false"!=u.is_migrated||(e.campaignBuilderHeader=["Tracking Number","Name","Ring-to Phone Number","Tracking Number Type","Ad Source","Spam Guard","Status"]),e.userAccess&&e.userAccess.blocked_recording&&e.multipleNumbersHeader.pop(),e.actionHeader=["Actions"],e.customTaggingOptions=[],e.callActionTaggingOptions=[],e.setCallerIdList=[],$(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},2e3)}),$(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},5e3)}),e.multipleCallsStickyHeader=function(){setTimeout(function(){$(window).trigger("resize")},200)},e.sizeOf=function(e){return Object.keys(e).length},e.tagAdded=function(t,o){var a=1;if(void 0!==e.addCallAction.email[t]&&e.addCallAction.email[t].length>1){var i=e.addCallAction.email[t].indexOf(o)-1;a=e.addCallAction.email[t][i].id+1}o.id=a},e.emailText="",e.countElement=function(t,o){var a=[],i=e.addCallAction.email[t];if(void 0!==i){for(var r=0;r<i.length;r++)a.push(i[r].text);e.emailText=a.join(","),e.emailText=e.emailText.replace(/,/g,"").replace(/ /g,""),e.addCallAction.remainingText[t]=1024-e.emailText.length+" characters are remaining",e.addCallAction.callActionFormSubmitted[t]=!1}},s.webhookList(u.currentOUId).then(function(t){e.webhook=[],t.data.json.length>0&&(e.webhook=t.data.json)}),D.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;_.each(o,function(t){void 0===e.customsourcesArray[t.custom_source_type]&&(e.customsourcesArray[t.custom_source_type]=[]),e.customsourcesArray[t.custom_source_type].push({id:t.custom_source_id,name:t.custom_source_name})})}),e.selectCustomOptions=function(t,o,a){return{formatNoMatches:function(i){e.customSourceType=o,e.customSourceRow=t,e.customSourceFrom=a;var r="";return""!==i.trim()?(r='<a ng-class="{disabled:disableAddCustom}" ng-click="addCustomSource(term)">Add Custom Source :"'+i.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsCustomeSource=i})):r="Can not add empty!",r},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.toLowerCase().trim()==t[r].text.toLowerCase().trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-class="{disabled:disableAddCustom}" ng-click="addCustomSource(term);">Add Custom Source:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsCustomeSource=a.term}),console.log("textcount called")}return t},simple_tags:!0,allowClear:!0}},e.select2Options=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-click="addTag(term)">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.trim()==t[r].text.trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="addTag(term);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return t},simple_tags:!0,allowClear:!0}},e.addCustomSource=function(t){var o="CS"+e.customSourceType;if(e.disableAddCustom=!0,_.where(e.customsourcesArray[o],{custom_source_name:this.noResultsCustomeSource.trim()}).length>0)return p.notify({title:"Update Custom Source",text:"This Custom Source already exists",type:"error"}),e.disableAddCustom=!1,!1;var a={customSource:{custom_source_name:e.noResultsCustomeSource,org_unit_id:u.currentOUId,custom_source_type:o}};if(e.noResultsCustomeSource.length>50)return p.notify({title:"Custom Source",text:"Not allowed more than 50 characters",type:"error"}),e.disableAddCustom=!1,!1;$(".select2-drop").hide(),D.customSource(a).then(function(t){e.customTaggingOptionsWatch=!0,""===t.data.err&&(p.notify({title:"Create Custom Source",text:"Successfully added the custom source",type:"success"}),e.disableAddCustom=!1,e.customsourcesArray[o].push({id:t.data.json.custom_source_id,name:e.noResultsCustomeSource.trim()}),e.customTaggingOptions.push({custom_source_id:t.data.json.custom_source_id,custom_source_name:e.noResultsCustomeSource.trim(),org_unit_id:u.currentOUId}))})},e.addTag=function(t){if(_.where(e.callActionTaggingOptions,{tag_name:this.noResultsTag.trim()}).length>0)return p.notify({title:"Update Tags",text:"This Tag already exists",type:"error"}),!1;var o={tag:{tag_name:e.noResultsTag.trim(),org_unit_id:u.currentOUId}};$(".select2-drop").hide(),n.createTag(o).then(function(t){e.callActionTaggingOptionsWatch=!0,""===t.data.err&&(p.notify({title:"Create Tags",text:"Successfully added the tag",type:"success"}),e.callActionTaggingOptions.push({tag_id:t.data.json.tag_id,tag_name:e.noResultsTag.trim(),org_unit_id:u.currentOUId}))})},e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&w(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.$watch("addCallAction.email",function(t,o){for(var a in e.addCallAction.email)if(e.addCallAction.email.hasOwnProperty(a)){for(var i=0,r=e.addCallAction.email[a],n=0;n<r.length;n++){i+=r[n].text.replace(/,/g,"").replace(/ /g,"").length}e.addCallAction.remainingText[a]=1024-i+" characters are remaining"}},!0),e.$watch("noResultsTag",function(t,o){t&&t!==o&&w(function(){var t=$(".select2-no-results");S(t.contents())(e)})},!0),e.$watch("noResultsCustomeSource",function(t,o){t&&t!==o&&w(function(){var t=$(".select2-no-results");S(t.contents())(e)})},!0),e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&w(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.$watch("customTaggingOptions",function(t,o,a){e.customTaggingOptionsWatch&&w(function(){if(1===e.customSourceRow&&"single"===e.customSourceFrom)1===e.customSourceType?e.selectedCallFlow.customSourceList_1=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():2===e.customSourceType?e.selectedCallFlow.customSourceList_2=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():3===e.customSourceType?e.selectedCallFlow.customSourceList_3=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():4===e.customSourceType?e.selectedCallFlow.customSourceList_4=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():5===e.customSourceType&&(e.selectedCallFlow.customSourceList_5=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString());else if("multiple"===e.customSourceFrom)for(var t=1;t<=e.selectedCallFlow.count;t++)e.customSourceRow===t&&(1===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_1=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():2===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_2=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():3===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_3=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():4===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_4=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():5===e.customSourceType&&(e.MultCallFlowList[e.customSourceRow-1].customSourceList_5=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString()));$(".select2-drop").hide()})},!0),i.get("assets/demo/call_actions.json").then(function(t){e.names=t.data}),i.get("assets/demo/schedule_data.json").then(function(t){e.timeZones=t.data.timeZones,e.extendScheduleDays=t.data.extendScheduleDays,e.scheduledDays=t.data.scheduledDays,e.scheduleTimeSlots=t.data.scheduleTimeSlots,e.extendScheduleDays=t.data.extendScheduleDays}),e.addLocationVisible=function(){e.showAddloc=!1},e.chkSpclChar=function(e,t,o){var a=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;a.test(e)?(p.notify({title:t,text:"Special characters are not allowed",type:"error"}),o(e.replace(a,""))):o(e)},e.voiceTextChange=function(t){switch(e.promtElement=t,e.promtElement){case"voicePromt":e.promptAudio=void 0,void 0===e.selectedCallFlow.voicePromptTTSText||0===e.selectedCallFlow.voicePromptTTSText.length?(e.hasValidVoiceURL=!1,e.TTSSelected=!0):e.chkSpclChar(e.selectedCallFlow.voicePromptTTSText,"Voice Prompt",function(t){e.selectedCallFlow.voicePromptTTSText=t,e.hasValidVoiceURL=!0,e.TTSSelected=!0});break;case"voicemailGreetings":e.greetingAudio=void 0,void 0===e.selectedCallFlow.voicemailGreetingsTTSText||0===e.selectedCallFlow.voicemailGreetingsTTSText.length?(e.hasValidvoicemailGreetingsURL=!1,e.TTSvoicemailGreetingsSelected=!0):e.chkSpclChar(e.selectedCallFlow.voicemailGreetingsTTSText,"Voicemail Greetings",function(t){e.selectedCallFlow.voicemailGreetingsTTSText=t,e.hasValidvoicemailGreetingsURL=!0,e.TTSvoicemailGreetingsSelected=!0});break;case"outComePromt":e.outComePromtAudio=void 0,void 0===e.selectedCallFlow.outComePromtTTSText||0===e.selectedCallFlow.outComePromtTTSText.length?(e.hasValidoutComePromtURL=!1,e.TTSoutComePromtSelected=!0):e.chkSpclChar(e.selectedCallFlow.outComePromtTTSText,"Voice prompt for Call outcome",function(t){e.selectedCallFlow.outComePromtTTSText=t,e.hasValidoutComePromtURL=!0,e.TTSoutComePromtSelected=!0});break;case"salesAmountVoice":e.selectedCallFlow.salesAmountVoicePromptText?e.TTSsalesAmountVoiceSelected=!1:(e.salesAmountVoiceAudio=void 0,void 0===e.selectedCallFlow.salesAmountVoiceTTSText||0===e.selectedCallFlow.salesAmountVoiceTTSText.length?(e.hasValidsalesAmountVoiceURL=!1,e.TTSsalesAmountVoiceSelected=!0):e.chkSpclChar(e.selectedCallFlow.salesAmountVoiceTTSText,"Sale amount voice prompt",function(t){e.selectedCallFlow.salesAmountVoiceTTSText=t,e.hasValidsalesAmountVoiceURL=!0,e.TTSsalesAmountVoiceSelected=!0}));break;case"AgentIDVoicePrompt":e.AgentIDVoicePromptAudio=void 0,void 0===e.selectedCallFlow.AgentIDVoicePromptTTSText||0===e.selectedCallFlow.AgentIDVoicePromptTTSText.length?(e.hasValidAgentIDVoicePromptURL=!1,e.TTSAgentIDVoicePromptSelected=!0):e.chkSpclChar(e.selectedCallFlow.AgentIDVoicePromptTTSText,"Agent ID voice prompt",function(t){e.selectedCallFlow.AgentIDVoicePromptTTSText=t,e.hasValidAgentIDVoicePromptURL=!0,e.TTSAgentIDVoicePromptSelected=!0})}},e.whisperTextChange=function(){e.whisperAudio=void 0,void 0===e.selectedCallFlow.whisperTTSText||0===e.selectedCallFlow.whisperTTSText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):e.chkSpclChar(e.selectedCallFlow.whisperTTSText,"Whisper Message",function(t){e.selectedCallFlow.whisperTTSText=t,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0})},e.audioIsPlaying=function(t){return"whisper"!=t&&void 0!==e.whisperAudio&&!e.whisperAudio.paused&&!e.whisperAudio.ended||("prompt"!=t&&void 0!==e.promptAudio&&!e.promptAudio.paused&&!e.promptAudio.ended||("ivr"!=t&&void 0!==e.ivrAudio&&!e.ivrAudio.paused&&!e.ivrAudio.ended||("greeting"!=t&&void 0!==e.greetingAudio&&!e.greetingAudio.paused&&!e.greetingAudio.ended||("calloutcome"!=t&&void 0!==e.outComePromtAudio&&!e.outComePromtAudio.paused&&!e.outComePromtAudio.ended||("agentid"!=t&&void 0!==e.AgentIDVoicePromptAudio&&!e.AgentIDVoicePromptAudio.paused&&!e.AgentIDVoicePromptAudio.ended||("sale"!=t&&void 0!==e.salesAmountVoiceAudio&&!e.salesAmountVoiceAudio.paused&&!e.salesAmountVoiceAudio.ended||"geolocation"!=t&&void 0!==e.geoLocationAudio&&!e.geoLocationAudio.paused&&!e.geoLocationAudio.ended))))))};var F=function(){void 0!==e.whisperAudio&&(e.whisperAudio.pause(),e.whisperAudio=void 0),void 0!==e.promptAudio&&(e.promptAudio.pause(),e.promptAudio=void 0),void 0!==e.ivrAudio&&(e.ivrAudio.pause(),e.ivrAudio=void 0),void 0!==e.ivrAudio1&&(e.ivrAudio1.pause(),e.ivrAudio1=void 0),void 0!==e.greetingAudio&&(e.greetingAudio.pause(),e.greetingAudio=void 0),void 0!==e.calloutcomeAudio&&(e.calloutcomeAudio.pause(),e.calloutcomeAudio=void 0),void 0!==e.agentidAudio&&(e.agentidAudio.pause(),e.agentidAudio=void 0),void 0!==e.saleAudio&&(e.saleAudio.pause(),e.saleAudio=void 0),void 0!==e.leadAudio&&(e.leadAudio.pause(),e.leadAudio=void 0),void 0!==e.geoLocationAudio&&(e.geoLocationAudio.pause(),e.geoLocationAudio=void 0)};e.audioIsDownloading=function(){return void 0!==e.whisperAudio&&void 0!==e.onTTS_WH_Request||(void 0!==e.promptAudio&&void 0!==e.onTTS_VP_Request||(void 0!==e.ivrAudio&&void 0!==e.onTTS_IVR_Request||(void 0!==e.greetingAudio&&void 0!==e.onTTS_WH_Request||(void 0!==e.calloutcomeAudio&&void 0!==e.onTTS_VP_Request||(void 0!==e.agentidAudio&&void 0!==e.onTTS_IVR_Request||(void 0!==e.saleAudio&&void 0!==e.onTTS_VP_Request||(void 0!==e.leadAudio&&void 0!==e.onTTS_IVR_Request||void 0!==e.geoLocationAudio&&void 0!==e.onTTS_IVR_Request)))))))},e.addLocation=function(){e.inserted={id:e.locations.length+1,name:"",status:null,group:null},e.locations.push(e.inserted)},e.prompts=h.prompts,e.whispers=v.whispers,e.voicemails=f.voicemails,e.isVoiceOpen=!1,e.disableClickOnVoice=function(){e.isVoiceOpen=!0},e.showVoiceModal=function(t){e.promtElement=t,F(),b.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){e.isVoiceOpen=!1;for(var t=0;t<h.prompts.length;t++)if(!0===h.prompts[t].selectedprompt)switch(e.promtElement){case"voicePromt":e.selectedCallFlow.voicePromptText=h.prompts[t].name,e.selectedCallFlow.voicePromptFileName=h.prompts[t].filename,e.selectedCallFlow.voicePromptId=h.prompts[t].id,e.selectedCallFlow.voiceURL=h.prompts[t].url,e.selectedCallFlow.promptAudio=void 0,e.prompts=h.prompts,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptTTSText="";break;case"outComePromt":e.selectedCallFlow.outComePromtText=h.prompts[t].name,e.selectedCallFlow.outComePromtFileName=h.prompts[t].filename,e.selectedCallFlow.outComePromtId=h.prompts[t].id,e.selectedCallFlow.outComePromtURL=h.prompts[t].url,e.selectedCallFlow.outComePromtAudio=void 0,e.outComePromtAudio=void 0,e.prompts=h.prompts,e.TTSoutComePromtSelected=!1,e.hasValidoutComePromtURL=!0,e.selectedCallFlow.outComePromtTTSText="";break;case"salesAmountVoice":e.selectedCallFlow.salesAmountVoicePromptText=h.prompts[t].name,e.selectedCallFlow.salesAmountVoicePromptFileName=h.prompts[t].filename,e.selectedCallFlow.salesAmountVoicePromptId=h.prompts[t].id,e.selectedCallFlow.salesAmountVoiceURL=h.prompts[t].url,e.selectedCallFlow.salesAmountVoiceAudio=void 0,e.salesAmountVoiceAudio=void 0,e.selectedCallFlow.salesAmountVoiceFileName=h.prompts[t].filename,e.prompts=h.prompts,e.hasValidsalesAmountVoiceURL=!0,e.TTSsalesAmountVoiceSelected=!1,e.selectedCallFlow.salesAmountVoicePromptTTSText="",e.selectedCallFlow.salesAmountVoiceTTSText="";break;case"AgentIDVoicePrompt":e.selectedCallFlow.AgentIDVoicePromptText=h.prompts[t].name,e.selectedCallFlow.AgentIDVoicePromptFileName=h.prompts[t].filename,e.selectedCallFlow.AgentIDVoicePromptId=h.prompts[t].id,e.selectedCallFlow.AgentIDVoicePromptURL=h.prompts[t].url,e.selectedCallFlow.AgentIDVoicePromptAudio=void 0,e.AgentIDVoicePromptAudio=void 0,e.prompts=h.prompts,e.hasValidAgentIDVoicePromptURL=!0,e.TTSAgentIDVoicePromptSelected=!1,e.selectedCallFlow.AgentIDVoicePromptTTSText=""}},function(){e.isVoiceOpen=!1,console.log("Modal dismissed at: "+new Date)})},e.totPercent=0,e.percentageCount=function(t){for(var o=0,a=0;a<e.percentInfo.length;a++)o+=e.percentInfo[a].percentage;if(e.totPercent=o,e.totPercent>100)p.notify({title:"Percentage Call Route",text:"Percentage is greater than 100 ",type:"error"});else{for(a=0;a<e.percentInfo.length;a++)if(""==e.percentInfo[a].percentage||null==e.percentInfo[a].percentage||isNaN(e.percentInfo[a].percentage))return;if(t<9&&e.totPercent<100&&e.percentInfo.length<10)for(a=0;a<e.percentInfo.length;a++)if(100-o>0){var i=100-o;e.addPercentRow(i);break}}},e.removePercentNumber=function(t){bootbox.confirm("Are you sure you want to delete this percentage route ring to Number?",function(o){o&&(e.percentInfo.splice(t,1),angular.forEach(e.percentInfo,function(t){e.disableRC=!1,1==t.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0)}))})},e.isVoicemailOpen=!1,e.disableClickOnVoicemail=function(){e.isVoicemailOpen=!0},e.showVoicemailModal=function(t){F(),b.open({templateUrl:"assets/partials/assignVoicemail.html",controller:"voicemailModel",size:t,backdrop:"static",keyboard:!1}).result.then(function(){e.isVoicemailOpen=!1;for(var t=0;t<f.voicemails.length;t++)!0===f.voicemails[t].selectedvoicemail&&(e.selectedCallFlow.voicemailGreetingsText=f.voicemails[t].name,e.selectedCallFlow.voicemailGreetingsFileName=f.voicemails[t].filename,e.selectedCallFlow.voicemailGreetingsPromptId=f.voicemails[t].id,e.selectedCallFlow.VoiceMainGreetingURL=f.voicemails[t].url,e.selectedCallFlow.voicemailGreetingspromptAudio=void 0);e.voicemails=f.voicemails,e.TTSvoicemailGreetingsSelected=!1,e.hasValidvoicemailGreetingsURL=!0,e.selectedCallFlow.voicemailGreetingsTTSText=""},function(){e.isVoicemailOpen=!1,console.log("Modal dismissed at: "+new Date)})},e.isWhisperOpen=!1,e.disableClickOnWhisper=function(){e.isWhisperOpen=!0},e.showWhisperModal=function(t){F(),b.open({templateUrl:"assets/partials/assignWhisper.html",controller:"whisperModal",size:"lg",backdrop:"static",keyboard:!1}).result.then(function(){e.isWhisperOpen=!1;for(var t=0;t<v.whispers.length;t++)!0===v.whispers[t].selectedwhisper&&(e.selectedCallFlow.whisperText=v.whispers[t].name,e.selectedCallFlow.whisperFileName=v.whispers[t].filename,e.selectedCallFlow.whisperId=v.whispers[t].id,e.selectedCallFlow.whisperURL=v.whispers[t].url,e.selectedCallFlow.whisperAudio=void 0,e.selectedCallFlow.hasValidWhisperURL=!0,e.selectedCallFlow.TTSWhisperSelected=!0);console.log(v.whispers),e.whispers=v.whispers,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperTTSText=""},function(){e.isWhisperOpen=!1,console.log("Modal dismissed at: "+new Date)})},e.saveLocation=function(e,t){console.log("SAVING")},e.removeLocation=function(t){e.locations.splice(t,1)},e.savedlocations=[],e.savedlocations.push({id:"0",location:"Create Location",address:"1664 S. Dixie Dr.",city:"Saint George",state:"UT",zip:"84770",phone:"6809909123",action:"Delete"}),e.savedlocations.push({id:"1",location:"LogMyCalls",address:"1664 S. Dixie Dr.",city:"Saint George",state:"UT",zip:"84770",phone:"6809909123",action:"Delete"}),e.savedlocations.push({id:"2",location:"Blue Moon Inn",address:"25 Willow Ln.",city:"Port Costa",state:"CA",zip:"94569",phone:"9259465638",action:"Delete"}),e.savedlocations.push({id:"3",location:"Walnut Creek branch",address:"2705 Main St.",city:"Walnut Creek",state:"CA",zip:"94598",phone:"9255126685",action:"Delete"}),e.savedlocations.push({id:"4",location:"Ocean Gate Shop",address:"321 Mall Dr.",city:"St. George",state:"UT",zip:"84790",phone:"4356746700",action:"Delete"}),e.savedlocations.push({id:"5",location:"South Kings branch",address:"3110 S. Kings Hwy",city:"Nob Hill",state:"CA",zip:"94518",phone:"9255126225",action:"Delete"}),e.getLocation=function(t){if(e.rc=[],t){if(t.length>2){var o=[],i=t.split(/,|-/);return n.getGeoCity(i[0]).then(function(i){return"error"!=i.data.result?(angular.forEach(i.data.json.json,function(t){o.push(t.npa+"-"+t.city+","+t.state);var a=t.npa+"-"+t.city+","+t.state;e.rc.push({address:a,rc:t.rc,state:t.state}),t.city,t.state}),o=_.uniq(o),e.rc=_.uniq(e.rc),a("filter")(o,t)):o})}return""}},e.getNum=function(e){console.log(e)},e.showSubmit=function(){this.selectedCallFlow.name&&""!==this.selectedCallFlow.name?this.selectedCallFlow.callflowlabel="For "+this.selectedCallFlow.name:this.selectedCallFlow.callflowlabel="",setTimeout(function(){e.submitted1=!1},100)},e.showConfirmationPopup=function(){if(e.singlecallForm.$dirty){C.confirm("You are leaving the IVR creation pane. If you continue you will lose any IVR configuration settings that have been set. Press 'Ok' to continue and discard all IVR settings, or press 'Back' to continue editing IVR settings.",function(t){t?e.routeChange():e.selectedCallFlow.routetype="ivr"})}else e.$dismiss()},e.showConfirmationPopupOnCancel=function(){if(e.singlecallForm.$dirty){C.confirm("You are leaving the IVR creation pane. If you continue you will lose any IVR configuration settings that have been set. Press 'Ok' to continue and discard all IVR settings, or press 'Back' to continue editing IVR settings.",function(t){t?c.reload():e.selectedCallFlow.routetype="ivr"})}else e.$dismiss()},e.$watch("selectedCallFlow.routetype",function(t,o){console.log(o,t),!o||"hangup"!==o&&"voicemail"!==o||e.routeChange(),o&&"outbound"===o&&(e.routeChange(),e.phoneNumbers.push({rinterval:0})),!t||void 0===o||"hangup"!==t&&"voicemail"!==t||e.routeChange(),t&&void 0!==o&&"outbound"===t&&(e.routeChange(),e.phoneNumbers.push({rinterval:0})),o&&"ivr"===o&&"ivr"!==t&&e.showConfirmationPopup(),!o||"PercentageBasedRoute"!==o&&"schedule"!==o||(e.disableRC=!1),!t||"PercentageBasedRoute"!=t&&"schedule"!=t&&"geo"!=t&&"simple"!=t||(e.disableRC=!1,"simple"==t&&e.selectedCallFlow.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),"geo"==t&&e.selectedCallFlow.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),"schedule"==t&&(void 0==e.selectedCallFlow.ringtoNum||""==e.selectedCallFlow.ringtoNum?(e.activatevm=!1,e.selectedCallFlow.activateVoicemail=!1):(e.activatevm=!0,e.selectedCallFlow.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0)),angular.forEach(e.scheduleInfo,function(t){1==t.activateVoicemail&&(e.disableRC=!0)})),"PercentageBasedRoute"==t&&angular.forEach(e.percentInfo,function(t){1==t.activateVoicemail&&(e.disableRC=!0,e.selectedCallFlow.recordCall=!0)})),!t||void 0===o||"geo"!=t&&"simple"!=t||e.openOverflowBox&&(e.overflowNumbers.length=1,_.each(e.overflowNumbers,function(t){t.overflowNumber="",t.rings=e.defaultsRings}),e.isSimultaneousRing=!1,e.openOverflowBox=!1)}),e.routeChange=function(){if("PercentageBasedRoute"===e.selectedCallFlow.routetype)e.selectedCallFlow.ringtoNum="",e.selectedCallFlow.voicemail_rings_count="3",e.openOverflowBox&&(e.overflowNumbers.length=1,_.each(e.overflowNumbers,function(e){e.overflowNumber="",e.rings=3}),e.isSimultaneousRing=!1,e.openOverflowBox=!1),e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],void 0!==e.defaultData.play_whisper_message&&1==e.defaultData.play_whisper_message&&(e.selectedCallFlow.whisperPrompt1=!0),L(e.defaultSetting,!0));else if("simple"===e.selectedCallFlow.routetype)e.selectedCallFlow.playDisclaimer="before",e.selectedCallFlow.dnis_as_cid="caller_id",e.selectedCallFlow.ringtoNum="",e.openOverflowBox&&(e.overflowNumbers.length=1,_.each(e.overflowNumbers,function(e){e.overflowNumber="",e.rings="3"}),e.isSimultaneousRing=!1,e.openOverflowBox=!1),e.selectedCallFlow.voicemail_rings_count="3",e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],void 0!==e.defaultData.play_whisper_message&&1==e.defaultData.play_whisper_message&&(e.selectedCallFlow.whisperPrompt1=!0),L(e.defaultSetting,!0));else if("ivr"===e.selectedCallFlow.routetype)if(e.isNew&&I.callFlowData.length>0){if(e.defaultData=I.callFlowData[0],void 0!==e.defaultData.play_voice_prompt_first&&1==e.defaultData.play_voice_prompt_first){e.ivrAudio1=void 0,e.selectedCallFlow.voicepromptTTSText="";var t=e.defaultData.play_voice_prompt_first_text;"file://"==t.substring(0,7)?(e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0,e.selectedCallFlow.voicepromptText=e.defaultData.prompt_message_name,e.selectedCallFlow.voicepromptFileName=t.replace("file://",""),e.selectedCallFlow.voicepromptURL=e.defaultData.voice_prompt_url,e.selectedCallFlow.voicepromptId=e.defaultData.voice_prompt_id):(e.TTSIVRSelected=!0,e.selectedCallFlow.voicepromptTTSText=t,e.selectedCallFlow.voicepromptFileName=t)}L(e.defaultSetting,!0)}else e.defaultData="",e.selectedCallFlow.voicemail_rings_count="3";else if("geo"===e.selectedCallFlow.routetype)e.selectedCallFlow.ringtoNum="",e.selectedCallFlow.voicemail_rings_count="3",e.selectedCallFlow.playDisclaimer="before",e.openOverflowBox&&(e.overflowNumbers.length=1,_.each(e.overflowNumbers,function(e){e.overflowNumber="",e.rings="3"}),e.isSimultaneousRing=!1,e.openOverflowBox=!1),e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],void 0!==e.defaultData.play_whisper_message&&1==e.defaultData.play_whisper_message&&(e.selectedCallFlow.whisperPrompt1=!0),L(e.defaultSetting,!0));else if("hangup"===e.selectedCallFlow.routetype){if(e.selectedCallFlow.preCallWebhook=!1,e.selectedCallFlow.activateVoicemail=!1,e.disableRC=!1,e.selectedCallFlow.whisperPrompt1=!1,e.selectedCallFlow.voicemail_rings_count=null,e.selectedCallFlow.caller_id="",e.selectedCallFlow.spamActive=!1,e.postCallIVR=!1,e.selectedCallFlow.voicemailGreetingsTTSText="",e.selectedCallFlow.AgentIDVoicePromptTTSText="",e.selectedCallFlow.lengthOfAgentId="",e.selectedCallFlow.outComePromtTTSText="",e.selectedCallFlow.salesAmountVoiceTTSText="",e.selectedCallFlow.recordCall=!0,e.selectedCallFlow.playDisclaimer="before",e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],e.selectedCallFlow.recordCall=e.defaultData.record_call,e.selectedCallFlow.playDisclaimer=e.defaultData.play_disclaimer,e.selectedCallFlow.voicePrompt1=e.defaultData.play_voice_prompt_first,e.selectedCallFlow.voicePromptTTSText=e.defaultData.play_voice_prompt_first_text,void 0!==e.userAccess.dni&&e.userAccess.dni>4&&I.dniSettingData.length>0)){e.selectedCallFlow.showDNI=I.defOrgComponentStatus[0].dni_status;var o=I.dniSettingData[0],i=o.referrer;o.referrer_type&&(i+="|"+o.referrer_type),a("filter")(e.dniReferrer,i,!0).length<1&&e.dniReferrer.push({value:i,text:o.referrer});var r=o.referrer;o.referrer_type&&(r+="|"+o.referrer_type),e.selectedCallFlow.dni_setting_id=o.dni_setting_id,e.selectedCallFlow.destination_url=o.destination_url,e.selectedCallFlow.dniType=o.dni_type,e.populatedDniType=o.dni_type,e.selectedCallFlow.showDNI&&(e.selectedCallFlow.referrer=r,e.selectedCallFlow.dni_element=o.dni_element),e.selectedCallFlow.dni_ttl=o.ttl}}else"voicemail"===e.selectedCallFlow.routetype?(e.selectedCallFlow.activateVoicemail=!1,e.selectedCallFlow.showDNI=!1,e.selectedCallFlow.whisperPrompt1=!1,e.selectedCallFlow.value=null,e.selectedCallFlow.voicemail_rings_count=null,e.selectedCallFlow.caller_id="",e.selectedCallFlow.spamActive=!1,e.selectedCallFlow.destination_url="*.*",e.selectedCallFlow.dniType="",e.selectedCallFlow.dni_element="",e.selectedCallFlow.referrer="",e.selectedCallFlow.preCallWebhook=!1,e.selectedCallFlow.webhook="",e.selectedCallFlow.recordCall=!0,e.selectedCallFlow.voicePrompt1=!1,e.selectedCallFlow.playDisclaimer="never",e.selectedCallFlow.voicePromptTTSText="",e.postCallIVR=!1,e.selectedCallFlow.AgentIDVoicePromptTTSText="",e.selectedCallFlow.lengthOfAgentId="",e.selectedCallFlow.outComePromtTTSText="",e.selectedCallFlow.salesAmountVoiceTTSText="",e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5=""):"outbound"===e.selectedCallFlow.routetype?(e.selectedCallFlow.preCallWebhook=!1,e.selectedCallFlow.activateVoicemail=!1,e.disableRC=!1,e.selectedCallFlow.showDNI=!1,e.postCallIVR=!1,e.selectedCallFlow.AgentIDVoicePromptTTSText="",e.selectedCallFlow.lengthOfAgentId="",e.selectedCallFlow.outComePromtTTSText="",e.selectedCallFlow.salesAmountVoiceTTSText="",e.selectedCallFlow.whisperPrompt1=!1,this.selectedCallFlow.value="",this.selectedCallFlow.rinterval="",e.selectedCallFlow.voicemail_rings_count=null,e.selectedCallFlow.voicemailGreetingsTTSText="",e.selectedCallFlow.caller_id="CALLER_NUMBER",e.selectedCallFlow.spamActive=!1,e.selectedCallFlow.smsActive=!1,e.selectedCallFlow.smsFeature=!1,e.selectedCallFlow.destination_url="*.*",e.selectedCallFlow.dniType="",e.selectedCallFlow.dni_element="",e.selectedCallFlow.referrer="",e.selectedCallFlow.webhook="",e.selectedCallFlow.recordCall=!0,e.selectedCallFlow.playDisclaimer="before",e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],e.selectedCallFlow.recordCall=e.defaultData.record_call,e.selectedCallFlow.playDisclaimer=e.defaultData.play_disclaimer,e.selectedCallFlow.voicePrompt1=e.defaultData.play_voice_prompt_first,e.selectedCallFlow.voicePromptTTSText=e.defaultData.play_voice_prompt_first_text)):"schedule"===e.selectedCallFlow.routetype?(e.selectedCallFlow.ringtoNum="",e.showAddSchedule=!0,e.selectedCallFlow.activateVoicemail=!1,e.disableRC=!1,e.scheduleInfo=[{scheduleId:0,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!1,overflowNumbers:[{overflowNumber:"",rings:e.defaultsRings,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1}],e.selectedCallFlow.voicemail_rings_count="3",e.isNew&&I.callFlowData.length>0&&(e.defaultData=I.callFlowData[0],e.selectedCallFlow.activateVoicemail=!1,e.disableRC=!1,e.selectedCallFlow.recordCall=!1,1==e.defaultData.play_whisper_message&&(e.selectedCallFlow.whisperPrompt1=!0),L(e.defaultSetting,!0))):e.isNew&&I.callFlowData.length>0&&L(e.defaultSetting,!0)},e.activatevm=!0,e.activateVoicemailSchedule=function(){t.unMaskData(e.selectedCallFlow.ringtoNum);e.selectedCallFlow.ringtoNum&&10==t.unMaskData(e.selectedCallFlow.ringtoNum).length?(e.activatevm=!0,e.isNew&&(e.selectedCallFlow.activateVoicemail=e.defaultData.activate_voicemail)):(e.selectedCallFlow.activateVoicemail=!1,e.activatevm=!1)},e.showSaveButton=function(){setTimeout(function(){e.formSubmit1=!1},100)},e.showSaveButtonOverflow=function(){e.showSaveButton(),e.showSubmit()},e.resNumChange=function(){"reservedNumber"==e.selectedCallFlow.callflowOption&&(e.loadResNum=!0,$("#loadResNum").show(),n.getReservedNumbers().then(function(t){"error"!=t.data.result&&(e.loadResNum=!1,$("#loadResNum").hide(),e.resNumList=t.data.json,0==e.resNumList.length&&e.resNumList.push({number:"Numbers not available",number_id:"",pretty_number:"Numbers not available",source:"",vendor_id:""}))})),"singleNumber"!=e.selectedCallFlow.callflowOption&&"reservedNumber"!=e.selectedCallFlow.callflowOption&&(e.selectedCallFlow.smsActive=!1)},e.onReservedNumberFocus=function(){n.getReservedNumbers().then(function(t){"error"!=t.data.result&&(e.resNumList=t.data.json)})};var x="";function L(t,o){e.populatedDniType="",e.selectedCallFlow.voicemail_rings_count=3;e.prompts,e.whispers;if(!0===e.dniComponent&&t.data.json.callFlowData.defOrgComponentStatus.length>0?e.selectedCallFlow.showDNI=t.data.json.callFlowData.defOrgComponentStatus[0].dni_status:e.selectedCallFlow.showDNI=!1,void 0!==e.userAccess.dni&&e.userAccess.dni>4&&e.selectedCallFlow.showDNI&&t.data.json.callFlowData.dniSettingData.length>0){var i=(p=t.data.json.callFlowData.dniSettingData[0]).referrer;p.referrer_type&&(i+="|"+p.referrer_type),a("filter")(e.dniReferrer,i,!0).length<1&&e.dniReferrer.push({value:i,text:p.referrer});var r=p.referrer;p.referrer_type&&(r+="|"+p.referrer_type),e.selectedCallFlow.dni_setting_id=p.dni_setting_id,e.selectedCallFlow.destination_url=p.destination_url,e.selectedCallFlow.referrer=r,e.selectedCallFlow.dniType=p.dni_type,e.populatedDniType=p.dni_type,e.selectedCallFlow.dni_element=p.dni_element,e.selectedCallFlow.dni_ttl=p.ttl}else e.selectedCallFlow.showDNI=!1,e.selectedCallFlow.destination_url="*.*",e.selectedCallFlow.dniType="",e.selectedCallFlow.dni_element="",e.selectedCallFlow.referrer="";if(void 0!==e.userAccess.postcallivr&&e.userAccess.postcallivr>4){if(t.data.json.callFlowData.postCallIVR&&t.data.json.callFlowData.postCallIVR.length>0){var n=t.data.json.callFlowData.postCallIVR;e.postCallIVR=t.data.json.callFlowData.defOrgComponentStatus[0].postcallivr_status,e.postIVRType=e.postIVRTypes[n[0].post_call_ivr_option_id-1].value,e.prompts=[];for(var s=0;s<u.prompts.length;s++)1==u.prompts[s].active&&e.prompts.push(u.prompts[s]);e.TTSoutComePromtSelected=!0,e.TTSsalesAmountVoiceSelected=!0,e.TTSAgentIDVoicePromptSelected=!0;for(s=0;s<n.length;s++)switch(n[s].voice_prompt){case"record_call_outcome":var l=(v=n[s].voice_prompt_value).substring(0,7);if(e.hasValidoutComePromtURL=!1,"file://"==l){var c="";if(v=v.substring(v.lastIndexOf("/")+1,v.length),u.prompts)for(var d=0;d<u.prompts.length;d++){u.prompts[d].filename==v&&(c=u.prompts[d],e.TTSoutComePromtSelected=!1,e.hasValidoutComePromtURL=!0)}e.selectedCallFlow.outComePromtText=c.name,e.selectedCallFlow.outComePromtURL=c.url,e.selectedCallFlow.outComePromtFileName=c.filename,e.selectedCallFlow.outComePromtId=c.id}else e.TTSoutComePromtSelected=!0,e.selectedCallFlow.outComePromtTTSText=v;break;case"record_a_sale":if("file://"==(l=(v=n[s].voice_prompt_value).substring(0,7))){c="";if(v=v.substring(v.lastIndexOf("/")+1,v.length),u.prompts)for(d=0;d<u.prompts.length;d++){u.prompts[d].filename==v&&(c=u.prompts[d],e.TTSsalesAmountVoiceSelected=!1,e.hasValidsalesAmountVoiceURL=!0)}e.selectedCallFlow.salesAmountVoicePromptText=c.name,e.selectedCallFlow.salesAmountVoiceURL=c.url,e.selectedCallFlow.salesAmountVoiceFileName=c.filename,e.selectedCallFlow.salesAmountVoiceId=c.id}else e.TTSsalesAmountVoiceSelected=!0,e.selectedCallFlow.salesAmountVoiceTTSText=v;break;case"record_agent_id":l=(v=n[s].voice_prompt_value).substring(0,7);if(e.selectedCallFlow.lengthOfAgentId=n[s].number_of_digits,"file://"==l){c="";if(v=v.substring(v.lastIndexOf("/")+1,v.length),u.prompts)for(d=0;d<u.prompts.length;d++){u.prompts[d].filename==v&&(c=u.prompts[d],e.TTSAgentIDVoicePromptSelected=!1,e.hasValidAgentIDVoicePromptURL=!0)}e.selectedCallFlow.AgentIDVoicePromptText=c.name,e.selectedCallFlow.AgentIDVoicePromptURL=c.url,e.selectedCallFlow.AgentIDVoicePromptFileName=c.filename,e.selectedCallFlow.AgentIDVoicePromptId=c.id}else e.TTSAgentIDVoicePromptSelected=!0,e.selectedCallFlow.AgentIDVoicePromptTTSText=v}}}else e.postCallIVR=!1;if(t.data.json.callFlowData.customSourceData.length>0){var p=t.data.json.callFlowData.customSourceData,m={CS1:"customSourceList_1",CS2:"customSourceList_2",CS3:"customSourceList_3",CS4:"customSourceList_4",CS5:"customSourceList_5"};_.each(p,function(t){e.selectedCallFlow[m[t.custom_source_type]]=t.custom_source_id})}if(t.data.json.callFlowData.callFlowData.length>0){p=t.data.json.callFlowData.callFlowData[0];e.selectedCallFlow.activateVoicemail=0==e.voicemailComponent?e.selectedCallFlow.activateVoicemail=!1:t.data.json.callFlowData.callFlowData[0].activate_voicemail,e.hasValidVoiceURL=!1;l=(v=p.play_voice_prompt_first_text).substring(0,7);e.prompts=[],u.prompts=JSON.parse(g.sessionStorage.prompts);for(s=0;s<u.prompts.length;s++)1==u.prompts[s].active&&e.prompts.push(u.prompts[s]);"file://"==l?(e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptText=p.prompt_message_name,e.selectedCallFlow.voicePromptFileName=v.replace("file://",""),e.selectedCallFlow.voiceURL=p.voice_prompt_url,e.selectedCallFlow.voicePromptId=p.voice_prompt_id,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePrompt1=!0):(e.TTSSelected=!0,e.selectedCallFlow.voicePromptTTSText=v,e.selectedCallFlow.voicePromptFileName=v,e.selectedCallFlow.voicePrompt1=!0);var f=p.play_whisper_message_text,h=f.substring(0,7);u.whispers=JSON.parse(g.sessionStorage.whispers),e.hasValidWhisperURL=!1,e.whispers=[];for(s=0;s<u.whispers.length;s++)1==u.whispers[s].active&&e.whispers.push(u.whispers[s]);if("file://"==h?(e.TTSWhisperSelected=!1,e.selectedCallFlow.whisperText=p.whisper_message_name,e.selectedCallFlow.whisperFileName=f.replace("file://",""),e.selectedCallFlow.whisperURL=p.whisper_message_url,e.selectedCallFlow.whisperId=p.whisper_id,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperPrompt1=!0):(e.TTSWhisperSelected=!0,e.selectedCallFlow.whisperTTSText=f,e.selectedCallFlow.whisperFileName=f,e.selectedCallFlow.whisperPrompt1=!0),e.voicemailComponent&&null!==p.voicemail_greeting_message&&void 0!==p.voicemail_greeting_message){var v,b=p.voicemail_greeting_message,w=b.substring(0,7),y=(v=b.split("//"))[1],S="",C="";e.voicemails=[],u.voicemails=JSON.parse(g.sessionStorage.voicemails);for(s=0;s<u.voicemails.length;s++)1==u.voicemails[s].active&&e.voicemails.push(u.voicemails[s]);if("file://"==w){if(u.voicemails)for(d=0;d<u.voicemails.length;d++){u.voicemails[d].filename==y&&(u.voicemails[d].filename,S=u.voicemails[d].name,C=u.voicemails[d].url,e.hasValidvoicemailGreetingsURL=!0,e.TTSvoicemailGreetingsSelected=!1,e.selectedCallFlow.voicemailGreetingsTTSText="")}e.selectedCallFlow.voicemailGreetingsText=S,e.selectedCallFlow.VoiceMainGreetingURL=C,e.selectedCallFlow.voicemailGreetingsFileName=y}else e.TTSvoicemailGreetingsSelected=!0,e.selectedCallFlow.voicemailGreetingsTTSText=b}o||(e.selectedCallFlow.routetype="simple"),e.selectedCallFlow.recordCall=p.record_call,e.selectedCallFlow.ringtoNum=p.ring_to_number,e.selectedCallFlow.voicePrompt1=p.play_voice_prompt_first,e.selectedCallFlow.whisperPrompt1=p.play_whisper_message,e.selectedCallFlow.rinterval=p.repeat_interval_call,e.selectedCallFlow.playDisclaimer=p.play_disclaimer,e.oldVoicePromptFileName=e.selectedCallFlow.voicePromptFileName,e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText,e.selectedCallFlow.value=p.call_value,p.voicemail_rings&&""!=p.voicemail_rings&&"undefined"!=p.voicemail_rings||(p.voicemail_rings=3),e.selectedCallFlow.voicemail_rings_count=p.voicemail_rings,e.selectedCallFlow.Overflow=p.overflow_rings,p.overflow_rings&&(e.defaultsRings=p.overflow_rings),e.ivrActions[0].overflowNumbers=[{overflowNumber:"",rings:void 0===e.defaultsRings?3:e.defaultsRings,overflow_order:1}]}else e.selectedCallFlow.routetype="simple";if(e.overflowNumbers=[{overflowNumber:"",rings:void 0===e.selectedCallFlow.Overflow?3:e.selectedCallFlow.Overflow,overflow_order:1}],e.currentOverFlowNumber=e.overflowNumbers[0],e.percentInfo=[{percentage:"",ringToNum:"",overflowNumbers:[{overflowNumber:"",rings:void 0===e.selectedCallFlow.Overflow?3:e.selectedCallFlow.Overflow,overflow_order:1}],isSimultaneousRing:!1,openOverflowBox:!1,route_order:1,activateVoicemail:!1}],t.data.json.featureData.defaultData.length>0){p=t.data.json.featureData.defaultData[0];e.selectedCallFlow.spamActive=p.spam_guard_status}e.isAdvancedTrackingNumbersOpen=!0,e.selectedCallFlow.dnis_as_cid="caller_id",$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1")}function O(e,t){var o;return _.each(e,function(e,a){e===t&&(o=a)}),o}function U(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function P(t){if(delete e.ruleDropDown[t.toString()],delete e.addCallAction.callActionFormSubmitted[t.toString()],$.each(e.addCallAction,function(e,o){angular.isUndefined(o)||U(o[t.toString()])||"string"==typeof o||delete o[t.toString()]}),"IVR"==e.addCallAction.route_type)0===e.callActions.length&&(e.callActions=[],e.callActions.push({id:1}),e.addCallAction.actionOptions[1]="action0",e.addCallAction.email[1]=[],e.addCallAction.callActionFormSubmitted[1]=!1,e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(0===e.callActions.length){e.callActions=[],e.callActions.push({id:1}),e.addCallAction.actionOptions[1]="action0",e.addCallAction.email[1]=[],e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}e.onFocus=function(t){if(t&&t!=x){x=t,e.numList=[];var o=t.split(","),a=o[0].split("-"),i=a.shift(),r=a.join("-"),s=o.pop();""!=r&&""!=i?("TOLLFREE"===r&&(s="XX"),""!=s?(n.getPhoneNumbers(r,s,i).then(function(o){"error"!=o.data.result?(e.numList=o.data.json,e.numList instanceof Array||(e.numList=[]),"TOLLFREE"!==r&&(e.numList.push({number:"more",number_id:0}),e.removeNo=o.data.json.length-1,_.forEach(e.numList,function(o){"more"===o.number&&e.setNewNumber(o,t)}))):e.numList=[]}),!0===e.showMultiPass&&console.log(e.selectedCallFlow.count)):e.numList=[]):e.numList=[]}},document.getElementById("rateCenterAddress").addEventListener("keydown",function(t){if(13===t.keyCode)setTimeout(function(){return e.onFocus(e.selectedCallFlow.address),!0},400)}),e.lostFocus=function(t){t||(e.numList=[],e.selectedCallFlow.num="")},e.setNewNumber=function(t,o){var a,i=[],r="",s=0,l=0;if(e.LoadTrackingNumber=!0,$("#LoadTrackingNumber").show(),console.log("$scope.LoadTrackingNumber ****",e.LoadTrackingNumber),t&&"more"===t.number&&""!==o)if(e.numList.pop(),$.each(e.rc,function(e,t){t.address===o&&-1===i.indexOf(t.rc)&&void 0!==t.rc&&1==++l&&(i.push(t.rc.trim()),r=t.state.trim())}),i.length>0){a=i.length;for(var c=0;c<i.length&&0==s;c++)null===i[c]&&""===i[c]||n.getThirdPartyNumbers(r,i[c]).then(function(t){if(a-=1,"error"!==t.data.result)if("fail"!==t.data.json[0]){s=1,parseInt(e.removeNo)>0&&t.data.json.splice(0,parseInt(e.removeNo)),angular.forEach(t.data.json,function(t){e.numList.push(t)});for(var o=[],i=[],r=0;r<e.numList.length;r++)"inventory"==e.numList[r].source&&o.push(e.numList[r].number),"shoutpoint"==e.numList[r].source&&i.push(e.numList[r].number);var n=[];if(o.length>0){o.sort(function(e,t){return e-t});for(r=0;r<o.length;r++)for(var l=0;l<e.numList.length;l++)o[r]==e.numList[l].number&&"inventory"==e.numList[l].source&&n.push(e.numList[l])}if(i.length>0){i.sort(function(e,t){return e-t});for(r=0;r<i.length;r++)for(l=0;l<e.numList.length;l++)i[r]==e.numList[l].number&&"shoutpoint"==e.numList[l].source&&n.push(e.numList[l])}e.numList=n,e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()}else e.numList.push({number:"Numbers not available",number_id:"",pretty_number:"Numbers not available",source:"",vendor_id:""}),console.log("No data found"),e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide();else{for(o=[],r=0;r<e.numList.length;r++)"inventory"==e.numList[r].source&&o.push(e.numList[r].number);n=[];if(o.length>0){o.sort(function(e,t){return e-t});for(r=0;r<o.length;r++)for(l=0;l<e.numList.length;l++)o[r]==e.numList[l].number&&"inventory"==e.numList[l].source&&n.push(e.numList[l])}e.numList=n,e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()}e.numList.length>25&&(e.numList=e.numList.slice(0,25)),0==e.numList.length&&0===a&&e.numList.push({number:"Numbers not available",number_id:"",pretty_number:"Numbers not available",source:"",vendor_id:""})})}else e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide();else e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()},e.updateqCall=function(){e.qcf=this.qcf},u.$on("loadCallFlowReceiver",function(t,o){o.name&&(e.flowname=o.name),e.loadCallFlow(o)}),e.hideDniOptions=function(e,t){return"singleNumber"===t||"reservedNumber"===t?"session"===e:"session"!==e},e.changeLocId=function(t){void 0!=t&&(e.selectedCallFlow.geoList=t.id)},e.loadCallFlow=function(t){$(".addTrackingNumbersProgressLoader").show(),e.isAddTrackingNumbersOpen=!0,e.disableSaveForSchedule.levelOne=!1,e.disableSaveForSchedule.levelTwo=!1,e.disableSaveForSchedule.levelThird=!1,e.hideCallAction=!0,e.openOverflowBox=!1,e.referrerClassCombinations=[],e.showReferrerTextBox=!1,e.showWebHookTextBox=!1,e.oldVoicePromptTTSText="",e.oldVoicePrompt1=!1,e.TTSIVRSelected=!0,t&&(e.prompts=JSON.parse(g.sessionStorage.prompts),e.whispers=JSON.parse(g.sessionStorage.whispers),e.voicemails=JSON.parse(g.sessionStorage.voicemails)),e.selectedCallFlow.activateVoiceMail=!1;var o;void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,void 0!==e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio=void 0,void 0!==e.ivrAudio1&&e.ivrAudio1.pause(),e.ivrAudio1=void 0,void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,void 0!==e.greetingAudio&&e.greetingAudio.pause(),e.greetingAudio=void 0,void 0!==e.calloutcomeAudio&&e.calloutcomeAudio.pause(),e.calloutcomeAudio=void 0,void 0!==e.agentidAudio&&e.agentidAudio.pause(),e.agentidAudio=void 0,void 0!==e.saleAudio&&e.saleAudio.pause(),void 0!==e.leadAudio&&e.leadAudio.pause(),e.leadAudio=void 0,e.changeReferrer=function(){"new"===e.selectedCallFlow.referrer?(e.showReferrerTextBox=!0,e.selectedCallFlow.referrer=""):""!==e.selectedCallFlow.referrer&&void 0!==e.selectedCallFlow.referrer||(e.showReferrerTextBox=!1,e.selectedCallFlow.referrer="")},void 0!==e.singlecallForm&&e.singlecallForm.$setPristine(),e.ivrActions=[],e.ivrActions=[{id:1,action_order:1,voicepromptText:"",voicepromptFileName:"",voicepromptURL:"",voicepromptId:"",TTSIVRSelected:!0,hasValidTTSVoiceURL:"",voicepromptTTSText:"",action:"simple",message_type:"",message:"",ringtonum:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",overflowNumbers:[{overflowNumber:"",rings:e.overflow,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before"},back_press:"",whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:""}],e.scheduleInfo=[{scheduleId:0,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!1,overflowNumbers:[{overflowNumber:"",rings:e.defaultsRings,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1}],e.showCallFlow=!0,e.showMultiPass=!1,e.numList=[],e.bCreateAnother=!1,e.qCallFlowList=[{name:"Forward to phone number",id:1,value:"qSimple",action:"qSimple",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""},{name:"Geo Route",id:2,value:"qGeo",action:"qGeo",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""},{name:"Hang up",id:8,value:"qHangup",action:"qHangup",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""}],n.getSetCallerId().then(function(t){if("error"!=t.data.result){for(var o=0;o<t.data.json.length;o++)void 0!==e.selectedCallFlow.num&&t.data.json[o].value==e.selectedCallFlow.num.number&&t.data.json.splice(o,1);e.setCallerIdList=t.data.json}}),n.getChannels().then(function(o){"error"!=o.data.result&&(e.channels=o.data.json,angular.forEach(e.channels,function(o){o.category=o.category.trim(),o.sub_category=o.category+":"+o.sub_category,t&&t.channelId==o.channel_id&&(e.selectedCallFlow.channel=o)}))}),t&&(e.provisionedrouteId=t.id,o=t.id,e.addCallAction.provisioned_route_id&&t.id!==e.addCallAction.provisioned_route_id&&(e.showCallActions=!1)),y.getDniSettings(u.currentOUId).then(function(t){if(t.data.json[0].dni_org_unit.length>0)$.each(t.data.json[0].dni_settings,function(t,o){var i=o.referrer;o.referrer_type&&(i+="|"+o.referrer_type);o.number&&(o.number.slice(0,3),o.number.slice(3,6),o.number.slice(6,10));a("filter")(e.dniReferrer,i,!0).length<1&&e.dniReferrer.push({value:i,text:o.referrer})});else{var o={dniOrgUnit:{org_unit_id:u.currentOUId}};y.createDniOUData(o).then(function(e){})}}),t&&(e.isAdvancedTrackingNumbersOpen=!1,y.getDniSettings(u.currentOUId,o).then(function(t){t.data.json[0].dni_settings.length>0&&(!0===e.dniComponent?e.selectedCallFlow.showDNI=!0:e.selectedCallFlow.showDNI=!1,$.each(t.data.json[0].dni_settings,function(t,o){var a=o.referrer;o.referrer_type&&(a+="|"+o.referrer_type),e.selectedCallFlow.dni_setting_id=o.dni_setting_id,e.selectedCallFlow.destination_url=o.destination_url,e.selectedCallFlow.referrer=a,e.selectedCallFlow.dniType=o.dni_type,e.selectedCallFlow.dni_element=o.dni_element,e.selectedCallFlow.dni_ttl=o.keep_alive_mins}))})),t?(e.numList.push({id:t.id,number:t.phone,pretty_number:t.phonep,numberid:t.phoneid,vendor_id:t.vendor_id}),e.oldQuantity=t.quantity,e.isNew=!1,e.selectedCallFlow=t,e.selectedCallFlow.callflowlabel="For "+t.name,e.selectedCallFlow.num=e.numList[0],e.selectedCallFlow.numberPool=t.quantity,e.selectedCallFlow.rate_center=t.rate_center,e.pool_state=t.state,e.rate_center=t.rate_center,e.pool_id=t.pooId,t.phone?e.selectedCallFlow.callflowOption="singleNumber":e.selectedCallFlow.callflowOption="numberPool",e.selectedCallFlow.showWebhook=!0,t.webhook_id&&(e.selectedCallFlow.webhook=t.webhook_id,e.selectedCallFlow.webhook&&(e.selectedCallFlow.preCallWebhook=!0)),e.selectedCallFlowEdit=!0,"Active"==t.status2?e.cfactive=!0:e.cfactive=!1,n.getprovRouteCallFlow(t.id).then(function(t){if("error"!=t.data.status){if(void 0!==t.data.json.call_flow.spam_active&&(e.selectedCallFlow.spamActive=t.data.json.call_flow.spam_active),void 0!==t.data.json.call_flow.sms_enabled&&(e.selectedCallFlow.smsActive=t.data.json.call_flow.sms_enabled,e.selectedCallFlow.oldSmsActive=t.data.json.call_flow.sms_enabled),void 0!==t.data.json.call_flow.sms_feature&&(e.selectedCallFlow.smsFeature=t.data.json.call_flow.sms_feature),e.postCallIVR=t.data.json.call_flow.post_call_ivr_enabled,e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.selectedCallFlow.routetype=t.data.json.call_flow.routable_type,e.callFlowId=t.data.json.call_flow.id,e.selectedCallFlow.ringtoNum=t.data.json.call_flow.default_ringto,e.selectedCallFlow.org_unit_id=t.data.json.call_flow.org_unit_id,e.selectedCallFlow.activateVoicemail="VoicemailRoute"!=e.selectedCallFlow.routetype&&(0!=e.voicemailComponent&&t.data.json.call_flow.vm_enabled),t.data.json.call_flow.voicemail_rings?e.selectedCallFlow.voicemail_rings_count=t.data.json.call_flow.voicemail_rings:e.selectedCallFlow.voicemail_rings_count=3,void 0!==e.userAccess.postcallivr&&e.userAccess.postcallivr>4&&"hangup"!==e.selectedCallFlow.ringtoNum){if(t.data.json.post_call_ivr&&t.data.json.post_call_ivr.length>0){var o=t.data.json.post_call_ivr;for(e.selectedCallFlow.post_call_ivr_id=o[0].post_call_ivr_id,e.postIVRType=_.find(e.postIVRTypes,function(e){return e.name===o[0].post_call_ivr_option_name}).value,m=0;m<o.length;m++)switch(o[m].voice_prompt){case"record_call_outcome":if("file://"==(r=(n=o[m].voice_prompt_value).substring(0,7))){var a="";if(n=n.substring(n.lastIndexOf("/")+1,n.length),e.prompts)for(var i=0;i<e.prompts.length;i++){(u=e.prompts[i].filename+".wav")==n&&(a=e.prompts[i])}e.TTSoutComePromtSelected=!1,e.selectedCallFlow.outComePromtText=a.name,e.selectedCallFlow.outComePromtURL=a.url,e.selectedCallFlow.outComePromtFileName=a.filename,e.hasValidoutComePromtURL=!0,e.selectedCallFlow.outComePromtId=a.id}else e.TTSoutComePromtSelected=!0,e.selectedCallFlow.outComePromtTTSText=n.substring(6,n.length);break;case"record_a_sale":if("file://"==(r=(n=o[m].voice_prompt_value).substring(0,7))){a="";if(n=n.substring(n.lastIndexOf("/")+1,n.length),e.prompts)for(i=0;i<e.prompts.length;i++){(u=e.prompts[i].filename+".wav")==n&&(a=e.prompts[i])}e.TTSsalesAmountVoiceSelected=!1,e.selectedCallFlow.salesAmountVoicePromptText=a.name,e.selectedCallFlow.salesAmountVoiceURL=a.url,e.selectedCallFlow.salesAmountVoiceFileName=a.filename,e.hasValidsalesAmountVoiceURL=!0,e.selectedCallFlow.salesAmountVoiceId=a.id}else e.TTSsalesAmountVoiceSelected=!0,e.selectedCallFlow.salesAmountVoiceTTSText=n.substring(6,n.length);break;case"record_agent_id":var r=(n=o[m].voice_prompt_value).substring(0,7);if(e.selectedCallFlow.lengthOfAgentId=o[m].number_of_digits,"file://"==r){a="";if(n=n.substring(n.lastIndexOf("/")+1,n.length),e.prompts)for(i=0;i<e.prompts.length;i++){(u=e.prompts[i].filename+".wav")==n&&(a=e.prompts[i])}e.TTSAgentIDVoicePromptSelected=!1,e.selectedCallFlow.AgentIDVoicePromptText=a.name,e.selectedCallFlow.AgentIDVoicePromptURL=a.url,e.selectedCallFlow.AgentIDVoicePromptFileName=a.filename,e.hasValidAgentIDVoicePromptURL=!0,e.selectedCallFlow.AgentIDVoicePromptId=a.id}else e.TTSAgentIDVoicePromptSelected=!0,e.selectedCallFlow.AgentIDVoicePromptTTSText=n.substring(6,n.length)}}}else e.postCallIVR=!1;if("SimpleRoute"===t.data.json.call_flow.routable_type&&t.data.json.call_flow.dnis_as_cid?e.selectedCallFlow.dnis_as_cid="tracking_number":e.selectedCallFlow.dnis_as_cid="caller_id",t.data.json.hunt_options&&t.data.json.hunt_options.length>0&&t.data.json.hunt_options[0].target_did){for(e.openOverflowBox=!0,e.overflowNumbers=[],"Simultaneous Ring"==t.data.json.hunt_options[0].hunt_type||"simultaneous"==t.data.json.hunt_options[0].hunt_type.toLowerCase()?e.isSimultaneousRing=!0:e.isSimultaneousRing=!1,m=0;m<t.data.json.hunt_options.length;m++)e.overflowNumbers.push({overflowNumber:t.data.json.hunt_options[m].target_did,rings:t.data.json.hunt_options[m].ring_delay/6,overflow_order:t.data.json.hunt_options[m].overflow_order}),e.hunt_option=t.data.json.hunt_options[m].hunt_route_id;e.currentOverFlowNumber=e.overflowNumbers[e.overflowNumbers.length-1]}else e.overflowNumbers=[{overflowNumber:"",rings:3,overflow_order:1}];if(t.data.json.custom_sources&&void 0!==t.data.json.custom_sources)for(m=0;m<t.data.json.custom_sources.length;m++)"CS1"===t.data.json.custom_sources[m].custom_source_type?e.selectedCallFlow.customSourceList_1=t.data.json.custom_sources[m].custom_source_id:"CS2"===t.data.json.custom_sources[m].custom_source_type?e.selectedCallFlow.customSourceList_2=t.data.json.custom_sources[m].custom_source_id:"CS3"===t.data.json.custom_sources[m].custom_source_type?e.selectedCallFlow.customSourceList_3=t.data.json.custom_sources[m].custom_source_id:"CS4"===t.data.json.custom_sources[m].custom_source_type?e.selectedCallFlow.customSourceList_4=t.data.json.custom_sources[m].custom_source_id:"CS5"===t.data.json.custom_sources[m].custom_source_type&&(e.selectedCallFlow.customSourceList_5=t.data.json.custom_sources[m].custom_source_id)}if(void 0!=t.data.json.call_flow.webhook_id&&""!=t.data.json.call_flow.webhook_id&&(e.selectedCallFlow.showWebhook=!0,e.selectedCallFlow.webhook=t.data.json.call_flow.webhook_id),t.data.json.call_flow.whisper_enabled&&null!==t.data.json.call_flow.whisper_message){e.selectedCallFlow.whisperPrompt1=!0;var n=t.data.json.call_flow.whisper_message.substring(t.data.json.call_flow.whisper_message.lastIndexOf("/")+1,t.data.json.call_flow.whisper_message.length);if("file"==t.data.json.call_flow.whisper_type){if(e.whispers&&void 0!==e.whispers&&null!==e.whispers)for(i=0;i<e.whispers.length;i++){n==(u=e.whispers[i].filename)&&(e.selectedCallFlow.whisperText=e.whispers[i].name,e.selectedCallFlow.whisperURL=e.whispers[i].url,e.selectedCallFlow.whisperId=e.whispers[i].id,e.selectedCallFlow.whisperFileName=u,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperTTSText="")}}else e.selectedCallFlow.whisperTTSText=t.data.json.call_flow.whisper_message,e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperText="hh"}else e.selectedCallFlow.whisperPrompt1=!1;if(t.data.json.call_flow.message_enabled&&null!==t.data.json.call_flow.message){n=t.data.json.call_flow.message.substring(t.data.json.call_flow.message.lastIndexOf("/")+1,t.data.json.call_flow.message.length);if(e.selectedCallFlow.voicePrompt1=!0,"file"==t.data.json.call_flow.message_type){if(e.prompts&&void 0!==e.prompts&&null!==e.prompts)for(i=0;i<e.prompts.length;i++){n==(u=e.prompts[i].filename)&&(e.selectedCallFlow.voicePromptText=e.prompts[i].name,e.selectedCallFlow.voiceURL=e.prompts[i].url,e.selectedCallFlow.voicePromptId=e.prompts[i].id,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptFileName=e.prompts[i].filename,e.selectedCallFlow.voicePromptTTSText="",e.oldVoicePromptFileName=e.selectedCallFlow.voicePromptFileName,e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText)}}else e.selectedCallFlow.voicePromptTTSText=t.data.json.call_flow.message,e.TTSSelected=!0,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptText="hh"}else e.selectedCallFlow.voicePrompt1=!1;var s=t.data.json.call_flow.vm_message,l=t.data.json.call_flow.vm_type;if(!0===e.voicemailComponent){if("file"===l&&e.voicemails){for(a="",i=0;i<e.voicemails.length;i++){(u=e.voicemails[i].filename)==s&&(a=e.voicemails[i])}e.TTSvoicemailGreetingsSelected=!1,a?(e.selectedCallFlow.voicemailGreetingsText=a.name,e.selectedCallFlow.VoiceMainGreetingURL=a.url,e.selectedCallFlow.voicemailGreetingsFileName=a.filename):(e.selectedCallFlow.voicemailGreetingsText="",e.selectedCallFlow.VoiceMainGreetingURL=""),e.selectedCallFlow.voicemailGreetingsTTSText="",e.hasValidvoicemailGreetingsURL=!0}else null!==s&&"undefined"!==s?(e.TTSvoicemailGreetingsSelected=!0,e.selectedCallFlow.voicemailGreetingsTTSText=s):(e.TTSvoicemailGreetingsSelected=!0,e.selectedCallFlow.voicemailGreetingsText="")}else e.selectedCallFlow.activateVoicemail=!1;switch(1==t.data.json.call_flow.record_call||!0===t.data.json.call_flow.record_call?(e.selectedCallFlow.playDisclaimer=t.data.json.call_flow.play_disclaimer,e.selectedCallFlow.recordCall=!0):(e.selectedCallFlow.recordCall=!1,e.selectedCallFlow.playDisclaimer="before"),e.basicRoute=t.data.json.call_flow.routable_type,t.data.json.call_flow.routable_type){case"SimpleRoute":"hangup"===t.data.json.call_flow.default_ringto?(e.selectedCallFlow.routetype="hangup",e.selectedCallFlow.overflowNumbers=""):(!0!==t.data.json.call_flow.vm_enabled||1!=t.data.json.call_flow.record_call&&1!=t.data.json.call_flow.record_call?1==t.data.json.call_flow.record_call||1==t.data.json.call_flow.record_call?(e.selectedCallFlow.recordCall=!0,e.disableRC=!1):(e.selectedCallFlow.recordCall=!1,e.disableRC=!1):(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),e.selectedCallFlow.routetype="simple");break;case"GeoRoute":if(e.selectedCallFlow.routetype="geo",e.selectedCallFlow.routeBy=t.data.json.geo_route[0].strategy,e.selectedCallFlow.geoRouteId=t.data.json.geo_route[0].id,e.selectedCallFlow.geoList=t.data.json.geo_route[0].location_id,e.selectedCallFlow.ringtoNum=t.data.json.geo_route[0].default_ringto,e.selectedCallFlow.geoList&&void 0!==e.selectedCallFlow.geoList&&""!==e.selectedCallFlow.geoList&&null!==e.selectedCallFlow.geoList?e.georoutelocations.forEach(function(t){t.id===parseInt(e.selectedCallFlow.geoList)&&(e.locObj=t)}):e.locObj={id:"",name:"",routes:[]},"Npa"!==t.data.json.geo_route[0].strategy&&"Zipcode"!==t.data.json.geo_route[0].strategy||(e.selectedCallFlow.radius=t.data.json.geo_route[0].radius.toString()),!0!==t.data.json.call_flow.vm_enabled||1!=t.data.json.call_flow.record_call&&1!=t.data.json.call_flow.record_call?1==t.data.json.call_flow.record_call||1==t.data.json.call_flow.record_call?(e.selectedCallFlow.recordCall=!0,e.disableRC=!1):(e.selectedCallFlow.recordCall=!1,e.disableRC=!1):(e.disableRC=!0,e.selectedCallFlow.recordCall=!0),"claimedState"!==t.data.json.geo_route[0].strategy&&"Npa"!==t.data.json.geo_route[0].strategy&&t.data.json.geo_route[0].message_enabled&&t.data.json.geo_route[0].message&&t.data.json.geo_route[0].message.length>0){e.selectedCallFlow.playGeoLocationPrompt=!0;var c="file";if(t.data.json.geo_route[0].message&&"file"!=t.data.json.geo_route[0].message.substring(0,4)&&(c="text"),d=t.data.json.geo_route[0].message.substring(t.data.json.geo_route[0].message.lastIndexOf("/")+1,t.data.json.geo_route[0].message.length),"file"==c)if(e.prompts)for(i=0;i<e.prompts.length;i++){(u=e.prompts[i].filename+".wav")==d&&(a=e.prompts[i],e.selectedCallFlow.geoLocationPromptURL=a.url,e.selectedCallFlow.geoLocationPromptText=a.name,e.selectedCallFlow.geoLocationPromptName=a.filename,e.TTGeoloLocationPromptSelected=!1,e.hasValidGeoloLocationPromptURL=!0)}else e.TTGeoloLocationPromptSelected=!0,e.selectedCallFlow.geoLocationPromptTTSText=d,e.hasValidTTSVoiceURL=!1;else e.TTGeoloLocationPromptSelected=!0,e.selectedCallFlow.geoLocationPromptTTSText=d,e.hasValidTTSVoiceURL=!1}else e.selectedCallFlow.playGeoLocationPrompt=!1,e.selectedCallFlow.geoLocationPromptText="",e.selectedCallFlow.geoLocationPromptTTSText="";break;case"PercentageBasedRoute":e.percentInfo=[],e.selectedCallFlow.routetype="PercentageBasedRoute";e.percentInfo=_.sortBy(t.data.json.ringto_percentage,"route_order"),_.map(e.percentInfo,function(t){t.overflowNumbers.length<1&&t.overflowNumbers.push({overflowNumber:"",rings:3,overflow_order:1}),t.activateVoicemail=0!=e.voicemailComponent&&t.activateVoicemail});break;case"IvrRoute2":var d="";if(d=t.data.json.call_flow.message,"file"==t.data.json.call_flow.message_type){if(d=d.substring(d.lastIndexOf("/")+1,d.length),e.prompts)for(i=0;i<e.prompts.length;i++){var u;(u=e.prompts[i].filename)==d&&(a=e.prompts[i],e.selectedCallFlow.voicepromptURL=a.url,e.voicepromptId=a.id,e.selectedCallFlow.voicepromptText=a.name,e.selectedCallFlow.voicepromptFileName=a.filename,e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0)}}else e.TTSIVRSelected=!0,d=d,e.selectedCallFlow.voicepromptTTSText=d,e.hasValidTTSVoiceURL=!1;var p=[];if(_.each(t.data.json.ivrs,function(t){var o="file",a="file",i=t.message,r=t.whisper_message,n=t.whisper_enabled,s=!1,l=[],c=!1,d={},u=!1,m="",g="",f="",h="",v=!0,b="",w="",y="",S="",C="",A="",T=!1,D=!1;if(t.message&&"file"!=t.message.substring(0,4)&&(o="text"),t.whisper_message&&"file"!=t.whisper_message.substring(0,4)&&(a="text"),"file"==o){if(i=i.substring(i.lastIndexOf("/")+1,i.length),e.prompts)for(var I=0;I<e.prompts.length;I++){e.prompts[I].filename+".wav"==i&&(d=e.prompts[I]),m=d.url,f=d.id,h=d.name,b=d.filename,u=!1,v=!0}}else u=!0,g=i="blank://"==i?"":i.substring(6,i.length),v=!1;if(n)if("file"==a){if(r=r.substring(r.lastIndexOf("/")+1,r.length),e.whispers)for(I=0;I<e.whispers.length;I++){e.whispers[I].filename+".wav"==r&&(y=(w=e.whispers[I]).name,C=w.url,w.id,A=w.filename,T=!1,D=!0)}}else T=!0,S=r=r.substring(6,r.length),D=!1;else T=!0;_.each(t.overflowNumbers,function(e){var t={overflowNumber:e.target_did,rings:e.ring_delay/6,overflow_order:e.overflow_order};"Simultaneous"===e.hunt_type&&(s=!0),l.push(t)}),l.length?c=!0:l=[{overflowNumber:"",rings:3,overflow_order:1}],"hangup"===t.target_did&&(t.ivr_option_type="hangup"),t.location_id&&(t.location_id=t.location_id.toString());var N={};t.scheduleRoute&&(N=t.scheduleRoute),$.each(e.timeZones,function(t,o){o.value==N.timezone&&(N.timezone=e.timeZones[t])});var k={action:t.ivr_option_type,action_order:t.action_order,activateVoiceMail:t.vm_enabled,destination:t.destination,id:t.id,level:t.level,parentid:t.parentid,previousmenu:t.back_press,message:i,keypress:t.key_press,message_type:o,ringtoNum:"schedule"===t.ivr_option_type?"":t.target_did,overflowNumbers:l,openOverflowBox:c,isSimultaneousRing:s,back_press:t.back_press,voicepromptURL:m,voicepromptId:f,voicepromptText:h,recordCall:t.record_enabled,playDisclaimer:"true"===t.play_disclaimer?"before":t.play_disclaimer,voicepromptTTSText:g,TTSIVRSelected:u,hasValidTTSVoiceURL:v,voicepromptFileName:b,whisperPrompt:n,TTSWhisperSelected:T,whisperTTSText:S,hasValidWhisperURL:D,whisperText:y,whisperURL:C,whisperFileName:A,geoRoute:{routeBy:t.strategy,radius:t.radius,geoList:t.location_id},scheduleRoute:{recordCall:t.record_enabled,playDisclaimer:"true"===t.play_disclaimer?"before":t.play_disclaimer,timezone:N.timezone,default_ringto:N.default_ringto,scheduleInfo:N.schedules,activate_voicemail:N.vm_enabled},disableRC:!!t.vm_enabled};p.push(k)}),e.ivrActions=function(e){for(var t,o,a=[],i={},r=0,n=e.length;r<n;r++)t=e[r],i[t.id]=t,i[t.id].ivrActions=[];for(var s in i)i.hasOwnProperty(s)&&((o=i[s]).parentid?i[o.parentid].ivrActions.push(o):a.push(o));return a}(p),e.ivrActions=_.sortBy(e.ivrActions,"action_order"),m<e.ivrActions.length&&e.ivrActions[m].ivrActions&&e.ivrActions[m].ivrActions.length>0)for(var m=0;m<e.ivrActions.length;m++)if(e.ivrActions[m].ivrActions=_.sortBy(e.ivrActions[m].ivrActions,"action_order"),e.ivrActions[m].ivrActions&&e.ivrActions[m].ivrActions.length>0)for(i=0;i<e.ivrActions[m].ivrActions.length;i++)e.ivrActions[m].ivrActions[i].ivrActions=_.sortBy(e.ivrActions[m].ivrActions[i].ivrActions,"action_order");e.selectedCallFlow.routetype="ivr";break;case"OutboundRoute":"default"===t.data.json.outbound_Data[0].callerid&&(t.data.json.outbound_Data[0].callerid="CALLER_NUMBER"),e.selectedCallFlow.routetype="outbound",e.selectedCallFlow.pin=t.data.json.outbound_Data[0].pin,e.selectedCallFlow.caller_id=t.data.json.outbound_Data[0].callerid,e.selectedCallFlow.showDNI=!1,e.selectedCallFlow.whisperPrompt1=!1,e.selectedCallFlow.value="",e.selectedCallFlow.rinterval="",e.selectedCallFlow.voicemail_rings_count=null,e.selectedCallFlow.voicemailGreetingsTTSText="",e.selectedCallFlow.destination_url="",e.selectedCallFlow.dniType="",e.selectedCallFlow.dni_element="",e.selectedCallFlow.referrer="",e.selectedCallFlow.overflowNumbers="";break;case"VoicemailRoute":e.selectedCallFlow.routetype="voicemail";break;case"ScheduleRoute":e.selectedCallFlow.routetype="schedule",$.each(e.timeZones,function(o,a){a.value==t.data.json.schedule.timezone&&(e.selectedCallFlow.timezone=e.timeZones[o])}),e.showAddSchedule=!1,e.scheduleInfo=t.data.json.schedule.schedule,e.selectedCallFlow.activateVoicemail=t.data.json.schedule.vm_enabled,e.selectedCallFlow.ringtoNum=t.data.json.schedule.default_ringto,$.each(t.data.json.schedule.schedule,function(t,o){e.formationscheduleTimeSlots(t),o.activateVoicemail=0!=e.voicemailComponent&&o.activateVoicemail,1==o.activateVoicemail&&(e.disableRC=!0)}),e.selectedCallFlow.activateVoicemail&&(e.disableRC=!0),void 0==e.selectedCallFlow.ringtoNum||""==e.selectedCallFlow.ringtoNum?e.activatevm=!1:e.activatevm=!0}"PercentageBasedRoute"!==t.data.json.call_flow.routable_type&&(e.percentInfo=[{percentage:"",ringToNum:"",overflowNumbers:[{overflowNumber:"",rings:void 0===e.selectedCallFlow.Overflow?3:e.selectedCallFlow.Overflow,overflow_order:1}],isSimultaneousRing:!1,openOverflowBox:!1,route_order:1,activateVoicemail:!1}]),$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1")})):(e.isAddTrackingNumbersOpen=!0,e.isAdvancedTrackingNumbersOpen=!1,e.basicRoute="newRoute",e.isNew=!0,e.scheduleInfo=[{scheduleId:0,days:[],fromTime:"",toTime:"",ringTo:"",isAddOverflow:!1,overflowNumbers:[{overflowNumber:"",rings:e.defaultsRings,overflow_order:1}],simultaneousRings:!1,activateVoicemail:!1}],e.selectedCallFlow={rinterval:72,callflowOption:"singleNumber"},e.selectedCallFlow.recordCall=!0,e.selectedCallFlow.spamActive=!1,e.selectedCallFlow.smsActive=!1,e.selectedCallFlow.smsFeature=!1,e.selectedCallFlow.oldSmsActive=!1,e.showSpambutton&&(e.selectedCallFlow.spamActive=!0),e.selectedCallFlow.showDNI=!0,e.selectedCallFlow.showWebhook=!0,e.selectedCallFlow.playDisclaimer="before",e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.hasValidVoiceURL=!0,e.hasValidWhisperURL=!0,e.selectedCallFlow.address=null,e.selectedCallFlow.voicePromptText="hh",e.selectedCallFlow.whisperText="hh",e.addresses=[],e.selectedCallFlow.geoRouteId=null,e.cfactive=!0,e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.locObj="",e.campActive||(e.cfactive=!1),e.callActions=[],e.ivrActions=[],e.ivrActions=[{id:1,action_order:1,voicepromptText:"",voicepromptFileName:"",voicepromptURL:"",voicepromptId:"",TTSIVRSelected:!0,hasValidTTSVoiceURL:"",voicepromptTTSText:"",action:"simple",message_type:"",message:"",ringtonum:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",overflowNumbers:[{overflowNumber:"",rings:void 0===e.selectedCallFlow.Overflow?3:e.selectedCallFlow.Overflow,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before"},back_press:"",whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:""}],n.getDefaultData(e.currentOUId).then(function(t){e.defaultSetting=t,I=t.data.json.callFlowData,e.defaultData=I.callFlowData[0],L(t,!1)})),c.current.params.id&&setTimeout(function(){$("html, body").animate({scrollTop:$("#callFlow").offset().top-50},1e3)},100),e.originalcfactive=e.cfactive},e.enableSave=function(t){"tag_call"===e.addCallAction.actionOptions[t]&&(e.callActionLoaded||(e.addCallAction.callActionFormSubmitted[t]=!1),e.callActionLoaded=!1)},e.loadCallActionsTemplate=function(t){e.callActions=[];var o={},a=1,i="";if(t.data.json.forEach(function(t){if(e.addCallAction.rule[t.action_order]={},e.ruleDropDown[t.action_order]={},"IVR"==e.addCallAction.route_type){var r=Object.assign({},e.names.fields);t.rules.forEach(function(o,a){i="duration"==O(r,o.data_field)?"="==o.operator?"=":"!="==o.operator?"!=":O(e.names.Ct_operators_based_on_fields,o.operator):O(e.names.Ct_operators_based_on_fields,o.operator),"NONE"==o.join_type&&(o.join_type=""),"contains"!==o.operator&&"does not contain"!==o.operator&&"begins with"!==o.operator&&"ends with"!==o.operator||(i=o.operator),e.addCallAction.rule[t.action_order][a]={},e.ruleDropDown[t.action_order][a]={},e.addCallAction.rule[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][a].fields=Object.keys(r),e.ruleDropDown[t.action_order][a].operators=e.names.operators[O(r,o.data_field)],e.ruleDropDown[t.action_order][a].enum=e.names.enum[O(r,o.data_field)],e.ruleDropDown[t.action_order][a].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(a)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][a].fields=O(r,o.data_field),e.addCallAction.rule[t.action_order][a].operators=i,e.addCallAction.rule[t.action_order][a].enum=o.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][a].join_type=o.join_type,e.addCallAction.rule[t.action_order][parseInt(a)+1].join_type=""})}else{var n=Object.assign({},e.names.fields);delete n["Ring to Phone Number"],t.rules.forEach(function(o,a){"duration"==O(n,o.data_field)?(console.log("rule.data_field",o.data_field),i="="==o.operator?"=":"!="==o.operator?"!=":O(e.names.Ct_operators_based_on_fields,o.operator)):i=O(e.names.Ct_operators_based_on_fields,o.operator),"NONE"==o.join_type&&(o.join_type=""),"contains"!==o.operator&&"does not contain"!==o.operator&&"begins with"!==o.operator&&"ends with"!==o.operator||(i=o.operator),e.addCallAction.rule[t.action_order][a]={},e.ruleDropDown[t.action_order][a]={},e.addCallAction.rule[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][a].fields=Object.keys(n),e.ruleDropDown[t.action_order][a].operators=e.names.operators[O(n,o.data_field)],e.ruleDropDown[t.action_order][a].enum=e.names.enum[O(n,o.data_field)],e.ruleDropDown[t.action_order][a].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(a)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][a].fields=O(n,o.data_field),e.addCallAction.rule[t.action_order][a].operators=i,e.addCallAction.rule[t.action_order][a].enum=o.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][a].join_type=o.join_type,e.addCallAction.rule[t.action_order][parseInt(a)+1].join_type=""})}switch(o={id:t.action_order},t.action){case"email_alert":for(var s=[],l=t.action_target.split(","),c=0;c<l.length;c++){var d={id:a,text:l[c]};s.push(d),a++}var u=t.action_target.replace(/,/g,"");u=u.replace(/ /g,""),e.addCallAction.remainingText[t.action_order]=1024-u.length+" characters are remaining",e.addCallAction.email[t.action_order]=s;break;case"sms_alert":e.addCallAction.phone[t.action_order]=t.action_target;break;case"tag_call":var p=[];t.action_target=t.action_target.split(","),angular.forEach(t.action_target,function(e,t){var o=e.trim();p.push(o)}),e.addCallAction.tagList[t.action_order]=p;break;case"post_event":e.addCallAction.postEvent[t.action_order]=t.action_target;break;case"webhook":e.addCallAction.webhook[t.action_order]=t.action_target;break;case"post_detail":e.addCallAction.sendCallDetails[t.action_order]=t.action_target;break;case"callback":e.addCallAction.callbackFlag[t.action_order]=t.action_target}e.addCallAction.action_id[t.action_order]=t.action_id,e.addCallAction.actionOptions[t.action_order]=t.action,"doubleclick"===t.action&&!1===e.dcSetting&&(e.addCallAction.actionOptions[t.action_order]=""),e.addCallAction.callActionFormSubmitted[t.action_order]=!0,e.callActions.push(o)}),"IVR"==e.addCallAction.route_type)U(e.addCallAction.actionOptions)&&(e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.remainingText[0]="1024 characters are remaining",e.addCallAction.email[1]=[],e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(U(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(r)}},e.addCallAction.remainingText[0]="1024 characters are remaining",e.addCallAction.email[1]=[],e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}},n.getWebhooks().then(function(t){if(null==t.data.err||""==t.data.err){for(var o=[],a=0;a<t.data.json.length;a++)"active"===t.data.json[a].webhook_status&&o.push(t.data.json[a]);e.callActionWebhookOptions=o}}),o.getTags().then(function(t){console.log("tags:",t),""===t.data.err&&(e.callActionTaggingOptionsWatch=!1,e.callActionTaggingOptions=t.data.json)}),e.gaSetting=!0,n.getAnalytics().then(function(t){""===t.data.err&&t.data.json.length>0&&(t.data.json[0].all_routes||"inactive"===t.data.json[0].analytic_status)&&(e.gaSetting=!1)}),e.dcSetting=!1,n.callActionDC(u.currentOUId).then(function(t){"success"===t.data.result&&void 0!==t.data.json&&t.data.json.dc_enabled&&(console.log("Setting dcSetting to true"),e.doubleclick_id=t.data.json.doubleclick_id,e.dcSetting=!0)}),e.loadCallActions=function(t){e.addNewStep=!0,e.hideCallAction=!1,void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),void 0!==e.greetingAudio&&e.greetingAudio.pause(),void 0!==e.calloutcomeAudio&&e.calloutcomeAudio.pause(),void 0!==e.agentidAudio&&e.agentidAudio.pause(),void 0!==e.saleAudio&&e.saleAudio.pause(),void 0!==e.leadAudio&&e.leadAudio.pause(),e.showCallActions=!0;e.callActions=[],e.callActions.push({id:1}),e.addCallAction={},e.addCallAction.cfname=t.name,e.addCallAction.route_type=t.route_type,e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.addCallAction.callActionFormSubmitted={},e.addCallAction.remainingText={},e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.ruleDropDown={},e.addCallAction.provisioned_route_id=t.id,e.addCallAction.phoneid=t.phoneid,e.callActionLoaded=!1,n.getcallActions(t.id).then(function(o){if(e.callActionLoaded=!0,console.log("routee",t.route_type),"error"!=o.data.result&&o.data.json.length&&o.data.json[0].rules.length>0?e.loadCallActionsTemplate(o,t):"error"!=o.data.result&&0===o.data.json.length&&D.getCallActions(e.currentOUId).then(function(o){"error"!=o.data.result&&o.data.json.length&&o.data.json[0].rules.length>0&&e.loadCallActionsTemplate(o,t)}),"IVR"==e.addCallAction.route_type)U(e.addCallAction.actionOptions)&&(e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.addCallAction.remainingText[1]="1024 characters are remaining",e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(U(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.addCallAction.remainingText[1]="1024 characters are remaining";var a=Object.assign({},e.names.fields);delete a["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(a)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}),e.callFlowId&&t.id!==e.provisionedrouteId&&(e.showCallFlow=!1),setTimeout(function(){$("html, body").animate({scrollTop:$("#callActions").offset().top-50},1e3)},100)},e.loadMultiPass=function(){e.showMultiPass=!0,e.showCallFlow=!1,e.selectedCallFlow=[],e.selectedCallFlow.address=null,e.MultCallFlowList=[],w(function(){e.numList=[]},1e3),e.selectedCallFlow.count=0,n.getChannels().then(function(t){"error"!=t.data.result&&(e.channels=t.data.json,angular.forEach(t.data.json,function(e){e.category=e.category.trim(),e.sub_category=e.category+":"+e.sub_category}))}),setTimeout(function(){$("html, body").animate({scrollTop:$("#multiPass").offset().top-50},1e3)},100)},e.cancel=function(){"ivr"===e.selectedCallFlow.routetype?e.showConfirmationPopupOnCancel():(e.showCallFlow=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#page-heading").offset().top-50},1e3)},100),c.reload())},e.addNewCallAction=function(t){if("IVR"==e.addCallAction.route_type){o={id:(t=parseInt(t))+1},e.callActions.push(o),e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.addCallAction.actionOptions[t+1]="action0",e.ruleDropDown[t+1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}else{var o;o={id:(t=parseInt(t))+1},e.callActions.push(o),e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.addCallAction.actionOptions[t+1]="action0";var a=Object.assign({},e.names.fields);delete a["Ring to Phone Number"],e.ruleDropDown[t+1]={0:{fields:Object.keys(a)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}},e.removeCallAction=function(t){var o=!0;$.each(e.callActions,function(a,i){o&&i.id===t&&(angular.isUndefined(e.addCallAction.action_id[t])?(e.callActions.splice(a,1),P(i.id),o=!1):C.confirm("Are you sure you want to delete this Call Action?",function(r){r&&n.removecallActions(e.addCallAction.action_id[t]).then(function(t){"error"!==t.data.result?(p.notify({title:"Call Action",text:"Call Action deleted successfully",type:"success"}),e.callActions.splice(a,1),P(i.id),o=!1):p.notify({title:"Call Action",text:"Error in Deleting in Call Action",type:"success"})})}))})},e.addMultCalls=function(){e.isEditable=!0,e.MultCallFlowList=[];if(console.log("add mult numbers clicked:"+e.selectedCallFlow.count),/\d{3}-[a-z]/i.test(e.selectedCallFlow.address))if(e.selectedCallFlow.count>100)p.notify({title:"Multiple Tracking Numbers",text:"You can add 100 Tracking Numbers at once.",type:"error"});else if(e.numList)if(e.selectedCallFlow.count>=e.numList.length){var t=[],o="",a=0;if(e.numList.pop(),$.each(e.rc,function(a,i){i.address===e.selectedCallFlow.address&&-1===t.indexOf(i.rc)&&void 0!==i.rc&&(t.push(i.rc.trim()),o=i.state.trim())}),t.length>0)for(var i=0;i<t.length&&0==a;i++)if(null!==t[i]||""!==t[i]){var r=T.defer();return n.getThirdPartyNumbers(o,t[i]).then(function(t){console.log(t),"error"!==t.data.result&&"fail"!==t.data.json[0]?(a=1,angular.forEach(t.data.json,function(t){e.numList.push(t)}),n.getDefaultData(e.currentOUId).then(function(t){if(console.log("Hello:---------",t),e.selectedCallFlow.count<=e.numList.length){for(var o=0;o<e.selectedCallFlow.count;o++){var a={number:e.numList[o].number,source:e.numList[o].source,pretty_number:e.numList[o].pretty_number,numberid:e.numList[o].number_id,vendor_id:e.numList[o].vendor_id,name:"",value:"",channel:"",repeatint:72,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,recordcall:"yes",customTaggingOptions:e.customTaggingOptions,selectCustomOptions:e.selectCustomOptions};if(t.data.json.callFlowData.callFlowData.length>0){var i=t.data.json.callFlowData.callFlowData[0];a.repeatint=i.repeat_interval_call,a.ringto=i.ring_to_number,a.recordcall=!0===i.record_call?"yes":"no"}e.MultCallFlowList.push(a)}r.resolve()}else p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"})})):p.notify({title:"Multiple Tracking Number",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"})}),r.promise}}else{if(!(e.selectedCallFlow.count<=e.numList.length))return void p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});n.getDefaultData(e.currentOUId).then(function(t){for(var o=0;o<e.selectedCallFlow.count;o++){var a={number:e.numList[o].number,source:e.numList[o].source,pretty_number:e.numList[o].pretty_number,numberid:e.numList[o].number_id,vendor_id:e.numList[o].vendor_id,name:"",value:"",channel:"",repeatint:72,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,recordcall:"yes",customTaggingOptions:e.customTaggingOptions,selectCustomOptions:e.selectCustomOptions};if(t.data.json.callFlowData.callFlowData.length>0){var i=t.data.json.callFlowData.callFlowData[0];a.repeatint=i.repeat_interval_call,a.ringto=i.ring_to_number,a.recordcall=!0===i.record_call?"yes":"no"}e.MultCallFlowList.push(a)}})}else p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else p.notify({title:"Multiple Tracking Numbers",text:"invalid location",type:"error"})},e.recordoptions=[{id:1,text:"yes"},{id:2,text:"no"}],e.showRecordOptions=function(t){if(t.recordcall&&e.recordoptions.length){var o=a("filter")(e.recordoptions,{text:t.recordcall});return o.length?o[0].text:"yes"}return t.recordcall||"yes"},e.showRemoveRule=function(e){var t=0;return $.each(e,function(e,o){U(o)||(t+=1)}),t>1},e.showNumber=function(e){return 1===e?"First":2===e?"Second":3===e?"Third":4===e?"Fourth":5===e?"Fifth":6===e?"Sixth":7===e?"Seventh":8===e?"Eighth":9===e?"Ninth":10===e?"Tenth":""},e.selectedCallFlow.voicePrompt1=!0,e.selectedCallFlow.voicePromptTTSText="",e.TTSSelected=!0,e.ivrActions=[{id:1,action_order:1,voicepromptText:"",voicepromptFileName:"",voicepromptURL:"",voicepromptId:"",TTSIVRSelected:!0,hasValidTTSVoiceURL:"",voicepromptTTSText:"",action:"simple",ringtonum:"",recordCall:!1,activateVoiceMail:!1,playDisclaimer:"before",overflowNumbers:[{overflowNumber:"",rings:void 0===e.selectedCallFlow.Overflow?3:e.selectedCallFlow.Overflow,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,geoRoute:{routeBy:"",geoList:"",radius:""},scheduleRoute:{timezone:"",default_ringto:"",activate_voicemail:!1,recordCall:!1,playDisclaimer:"before"},TTSWhisperSelected:!0,whisperPrompt:!1,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:"",back_press:""}],e.channels=[{value:1,text:"Online: Paid Search"},{value:2,text:"Online: Organic Search"},{value:3,text:"Online: Display"},{value:4,text:"Online: Email"},{value:5,text:"Offline: Direct Mail"},{value:6,text:"Offline: Magazine"},{value:7,text:"Mobile: Paid Search"},{value:8,text:"Mobile: Organic Search"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],n.getVoicemails(u.currentOUId).then(function(t){if("error"!=t.data.result&&(e.voicemails=t.data.json,e.voicemails))for(var o=0;o<e.voicemails.length;o++)e.voicemails[o].selectedvoicemail=!1}),n.getVoicePrompts(u.currentOUId).then(function(t){if("error"!=t.data.result&&(e.prompts=t.data.json,e.prompts))for(var o=0;o<e.prompts.length;o++)e.prompts[o].selectedprompt=!1}),e.georoutelocations=[],n.getWhispers(u.currentOUId).then(function(t){if("error"!=t.data.result&&(e.whispers=t.data.json,e.whispers))for(var o=0;o<e.whispers.length;o++)e.whispers[o].selectedwhisper=!1}),o.getTags().then(function(t){if(""===t.data.err){for(var o=0;o<t.data.json.length;o++)"callback"===t.data.json[o].tag_name&&(e.callbackid=t.data.json[o].tag_id);if(e.callbackid<0){var a={tag:{tag_name:"callback",org_unit_id:u.currentOUId}};n.createTag(a).then(function(e){console.log(e)})}}});$("#filecontrol");function M(e){return!!/^[0-9]+$/.test(e)}function j(e){var o=!1,a=[];return _.each(e.overflowNumbers,function(i){e.openOverflowBox&&(i.overflowNumber&&10===t.unMaskData(i.overflowNumber).length||(a.push(i.overflowNumber),o=!0))}),o}e.$on("$destroy",function(){u.$emit("stopIvrAudios",{}),void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!=e.outComePromtAudio&&e.outComePromtAudio.pause(),void 0!==e.salesAmountVoiceAudio&&e.salesAmountVoiceAudio.pause(),void 0!=e.AgentIDVoicePromptAudio&&e.AgentIDVoicePromptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.ivrAudio1&&e.ivrAudio1.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),void 0!==e.greetingAudio&&e.greetingAudio.pause(),void 0!==e.calloutcomeAudio&&e.calloutcomeAudio.pause(),void 0!==e.agentidAudio&&e.agentidAudio.pause(),void 0!==e.saleAudio&&e.saleAudio.pause(),void 0!==e.leadAudio&&e.leadAudio.pause(),$("body").removeClass("showScroll")}),e.removeSelectedVoiceAudio=function(t){switch(t){case"voicePromt":void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,e.selectedCallFlow.voiceURL=void 0,e.selectedCallFlow.voicePromptTTSText="",e.TTSSelected=!0,e.hasValidVoiceURL=!1;break;case"voicemailGreetings":void 0!==e.greetingAudio&&e.greetingAudio.pause(),e.greetingAudio=void 0,e.selectedCallFlow.voicemailGreetingsText="",e.selectedCallFlow.voicemailGreetingsTTSText="",e.selectedCallFlow.VoiceMainGreetingURL=void 0,e.TTSvoicemailGreetingsSelected=!0,e.hasValidvoicemailGreetingsURL=!1;break;case"outComePromt":void 0!==e.outComePromtAudio&&e.outComePromtAudio.pause(),e.outComePromtAudio=void 0,e.selectedCallFlow.outComePromtText="",e.selectedCallFlow.outComePromtURL=void 0,e.TTSoutComePromtSelected=!0,e.hasValidoutComePromtURL=!1;break;case"salesAmountVoice":void 0!==e.salesAmountVoiceAudio&&e.salesAmountVoiceAudio.pause(),e.salesAmountVoiceAudio=void 0,e.selectedCallFlow.salesAmountVoicePromptText="",e.selectedCallFlow.salesAmountVoiceURL=void 0,e.TTSsalesAmountVoiceSelected=!0,e.hasValidsalesAmountVoiceURL=!1;break;case"AgentIDVoicePrompt":void 0!==e.AgentIDVoicePromptAudio&&e.AgentIDVoicePromptAudio.pause(),e.AgentIDVoicePromptAudio=void 0,e.selectedCallFlow.AgentIDVoicePromptText="",e.selectedCallFlow.AgentIDVoicePromptURL=void 0,e.TTSAgentIDVoicePromptSelected=!0,e.hasValidAgentIDVoicePromptURL=!1}},e.playTtsVoiceAudio=function(t){void 0===e.ivrAudio||e.ivrAudio.paused?void 0!==e.ivrAudio&&e.ivrAudio.paused?e.ivrAudio.play():t.voicepromptTTSText.length>0?(e.ivrAudio=new Audio,e.onTTS_IVR_Request=!0,n.getTTS(t.voicepromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.ivrAudio.src=o,e.ivrAudio.paused?e.ivrAudio.play():e.ivrAudio.pause()}e.onTTS_IVR_Request=void 0})):(e.ivrAudio=new Audio(t.voicepromptURL),e.ivrAudio.play()):e.ivrAudio.pause()},e.removeSelectedIvrVoiceAudio=function(t){void 0!==e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio=void 0,t.voicepromptURL=void 0,t.voicepromptTTSText="",t.TTSIVRSelected=!0,t.hasValidTTSVoiceURL=!1},e.showIVRVoiceModal=function(t){e.disableBtn=!0,F(),b.open({templateUrl:"assets/partials/assignPrompt.html",controller:"oldVoiceModal",size:t}).result.then(function(){for(var t=0;t<h.prompts.length;t++)!0===h.prompts[t].selectedprompt&&(e.selectedCallFlow.voicepromptText=h.prompts[t].name,e.selectedCallFlow.voicepromptFileName=h.prompts[t].filename,e.selectedCallFlow.voicepromptURL=h.prompts[t].url,e.selectedCallFlow.voicepromptId=h.prompts[t].id);console.log(h.prompts),e.prompts=h.prompts,e.TTSIVRSelected=!1,e.hasValidTTSVoiceURL=!0,e.selectedCallFlow.voicepromptTTSText="",e.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),e.disableBtn=!1})},e.voiceTextIVRChange=function(){e.ivrAudio1=void 0,void 0===e.selectedCallFlow.voicepromptTTSText||0===e.selectedCallFlow.voicepromptTTSText.length?(console.log(e.selectedCallFlow.voicepromptTTSText,"voicepromptTTSText"),e.hasValidTTSVoiceURL=!1,e.TTSIVRSelected=!0):e.chkSpclChar(e.selectedCallFlow.voicepromptTTSText,"Voice Prompt",function(t){e.selectedCallFlow.voicepromptTTSText=t,e.hasValidTTSVoiceURL=!0,e.TTSIVRSelected=!0})},e.removeSelectedIVRVoiceAudio=function(){void 0!==e.ivrAudio1&&e.ivrAudio1.pause(),e.ivrAudio1=void 0,e.selectedCallFlow.voicepromptURL=void 0,e.selectedCallFlow.voicepromptTTSText="",e.TTSIVRSelected=!0,e.hasValidTTSVoiceURL=!1},e.playTTSVoiceAudio=function(t){void 0==e.selectedCallFlow.voicepromptTTSText&&(e.selectedCallFlow.voicepromptTTSText=""),void 0===e.ivrAudio1||e.ivrAudio1.paused?void 0!==e.ivrAudio1&&e.ivrAudio1.paused?e.ivrAudio1.play():e.selectedCallFlow.voicepromptTTSText.length>0?(e.ivrAudio1=new Audio,e.onTTS_IVR_Request=!0,n.getTTS(e.selectedCallFlow.voicepromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.ivrAudio1.src=o,e.ivrAudio1.paused?e.ivrAudio1.play():e.ivrAudio1.pause()}e.onTTS_IVR_Request=void 0})):(e.ivrAudio1=new Audio(e.selectedCallFlow.voicepromptURL),e.ivrAudio1.play()):e.ivrAudio1.pause()},e.showGeLocationVoiceModal=function(t){e.disableBtn=!0,F(),b.open({templateUrl:"assets/partials/assignPrompt.html",controller:"oldVoiceModal",size:t}).result.then(function(){for(var t=0;t<h.prompts.length;t++)!0===h.prompts[t].selectedprompt&&(e.selectedCallFlow.geoLocationPromptText=h.prompts[t].name,e.selectedCallFlow.geoLocationPromptName=h.prompts[t].filename,e.selectedCallFlow.geoLocationPromptURL=h.prompts[t].url,e.selectedCallFlow.geoLocationPromptId=h.prompts[t].id);e.prompts=h.prompts,e.TTGeoloLocationPromptSelected=!1,e.hasValidGeoloLocationPromptURL=!0,e.selectedCallFlow.geoLocationPromptTTSText="",e.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),e.disableBtn=!1})},e.voiceTextGeoLocationPromptChange=function(){e.geoLocationAudio=void 0,void 0===e.selectedCallFlow.geoLocationPromptTTSText||0===e.selectedCallFlow.geoLocationPromptTTSText.length?(e.hasValidGeoloLocationPromptURL=!1,e.TTGeoloLocationPromptSelected=!0):e.chkSpclChar(e.selectedCallFlow.geoLocationPromptTTSText,"Voice Prompt",function(t){e.selectedCallFlow.geoLocationPromptTTSText=t,e.hasValidGeoloLocationPromptURL=!0,e.TTGeoloLocationPromptSelected=!0})},e.playGeoLocationVoiceAudio=function(t){void 0==e.selectedCallFlow.geoLocationPromptTTSText&&(e.selectedCallFlow.geoLocationPromptTTSText=""),void 0===e.geoLocationAudio||e.geoLocationAudio.paused?void 0!==e.geoLocationAudio&&e.geoLocationAudio.paused?e.geoLocationAudio.play():e.selectedCallFlow.geoLocationPromptTTSText.length>0?(e.geoLocationAudio=new Audio,e.onTTS_IVR_Request=!0,n.getTTS(e.selectedCallFlow.geoLocationPromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.geoLocationAudio.src=o,e.geoLocationAudio.paused?e.geoLocationAudio.play():e.geoLocationAudio.pause()}e.onTTS_IVR_Request=void 0})):(e.geoLocationAudio=new Audio(e.selectedCallFlow.geoLocationPromptURL),e.geoLocationAudio.play()):e.geoLocationAudio.pause()},e.removeSelectedGeoloLocationPrompt=function(){void 0!==e.geoLocationAudio&&e.geoLocationAudio.pause(),e.geoLocationAudio=void 0,e.selectedCallFlow.geoLocationPromptURL=void 0,e.selectedCallFlow.geoLocationPromptTTSText="",e.TTGeoloLocationPromptSelected=!0,e.hasValidGeoloLocationPromptURL=!1},e.removeSelectedWhisperAudio=function(){void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,e.selectedCallFlow.whisperURL=void 0,e.selectedCallFlow.whisperTTSText="",e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!1},e.playVoiceAudio=function(t){void 0===e.promptAudio||e.promptAudio.paused?void 0!==e.promptAudio&&e.promptAudio.paused?e.promptAudio.play():void 0!==e.selectedCallFlow.voicePromptTTSText&&e.selectedCallFlow.voicePromptTTSText.length>0?(e.promptAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.voicePromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.promptAudio.src=o,e.promptAudio.paused?e.promptAudio.play():e.promptAudio.pause()}e.onTTS_VP_Request=void 0})):(e.promptAudio=new Audio(t),e.promptAudio.play()):e.promptAudio.pause()},e.playVoiceAudioPromt=function(t,o){switch(o){case"voicemailGreetings":void 0===e.greetingAudio||e.greetingAudio.paused?void 0!==e.greetingAudio&&e.greetingAudio.paused?e.greetingAudio.play():void 0!==e.selectedCallFlow.voicemailGreetingsTTSText&&e.selectedCallFlow.voicemailGreetingsTTSText.length>0&&" "!=e.selectedCallFlow.voicemailGreetingsTTSText?(e.greetingAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.voicemailGreetingsTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.greetingAudio.src=o,e.greetingAudio.paused?e.greetingAudio.play():e.greetingAudio.pause()}e.onTTS_VP_Request=void 0})):(e.greetingAudio=new Audio(t),e.greetingAudio.play()):e.greetingAudio.pause();break;case"outComePromt":void 0===e.outComePromtAudio||e.outComePromtAudio.paused?void 0!==e.outComePromtAudio&&e.outComePromtAudio.paused?e.outComePromtAudio.play():void 0!==e.selectedCallFlow.outComePromtTTSText&&e.selectedCallFlow.outComePromtTTSText.length>0?(e.outComePromtAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.outComePromtTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.outComePromtAudio.src=o,e.outComePromtAudio.paused?e.outComePromtAudio.play():e.outComePromtAudio.pause()}e.onTTS_VP_Request=void 0})):(e.outComePromtAudio=new Audio(t),e.outComePromtAudio.play()):e.outComePromtAudio.pause();break;case"salesAmountVoice":void 0===e.salesAmountVoiceAudio||e.salesAmountVoiceAudio.paused?void 0!==e.salesAmountVoiceAudio&&e.salesAmountVoiceAudio.paused?e.salesAmountVoiceAudio.play():void 0!==e.selectedCallFlow.salesAmountVoiceTTSText&&e.selectedCallFlow.salesAmountVoiceTTSText.length>0?(e.salesAmountVoiceAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.salesAmountVoiceTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.salesAmountVoiceAudio.src=o,e.salesAmountVoiceAudio.paused?e.salesAmountVoiceAudio.play():e.salesAmountVoiceAudio.pause()}e.onTTS_VP_Request=void 0})):(e.salesAmountVoiceAudio=new Audio(t),e.salesAmountVoiceAudio.play()):e.salesAmountVoiceAudio.pause();break;case"AgentIDVoicePrompt":void 0===e.AgentIDVoicePromptAudio||e.AgentIDVoicePromptAudio.paused?void 0!==e.AgentIDVoicePromptAudio&&e.AgentIDVoicePromptAudio.paused?e.AgentIDVoicePromptAudio.play():void 0!==e.selectedCallFlow.AgentIDVoicePromptTTSText&&e.selectedCallFlow.AgentIDVoicePromptTTSText.length>0?(e.AgentIDVoicePromptAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.AgentIDVoicePromptTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.AgentIDVoicePromptAudio.src=o,e.AgentIDVoicePromptAudio.paused?e.AgentIDVoicePromptAudio.play():e.AgentIDVoicePromptAudio.pause()}e.onTTS_VP_Request=void 0})):(e.AgentIDVoicePromptAudio=new Audio(t),e.AgentIDVoicePromptAudio.play()):e.AgentIDVoicePromptAudio.pause()}},e.playWhisperAudio=function(t){void 0===e.whisperAudio||e.whisperAudio.paused?void 0!==e.whisperAudio&&e.whisperAudio.paused?e.whisperAudio.play():void 0!==e.selectedCallFlow.whisperTTSText&&e.selectedCallFlow.whisperTTSText.length>0?(e.whisperAudio=new Audio,e.onTTS_WH_Request=!0,n.getTTS(e.selectedCallFlow.whisperTTSText).then(function(t){if(t.data.json.length>1){var o="data:audio/mp3;base64,"+t.data.json;e.whisperAudio.src=o,e.whisperAudio.play()}e.onTTS_WH_Request=void 0})):(e.whisperAudio=new Audio(t),e.whisperAudio.play()):e.whisperAudio.pause()},e.showChannel=function(t){var o=[];return t&&(o=a("filter")(e.channels,{channel_id:t})),o.length?o[0].sub_category:"--Select--"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeNumber=function(t){void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),void 0!==e.greetingAudio&&e.greetingAudio.pause(),void 0!==e.calloutcomeAudio&&e.calloutcomeAudio.pause(),void 0!==e.agentidAudio&&e.agentidAudio.pause(),void 0!==e.saleAudio&&e.saleAudio.pause(),void 0!==e.leadAudio&&e.leadAudio.pause();var o;o={provisioned_route:{ids:[t.id]}},n.checkOutboundCallerId(t.phone).then(function(e){if("success"===e.data.status){if(parseInt(e.data.json[0].count)>0)t="Are you sure you want to delete this Tracking Number as it is selected as a Caller ID in outbound route?";else var t="Are you sure you want to delete this Tracking Number?";C.confirm(t,function(e){e&&n.removeCallFlow(o).then(function(e){""===e.data.err?(p.notify({title:"Remove Tracking Number",text:"Tracking Number removed successfully.",type:"success"}),c.reload()):p.notify({title:"Remove Tracking Number",text:e.data.err.data?e.data.err.data:e.data.err,type:"error"})})})}})},e.arrRequired=[],e.validateData=function(e,t){if(!e)return"   "},e.isCampaignInReferralStage=!1,e.proceedToSaveTable=function(t){if(e.isCampaignInReferralStage=!1,!0!==e.campActive&&void 0!==e.dateTime.endDate.date&&e.showReferral&&e.referralChecked){var o=e.referralNumber.replace(/\D/g,"");moment(e.dateTime.endDate.date).isBefore(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))&&10===o.length&&(e.isCampaignInReferralStage=!0)}e.date_changed=!1,!0!==e.campActive&&!1===e.isCampaignInReferralStage?C.confirm("Activating Tracking Number will also activate campaign, do you want to continue?",function(o){o?(moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A"))&&(e.dateTime.startDate.date=moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A")),e.dateTime.endDate.date=null,e.date_changed=!0,e.campActive=!0,e.saveTable(t)):(e.showSubmit(),e.showSaveButton())}):e.saveTable(t)},e.saveTable=function(o){if(o.$invalid)return setTimeout(function(){o.$show()},50),!1;var a,i=[],r=[],s=!0!==e.campActive?"inactive":"active",m=!0!==e.campActive?"inactive":"active";!0===e.isCampaignInReferralStage&&(s="referral");for(var g=e.MultCallFlowList.length;g--;){var f,h=[{custom_source_id:e.MultCallFlowList[g].customSourceList_1,custom_source_type:"CS1"},{custom_source_id:e.MultCallFlowList[g].customSourceList_2,custom_source_type:"CS2"},{custom_source_id:e.MultCallFlowList[g].customSourceList_3,custom_source_type:"CS3"},{custom_source_id:e.MultCallFlowList[g].customSourceList_4,custom_source_type:"CS4"},{custom_source_id:e.MultCallFlowList[g].customSourceList_5,custom_source_type:"CS5"}];r.push(e.MultCallFlowList[g].name),e.MultCallFlowList[g].ringto=t.unMaskData(e.MultCallFlowList[g].ringto),console.log(e.MultCallFlowList[g]),f="yes"===e.MultCallFlowList[g].recordcall?"":"2015-02-24 00:00:00",a={provisioned_route:{route_type:"simple",name:e.MultCallFlowList[g].name,org_unit_id:u.currentOUId,repeat_interval:e.MultCallFlowList[g].repeatint,call_value:e.MultCallFlowList[g].value},call_flow:{tracking_number:e.MultCallFlowList[g].number,organizational_unit_id:u.currentOUId,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.MultCallFlowList[g].ringto,route_type:"simple",play_disclaimer:"before",record_until:f,whisper_enabled:"0",whisper_type:"text",whisper_message:" ",message_enabled:"0",message_type:"text",message:" ",status:s,customSourceList:h},channel:{id:e.MultCallFlowList[g].channel}},"inventory"===e.MultCallFlowList[g].source?a.phone_number={id:e.MultCallFlowList[g].numberid,vendor_id:e.MultCallFlowList[g].vendor_id,source:e.MultCallFlowList[g].source,number_ou_id:void 0==e.MultCallFlowList[g].number_ou_id?u.currentOUId:e.MultCallFlowList[g].number_ou_id}:a.phone_number={number:e.MultCallFlowList[g].numberid,vendor_id:e.MultCallFlowList[g].vendor_id,source:e.MultCallFlowList[g].source,number_ou_id:void 0==e.MultCallFlowList[g].number_ou_id?u.currentOUId:e.MultCallFlowList[g].number_ou_id},i.push(a)}var v=r;if(_.uniq(r).length!==v.length)return p.notify({title:"Multiple Tracking Numbers",text:"Duplicate Tracking Number names are not allowed to save.",type:"error"}),setTimeout(function(){o.$show()},50),!1;if(p.notify({title:"Save Tracking Number",text:"Saving....",type:"success"}),e.Id)a={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:m,timezone:u.timezone},call_flows:i},console.log(a),n.createCallFlow(a).then(function(t){""===t.data.err?(p.notify({title:"Multiple Tracking Numbers",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})});else{var b={campaign:{name:e.name,org_unit_id:u.currentOUId,external_id:e.campExtId?e.campExtId:"",start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,status:e.campaignStatus,timezone:u.timezone},call_flows:i};console.log(JSON.stringify(b)),n.createCampaign(b).then(function(t){e.formSubmit=!1,console.log(t),""===t.data.err?(p.notify({title:"Create Campaign",text:"Campaign created successfully.",type:"success"}),d.Id=t.data.json.campaign.campaign_id,l.search("id",d.Id),e.Id=t.data.json.campaign.campaign_id,c.reload()):p.notify({title:"Create Campaign",text:t.data.err,type:"error"})})}},e.loadNextValue=function(t,o,a,i){if("IVR"==e.addCallAction.route_type)"fields"==o?e.ruleDropDown[a][i][o]=Object.keys(e.names.fields):"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum="")),"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="");else{var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],"fields"==o?e.ruleDropDown[a][i][o]=Object.keys(r):"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum="")),"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="")}},e.removeRule=function(t,o){var a,i=Object.keys(e.addCallAction.rule[o]).map(function(e){return e});a=i.indexOf(t)===i.length-1,e.addCallAction.callActionFormSubmitted[o]=!1,delete e.ruleDropDown[o][t],delete e.addCallAction.rule[o][t];var r=Object.keys(e.ruleDropDown[o]).map(function(e){return e}),n=Object.keys(e.ruleDropDown[o][r[0]]).map(function(e){return e});if("IVR"==e.addCallAction.route_type)"join_type"===n[0]&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields&&(e.ruleDropDown[o]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}));else if("join_type"===n[0]&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields)){var s=Object.assign({},e.names.fields);delete s["Ring to Phone Number"],e.ruleDropDown[o]={0:{fields:Object.keys(s)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}}a&&(e.addCallAction.rule[o][t]={},e.ruleDropDown[o][t]={},e.addCallAction.rule[o][t].join_type="",e.ruleDropDown[o][t].join_type=["AND","OR"])},e.getTagClass=function(e){console.log(e)},e.getGeoLocationList=function(){n.getGeoLocations().then(function(t){"error"!=t.data.status&&(e.georoutelocations=[],t.data.json.locations.forEach(function(t){t.count>0&&e.georoutelocations.push({id:t.id,name:t.name,routes:t.routes})}))})},e.saveCallAction=function(t,o){e.disableSaveButton=!0;var a=[],i=[],r=[],s={};e.invalidNumber=!1;var l=!1;t=parseInt(t);if(_.each(e.callActions,function(o){e.errorEmail="";var n,c=1,d=1;switch(e.invalidNumber=!1,e.invalidEmailIds=[],e.errors={},t=o.id,e.errors[t]={},e.addCallAction.actionOptions[t]){case"email_alert":var u=[];void 0===(s=e.addCallAction.email[t])&&(s=[]);for(var m=0;m<s.length;m++){angular.isUndefined(s[m].text)||!s[m].text.length||/^[_a-zA-Z0-9]*['a-zA-Z0-9]*[-a-zA-Z0-9]*[\.a-zA-Z0-9]*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})*(\.[a-zA-Z]{2,4})/.test(s[m].text.trim())||(i.push(s[m].text),e.invalidEmailIds.push(s[m].text)),u.push(s[m].text.trim())}var g=_.uniq(u).join(",");(g=g.replace(/,/g,"")).length>1024&&(e.errorEmail="No of characters should not be greater than 1024"),s=_.uniq(u),e.addCallAction.email[t]=[];var f=Math.floor(1e3+9e3*Math.random());for(m=0;m<s.length;m++){var h={id:m+1+f,text:s[m]};e.addCallAction.email[t].push(h)}e.addCallAction.remainingText[t]=1024-g.length+" characters are remaining";break;case"sms_alert":var v=angular.copy(e.addCallAction.phone[t]);if(v)10!=v.replace(/[()_\-\s]/gi,"").length&&(e.invalidNumber=!0,i.push("Phone Number"));s=e.addCallAction.phone[t];break;case"tag_call":s=e.addCallAction.tagList[t];break;case"post_event":s=e.addCallAction.postEvent[t];break;case"webhook":s=e.addCallAction.webhook[t];break;case"post_detail":s=e.addCallAction.sendCallDetails[t];break;case"callback":s=e.callbackid.toString();break;case"doubleclick":s=void 0!==e.doubleclick_id?e.doubleclick_id:null;break;case"analytic":s=null}if(angular.isArray(s)&&(s=s.join(", ")),U(e.addCallAction.rule[t])&&1===d&&(r.push("Rule"),d+=1),_.each(e.addCallAction.rule[t],function(o,a){(!U(o)&&void 0!==o.fields||!U(o)&&!U(o.join_type))&&((U(o.fields)||U(o.enum)||U(o.operators))&&(U(o.enum)&&(e.errors[t][a]=!0),1===d&&(r.push("Rule"),d+=1)),U(o.enum)||"referring source"!=o.fields||"contains"!=o.operators&&"does not contain"!=o.operators||(o.enum.startsWith("*.")||o.enum.endsWith(".*"))&&(1===c&&(i.push("WildCard only Support With is/is not for referring source."),c+=1),e.errors[t][a]=!0),U(o.enum)||("duration"==o.fields&&!M(o.enum)||"caller id"==o.fields&&(!M(o.enum)||o.enum.length>10))&&(1===c&&(i.push("Rule Value"),c+=1),e.errors[t][a]=!0))}),angular.isArray(s)?U(s)&&r.push("Action"):""!==s&&void 0!==s||r.push("Action"),"action0"==e.addCallAction.actionOptions[t]&&r.push("Action Target"),r.length||i.length||e.errorEmail.length)return l=!0,r.length&&(n="field is required.",r.length>1&&(n="fields are required."),p.notify({title:"Call Action",text:"'"+r.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1),e.errorEmail.length>0&&(p.notify({title:"Call Action",text:e.errorEmail,type:"error"}),e.disableSaveButton=!1),e.invalidEmailIds.length>0?(n="Invalid email address entered. Please fix highlighted errors and re-save",p.notify({title:"Call Action",text:"'"+e.invalidEmailIds.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1):i.length&&(n="field is invalid.",i.length>1&&(n="fields are invalid."),p.notify({title:"Call Action",text:"'"+i.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1),$(".invalidList").css({"background-color":"red",border:"1px solid red"}),i=[],r=[],!1;var b={provisioned_route_id:e.addCallAction.provisioned_route_id,action_id:e.addCallAction.action_id[t],action_order:t,rules:function(t){var o=[],a="";for(var i in t){if("contains"===t[i].operators||"does not contain"===t[i].operators||"begins with"===t[i].operators||"ends with"===t[i].operators?t[i].operators:e.names.Ct_operators[t[i].operators],a="NONE",t[i].join_type.length&&(a=t[i].join_type),"IVR"==e.addCallAction.route_type)t[i].fields&&o.push({data_field:e.names.fields[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a});else{var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],t[i].fields&&o.push({data_field:r[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a})}}return o}(e.addCallAction.rule[t]),action:e.addCallAction.actionOptions[t],action_target:s};a.push(b)}),l)return!1;n.saveBulkCallActions(a).then(function(o){e.addNewStep=!0,"success"===o.data.result?(p.notify({title:"Save Call Action",text:"Successfully saved Call Actions",type:"success"}),e.disableSaveButton=!1,e.addCallAction.action_id[t]=o.data.json.insertId,c.reload()):(p.notify({title:"Save Call Action",text:o.data.err.data,type:"error"}),e.disableSaveButton=!1)})},e.setCreateAnother=function(){e.totalDataRows=parseInt(e.totalDataRows)+1,e.bCreateAnother=!0},e.getCallFlowList=function(t){n.getCampaign(t,e.currentPage).then(function(t){if(t)if("error"!==t.data.result){e.phoneNumbers=[],e.isNew=!0;var o=t.data.json.campaigns[0];e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.selectedCallFlow.num="";var a=[],i=[];e.bCreateAnother=!1,e.selectedCallFlow.id&&(e.selectedCallFlow.id=null),"numberPool"===e.selectedCallFlow.callflowOption&&(e.selectedCallFlow.numberPool=""),o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var o="",r="",n="",s=!1,l=t.status.charAt(0).toUpperCase();t.status=l+t.status.substr(1),t.channels[0]&&(o=t.channels[0].category,r=t.channels[0].sub_category,n=t.channels[0].id),0===a.length?(a.push(t.id),s=!0):-1===a.indexOf(t.id)&&(s=!0,a.push(t.id)),t.phone_numbers[0].number?angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:o+":"+r,channelId:n,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:s}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:o+":"+r,channelId:n,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:s}):void 0!==t.pool&&t.pool.length>0&&-1===i.indexOf(t.pool[0].pool_id)&&(i.push(t.pool[0].pool_id),e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.state,rate_center:t.rate_center,pool_npa:t.poolNPA,pool_nxx:t.poolNXX,name:t.name,channels:o+":"+r,channelId:n,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),route_type:t.route_type,ringto:t.ringto,spam_guard:t.spam_filter_enabled,sms_enabled:!!t.sms_enabled&&t.sms_enabled,showButtons:s}))}}),e.singlecallForm.$setPristine(),e.showSubmit(),console.log("LOADED IN PHONE NUMBERS",e.phoneNumbers)}else"error"===t.data.result&&console.log("ERROR getCampaign CWS")}),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)},e.proceedToCallFlowUpdate=function(){var t,o,a=[],i=[],r=new RegExp(/^[a-z0-9\*]+([\-\.]{1}[a-z0-9\*]+)*\.[a-z\*]{1,5}(:[0-9]{1,5})?(\/.*)?$/i),s=new RegExp(/^[0-9]+$/);if(e.selectedCallFlow.showDNI&&(r.test(e.selectedCallFlow.destination_url)||i.push("Host Domain"),"session"!=e.selectedCallFlow.dniType||s.test(e.selectedCallFlow.dni_ttl)||i.push("TTL"),""!=e.selectedCallFlow.destination_url&&void 0!=e.selectedCallFlow.destination_url||a.push("Host Domain"),""!=e.selectedCallFlow.referrer&&void 0!=e.selectedCallFlow.referrer||a.push("Referring Website"),""!=e.selectedCallFlow.dniType&&void 0!=e.selectedCallFlow.dniType||a.push("DNI Type"),""!=e.selectedCallFlow.dni_element&&void 0!=e.selectedCallFlow.dni_element||a.push("HTML Class"),"session"!=e.selectedCallFlow.dniType||""!=e.selectedCallFlow.dni_ttl&&void 0!=e.selectedCallFlow.dni_ttl||a.push("TTL")),a.length)return t="field is required.",a.length>1&&(t="fields are required."),e.showSubmit(),e.showSaveButton(),void p.notify({title:"Tracking Number Details Form",text:"'"+a.join(", ")+"' "+t,type:"error"});if(i.length)return o="field is invalid.",i.length>1&&(o="fields are invalid."),e.showSubmit(),e.showSaveButton(),void p.notify({title:"Tracking Number Details Form",text:"'"+i.join(", ")+"' "+o,type:"error"});if(e.date_changed=!1,!0===e.cfactive&&!0!==e.campActive)C.confirm("Activating Tracking Number will also activate campaign, do you want to continue?",function(t){t?(moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A"))&&(e.dateTime.startDate.date=moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A")),e.dateTime.endDate.date=null,e.date_changed=!0,e.saveCallFlow()):(e.showSubmit(),e.showSaveButton())});else if(e.isNewCamp||!0===e.cfactive)e.saveCallFlow();else{var l=void 0!=e.selectedCallFlow.phonep?e.selectedCallFlow.phonep.replace(/[&\/\\#,+()$~%'":*?<>{}|-]/g,"").replace(/ +/g,"").toString():e.selectedCallFlow.phonep;n.checkOutboundCallerId(l).then(function(t){if("success"===t.data.status)if(1==e.originalcfactive){if(parseInt(t.data.json[0].count)>0)var o="Are you sure you want to deactivate this Tracking Number as it is selected as a Caller ID in outbound route?";else o="Are you sure you want to deactivate this Tracking Number?";C.confirm(o,function(t){t?e.saveCallFlow():(e.showSubmit(),e.showSaveButton())})}else e.saveCallFlow()})}};var V=function(e){var o=[];return _.each(e,function(e){1==e.TTSIVRSelected?(e.message_type="text",e.message=e.voicepromptTTSText):(e.message_type="file",e.message=e.voicepromptFileName),1==e.TTSWhisperSelected?(e.whisper_message_type="text",e.whisper_message=e.whisperTTSText):(e.whisper_message_type="file",e.whisper_message=e.whisperFileName);var a,i,r={action:e.action,action_order:e.action_order,activateVoiceMail:e.activateVoiceMail,destination:e.destination,id:e.id,ouid:u.currentOUId,level:e.level,record_enabled:e.recordCall,back_press:e.previousmenu,keypress:e.keypress,message:e.message,message_type:e.message_type};if("simple"==e.action||"geo"==e.action||"hangup"==e.action||"schedule"==e.action?(r.whisper_message=e.whisper_message,r.whisper_message_type=e.whisper_message_type,r.whisper_enabled=e.whisperPrompt,r.record_enabled=e.recordCall,r.play_disclaimer=e.playDisclaimer,"schedule"==e.action&&(r.record_enabled=e.scheduleRoute.recordCall,r.play_disclaimer=e.scheduleRoute.playDisclaimer)):(r.whisper_message="",r.whisper_message_type="text",r.whisper_enabled=!1),"interactiveVoice"==e.action){var n=V(e.ivrActions);r.ivrData=n}else if("simple"==e.action){var s=function(e){var o=[];return _.forEach(e.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=t.unMaskData(e.overflowNumber);(!a||a.length<10)&&(isOverflowNumbersValid=!0),o.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),e.overflowNumbers=o,{openOverflowBox:e.openOverflowBox,overflowNumbers:e.overflowNumbers,ringtoNum:t.unMaskData(e.ringtoNum),isSimultaneousRing:e.isSimultaneousRing}}(e);r.ringToData=s}else if("geo"==e.action){var l=function(e){var o=[],a=null;_.forEach(e.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=t.unMaskData(e.overflowNumber);(!a||a.length<10)&&(isOverflowNumbersValid=!0),o.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),e.overflowNumbers=o,e.ringtoNum&&(a=t.unMaskData(e.ringtoNum));var i={openOverflowBox:e.openOverflowBox,overflowNumbers:e.overflowNumbers,isSimultaneousRing:e.isSimultaneousRing,geo_rt:{strategy:e.geoRoute.routeBy},geo_opt:{location_ids:e.geoRoute.geoList,default_ringto:a}};if("Claimed"!==e.geoRoute.routeBy&&"claimedState"!==e.geoRoute.routeBy){var r=e.geoRoute.radius;i.geo_rt.radius=r}return i}(e);r.geoData=l}else if("schedule"==e.action){var c={};c.timezone=e.scheduleRoute.timezone.value,e.scheduleRoute.default_ringto&&(c.default_ringto=t.unMaskData(e.scheduleRoute.default_ringto)),c.activate_voicemail=e.scheduleRoute.activate_voicemail,c.schedules=(a=e.scheduleRoute.scheduleInfo,i=[],_.forEach(a,function(e){var o=[];_.forEach(e.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=t.unMaskData(e.overflowNumber);(!a||a.length<10)&&(isOverflowNumbersValid=!0),o.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}});var a=[];_.forEach(e.days,function(e){""!==e.id&&void 0!==e.id&&a.push({id:e.id})});var r={scheduleId:e.scheduleId,days:a,fromTime:e.fromTime,toTime:e.toTime,overflowNumbers:o,simultaneousRings:e.simultaneousRings,activateVoicemail:e.activateVoicemail,openOverflowBox:e.openOverflowBox};e.ringTo&&(r.ringTo=t.unMaskData(e.ringTo)),i.push(r)}),i),r.scheduleRoute=c}else if("hangup"==e.action){var d={ringtoNum:"hangup"};r.ringToData=d}o.push(r)}),o};e.keycheck=!1,e.isOverlappingSchedules={levelOne:!1,levelTwo:!1,levelThird:!1};var E=function(t,o){for(var a=[],i=[],r=t.length-1;r>=0;r--)if(""!==t[r].keypress&&void 0!==t[r].keypress&&null!==t[r].keypress||a.push("Keypress"),""!==t[r].destination&&void 0!==t[r].destination||a.push("Destination"),""!==t[r].voicepromptTTSText&&void 0!==t[r].voicepromptTTSText||""!==t[r].voicepromptURL&&void 0!==t[r].voicepromptURL||"interactiveVoice"!==t[r].action||a.push("Voice Prompt"),r===t.length-1&&(1===o||""!==t[r].previousmenu&&void 0!==t[r].previousmenu&&null!==t[r].previousmenu||a.push("Go Back to the previous menu")),"interactiveVoice"!==t[r].action){if(t[r].recordCall&&("true"!==t[r].playDisclaimer&&""!==t[r].playDisclaimer&&void 0!==t[r].playDisclaimer||a.push("Play call recording disclaimer")),t[r].whisperPrompt&&(void 0!==t[r].whisperTTSText&&""!==t[r].whisperTTSText||""!==t[r].whisperURL&&void 0!==t[r].whisperURL||a.push("Play whisper message before connecting")),"simple"===t[r].action&&(void 0!==t[r].ringtoNum&&""!==t[r].ringtoNum&&10===t[r].ringtoNum.replace(/[^0-9]+/g,"").length||a.push("Ring to Phone Number")),"geo"===t[r].action&&(""!==t[r].geoRoute.routeBy&&void 0!==t[r].geoRoute.routeBy||a.push("Route By"),""!==t[r].geoRoute.geoList&&void 0!==t[r].geoRoute.geoList||a.push("Location List"),void 0!==t[r].ringtoNum&&""!==t[r].ringtoNum&&10===t[r].ringtoNum.replace(/[^0-9]+/g,"").length||a.push("Default Number"),"Zipcode"!==t[r].geoRoute.routeBy&&"Npa"!==t[r].geoRoute.routeBy||null!==t[r].geoRoute.radius&&""!==t[r].geoRoute.radius&&void 0!==t[r].geoRoute.radius||a.push("Proximity Limit")),"schedule"===t[r].action){t[r].scheduleRoute.isValid&&(1===o?e.isOverlappingSchedules.levelOne=!1:2===o?e.isOverlappingSchedules.levelTwo=!1:e.isOverlappingSchedules.levelThird=!1),""!==t[r].scheduleRoute.timezone&&void 0!==t[r].scheduleRoute.timezone&&null!==t[r].scheduleRoute.timezone||a.push("Time Zone");var n=0;_.each(t[r].scheduleRoute.scheduleInfo,function(i){if(""!==i.fromTime&&void 0!==i.fromTime&&null!==i.fromTime||a.push("FromTime"),""!==i.toTime&&void 0!==i.toTime&&null!==i.toTime||a.push("ToTime"),0===i.days.length&&a.push("Days"),""!==i.ringTo&&void 0!==i.ringTo&&null!==i.ringTo&&10===i.ringTo.replace(/[^0-9]+/g,"").length||a.push("Ring to Phone Number"),_.each(i.overflowNumbers,function(e){!i.openOverflowBox||""!==e.overflowNumber&&void 0!==e.overflowNumber&&null!==e.overflowNumber&&10===e.overflowNumber.replace(/[^0-9]+/g,"").length||a.push("Overflow Ring to Phone Number")}),e.isOverlappingSchedules.levelOne||e.isOverlappingSchedules.levelTwo||e.isOverlappingSchedules.levelThird)return!1;e.checkCurrentIVRSchedule(n,t[r].scheduleRoute.scheduleInfo,o),n+=1})}}else{var s=o+1;E(t[r].ivrActions,s)}for(n=0;n<t.length;n++)t[n].keypress===t[n].previousmenu&&(2==o&&p.notify({title:"2nd Level IVR",text:"keypress and backpress value should not be same",type:"error"}),3==o&&p.notify({title:"3rd Level IVR",text:"keypress and backpress value should not be same",type:"error"}),e.keycheck=!0);if(a.length>0||i.length>0)return r=0,Y(a,i,o)};var Y=function(t,o,a){var i=function(e){var t={},o=[];for(var a in e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t)t[a]>=2&&o.push(a);return o}(t);if(t.length>0){var r=1===t.length&&0===i.length?" field is required.":" fields are required.";t=_.uniq(t),e.IVRInvalidFields.push(t);var n=1==a?"1st":2===a?"2nd":"3rd";return p.notify({title:n+" level IVR Form",text:t.toString()+r,type:"error"}),!1}if(o.length>0){n=1==a?"1st":2===a?"2nd":"3rd";return o=_.uniq(o),e.scheduleInvalidFields.push(o),p.notify({title:n+" level IVR Form",text:o.toString(),type:"error"}),!1}};e.checkSMSFeature=function(t){var o=!1,a="SMS feature will be enabled on the Tracking Number in 4-5 business days";e.isNew&&e.selectedCallFlow.smsActive?(o=!0,a="SMS feature will be enabled on the Tracking Number in 4-5 business days"):e.selectedCallFlow.id&&e.selectedCallFlow.smsActive!==e.selectedCallFlow.oldSmsActive?(o=!0,a=e.selectedCallFlow.smsActive?"SMS feature will be enabled on the Tracking Number in 4-5 business days":"SMS feature will be disabled from the Tracking Number in 4-5 business days"):o=!1,o?C.confirm(a,function(e){t(e||!1)}):t(!0)},e.checkLDM=function(t){var o={trackingNumber:"",ringToNumbers:[]};switch(e.isNew?"reservedNumber"===e.selectedCallFlow.callflowOption?o.trackingNumber=e.selectedCallFlow.num.number.toString():o.trackingNumber=e.selectedCallFlow.address.substring(0,3):o.trackingNumber=e.selectedCallFlow.phonep.replace(/[^0-9]+/g,"").toString(),e.selectedCallFlow.routetype){case"PercentageBasedRoute":e.percentInfo.forEach(function(e){o.ringToNumbers.push(e.ringToNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers.forEach(function(e){o.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))})});break;case"outbound":break;case"voicemail":case"hangup":return void t(!0);case"schedule":for(var a=0;a<e.scheduleInfo.length;a++){var i=[];(i=_.map(e.scheduleInfo[a].overflowNumbers,"overflowNumber")).push(e.scheduleInfo[a].ringTo),i.push(e.selectedCallFlow.ringtoNum),(i=_.compact(i)).forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))})}break;case"ivr":var r=_.sortBy(e.ivrActions,"action_order");if(_.filter(r,function(e){return"hangup"===e.action}).length===r.length)return void t(!0);_.each(r,function(e){if(e.ringtoNum&&o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){o.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),e.scheduleRoute.scheduleInfo&&"schedule"==e.action)for(var t=0;t<e.scheduleRoute.scheduleInfo.length;t++){var a=[];(a=_.map(e.scheduleRoute.scheduleInfo[t].overflowNumbers,"overflowNumber")).push(e.scheduleRoute.scheduleInfo[t].ringTo),a.push(e.scheduleRoute.default_ringto),(a=_.compact(a)).forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))})}e.ivrActions.length>0&&_.each(e.ivrActions,function(e){if(e.ringtoNum&&o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){o.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),e.scheduleRoute.scheduleInfo&&"schedule"==e.action)for(var t=0;t<e.scheduleRoute.scheduleInfo.length;t++){var a=[];(a=_.map(e.scheduleRoute.scheduleInfo[t].overflowNumbers,"overflowNumber")).push(e.scheduleRoute.scheduleInfo[t].ringTo),a.push(e.scheduleRoute.default_ringto),(a=_.compact(a)).forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))})}e.ivrActions&&e.ivrActions.length>0&&_.each(e.ivrActions,function(e){if(o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){o.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),e.scheduleRoute.scheduleInfo&&"schedule"==e.action)for(var t=0;t<e.scheduleRoute.scheduleInfo.length;t++){var a=[];(a=_.map(e.scheduleRoute.scheduleInfo[t].overflowNumbers,"overflowNumber")).push(e.scheduleRoute.scheduleInfo[t].ringTo),a.push(e.scheduleRoute.default_ringto),(a=_.compact(a)).forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))})}})})});break;default:o.ringToNumbers=[e.selectedCallFlow.ringtoNum.replace(/[^0-9]+/g,"")]}e.overflowNumbers&&e.overflowNumbers.forEach(function(e){o.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),n.checkLDM(o).then(function(e){if(e.data.isLDM){var o="The "+e.data.numberType+" you have selected belongs to "+e.data.rateCenter+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes. Click OK to continue.";C.confirm(o,function(e){t(e)})}else t(!0)})},e.saveCallFlow=function(){if(e.IVRInvalidFields=[],e.scheduleInvalidFields=[],e.singlecallForm.$invalid)return e.showSubmit(),void e.showSaveButton();if("schedule"==e.selectedCallFlow.routetype)for(var o=0;o<e.scheduleInfo.length;o++){if(0==e.scheduleInfo[o].days.length)return p.notify({title:"Following a schedule",text:"Please select Schedule Day(s) of the week ",type:"error"}),e.showSubmit(),void e.showSaveButton();if(void 0!==e.selectedCallFlow.num.number&&void 0!=e.selectedCallFlow.num.number&&void 0!=t.unMaskData(e.scheduleInfo[o].ringTo)&&e.selectedCallFlow.num.number===t.unMaskData(e.scheduleInfo[o].ringTo))return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSubmit(),void e.showSaveButton();if(N(o))return void e.checkCurrentSchedule(o)}if("ivr"==e.selectedCallFlow.routetype){if(E(e.ivrActions,1),e.IVRInvalidFields.length>0||e.scheduleInvalidFields.length>0)return e.showSubmit(),void e.showSaveButton();if(e.keycheck)return e.showSubmit(),e.showSaveButton(),void(e.keycheck=!1);if(e.isOverlappingSchedules.levelOne||e.isOverlappingSchedules.levelTwo||e.isOverlappingSchedules.levelThird)return e.showSubmit(),void e.showSaveButton()}var a,i,r,s=null,d=null,m=null,f="",h="",v=null,b="",w="",y=[],S=[],C=[],A={},T=[],D={},I="";if("undefined"==this.selectedCallFlow.value&&(this.selectedCallFlow.value=null),"undefined"==this.selectedCallFlow.rinterval&&(this.selectedCallFlow.rinterval=null),e.selectedCallFlow.ringtoNum=t.unMaskData(e.selectedCallFlow.ringtoNum),e.flowname=this.selectedCallFlow.name,e.category=this.selectedCallFlow.channel.category,e.sub_category=this.selectedCallFlow.channel.sub_category,e.callFlowvalue=this.selectedCallFlow.value,e.callFlowrinterval=this.selectedCallFlow.rinterval,i=!0!==e.campActive?"inactive":"active",e.callFlowstatus=!0!==e.cfactive?"inactive":"active","inactive"===i&&void 0!==e.dateTime.endDate.date&&e.showReferral&&e.referralChecked){console.log("In referral condition **************");var k=e.referralNumber.replace(/\D/g,"");console.log(k.length),moment(e.dateTime.endDate.date).isBefore(moment.tz(u.timezone).format("DD MMMM YYYY hh:mm A"))&&10===k.length&&(e.callFlowstatus="referral")}if(e.browserAgentName=g.navigator.userAgent,e.browserAgentName.indexOf("firefox")>-1&&(I=moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))),e.browserAgentName.indexOf("chrome")>-1&&(I=moment(e.dateTime.startDate.date).isAfter(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))),(null===e.selectedCallFlow.rinterval||void 0===e.selectedCallFlow.rinterval)&&"outbound"!==e.selectedCallFlow.routetype&&"voicemail"!==e.selectedCallFlow.routetype)return e.showSaveButton(),e.isAdvancedTrackingNumbersOpen=!0,void p.notify({title:"Save Tracking Number",text:"Repeat Interval, field is required.",type:"error"});if((null===e.selectedCallFlow.voicemail_rings_count||void 0===e.selectedCallFlow.voicemail_rings_count||0===e.selectedCallFlow.voicemail_rings_count)&&"outbound"!==e.selectedCallFlow.routetype&&"voicemail"!==e.selectedCallFlow.routetype&&"hangup"!==e.selectedCallFlow.routetype&&e.voicemailComponent)return e.showSaveButton(),e.isAdvancedTrackingNumbersOpen=!0,void p.notify({title:"Save Tracking Number",text:"Voicemail rings, field is required.",type:"error"});if(null!==e.dateTime.startDate.date&&I&&1==e.cfactive)return e.showSaveButton(),void p.notify({title:"Save Tracking Number",text:"Cannot activate Tracking Number, Campaign is set to future date.",type:"error"});!0===e.selectedCallFlow.recordCall?r="":(r="2015-02-24 00:00:00",e.selectedCallFlow.playDisclaimer="never"),!0===e.selectedCallFlow.voicePrompt1?(v="1",e.TTSSelected?(b="text",w=e.selectedCallFlow.voicePromptTTSText):(b="file",w=e.selectedCallFlow.voicePromptFileName,T.push(e.selectedCallFlow.voicePromptId))):v="0",!0===e.selectedCallFlow.whisperPrompt1?(m="1",e.TTSWhisperSelected?(f="text",h=e.selectedCallFlow.whisperTTSText):(f="file",h=e.selectedCallFlow.whisperFileName,T.push(e.selectedCallFlow.whisperId))):m="0";var R="text",F="";e.TTSvoicemailGreetingsSelected?(R="text",F=void 0===e.selectedCallFlow.voicemailGreetingsTTSText?"":e.selectedCallFlow.voicemailGreetingsTTSText):(R="file",F=e.selectedCallFlow.voicemailGreetingsFileName);var x,L,O,U,P,M,Y,z,B,q,W,G=[{custom_source_id:e.selectedCallFlow.customSourceList_1,custom_source_type:"CS1"},{custom_source_id:e.selectedCallFlow.customSourceList_2,custom_source_type:"CS2"},{custom_source_id:e.selectedCallFlow.customSourceList_3,custom_source_type:"CS3"},{custom_source_id:e.selectedCallFlow.customSourceList_4,custom_source_type:"CS4"},{custom_source_id:e.selectedCallFlow.customSourceList_5,custom_source_type:"CS5"}],H=[],J=[],Z={},X={},K=!1;if(e.selectedCallFlow.postIVRData={},void 0!==e.userAccess.postcallivr&&e.userAccess.postcallivr>4&&e.postCallIVR){K=!0;var Q="text",ee="text",te="text",oe=e.selectedCallFlow.outComePromtTTSText,ae=e.selectedCallFlow.salesAmountVoiceTTSText,ie=e.selectedCallFlow.AgentIDVoicePromptTTSText,re=e.selectedCallFlow.lengthOfAgentId;switch(e.TTSAgentIDVoicePromptSelected||(te="file",ie=e.selectedCallFlow.AgentIDVoicePromptFileName),e.TTSsalesAmountVoiceSelected||(ee="file",ae=e.selectedCallFlow.salesAmountVoiceFileName),e.TTSoutComePromtSelected||(Q="file",oe=e.selectedCallFlow.outComePromtFileName),e.postIVRType){case"conversion":e.selectedCallFlow.postIVRData={type:"conversion",post_call_ivr_id:e.selectedCallFlow.post_call_ivr_id,prompts:[{type:"record_call_outcome",msgType:Q,promt:oe},{type:"record_a_sale",msgType:ee,promt:ae}]};break;case"agentID":e.selectedCallFlow.postIVRData={type:"agentID",post_call_ivr_id:e.selectedCallFlow.post_call_ivr_id,prompts:[{type:"record_agent_id",msgType:te,noOfDigits:re,promt:ie}]};break;case"conversionAgentID":e.selectedCallFlow.postIVRData={type:"conversionAgentID",post_call_ivr_id:e.selectedCallFlow.post_call_ivr_id,prompts:[{type:"record_call_outcome",msgType:Q,promt:oe},{type:"record_a_sale",msgType:ee,promt:ae},{type:"record_agent_id",msgType:te,noOfDigits:re,promt:ie}]}}}switch(e.selectedCallFlow.routetype){case"geo":var ne=[],se=!1,le=!1;x=e.selectedCallFlow.routetype,d=e.selectedCallFlow.routeBy,e.selectedCallFlow.geoList=e.locObj.id,J.push(e.selectedCallFlow.geoList),X={location_ids:J},Z={strategy:d},"Claimed"!==d&&"claimedState"!==d&&(s=e.selectedCallFlow.radius,Z.radius=s),e.selectedCallFlow.playGeoLocationPrompt&&"claimedState"!==d&&"Npa"!==d?(Z.message_enabled=!0,e.TTGeoloLocationPromptSelected?(Z.message_type="text",Z.message=e.selectedCallFlow.geoLocationPromptTTSText):(Z.message_type="file",Z.message=e.selectedCallFlow.geoLocationPromptName)):(Z.message_enabled=!1,Z.message="");var ce={};if(ce=_.find(e.georoutelocations,function(t){return e.selectedCallFlow.geoList===t.id})){for(var de=0;de<ce.routes.length;de++)if(ce.routes[de].target===e.selectedCallFlow.num.number)return e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),void(le=!0);ce={}}if(e.selectedCallFlow.geoRouteId){var ue=[];ue.push(e.selectedCallFlow.geoRouteId),Z.id=ue}var pe=[],me=[],ge=t.unMaskData(e.selectedCallFlow.ringtoNum);if(_.each(e.overflowNumbers,function(e){var o=t.unMaskData(e.overflowNumber);o===ge&&pe.push(o),ne.push({overflowNumber:e.overflowNumber,unmaskNumber:o,rings:e.rings})}),ge===e.selectedCallFlow.num.number&&me.push(ge),ne.length!=_.uniq(ne,"unmaskNumber").length&&!0===e.isSimultaneousRing&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(pe)||!0!==e.isSimultaneousRing||(e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(me)||(e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),le=!0),se||le)return;break;case"ivr":se=!1;var fe=!1;H={};e.TTSIVRSelected?(H.message_type="text",H.message=e.selectedCallFlow.voicepromptTTSText):(H.message_type="file",H.message=e.selectedCallFlow.voicepromptFileName),e.keypressDuplicateL1=[],e.keypressDuplicateL2=[],e.keypressDuplicateL3=[];var he=!1;if(_.each(e.ivrActions,function(t){e.keypressDuplicateL1.push(t.keypress),_.each(t.ivrActions,function(t){""!==t.keypress&&e.keypressDuplicateL2.push(t.keypress),_.each(t.ivrActions,function(t){""!==t.keypress&&e.keypressDuplicateL3.push(t.keypress)})}),e.keypressL2=_.uniq(e.keypressDuplicateL2),e.keypressL3=_.uniq(e.keypressDuplicateL3),e.keypressL2.length===e.keypressDuplicateL2.length&&e.keypressL3.length===e.keypressDuplicateL3.length||(he=!0),e.keypressDuplicateL2=[],e.keypressDuplicateL3=[],e.keypressL2=[],e.keypressL3=[]}),e.keypressL1=_.uniq(e.keypressDuplicateL1),e.keypressL1.length!==e.keypressDuplicateL1.length&&(he=!0),he)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Multilevel IVR Form",text:"Duplicate Key Press Numbers are not allowed",type:"error"});if(_.each(e.ivrActions,function(o){if(e.overflowNumberDuplicateL1=[],e.duplicateRingToOverflowL1=[],e.duplicateTrackingRingto1=[],e.duplicateTrackingOverflow1=[],_.forEach(o.overflowNumbers,function(a){if(""!==a.overflowNumber&&void 0!==a.overflowNumber){var i=t.unMaskData(a.overflowNumber);i===t.unMaskData(o.ringtoNum)&&e.duplicateRingToOverflowL1.push(i),i===e.selectedCallFlow.num.number&&e.duplicateTrackingOverflow1.push(i),e.overflowNumberDuplicateL1.push({unmaskNumber:i,overflowNumber:a.overflowNumber,rings:a.rings,overflow_order:a.overflow_order})}}),"geo"===o.action){var a={};if(a=_.find(e.georoutelocations,function(e){return parseInt(o.geoRoute.geoList)===e.id})){for(var i=0;i<a.routes.length;i++)if(a.routes[i].target===e.selectedCallFlow.num.number)return e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),void(fe=!0);a={}}}void 0!==e.selectedCallFlow.num.number&&t.unMaskData(o.ringtoNum)===e.selectedCallFlow.num.number&&e.duplicateTrackingRingto1.push(o.ringToNum),e.overflowNumberDuplicateL1.length!=_.uniq(e.overflowNumberDuplicateL1,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateRingToOverflowL1)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateTrackingRingto1)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(e.duplicateTrackingOverflow1)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0),_.each(o.ivrActions,function(o){if(e.overflowNumberDuplicateL2=[],e.duplicateRingToOverflowL2=[],e.duplicateTrackingRingto2=[],e.duplicateTrackingOverflow2=[],_.forEach(o.overflowNumbers,function(a){if(""!==a.overflowNumber&&void 0!==a.overflowNumber){var i=t.unMaskData(a.overflowNumber);i===t.unMaskData(o.ringtoNum)&&e.duplicateRingToOverflowL2.push(i),i===e.selectedCallFlow.num.number&&e.duplicateTrackingOverflow2.push(i),e.overflowNumberDuplicateL2.push({unmaskNumber:i,overflowNumber:a.overflowNumber,rings:a.rings,overflow_order:a.overflow_order})}}),"geo"===o.action){var a={};if(a=_.find(e.georoutelocations,function(e){return parseInt(o.geoRoute.geoList)===e.id})){for(var i=0;i<a.routes.length;i++)if(a.routes[i].target===e.selectedCallFlow.num.number)return e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),void(fe=!0);a={}}}void 0!==e.selectedCallFlow.num.number&&t.unMaskData(o.ringtoNum)===e.selectedCallFlow.num.number&&e.duplicateTrackingRingto2.push(o.ringToNum),e.overflowNumberDuplicateL2.length!=_.uniq(e.overflowNumberDuplicateL2,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateRingToOverflowL2)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateTrackingRingto2)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(e.duplicateTrackingOverflow2)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0),_.each(o.ivrActions,function(o){if(e.overflowNumberDuplicateL3=[],e.duplicateRingToOverflowL3=[],e.duplicateTrackingRingto3=[],e.duplicateTrackingOverflow3=[],_.forEach(o.overflowNumbers,function(a){if(""!==a.overflowNumber&&void 0!==a.overflowNumber){var i=t.unMaskData(a.overflowNumber);i===t.unMaskData(o.ringtoNum)&&e.duplicateRingToOverflowL3.push(i),i===e.selectedCallFlow.num.number&&e.duplicateTrackingOverflow3.push(i),e.overflowNumberDuplicateL3.push({unmaskNumber:i,overflowNumber:a.overflowNumber,rings:a.rings,overflow_order:a.overflow_order})}}),"geo"===o.action){var a={};if(a=_.find(e.georoutelocations,function(e){return parseInt(o.geoRoute.geoList)===e.id})){for(var i=0;i<a.routes.length;i++)if(a.routes[i].target===e.selectedCallFlow.num.number)return e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),void(fe=!0);a={}}}void 0!==e.selectedCallFlow.num.number&&t.unMaskData(o.ringtoNum)===e.selectedCallFlow.num.number&&e.duplicateTrackingRingto3.push(o.ringToNum),e.overflowNumberDuplicateL3.length!=_.uniq(e.overflowNumberDuplicateL3,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateRingToOverflowL3)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(e.duplicateTrackingRingto3)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(e.duplicateTrackingOverflow3)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0)})})}),_.each(e.ivrActions,function(o){_.each(o.scheduleRoute.scheduleInfo,function(a){var i=[],r=[],n=[],s=[],l=t.unMaskData(a.ringTo);_.forEach(a.overflowNumbers,function(o){if(""!==o.overflowNumber&&void 0!==o.overflowNumber){var a=t.unMaskData(o.overflowNumber);a===l&&r.push(a),a===e.selectedCallFlow.num.number&&s.push(a),i.push({unmaskNumber:a,overflowNumber:o.overflowNumber,rings:o.rings,overflow_order:o.overflow_order})}}),void 0!==e.selectedCallFlow.num.number&&t.unMaskData(l)===e.selectedCallFlow.num.number&&n.push(l),i.length!=_.uniq(i,"unmaskNumber").length&&!0===a.simultaneousRings&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(r)||!0!==a.simultaneousRings||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(n)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(s)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"1st level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0)}),_.each(o.ivrActions,function(o){_.each(o.scheduleRoute.scheduleInfo,function(a){var i=[],r=[],n=[],s=[],l=t.unMaskData(a.ringTo);_.forEach(a.overflowNumbers,function(o){if(""!==o.overflowNumber&&void 0!==o.overflowNumber){var a=t.unMaskData(o.overflowNumber);a===l&&r.push(a),a===e.selectedCallFlow.num.number&&s.push(a),i.push({unmaskNumber:a,overflowNumber:o.overflowNumber,rings:o.rings,overflow_order:o.overflow_order})}}),void 0!==e.selectedCallFlow.num.number&&l===e.selectedCallFlow.num.number&&n.push(l),i.length!=_.uniq(i,"unmaskNumber").length&&!0===a.simultaneousRings&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(r)||!0!==a.simultaneousRings||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(n)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(s)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"2nd level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0)}),_.each(o.ivrActions,function(o){_.each(o.scheduleRoute.scheduleInfo,function(a){var i=[],r=[],n=[],s=[],l=t.unMaskData(a.ringTo);_.forEach(a.overflowNumbers,function(o){if(""!==o.overflowNumber&&void 0!==o.overflowNumber){var a=t.unMaskData(o.overflowNumber);a===l&&r.push(a),a===e.selectedCallFlow.num.number&&s.push(a),i.push({unmaskNumber:a,overflowNumber:o.overflowNumber,rings:o.rings,overflow_order:o.overflow_order})}}),void 0!==e.selectedCallFlow.num.number&&l===e.selectedCallFlow.num.number&&n.push(l),i.length!=_.uniq(i,"unmaskNumber").length&&!0===a.simultaneousRings&&"interactiveVoice"!==o.action&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(r)||!0!==a.simultaneousRings||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),_.isEmpty(n)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),fe=!0),_.isEmpty(s)||"interactiveVoice"===o.action||(e.showSaveButton(),e.showSubmit(),p.notify({title:"3rd level IVR Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0)})})})}),se||fe)return;H.ivrActions=V(e.ivrActions),x=e.selectedCallFlow.routetype;break;case"hangup":x="simple",e.selectedCallFlow.ringtoNum="hangup",delete e.selectedCallFlow.overflowNumbers;break;case"simple":if(L=e.overflowNumbers,O=t.unMaskData(e.selectedCallFlow.ringtoNum),U=e.selectedCallFlow.num.number,P=e.isSimultaneousRing,M=[],Y=[],z=[],B=[],q=[],W=!1,e.openOverflowBox&&(_.each(L,function(o){if(e.openOverflowBox){if(""==o.overflowNumber)return p.notify({title:"Tracking Number Details Form",text:"Please enter the Overflow Number!",type:"error"}),W=!0,!0;o.overflowNumber=t.unMaskData(o.overflowNumber),10===o.overflowNumber.length&&"0"!==o.overflowNumber.slice(0,1)||M.push(o.overflowNumber),o.overflowNumber===O&&o.overflowNumber===U?q.push(o.overflowNumber):(o.overflowNumber===O&&z.push(o.overflowNumber),o.overflowNumber===U&&B.push(o.overflowNumber))}}),_.each(L,function(e){var o=t.unMaskData(e.overflowNumber);Y.push({overflowNumber:e.overflowNumber,unmaskNumber:o,rings:e.rings})}),_.isEmpty(q)?(O===U&&(p.notify({title:"Simple Call Route",text:"Ring To number can not be same as tracking number",type:"error"}),W=!0),_.isEmpty(B)||(p.notify({title:"Simple Call Route",text:"Overflow can not be same as tracking number",type:"error"}),W=!0),_.isEmpty(z)||!0!==P||(p.notify({title:"Simple Call Route",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),W=!0)):(p.notify({title:"Simple Call Route",text:"Overflow Numbers and Ring To Number can not be same as Tracking Number",type:"error"}),W=!0),Y.length!=_.uniq(Y,"overflowNumber").length&&!0===P&&(p.notify({title:"Simple Call Route",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),W=!0),M.length>0&&(p.notify({title:"Simple Call Route",text:"Overflow Numbers are not valid",type:"error"}),W=!0),W))return e.showSubmit(),void e.showSaveButton();if(t.unMaskData(e.selectedCallFlow.ringtoNum)===e.selectedCallFlow.num.number)return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSubmit(),void e.showSaveButton();x=e.selectedCallFlow.routetype;break;case"outbound":x=e.selectedCallFlow.routetype,e.selectedCallFlow.showDNI=!1,e.selectedCallFlow.whisperPrompt1=!1,e.selectedCallFlow.spamActive=!1,delete e.selectedCallFlow.value,delete e.selectedCallFlow.rinterval,delete e.selectedCallFlow.voicemail_rings_count,delete e.selectedCallFlow.voicemailGreetingsTTSText,delete e.selectedCallFlow.destination_url,delete e.selectedCallFlow.dniType,delete e.selectedCallFlow.dni_element,delete e.selectedCallFlow.referrer;break;case"PercentageBasedRoute":var ve=[],_e=0,be=!1,we=!1,ye=!1,Se=(se=!1,[]),Ce=[],Ae=_.pluck(e.percentInfo,"ringToNum");_.each(Ae,function(e){Ce.push(t.unMaskData(e))});var Te=function(e){var t={},o=[];for(var a in e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t)t[a]>=2&&o.push(a);return o}(Ce);_.each(Te,function(e){""!==e&&void 0!==e&&Se.push(e)});for(o=0;o<e.percentInfo.length;o++){if(void 0!=e.selectedCallFlow.num.number&&void 0!=t.unMaskData(e.percentInfo[o].ringToNum)&&e.selectedCallFlow.num.number===t.unMaskData(e.percentInfo[o].ringToNum))return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSubmit(),void e.showSaveButton();if(e.percentInfo[o].percentage){_e+=parseInt(e.percentInfo[o].percentage);pe=[];(De=t.unMaskData(e.percentInfo[o].ringToNum))||(we=!0),(!De||De.length<10)&&(be=!0),j(e.percentInfo[o])&&(ye=!0),e.percentInfo[o].unmaskOverflowNumbers=[],_.forEach(e.percentInfo[o].overflowNumbers,function(a){if(""!==a.overflowNumber&&void 0!==a.overflowNumber){var i=t.unMaskData(a.overflowNumber);(!i||i.length<10)&&(ye=!0),i===De&&pe.push(i),i===e.selectedCallFlow.num.number&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0),e.percentInfo[o].unmaskOverflowNumbers.push({unmaskNumber:i,overflowNumber:a.overflowNumber,rings:a.rings,overflow_order:a.overflow_order})}}),e.percentInfo[o].unmaskOverflowNumbers.length!=_.uniq(e.percentInfo[o].unmaskOverflowNumbers,"unmaskNumber").length&&!0===e.percentInfo[o].isSimultaneousRing&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"Percentage Call Route",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(pe)||!0!==e.percentInfo[o].isSimultaneousRing||(e.showSaveButton(),e.showSubmit(),p.notify({title:"Percentage Call Route",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0),ve.push({ringto:t.unMaskData(e.percentInfo[o].ringToNum),percentage:parseInt(e.percentInfo[o].percentage),overflowNumbers:e.percentInfo[o].unmaskOverflowNumbers,activateVoicemail:!!e.percentInfo[o].activateVoicemail&&e.percentInfo[o].activateVoicemail,simultaneousRings:!!e.percentInfo[o].isSimultaneousRing&&e.percentInfo[o].isSimultaneousRing,route_order:e.percentInfo[o].route_order})}}if(_e>100)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"Percentage is greater than 100 ",type:"error"});if(_e<100)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"Percentage is less than 100 ",type:"error"});if(we)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"Ring to Phone Number is required ",type:"error"});if(be)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"Ring to Phone Number is not valid ",type:"error"});if(Se.length>0)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"Duplicate ring to number "+Te.toString(),type:"error"});if(ye)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Percentage Call Route",text:"'Overflow Ring to Phone Numbers' are not valid",type:"error"});if(se)return;e.selectedCallFlow.ringtoNum="",x=e.selectedCallFlow.routetype;break;case"voicemail":x=e.selectedCallFlow.routetype,F=e.selectedCallFlow.voicemailGreetingsTTSText,e.TTSvoicemailGreetingsSelected||(R="file",F=e.selectedCallFlow.voicemailGreetingsFileName);break;case"schedule":x=e.selectedCallFlow.routetype;ye=!1,se=!1;if(void 0!==e.selectedCallFlow.num.number&&t.unMaskData(e.selectedCallFlow.ringtoNum)===e.selectedCallFlow.num.number)return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSubmit(),void e.showSaveButton();for(o=0;o<e.scheduleInfo.length;o++){j(e.scheduleInfo[o])&&(ye=!0);pe=[];var De=t.unMaskData(e.scheduleInfo[o].ringTo);e.scheduleInfo[o].unmaskOverflowNumbers=[],_.forEach(e.scheduleInfo[o].overflowNumbers,function(a){if(""!==a.overflowNumber&&void 0!==a.overflowNumber){var i=t.unMaskData(a.overflowNumber);i===De&&pe.push(i),i===e.selectedCallFlow.num.number&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"Tracking Number Details Form",text:"Overflow Number cannot be same as tracking number.",type:"error"}),se=!0),e.scheduleInfo[o].unmaskOverflowNumbers.push({unmaskNumber:i,overflowNumber:a.overflowNumber,rings:a.rings,overflow_order:a.overflow_order})}}),e.scheduleInfo[o].unmaskOverflowNumbers.length!=_.uniq(e.scheduleInfo[o].unmaskOverflowNumbers,"unmaskNumber").length&&!0===e.scheduleInfo[o].simultaneousRings&&(e.showSaveButton(),e.showSubmit(),p.notify({title:"Schedule Call Route",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),se=!0),_.isEmpty(pe)||!0!==e.scheduleInfo[o].simultaneousRings||(e.showSaveButton(),e.showSubmit(),p.notify({title:"Schedule Call Route",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),se=!0)}if(ye)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"schedule Call Route",text:"'Overflow Ring to Phone Numbers' are not valid",type:"error"});if(se)return}var Ie={};if(e.selectedCallFlow.showDNI){var Ne=e.selectedCallFlow.referrer.split("|"),ke=Ne[0];e.selectedCallFlow.referrer_type=Ne[1],e.selectedCallFlow.referrer_type||(e.selectedCallFlow.referrer_type=null),Ie={provisioned_route_id:e.selectedCallFlow.id,org_unit_id:u.currentOUId,dni_setting_id:e.selectedCallFlow.dni_setting_id,destination_url:e.selectedCallFlow.destination_url,dni_type:e.selectedCallFlow.dniType,dni_element:e.selectedCallFlow.dni_element,referrer:ke,referrer_type:e.selectedCallFlow.referrer_type,dni_ttl:e.selectedCallFlow.dni_ttl};var Re=n.validateDniData(Ie,e.showReferrerTextBox);if(Re.length)return e.showSaveButton(),void p.notify({title:"Save Tracking Number",text:"'"+_.uniq(Re).join(","),type:"error"})}e.checkLDM(function(o){o?e.checkSMSFeature(function(o){if(o){if(p.notify({title:"Save Tracking Number",text:"Saving....",type:"success"}),e.Id){var s={},d=[];if(e.selectedCallFlow.id)if(e.unmaskOverflowNumbers=[],e.overflowNumbers.length>0&&_.forEach(e.overflowNumbers,function(o){if(""!==o.overflowNumber&&void 0!==o.overflowNumber){var a=t.unMaskData(o.overflowNumber);e.unmaskOverflowNumbers.push({unmaskNumber:a,overflowNumber:o.overflowNumber,rings:o.rings,overflow_order:o.overflow_order})}}),0==e.selectedCallFlow.preCallWebhook&&(e.selectedCallFlow.webhook=""),"numberPool"!==e.selectedCallFlow.callflowOption){console.log("Not number pool");if(_.each(e.numList,function(t){t.id===e.selectedCallFlow.phoneid&&t.source}),d.push({provisioned_route:{route_type:x,name:e.selectedCallFlow.name,repeat_interval:"outbound"==e.selectedCallFlow.routetype?0:"voicemail"==e.selectedCallFlow.routetype?72:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:e.selectedCallFlow.org_unit_id,id:e.selectedCallFlow.id,post_IVR_enabled:K},call_flow:{id:e.callFlowId,provisioned_route_id:e.selectedCallFlow.id,tracking_number:e.selectedCallFlow.phone,organizational_unit_id:e.selectedCallFlow.org_unit_id,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,route_type:x,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:m,whisper_type:f,whisper_message:h,message_enabled:v,message_type:b,message:w,record_until:r,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:G,isSimultaneousRing:e.isSimultaneousRing,vm_type:R,vm_enabled:e.selectedCallFlow.activateVoicemail,vm_message:F,hunt_option:e.hunt_option,overflowNumbers:"hangup"===e.selectedCallFlow.routetype||"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.unmaskOverflowNumbers,spam_active:e.selectedCallFlow.spamActive,sms_enabled:e.selectedCallFlow.smsActive,voicemail_rings_count:"outbound"==e.selectedCallFlow.routetype?"3":e.selectedCallFlow.voicemail_rings_count},phone_number:{id:e.selectedCallFlow.phoneid,vendor_id:e.selectedCallFlow.vendor_id,source:"inventory"},channel:{id:e.selectedCallFlow.channel.channel_id}}),K&&(d[0].call_flow.post_IVR_data=e.selectedCallFlow.postIVRData),"ivr"===e.selectedCallFlow.routetype){var T=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];d[0].ivrs=T,d[0].multiIvrs=H}if("simple"===e.selectedCallFlow.routetype&&(d[0].call_flow.dnis_as_cid=e.selectedCallFlow.dnis_as_cid),"PercentageBasedRoute"===e.selectedCallFlow.routetype){d[0].ringto_percentage=ve;for(var I=0;I<d[0].ringto_percentage.length;I++)if(void 0!=e.selectedCallFlow.phone&&void 0!=d[0].ringto_percentage[I].ringto&&e.selectedCallFlow.phone===d[0].ringto_percentage[I].ringto)return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSubmit(),void e.showSaveButton()}"geo"===e.selectedCallFlow.routetype&&(d[0].geo_route=Z,d[0].geo_options=X),"outbound"===e.selectedCallFlow.routetype&&(d[0].provisioned_route.route_type=e.selectedCallFlow.routetype,d[0].provisioned_route.callerid=e.selectedCallFlow.caller_id,d[0].provisioned_route.pin=void 0==e.selectedCallFlow.pin||""==e.selectedCallFlow.pin?null:e.selectedCallFlow.pin.toString().replace(/ +/g,"")),e.selectedCallFlow.showDNI?d[0].dni_setting=Ie:d[0].dni_setting="",console.log(Ie),"schedule"===e.selectedCallFlow.routetype&&(d[0].call_flow.ringto=void 0==d[0].call_flow.ringto?"":d[0].call_flow.ringto,d[0].provisioned_route.schedule_data={},_.each(e.scheduleInfo,function(e){e.ringTo=t.unMaskData(e.ringTo),e.overflowNumbers.length>0&&""!==e.overflowNumbers[0].overflowNumber?_.each(e.overflowNumbers,function(e){e.overflowNumber=t.unMaskData(e.overflowNumber)}):e.overflowNumbers=[]}),d[0].provisioned_route.schedule_data.schedule=e.scheduleInfo,d[0].provisioned_route.schedule_data.timezone=e.selectedCallFlow.timezone.value,d[0].provisioned_route.schedule_data.default_ringto=e.selectedCallFlow.ringtoNum,d[0].provisioned_route.schedule_data.vm_enabled=e.selectedCallFlow.activateVoicemail),s={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:i,timezone:u.timezone},call_flows:d},$(".addTrackingNumbersProgressLoader").show(),n.saveCallFlow(s).then(function(t){$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,console.log("Error Response Save Tracking Number:",JSON.stringify(t.data.err)),""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.isNew=!0,e.selectedCallFlow.callflowOption="singleNumber"):(g.location.href="#/set-campaign-builder?id="+s.campaign.id,c.reload())):p.notify({title:"Updated Tracking Number",text:t.data.err,type:"error"})})}else{var N=e.selectedCallFlow.numberPool-e.oldQuantity;if(console.log(e.selectedCallFlow.id),d.push({number_pool:{id:e.pool_id,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:x,name:e.selectedCallFlow.name,repeat_interval:"outbound"==e.selectedCallFlow.routetype?0:"voicemail"==e.selectedCallFlow.routetype?72:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:e.selectedCallFlow.org_unit_id,id:e.selectedCallFlow.id,post_IVR_enabled:K},call_flow:{id:e.callFlowId,provisioned_route_id:e.selectedCallFlow.id,tracking_number:"",organizational_unit_id:e.selectedCallFlow.org_unit_id,ringto:"Outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,route_type:x,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:m,whisper_type:f,whisper_message:h,message_enabled:v,message_type:b,message:w,record_until:r,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:G,spam_active:e.selectedCallFlow.spamActive,sms_enabled:e.selectedCallFlow.smsActive,isSimultaneousRing:e.isSimultaneousRing,vm_type:R,vm_enabled:e.selectedCallFlow.activateVoicemail,vm_message:F,hunt_option:e.hunt_option,overflowNumbers:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.unmaskOverflowNumbers,voicemail_rings_count:"outbound"==e.selectedCallFlow.routetype?3:e.selectedCallFlow.voicemail_rings_count},channel:{id:e.selectedCallFlow.channel.channel_id}}),K&&(d[0].call_flow.post_IVR_data=e.selectedCallFlow.postIVRData),"ivr"===e.selectedCallFlow.routetype){T=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];d[0].ivrs=T,d[0].multiIvrs=H}if("simple"===e.selectedCallFlow.routetype&&(d[0].call_flow.dnis_as_cid=e.selectedCallFlow.dnis_as_cid),"PercentageBasedRoute"===e.selectedCallFlow.routetype&&(d[0].ringto_percentage=ve),"geo"===e.selectedCallFlow.routetype&&(d[0].geo_route=Z,d[0].geo_options=X),e.selectedCallFlow.showDNI&&(d[0].dni_setting=Ie),"schedule"===e.selectedCallFlow.routetype&&(d[0].call_flow.ringto=void 0==d[0].call_flow.ringto?"":d[0].call_flow.ringto,d[0].provisioned_route.schedule_data={},_.each(e.scheduleInfo,function(e){e.ringTo=t.unMaskData(e.ringTo),e.overflowNumbers.length>0&&""!==e.overflowNumbers[0].overflowNumber?_.each(e.overflowNumbers,function(e){e.overflowNumber=t.unMaskData(e.overflowNumber)}):e.overflowNumbers=[]}),d[0].provisioned_route.schedule_data.schedule=e.scheduleInfo,d[0].provisioned_route.schedule_data.timezone=e.selectedCallFlow.timezone.value,d[0].provisioned_route.schedule_data.default_ringto=e.selectedCallFlow.ringtoNum,d[0].provisioned_route.schedule_data.vm_enabled=e.selectedCallFlow.activateVoicemail),s={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:i,timezone:u.timezone},call_flows:d},e.selectedCallFlow.numberPool-e.oldQuantity>0)if(e.selectedCallFlow.rate_center.length<=0)n.getPhoneNumbers("TOLLFREE","XX","888").then(function(t){if("error"!=t.data.result)if(C.push(t.data.json),0===C.length||C[0].length<e.selectedCallFlow.numberPool-e.oldQuantity)e.formSubmit1=!1,e.showSaveButton(),e.showSubmit(),p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{C=C[0].slice(0,e.selectedCallFlow.numberPool-e.oldQuantity);for(var o=0;o<C.length;o++){var a={};a.number=C[o].number,a.last_used=null,a.vendor_id=C[o].vendor_id,y.push(a)}D={type:"add",quantity:e.selectedCallFlow.numberPool-e.oldQuantity,newNumbers:y,name:e.selectedCallFlow.name,pool_src:"inventory",dni_setting:e.selectedCallFlow.showDNI?Ie:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},$(".addTrackingNumbersProgressLoader").show(),n.updateNumberPool(D,e.pool_id).then(function(t){n.saveCallFlow(s).then(function(t){$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):g.location.href="#/set-campaign-builder?id="+s.campaign.id+"&cfid="+e.selectedCallFlow.id):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}});else{var k="";null===e.rate_center&&""===e.rate_center||n.getThirdPartyNumbers(e.pool_state,e.rate_center).then(function(t){if("error"!==t.data.result&&"fail"!==t.data.json[0]&&C.push(t.data.json),0===C.length||C[0].length<N)e.formSubmit1=!1,e.showSaveButton(),e.showSubmit(),p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{C=C[0].slice(0,e.selectedCallFlow.numberPool-e.oldQuantity),console.log("numbers",C),y=[];for(var o=0;o<C.length;o++){var a={};a.number=C[o].number,a.last_used=null,a.vendor_id=C[o].vendor_id,y.push(a)}D={type:"add",quantity:e.selectedCallFlow.numberPool-e.oldQuantity,newNumbers:y,name:e.selectedCallFlow.name,pool_src:"vendor",dni_setting:e.selectedCallFlow.showDNI?Ie:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},$(".addTrackingNumbersProgressLoader").show(),n.updateNumberPool(D,e.pool_id).then(function(t){t.data.err?($(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"})):n.saveCallFlow(s).then(function(t){e.formSubmit1=!1,$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):g.location.href="#/set-campaign-builder?id="+s.campaign.id+"&cfid="+e.selectedCallFlow.id):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}})}else if(e.selectedCallFlow.numberPool-e.oldQuantity<0){var L="";L=e.selectedCallFlow.rate_center.length<=0?"inventory":"vendor",D={type:"delete",quantity:e.oldQuantity-e.selectedCallFlow.numberPool,name:e.selectedCallFlow.name,newNumbers:[],pool_src:L},$(".addTrackingNumbersProgressLoader").show(),n.updateNumberPool(D,e.pool_id).then(function(t){t.data.err?($(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"})):n.saveCallFlow(s).then(function(t){e.formSubmit1=!1,$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):g.location.href="#/set-campaign-builder?id="+s.campaign.id+"&cfid="+e.selectedCallFlow.id):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}else $(".addTrackingNumbersProgressLoader").show(),n.saveCallFlow(s).then(function(t){e.formSubmit1=!1,$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.selectedCallFlow.callflowOption="numberPool",e.isNew=!0):(g.location.href="#/set-campaign-builder?id="+s.campaign.id,c.reload())):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}else if(d=[],e.unmaskOverflowNumbers=[],e.overflowNumbers.length>0&&_.forEach(e.overflowNumbers,function(o){if(""!==o.overflowNumber&&void 0!==o.overflowNumber){var a=t.unMaskData(o.overflowNumber);e.unmaskOverflowNumbers.push({unmaskNumber:a,overflowNumber:o.overflowNumber,rings:o.rings,overflow_order:o.overflow_order})}}),1==e.selectedCallFlow.vmenabled?e.selectedCallFlow.vmenabled=1:e.selectedCallFlow.vmenabled=0,"numberPool"!==e.selectedCallFlow.callflowOption){if(d.push({provisioned_route:{route_type:x,name:e.selectedCallFlow.name,repeat_interval:"outbound"==e.selectedCallFlow.routetype?0:"voicemail"==e.selectedCallFlow.routetype?72:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId,post_IVR_enabled:K},call_flow:{tracking_number:e.selectedCallFlow.num.number,organizational_unit_id:u.currentOUId,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,route_type:x,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:m,whisper_type:f,whisper_message:h,message_enabled:v,message_type:b,message:w,record_until:r,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:G,spam_active:e.selectedCallFlow.spamActive,sms_enabled:e.selectedCallFlow.smsActive,isSimultaneousRing:e.isSimultaneousRing,vm_type:R,vm_enabled:e.selectedCallFlow.activateVoicemail,vm_message:F,overflowNumbers:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.unmaskOverflowNumbers,voicemail_rings_count:"outbound"==e.selectedCallFlow.routetype?3:e.selectedCallFlow.voicemail_rings_count},channel:{id:e.selectedCallFlow.channel.channel_id}}),K&&(d[0].call_flow.post_IVR_data=e.selectedCallFlow.postIVRData),"inventory"===e.selectedCallFlow.num.source?d[0].phone_number={id:e.selectedCallFlow.num.number_id,vendor_id:e.selectedCallFlow.num.vendor_id,source:void 0==e.selectedCallFlow.num.number_ou_id?"special_inventory":e.selectedCallFlow.num.source,number_ou_id:void 0==e.selectedCallFlow.num.number_ou_id?u.currentOUId:e.selectedCallFlow.num.number_ou_id}:(console.log("inside else",typeof e.selectedCallFlow.num.number_id),d[0].phone_number={number:e.selectedCallFlow.num.number_id,vendor_id:e.selectedCallFlow.num.vendor_id,source:e.selectedCallFlow.num.source,number_ou_id:void 0==e.selectedCallFlow.num.number_ou_id?u.currentOUId:e.selectedCallFlow.num.number_ou_id}),"ivr"===e.selectedCallFlow.routetype){T=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];d[0].ivrs=T,d[0].multiIvrs=H}ve&&(d[0].ringto_percentage=ve),"geo"===e.selectedCallFlow.routetype&&(d[0].geo_route=Z,d[0].geo_options=X),"outbound"===e.selectedCallFlow.routetype&&(d[0].provisioned_route.route_type=e.selectedCallFlow.routetype,d[0].provisioned_route.callerid=e.selectedCallFlow.caller_id,d[0].provisioned_route.pin=void 0==e.selectedCallFlow.pin||""==e.selectedCallFlow.pin?null:e.selectedCallFlow.pin.toString().replace(/ +/g,"")),e.selectedCallFlow.showDNI&&(d[0].dni_setting=Ie),"simple"===e.selectedCallFlow.routetype&&(d[0].call_flow.dnis_as_cid=e.selectedCallFlow.dnis_as_cid),"schedule"===e.selectedCallFlow.routetype&&(d[0].call_flow.ringto=void 0==d[0].call_flow.ringto?"":d[0].call_flow.ringto,d[0].provisioned_route.schedule_data={},_.each(e.scheduleInfo,function(e){e.ringTo=t.unMaskData(e.ringTo),e.overflowNumbers.length>0&&""!==e.overflowNumbers[0].overflowNumber?_.each(e.overflowNumbers,function(e){e.overflowNumber=t.unMaskData(e.overflowNumber)}):e.overflowNumbers=[]}),d[0].provisioned_route.schedule_data.schedule=e.scheduleInfo,d[0].provisioned_route.schedule_data.timezone=e.selectedCallFlow.timezone.value,d[0].provisioned_route.schedule_data.default_ringto=e.selectedCallFlow.ringtoNum,d[0].provisioned_route.schedule_data.vm_enabled=e.selectedCallFlow.activateVoicemail),s={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:i,timezone:u.timezone},call_flows:d},console.log(s),$(".addTrackingNumbersProgressLoader").show(),n.createCallFlow(s).then(function(t){e.showSaveButton(),e.showSubmit(),$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):(e.cfid=l.search().cfid,e.cfid?(l.search(e.cfid,null),g.location.href="#/set-campaign-builder?id="+s.campaign.id):c.reload())):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}else{if(null===e.selectedCallFlow.address||""===e.selectedCallFlow.address)return e.showSaveButton(),e.showSubmit(),void p.notify({title:"Save Tracking Number",text:"Address field is required",type:"error"});if(console.log("selectedCallFlow.address",e.selectedCallFlow.address),e.selectedCallFlow.address.indexOf("TOLLFREE")>0){var O=e.selectedCallFlow.address.split(/,|-/);O.length>2&&("TOLLFREE"===O[1]&&(O[2]="XX"),""!=O[1]&&""!=O[2]&&""!=O[0]&&n.getPhoneNumbers(O[1],O[2],O[0]).then(function(o){if("error"!=o.data.result)if(C.push(o.data.json),0===C.length||C[0].length<e.selectedCallFlow.numberPool)e.formSubmit1=!1,e.showSaveButton(),e.showSubmit(),p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{C=C[0].slice(0,e.selectedCallFlow.numberPool);for(var S=0;S<C.length;S++){var T={};T.number=C[S].number,T.last_used=null,T.vendor_id=C[S].vendor_id,y.push(T)}A={phone_number:y,keep_alive_minutes:null,organizational_unit_id:u.currentOUId,pool_id:null,provisioned_route_id:null,name:e.selectedCallFlow.name,state:k,rate_center:U,pool_src:"inventory",dni_setting:e.selectedCallFlow.showDNI?Ie:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},$(".addTrackingNumbersProgressLoader").show(),n.createNumberPool(A).then(function(o){if(o.data.err)$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:o.data.err,type:"error"});else{if(!0,a=o.data.json[0].pool_id,d.push({number_pool:{id:a,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:x,name:e.selectedCallFlow.name,repeat_interval:"outbound"==e.selectedCallFlow.routetype?0:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId,post_IVR_enabled:K},call_flow:{tracking_number:"",organizational_unit_id:u.currentOUId,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,route_type:x,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:m,whisper_type:f,whisper_message:h,message_enabled:v,message_type:b,message:w,record_until:r,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:G,vm_type:R,vm_enabled:e.selectedCallFlow.activateVoicemail,vm_message:F,spam_active:e.selectedCallFlow.spamActive,sms_enabled:e.selectedCallFlow.smsActive,isSimultaneousRing:e.isSimultaneousRing,hunt_option:e.hunt_option,overflowNumbers:e.unmaskOverflowNumbers,voicemail_rings_count:"outbound"==e.selectedCallFlow.routetype?3:e.selectedCallFlow.voicemail_rings_count},channel:{id:e.selectedCallFlow.channel.channel_id}}),K&&(d[0].call_flow.post_IVR_data=e.selectedCallFlow.postIVRData),"ivr"===e.selectedCallFlow.routetype){d[0].ivrs=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}],d[0].multiIvrs=H}ve&&(d[0].ringto_percentage=ve),"geo"===e.selectedCallFlow.routetype&&(d[0].geo_route=Z,d[0].geo_options=X),e.selectedCallFlow.showDNI&&(d[0].dni_setting=Ie),"simple"===e.selectedCallFlow.routetype&&(d[0].call_flow.dnis_as_cid=e.selectedCallFlow.dnis_as_cid),"schedule"===e.selectedCallFlow.routetype&&(d[0].call_flow.ringto=void 0==d[0].call_flow.ringto?"":d[0].call_flow.ringto,d[0].provisioned_route.schedule_data={},_.each(e.scheduleInfo,function(e){e.ringTo=t.unMaskData(e.ringTo),e.overflowNumbers.length>0&&""!==e.overflowNumbers[0].overflowNumber?_.each(e.overflowNumbers,function(e){e.overflowNumber=t.unMaskData(e.overflowNumber)}):e.overflowNumbers=[]}),d[0].provisioned_route.schedule_data.schedule=e.scheduleInfo,d[0].provisioned_route.schedule_data.timezone=e.selectedCallFlow.timezone.value,d[0].provisioned_route.schedule_data.default_ringto=e.selectedCallFlow.ringtoNum,d[0].provisioned_route.schedule_data.vm_enabled=e.selectedCallFlow.activateVoicemail),s={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:i,timezone:u.timezone},call_flows:d},console.log(s),n.createCallFlow(s).then(function(t){e.formSubmit1=!1,$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):(e.cfid=l.search().cfid,e.cfid?(l.search(e.cfid,null),g.location.href="#/set-campaign-builder?id="+s.campaign.id):c.reload())):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}})}}))}else{$.each(e.rc,function(t,o){o.address===e.selectedCallFlow.address&&-1===S.indexOf(o.rc)&&(S.push(o.rc.trim()),k=o.state.trim())});var U=[];for(I=0;I<S.length;I++)null===S[I]&&""===S[I]||n.getThirdPartyNumbers(k,S[I]).then(function(o){if("error"!==o.data.result&&"fail"!==o.data.json[0]&&C.push(o.data.json),U.push(S.shift()),0==S.length)if(0===C.length||C[0].length<e.selectedCallFlow.numberPool)e.formSubmit1=!1,e.showSaveButton(),e.showSubmit(),p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{C=C[0].slice(0,e.selectedCallFlow.numberPool);for(var T=0;T<C.length;T++){var D={};D.number=C[T].number,D.last_used=null,D.vendor_id=C[T].vendor_id,y.push(D)}A={phone_number:y,keep_alive_minutes:null,organizational_unit_id:u.currentOUId,pool_id:null,provisioned_route_id:null,name:e.selectedCallFlow.name,state:k,rate_center:U,pool_src:"vendor",dni_setting:e.selectedCallFlow.showDNI?Ie:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},$(".addTrackingNumbersProgressLoader").show(),n.createNumberPool(A).then(function(o){if(o.data.err)$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:o.data.err,type:"error"});else{if(!0,a=o.data.json[0].pool_id,d.push({number_pool:{id:a,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:x,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId,post_IVR_enabled:K},call_flow:{tracking_number:"",organizational_unit_id:u.currentOUId,ringto:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.selectedCallFlow.ringtoNum,route_type:x,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:m,whisper_type:f,whisper_message:h,message_enabled:v,message_type:b,message:w,record_until:r,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:G,post_IVR_data:e.selectedCallFlow.postIVRData,vm_type:R,vm_enabled:e.selectedCallFlow.activateVoicemail,vm_message:F,spam_active:e.selectedCallFlow.spamActive,sms_enabled:e.selectedCallFlow.smsActive,isSimultaneousRing:e.isSimultaneousRing,hunt_option:e.hunt_option,overflowNumbers:"outbound"==e.selectedCallFlow.routetype||"voicemail"==e.selectedCallFlow.routetype?"":e.unmaskOverflowNumbers,voicemail_rings_count:"outbound"==e.selectedCallFlow.routetype?3:e.selectedCallFlow.voicemail_rings_count},channel:{id:e.selectedCallFlow.channel.channel_id}}),"ivr"===e.selectedCallFlow.routetype){d[0].ivrs=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}],d[0].multiIvrs=H}ve&&(d[0].ringto_percentage=ve),"geo"===e.selectedCallFlow.routetype&&(d[0].geo_route=Z,d[0].geo_options=X),"simple"===e.selectedCallFlow.routetype&&(d[0].call_flow.dnis_as_cid=e.selectedCallFlow.dnis_as_cid),e.selectedCallFlow.showDNI&&(d[0].dni_setting=Ie),"schedule"===e.selectedCallFlow.routetype&&(d[0].call_flow.ringto=void 0==d[0].call_flow.ringto?"":d[0].call_flow.ringto,d[0].provisioned_route.schedule_data={},_.each(e.scheduleInfo,function(e){e.ringTo=t.unMaskData(e.ringTo),e.overflowNumbers.length>0&&""!==e.overflowNumbers[0].overflowNumber?_.each(e.overflowNumbers,function(e){e.overflowNumber=t.unMaskData(e.overflowNumber)}):e.overflowNumbers=[]}),d[0].provisioned_route.schedule_data.schedule=e.scheduleInfo,d[0].provisioned_route.schedule_data.timezone=e.selectedCallFlow.timezone.value,d[0].provisioned_route.schedule_data.default_ringto=e.selectedCallFlow.ringtoNum,d[0].provisioned_route.schedule_data.vm_enabled=e.selectedCallFlow.activateVoicemail),s={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:i,timezone:u.timezone},call_flows:d},console.log(s),n.createCallFlow(s).then(function(t){e.formSubmit1=!1,$(".addTrackingNumbersProgressLoader").hide(),$("#addTrackingNumbersProgressLoader").css("opacity","1"),""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.selectedCallFlow.callflowlabel="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):(e.cfid=l.search().cfid,e.cfid?(l.search(e.cfid,null),g.location.href="#/set-campaign-builder?id="+s.campaign.id):c.reload())):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}})}})}}}}else e.showSubmit(),e.formSubmit1=!1}):(e.showSubmit(),e.formSubmit1=!1)})},e.dni_settings=[],e.dniReferrer=[{value:"new",text:"Add New"},{value:"*.*|null",text:"Any"},{value:"*.bing.com|null",text:"Bing"},{value:"*.google.*|paid",text:"Google (Paid)"},{value:"*.google.*|organic",text:"Google (Organic)"},{value:"*.yahoo.com|paid",text:"Yahoo (Paid)"},{value:"*.yahoo.com|organic",text:"Yahoo (Organic)"}],e.dniOuId=null,e.showTtl=[],e.dni_type=[{id:"url",text:"URL"},{id:"source",text:"Source"},{id:"session",text:"Session"}]}]),angular.module("old-campaigns-builder",["angularFileUpload","kendo.directives","ui.select2","toggle-switch","angularUtils.directives.dirPagination","api-param","datetime-timezoned","ngTagsInput"]).directive("file",function(){return{scope:{file:"="},link:function(e,t,o){t.bind("change",function(t){var o=t.target.files[0];e.file=o?o.name:void 0,e.$apply()})}}}).factory("OldCampaignWebService",["$q","$timeout","$http","$window","$rootScope","$upload","ApiParam",function(e,t,o,a,i,r,n){"use strict";var s={getCampaigns:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone)+"/pageSize/"+t,n.headerConfig())},getCampaign:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/"+e+"/"+encodeURIComponent(i.timezone),n.headerConfig())},getCampaignsReport:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/reportData/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone),n.headerConfig())},saveBulkCallActions:function(e){var t={method:"POST",url:n.baseURL()+"/v1/callAction/bulk",headers:n.headerConfig().headers,data:e};return o(t)},getCampaignsCallFlowReport:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/campaign/reportData/ouid/"+i.currentOUId+"/userAccess/"+e+"/"+encodeURIComponent(i.timezone),n.headerConfig())},getCampaignCallflows:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaignCallflow",headers:n.headerConfig().headers,data:e};return o(t)},showCall:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaign",headers:n.headerConfig().headers,data:nc};return o(t)},createCampaign:function(e){var t={method:"POST",url:n.baseURL()+"/v1/campaign",headers:n.headerConfig().headers,data:e};return o(t)},createNumberPool:function(e){var t={method:"POST",url:n.baseURL()+"/v1/numberpool",headers:n.headerConfig().headers,data:e};return o(t)},updateNumberPool:function(e,t){var a={method:"PUT",url:n.baseURL()+"/v1/numberpool/"+t,headers:n.headerConfig().headers,data:e};return o(a)},updateCampaign:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/campaign/",headers:n.headerConfig().headers,data:e};return o(t)},setCampaignStatus:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/campaign/status",headers:n.headerConfig().headers,data:e};return o(t)},getPhoneNumbers:function(e,t,a){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/city/"+e+"/state/"+t+"/npa/"+a,n.headerConfig())},getReservedNumbers:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/reserved/"+i.currentOUId,n.headerConfig())},getPhoneNumber:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/number/"+e,n.headerConfig())},createCallFlow:function(e){var t={method:"POST",url:n.baseURL()+"/v1/provisionedroute",headers:n.headerConfig().headers,data:e};return o(t)},saveCallFlow:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/provisionedroute",headers:n.headerConfig().headers,data:e};return o(t)},getGeoCity:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/geolookup/cities/"+e,n.headerConfig())},getGeoZip:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/zip/"+e,n.headerConfig())},getDefaultData:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/defgroupsetting/populatecallflow/"+e,n.headerConfig())},getGeoArea:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/phonenumber/npa/"+e,n.headerConfig())},getCompUsers:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/user/campaignUser/"+e,n.headerConfig())},getCampOwners:function(e,t){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/user/campaignOwner/"+i.currentOUId+"/"+t,n.headerConfig())},getChannels:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/channel",n.headerConfig())},getprovRouteCallFlow:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflow/provisionedroute/"+e,n.headerConfig())},getVoicePrompts:function(e){var t=i.currentOUId;return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+t+"/prompt",n.headerConfig())},getWhispers:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflowrecording/"+e+"/whisper",n.headerConfig())},getTags:function(){return o.get(n.baseURL()+"/v1/tag/"+i.currentOUId,n.headerConfig())},getCustomSources:function(){return o.get(n.baseURL()+"/v1/customsource/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.campaign,n.headerConfig())},getWebhooks:function(){var e=i.currentOUId;return o.get(n.baseURL()+"/v1/webhook/list/"+e,n.headerConfig())},createTag:function(e){var t={method:"POST",url:n.baseURL()+"/v1/tag",headers:n.headerConfig().headers,data:e};return o(t)},createCustomSource:function(e){var t={method:"POST",url:n.baseURL()+"/v1/customsource",headers:n.headerConfig().headers,data:e};return o(t)},uploadVoicePrompt:function(e){var t;if(i.percentage=0,e&&e.length)for(var o=0;o<e.length;o++){var a=e[o];t=r.upload({url:n.baseURL()+"/v1/provisionedroute/prompt",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{name:a.name,org_unit_id:i.currentOUId},file:a}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return t},uploadWhisper:function(e){var t;if(i.percentage=0,e&&e.length)for(var o=0;o<e.length;o++){var a=e[o];t=r.upload({url:n.baseURL()+"/v1/provisionedroute/whisper",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{name:a.name,org_unit_id:i.currentOUId},file:a}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return t},uploadAudio:function(e,t){var o;if(i.percentage=0,e&&e.length)for(var a=0;a<e.length;a++){var s=e[a];o=r.upload({url:n.baseURL()+"/v1/callflowrecording/upload",headers:{Authorization:n.headerConfig().headers.Authorization},fields:{org_unit_id:i.currentOUId,message_type:t},file:s}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return o},saveCallActions:function(e){var t={method:"POST",url:n.baseURL()+"/v1/callAction",headers:n.headerConfig().headers,data:e};return o(t)},updateCallActions:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/callAction",headers:n.headerConfig().headers,data:e};return o(t)},getcallActions:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callAction/byRoute/"+e,n.headerConfig())},removecallActions:function(e){var t={method:"DELETE",url:n.baseURL()+"/v1/callAction/"+e,headers:n.headerConfig().headers};return o(t)},callActionDC:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/doubleclick/callAction/"+e,n.headerConfig())},getThirdPartyNumbers:function(e,t){var a={method:"GET",url:n.baseURL()+"/v1/shoutpoint/rcState/"+encodeURIComponent(t)+"/"+e,headers:n.headerConfig().headers};return o(a)},removeCallFlow:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/provisionedroute/delete",headers:n.headerConfig().headers,data:e};return o(t)},saveBlackList:function(e){var t={method:"POST",url:n.baseURL()+"/v1/blacklist",headers:n.headerConfig().headers,data:e};return o(t)},getBlackList:function(e){var t={method:"GET",url:n.baseURL()+"/v1/blacklist/ouid/"+e,headers:n.headerConfig().headers};return o(t)},deleteAudioFile:function(e){var t={method:"PUT",url:n.baseURL()+"/v1/callflowrecording/delete",headers:n.headerConfig().headers,data:e};return o(t)},getGeoLocations:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/location/ouid/"+i.currentOUId+"/"+encodeURIComponent(i.timezone),n.headerConfig())},getTTS:function(e){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/callflow/getmedia/"+encodeURIComponent(e),n.headerConfig())},getAnalytics:function(){return o.defaults.useXDomain=!0,o.get(n.baseURL()+"/v1/analytic/ouid/"+i.currentOUId+"/includeParentAnalytics/"+!0,n.headerConfig())},validateDniData:function(e,t){var o=[],a=[],i=new RegExp(/^([a-z0-9]+|\*)([\-\.]{1}[a-z0-9]+)*\.([a-z]{1,5}|\*)(:[0-9]{1,5})?(\/.*)?$/i);if(e.destination_url.indexOf("*")>-1&&("*"!=e.destination_url.charAt(0)||"."!=e.destination_url.charAt(1))&&(o.push("Host Domain"),a.push("When using a wildcard at the beginning of a Host Domain, *.domain format is required. Example: *.logmycalls.com")),e.referrer&&t)if(i.test(e.referrer)){var r=e.referrer.split(".");2==r.length&&"*"==r[0]&&"*"!=r[1]&&(o.push("Referring Website"),a.push("Wrong domain format for Referring Website."))}else o.push("Referring Website"),a.push("Wrong domain format for Referring Website.");else e.referrer||a.push("Referring Website field is required.");""!=e.dni_type&&"Select"!=e.dni_type||a.push("DNI Type field is required."),e.dni_element&&("lmc_track"!=e.dni_element||"session"!=e.dni_type&&"source"!=e.dni_type||(o.push("Class"),a.push("The HTML Class ID 'lmc_track' is only allowed for URL-based DNI.")),"lmc_track"!=e.dni_element&&"url"==e.dni_type&&(o.push("Class"),a.push("The HTML Class ID 'lmc_track' is required for URL-based DNI.")),e.dni_element.indexOf(" ")>-1&&(o.push("Class"),a.push("The HTML ID Class must not contain spaces.")));e.destination_url,e.referrer,e.referrer_type,e.dni_element;return a},checkLDM:function(e){var t={method:"POST",url:n.baseURL()+"/v1/ldm",headers:n.headerConfig().headers,data:e};return o(t)}};return s}]).factory("VoicePromptService",["$rootScope","OldCampaignWebService",function(e,t){"use strict";var o=[];return t.getVoicePrompts(e.currentOUId).then(function(e){if("error"!=e.data.result&&(o=e.data.json).length)for(var t=0;t<o.length;t++)o[t].selectedprompt=!1}),{getPrompts:function(){return o},setPrompts:function(e){o=e}}}]).factory("WhisperMessageService",["$rootScope","OldCampaignWebService",function(e,t){"use strict";var o=[];return t.getWhispers(e.currentOUId).then(function(e){if("error"!=e.data.result&&(o=e.data.json).length)for(var t=0;t<o.length;t++)o[t].selectedwhisper=!1}),{getWhispers:function(){return o},setWhispers:function(e){o=e}}}]).controller("oldVoiceModal",["$scope","$rootScope","$window","$uibModalInstance","VoicePromptService","OldCampaignWebService","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){var l=$("#filecontrol");if(e.upload={},e.upload.showme=[],t.prompts=[],e.prompts=[],JSON.parse(o.sessionStorage.prompts).length>0)for(var c=JSON.parse(o.sessionStorage.prompts),d=0;d<c.length;d++)1==c[d].active&&(e.prompts.push(c[d]),t.prompts.push(c[d]));else t.prompts="";e.isFileSelected=function(){return!!e.upload.files},e.useSelectedPrompt=function(e){},e.savePrompt=function(e,t){angular.extend(e,{id:t})},e.addPrompt=function(){e.inserted={id:e.prompts.length+1,name:"",status:null,group:null},e.prompts.push(e.inserted)},e.removePrompt=function(a){var i={id:e.prompts[a].id};e.playvoiceaudio(a,e.prompts[a].url,"pause"),s.confirm("Are you sure you want to delete this Prompt Message?",function(s){s?r.deleteAudioFile(i).then(function(r){if($("body").addClass("modal-open"),"error"!=r.data.result){for(var s=JSON.parse(o.sessionStorage.prompts),l=0;l<s.length;l++)s[l].id==i.id&&(s[l].active=!1);o.sessionStorage.prompts=JSON.stringify(s),t.prompts=s,n.notify({title:"Voice Prompt Message",text:"Voice Prompt Message deleted successfully",type:"success"}),e.prompts.splice(a,1)}else n.notify({title:"Voice Prompt Message",text:"Error Deleting Voice Prompt Message",type:"error"})}):setTimeout(function(){$("body").addClass("modal-open")},100)})},e.uploadFile=function(){var a=e.upload.files;if(e.fileIsUploading=!0,fileExtension=a[0].name.substr((Math.max(0,a[0].name.lastIndexOf("."))||1/0)+1),"mp3"!=fileExtension&&"wav"!=fileExtension&&"mp4"!=fileExtension)return e.fileIsUploading=!1,n.notify({title:"Voice Prompt Upload",text:"Invalid File Type",type:"error"}),!1;r.uploadAudio(a,"prompt").then(function(a){e.fileIsUploading=!1,"error"!=a.data.result?(e.inserted={id:e.prompts.length+1,name:a.data.json.call_flow_recording.url.filename,url:a.data.json.call_flow_recording.url.url,status:null,group:null},e.upload.files=null,r.getVoicePrompts(t.currentOUId).then(function(a){if("error"!=a.data.result){e.prompts=a.data.json;var r=JSON.parse(o.sessionStorage.prompts),n=e.prompts[e.prompts.length-1];if(n.active=!0,r.push(n),o.sessionStorage.prompts=JSON.stringify(r),t.prompts=r,i.setPrompts(e.prompts),e.prompts)for(var s=0;s<e.prompts.length;s++)e.prompts[s].selectedprompt=!1}}),e.param=null,l.replaceWith(l=l.clone(!0))):e.error="Invalid email or password"})},e.removeotherchecks=function(t){for(var o=0;o<e.prompts.length;o++)o!==t&&(e.prompts[o].selectedprompt=!1);i.prompts=e.prompts},e.playvoiceaudio=function(t,o,a){var i;for(var r in void 0===e.audio&&(e.audio=[]),void 0===e.audio[t]&&(e.audio[t]=new Audio(o),e.audio[t].addEventListener("ended",function(){e.upload.showme[t]=!1})),e.audio)r!=t&&(e.audio[r].pause(),e.audio[r].currentTime&&(e.audio[r].currentTime=0),e.upload.showme[r]=!1);switch(a){case"play":e.audio[t].play();break;case"pause":e.audio[t].pause();break;case"rewind":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i-10),e.audio[t].play();break;case"forward":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i+10),e.audio[t].play()}},e.ok=function(){for(var t=!1,o=0;o<e.prompts.length;o++)e.prompts[o].selectedprompt&&(t=!0);if(t){if(e.audio)for(o=0;o<e.audio.length;o++)void 0!==e.audio[o]&&e.audio[o].pause();a.close()}else n.notify({title:"Voice Prompt Message",text:"Please select a Voice Prompt Message",type:"error"})},e.cancel=function(){if(e.audio)for(d=0;d<e.audio.length;d++)void 0!==e.audio[d]&&e.audio[d].pause();a.dismiss("cancel")}}]).controller("oldWhisperModal",["$scope","$rootScope","$window","$uibModalInstance","WhisperMessageService","OldCampaignWebService","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){var l=$("#filecontrol");if(e.upload={},e.upload.showme=[],e.whispers=[],t.whispers=[],JSON.parse(o.sessionStorage.whispers).length>0)for(var c=JSON.parse(o.sessionStorage.whispers),d=0;d<c.length;d++)1==c[d].active&&(e.whispers.push(c[d]),t.whispers.push(c[d]));else t.whispers="";e.isFileSelected=function(){return!!e.upload.files},e.useSelectedWhisper=function(e){},e.saveWhisper=function(e,t){angular.extend(e,{id:t})},e.addWhisper=function(){e.inserted={id:e.whispers.length+1,name:"",status:null,group:null},e.whispers.push(e.inserted)},e.removeWhisper=function(a){var i={id:e.whispers[a].id};e.playvoiceaudio(a,e.whispers[a].url,"pause"),s.confirm("Are you sure you want to delete this Whisper Message?",function(s){s?r.deleteAudioFile(i).then(function(r){if($("body").addClass("modal-open"),"error"!=r.data.result){for(var s=JSON.parse(o.sessionStorage.whispers),l=0;l<s.length;l++)s[l].id==i.id&&(s[l].active=!1);o.sessionStorage.whispers=JSON.stringify(s),t.whispers=s,n.notify({title:"Whisper Message",text:"Whisper Message deleted successfully",type:"success"}),e.whispers.splice(a,1)}else n.notify({title:"Whisper Message",text:"Error Deleting Whisper Message",type:"error"})}):setTimeout(function(){$("body").addClass("modal-open")},100)})},e.uploadFile=function(){var a=e.upload.files;if(e.fileIsUploading=!0,fileExtension=a[0].name.substr((Math.max(0,a[0].name.lastIndexOf("."))||1/0)+1),"mp3"!=fileExtension&&"wav"!=fileExtension&&"mp4"!=fileExtension)return e.fileIsUploading=!1,n.notify({title:"Voice Prompt Upload",text:"Invalid file type.",type:"error"}),!1;r.uploadAudio(a,"whisper").then(function(a){e.fileIsUploading=!1,"error"!=a.data.result?(e.inserted={id:e.whispers.length+1,name:a.data.json.call_flow_recording.url.filename,url:a.data.json.call_flow_recording.url.url,status:null,group:null},e.upload.files=null,r.getWhispers(t.currentOUId).then(function(a){if("error"!=a.data.result){e.whispers=a.data.json;var i=JSON.parse(o.sessionStorage.whispers),r=e.whispers[e.whispers.length-1];if(r.active=!0,i.push(r),o.sessionStorage.whispers=JSON.stringify(i),t.whispers=i,e.whispers)for(var n=0;n<e.whispers.length;n++)e.whispers[n].selectedwhisper=!1}}),e.param=null,l.replaceWith(l=l.clone(!0))):e.error="Invalid email or password"})},e.removeotherchecks=function(t){for(var o=0;o<e.whispers.length;o++)o!==t&&(e.whispers[o].selectedwhisper=!1);i.whispers=e.whispers},e.playvoiceaudio=function(t,o,a){var i;for(var r in void 0===e.audio&&(e.audio=[]),void 0===e.audio[t]&&(e.audio[t]=new Audio(o),e.audio[t].addEventListener("ended",function(){e.upload.showme[t]=!1})),e.audio)r!=t&&(e.audio[r].pause(),e.audio[r].currentTime&&(e.audio[r].currentTime=0),e.upload.showme[r]=!1);switch(a){case"play":e.audio[t].play();break;case"pause":e.audio[t].pause();break;case"rewind":e.audio[t].pause(),i=e.audio[t].currentTime,e.audio[r].currentTime&&(e.audio[t].currentTime=i-10,e.audio[t].play());break;case"forward":e.audio[t].pause(),e.audio[r].currentTime&&(i=e.audio[t].currentTime,e.audio[t].currentTime=i+10),e.audio[t].play()}},e.ok=function(){var t,o=!1;if(e.whispers)for(t=0;t<e.whispers.length;t++)e.whispers[t].selectedwhisper&&(o=!0);if(o){if(e.audio)for(t=0;t<e.audio.length;t++)void 0!==e.audio[t]&&e.audio[t].pause();a.close()}else n.notify({title:"Whisper Message",text:"Please select a Whisper Message",type:"error"})},e.cancel=function(){if(e.audio)for(d=0;d<e.audio.length;d++)void 0!==e.audio[d]&&e.audio[d].pause();a.dismiss("cancel")}}]).factory("SelectedCampaign",function(){"use strict";var e={Id:""};return{getId:function(){return e.Id},setId:function(t){e.Id=t}}}).factory("PhoneList",function(){"use strict";var e=[];return{addtoList:function(t){e.push(t)},getList:function(){return e},clearList:function(){e=[]}}}).controller("CampaignsTableController",["$scope","$rootScope","$filter","OldCampaignWebService","SelectedCampaign","$location","$window","$q","$bootbox","pinesNotifications","ApiParam",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";e.campReportData,e.campaignIds=[],e.showCampaign=!1,e.showCampaignlist=!1,e.currentPage=1,e.pageSize=100,e.CurrentOUName=t.currentOUName,e.CurrentOUNameCSV=e.CurrentOUName+".csv",e.campaginCallFlowHeader=["Name","Campaign Start","Campaign End","Tracking Numbers","Status"],e.actionHeader=["Actions"],e.userId=parseInt(t.userId),t.isSafari=n.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.pageNumber=1;var u="bearer "+n.sessionStorage.token;e.collapse=!1,console.log(d.baseURL()),e.mainGridOptions={dataSource:{type:"json",transport:{read:{url:d.baseURL()+"/v1/campaign/ouid/"+t.currentOUId+"/userAccess/"+e.userAccess.campaign+"/"+encodeURIComponent(t.timezone),beforeSend:function(e){e.setRequestHeader("content-type","application/json"),e.setRequestHeader("Authorization",u)},complete:function(e){},dataType:"json"}},schema:{data:function(e){return e.json.campaigns},total:function(e){return e.json.total}},pageSize:30,serverPaging:!0,serverSorting:!0,serverFiltering:!0},pageable:!0,resizable:!0,columnMenu:!0,filterable:{extra:!1,operators:{string:{startswith:"Starts with",eq:"Is equal to",neq:"Is not equal to"}}},dataBound:function(e){this.expandRow(this.tbody.find("tr.k-master-row").first()),this.collapseRow(this.tbody.find("tr.k-master-row").first()),e.sender.items().each(function(){var t=$(this);0===e.sender.dataItem(t).quantity&&(t.find(".k-hierarchy-cell").html(),$(t).addClass("ready"),t.find(".k-hierarchy-cell").html(""))})},columns:[{field:"",headerTemplate:'<a class="k-icon k-i-expand" id="masterExpand" ng-click="masterexpand()"  aria-label="Expand" tabindex="-1"></a>',width:"50px"},{field:"organizational_unit_id",title:"OUID",filterable:!1,width:"120px"},{field:"organization_unit_name",title:"Group Name",filterable:!1,width:"120px"},{field:"name",title:"Campaign Name",width:"120px"},{field:"start_date",title:"Campaign Start",filterable:!1,width:"120px"},{field:"end_date",title:"Campaign End",filterable:!1,width:"120px"},{field:"quantity",title:"Tracking Number Quantity",filterable:!1,width:"120px"},{field:"status",title:"Campaign Status",filterable:!1,width:"120px",template:"<span class='status'>#= status#</span>"},{field:"campaign_id",title:"Actions",filterable:!1,sortable:!1,template:'<button class="btn btn-sm btn-primary" ng-click="editCampaign(dataItem)">Edit </button>&nbsp;<button class="btn btn-sm btn-danger" ng-click="archiveCampaign(dataItem)" >Archive</button>'}]},e.detailGridOptions=function(e){return{dataSource:{type:"json",transport:{read:{url:d.baseURL()+"/v1/campaignCallflow?campaign_id="+e.campaign_id,beforeSend:function(e){e.setRequestHeader("content-type","application/json"),e.setRequestHeader("Authorization",u)},complete:function(e){console.log(e.responseText)},dataType:"json"}},schema:{data:function(e){return e.json},total:function(e){return e.json.total}},pageSize:50,serverPaging:!0,serverSorting:!0,filter:{field:"campaign_id",operator:"eq",value:e.campaign_id}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"tracking_number",title:"Tracking Number"},{field:"callFlow_name",title:"Name"},{field:"ring_to_number",title:"RingToNumber"},{field:"spam_guard_status",title:"Spam Guard Protection",template:"# if(spam_guard_status) { #<img src='assets/img/spam.jpg' class='spam_gurad' alt='Spam'>#} #"},{field:"Ad_Source",title:"Ad Source"},{field:"status",title:"Status",template:"<span class='status'>#= status#</span>"},{field:"tracking_number",title:"Actions",template:'<button class="btn btn-sm btn-primary" ng-click="editCampaign(dataItem)">Edit </button>&nbsp;<button class="btn btn-sm btn-danger" ng-click="removeCallFlow(dataItem)" >Delete</button>'}]}},e.masterexpand=function(){var t=$("#grid").data("kendoGrid");0==e.collapse?($(".k-master-row").each(function(e){t.expandRow(this)}),$("#masterExpand").attr("class","k-icon k-i-collapse"),e.collapse=!0):($(".k-master-row").each(function(e){t.collapseRow(this)}),$("#masterExpand").attr("class","k-icon k-i-expand"),e.collapse=!1)},e.removeCallFlow=function(e){var t={provisioned_route:{ids:[e.call_flow_id]}};l.confirm("Are you sure you want to delete this Tracking Number?",function(e){e&&a.removeCallFlow(t).then(function(e){""===e.data.err?(c.notify({title:"Remove Tracking Number",text:"Tracking Number removed successfully.",type:"success"}),$route.reload()):c.notify({title:"Remove Tracking Number",text:e.data.err.data,type:"error"})})})},i.Id=null,e.editCampaign=function(e){console.log(e),r.path("/set-campaign-builder"),r.search("id",e.campaign_id)},e.archiveCampaign=function(o){console.log(r);var i=o.name,r=o.campaign_id,n={campaign:{id:r,status:"deleted",org_unit_id:t.currentOUId}},s="";s+="Are you sure you want to archive campaign - "+i+"?",l.confirm(s,function(t){t&&a.setCampaignStatus(n).then(function(t){if("success"===t.data.status){var o=_.findIndex(e.data.rows,function(e){return e[0]===index[0]});e.data.rows.splice(o,1),c.notify({title:"Campaign",text:i+" has been archived.",type:"success"})}else e.error=t})})},e.locate={locationheadings:["Id","Location","Address","City","State","Zip","Phone","Actions"],locations:[["1","LogMyCalls","1664 S. Dixie Dr.","Saint George","UT","84770","6809909123","Delete"],["2","Blue Moon Inn","25 Willow Ln.","Port Costa","CA","94569","9259465638","Delete"],["3","Walnut Creek branch","2705 Main St.","Walnut Creek","CA","94598","9255126685","Delete"],["4","Ocean Gate Shop","321 Mall Dr.","St. George","UT","84790","4356746700","Delete"],["5","South Kings branch","3110 S. Kings Hwy","Nob Hill","CA","94518","9255126225","Delete"]]},e.getHeader=function(){return["Account Name","Account ID","Group Name","Group ID","Group External ID","Group Status","Campaign Name","Campaign ID","Campaign External ID","Campaign Start","Campaign End","Campaign Status","Tracking Number Name","Tracking Number ID","Tracking Number","Ring-to","DNI","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Spam Guard Status"]},e.getCSVData=function(o){var i={},r=s.defer();if(a.getCampaignsCallFlowReport(e.userAccess.campaign).then(function(a){if("error"!=a.data.json){i=a.data.json;for(var n=[],s=0;s<i.length;s++)n.push({a:i[s].account_name,b:i[s].account_id,c:i[s].group_name,d:i[s].group_id,e:i[s].group_external_id,f:i[s].group_status,g:i[s].campaign_name,h:i[s].campaign_id,i:i[s].campaign_external_id,j:i[s].start_date,k:i[s].end_date,l:i[s].campaign_status,m:i[s].tracking_name,n:i[s].tracking_id,o:i[s].tracking_number,p:i[s].ring_to_number,q:i[s].dni,r:i[s].ad_source,s:i[s].custom_source_name1,t:i[s].custom_source_name2,u:i[s].custom_source_name3,v:i[s].custom_source_name4,x:i[s].custom_source_name5,y:i[s].spam_guard});if(console.log(n),r.resolve(n),!t.isSafari)return r.promise;var l=e.CurrentOUName;r.resolve(JSONToCSVConvertor(n,l,!0,o))}}),!t.isSafari)return r.promise},e.exportPDF=function(){$(".buttons").hide();var t=new jsPDF("p","pt","a4");t.addHTML($("#campData"),function(){t.output("datauristring")}),setTimeout(function(){t.save(e.CurrentOUName+".pdf"),$(".buttons").show()},5e3)}}]).controller("OldCampaignFormController",["$scope","$timeout","$http","$uibModal","$location","OldCampaignWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route","DNIWebService","smDateTimePicker",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m){"use strict";if(c.timezone){e.timezoneString=["AT","ET","CT","MT","MT","PT"][["America/Halifax","America/New_York","America/Chicago","America/Denver","America/Phoenix","America/Los_Angeles"].indexOf(c.timezone)],e.timezoneString||(c.timezone="America/New_York",e.timezoneString="ET")}else c.timezone="America/New_York",e.timezoneString="ET";if(1==c.is_migrated||"true"==c.is_migrated){var g=i.url().split("?");"/set-campaign-builder"==i.path()?location.href="#/set-legacy-campaign-builder?"+g[1]:(i.path("/set-campaign-builder"),i.search("id",c.editClickId))}e.dateTime={},e.dateTime.startDate={},e.universalNow=moment.tz(c.timezone),e.dateTime.startDate.minDate=moment.tz(c.timezone),e.dateTime.startDate.date=moment.tz(c.timezone),e.dateTime.startDate.opened=!1,e.dateTime.startDate.isMeridian=!0,e.startOnLoad=!0,e.dateTime.endDate={},e.dateTime.endDate.minDate=moment.tz(c.timezone),e.dateTime.endDate.date=void 0,e.dateTime.endDate.opened=!1,e.dateTime.endDate.isMeridian=!0,e.userAccess.referral&&e.userAccess.referral>4?e.referralSubscription=!0:e.referralSubscription=!1,e.referralNumber=null,e.showReferral=!1,e.disableReferral=!1,e.savingCampaign=!1,e.initiatedAsReferral=!1,e.referralChecked=!1,e.toggleReferralCheckbox=function(){e.disableReferral||(e.referralChecked=!e.referralChecked,e.referralNumber=null)},e.referralClick=function(){e.referralNumber=null},e.toggleReferralContainer=function(t){if(e.showReferral){var o=document.getElementsByClassName("icheckbox_minimal-blue")[0];t?(document.getElementById("referral-container").style.opacity="1",document.getElementById("referral-label").style.cursor="pointer",o.style.cursor="pointer",e.disableReferral=!1):(document.getElementById("referral-container").style.opacity="0.5",document.getElementById("referral-label").style.cursor="not-allowed",o.style.cursor="not-allowed",e.disableReferral=!0)}},e.updateCallFlows=function(){r.getCampaign(e.Id).then(function(t){var o=t.data.json.campaigns[0];console.log("INSIDE updateCallFlows IN campaign.js: Updating $scope.phoneNumbers with:",o),e.phoneNumbers=[],"inactive"===o.status?e.campActive=!1:e.campActive=!0,o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var o="",a="",i="",r=t.status.charAt(0).toUpperCase();t.status=r+t.status.substr(1),t.channels[0]&&(o=t.channels[0].category,a=t.channels[0].sub_category,i=t.channels[0].id),t.phone_numbers[0].number&&(t.pool?e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.pool[0].state,rate_center:t.pool[0].rate_center,name:t.name,channels:o+":"+a,channelId:i,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}):e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:o+":"+a,channelId:i,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}))}})})},e.dniParams=function(t){a.open({templateUrl:"assets/partials/dniParams.html",controller:"DNIModelController",size:t,resolve:{canModify:function(){return 1==e.canModify},callingController:function(){return"campaign"}}})},e.editBlacklist=function(e){a.open({templateUrl:"assets/partials/editBlacklist.html",controller:"BlacklistModalController",size:e})};e.timeManual=!1,e.dateIsNotEditable=!1,e.endDateIsNotEditable=!1,e.endDateIsNotEditable2=!0,e.switchStatus=1,e.switchStatus2=1,e.switchStatus3=1,e.switchStatus4=1,e.switchStatus5=1,e.switchStatus6=1,e.phoneNumbers=[],e.Id=i.search().id;var f,h=i.search().ou_id,v=i.search().level,b=i.search().billing_id,w=i.search().parent_id;void 0===h||angular.isNumber(h)||(c.currentOUId=h,c.$emit("current-ou-updated",{id:parseInt(h),level:parseInt(v),billing_id:parseInt(b),parent_id:parseInt(w)})),e.status=!1,e.selectedChannels=[],e.iStatus=!0,s.clearList(),e.campId="",e.selUsers=[],e.assSalesRep=[],e.Id?e.isNewCamp=!1:e.isNewCamp=!0,e.checkCallFlowIdUrl=function(e){c.$emit("loadCallFlowReceiver",e)},r.getCampOwners(c.currentOUId,e.Id).then(function(t){if("error"!=t.data.result){var o,a,i,r={};t.data.json.forEach(function(e){o=e.org_unit_name,a=e.username,i=e.ct_user_id,void 0===r[o]?r[o]={ouName:o,userList:[{id:i,name:a}]}:r[o].userList.push({id:i,name:a})}),e.ownersPickList=r}}),r.getCompUsers(c.currentOUId).then(function(o){if("error"!=o.data.result){var a,i,n,s={},d=[];if(o.data.json.all_users.forEach(function(e){a=e.org_unit_name,i=e.username,n=e.ct_user_id,void 0===s[a]?s[a]={ouName:a,userList:[{id:n,name:i}]}:s[a].userList.push({id:n,name:i})}),e.Id||null===o.data.json.added_users[0].users_list||(d=o.data.json.added_users[0].users_list.split(",")),e.assUserPickList=s,e.Id)return r.getCampaign(e.Id);e.campActive=!0,e.iStatus=!0,l.sessionStorage&&"4"!==l.sessionStorage.roleId&&!c.partnerConvirzaAdmin&&(e.assSalesRep=l.sessionStorage.userId),e.canModify=!0,t(function(){e.selUsers=d},100)}}).then(function(t){if(t){if("error"===t.data.result)return d.notify({title:"Campaign",text:t.data.err,type:"error"}),!1;if("error"!==t.data.result){console.log("Loading in Campaign",t.data.json);var o=t.data.json.campaigns[0];e.name=o.name,e.campId=o.campaign_id,e.campExtId=o.campaign_ext_id;var a=[];null===(f=o.status)||"inactive"===f||"referral"===f?(e.campActive=!1,e.iStatus=!1,e.endDateIsNotEditable=!0):(e.campActive=!0,e.iStatus=!0),o.referral_number&&(e.showReferral=!0,e.loadingInCampaign=!0,e.referralNumber=o.referral_number,e.referralChecked=!0),e.dateTime.startDate.date=moment(o.start_date),e.dateTime.startDate.minDate=moment(o.start_date),null==o.end_date?(e.dateTime.endDate.date=void 0,e.endDateIsNotEditable2=!0):(e.dateTime.endDate.date=moment(o.end_date),e.dateTime.endDate.minDate=moment.tz(c.timezone)),e.campEnd=o.end_date,e.editOnLoad=!0,e.dateTime.startDate.date.isBefore(moment.tz(c.timezone))&&(e.dateIsNotEditable=!0),o.users.forEach(function(t){e.selUsers.push(t.id)});var r="";_.each(e.ownersPickList,function(e){0===r.length&&(r=_.where(e.userList,{id:o.owner_user_id}))}),r.length>0&&(e.assSalesRep=o.owner_user_id),(o.owner_user_id==l.sessionStorage.userId||e.userAccess.campaign>6)&&(e.canModify=!0);var n=0;if(o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var i="",r="",s="",l=!1,d=t.status.charAt(0).toUpperCase();t.status=d+t.status.substr(1),t.channels[0]&&(i=t.channels[0].category,r=t.channels[0].sub_category,s=t.channels[0].id),0===a.length?(a.push(t.id),l=!0):-1===a.indexOf(t.id)&&(l=!0,a.push(t.id)),t.phone_numbers[0].number&&l?angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:i+":"+r,channelId:s,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,routetype:t.route_type,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.pool[0].state,rate_center:t.pool[0].rate_center,name:t.name,channels:i+":"+r,channelId:s,status:t.status,routetype:t.route_type,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}):l&&(angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:i+":"+r,channelId:s,status:t.status,routetype:t.route_type,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.pool[0].state,rate_center:t.pool[0].rate_center,name:t.name,channels:i+":"+r,channelId:s,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,routetype:t.route_type,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY"),webhook_id:t.webhook_id}))}if(++n==o.provisioned_routes.length&&u.current.params.prov_id){var p=parseInt(u.current.params.prov_id),m=_.find(e.phoneNumbers,function(e){return p===e.id});c.$emit("loadCallFlowReceiver",m),setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},150)}}),e.loadingInCampaign=!1,e.cfid=i.search().cfid,e.cfid){var s=_.findLastIndex(e.phoneNumbers,{id:parseInt(e.cfid)});s>-1&&e.checkCallFlowIdUrl(e.phoneNumbers[s])}}else"error"===t.data.result&&console.log("ERROR getCampaign CWS")}}),e.saveCampaign=function(){if(e.savingCampaign=!0,!e.name)return d.notify({title:"Campaign Details",text:"Campaign name should not be empty.",type:"error"}),void(e.savingCampaign=!1);if(!e.assSalesRep||!e.assSalesRep.toString().length)return d.notify({title:"Campaign Details",text:"Campaign owner should not be empty.",type:"error"}),void(e.savingCampaign=!1);if(e.dateTime.endDate.date&&moment(e.dateTime.startDate.date).isAfter(e.dateTime.endDate.date))return d.notify({title:"Campaign Details",text:"Campaign end date should not be before campaign start date.",type:"error"}),void(e.savingCampaign=!1);if(moment(e.dateTime.startDate.date).isBefore(e.universalNow.format("DD-MMMM-YYYY hh:mm A"))&&!e.dateIsNotEditable)return d.notify({title:"Campaign Details",text:"Campaign start date should not be before current time: "+e.universalNow.format("DD-MMMM-YYYY hh:mm A")+" ("+e.timezoneString+" )",type:"error"}),void(e.savingCampaign=!1);if(e.dateTime.endDate.date&&moment(e.dateTime.endDate.date).isBefore(e.universalNow.format("DD-MMMM-YYYY hh:mm A"))&&!e.endDateIsNotEditable&&(e.dateTime.endDate.date=e.universalNow),e.showReferral&&e.referralChecked){if(!e.referralNumber)return angular.element("#referralNumber").addClass("ng-invalid ng-dirty"),angular.element("#referralNumber").removeClass("ng-valid"),d.notify({title:"Referral Phone Number",text:"Referral phone number is not a valid phone number.",type:"error"}),void(e.savingCampaign=!1);var t=e.referralNumber.replace(/\D/g,"");if(10!==t.length)return angular.element("#referralNumber").addClass("ng-invalid ng-dirty"),angular.element("#referralNumber").removeClass("ng-valid"),d.notify({title:"Referral Phone Number",text:"The referral phone number specified is not a valid phone number. Please try again.",type:"error"}),void(e.savingCampaign=!1)}var o;o=e.campActive?"active":"inactive";var a={campaign:{name:e.name,org_unit_id:parseInt(c.currentOUId),external_id:e.campExtId?e.campExtId:"",status:o,start_date:e.dateTime.startDate.date?moment(e.dateTime.startDate.date).format("YYYY-MM-DD HH:mm"):null,end_date:e.dateTime.endDate.date?moment(e.dateTime.endDate.date).format("YYYY-MM-DD HH:mm"):null,timezone:c.timezone,owner_user_id:e.assSalesRep},referral:{pnumber:null}};e.showReferral&&e.referralChecked&&e.referralSubscription&&(a.referral.pnumber=t),e.Id?(a.campaign.id=parseInt(e.Id),console.log("INSIDE saveCampaign IN campaign.js: Updating campaign with:",a),r.updateCampaign(a).then(function(t){console.log("updateCampaign .result= ",t),e.formSubmit=!1,console.log("INSIDE saveCampaign IN campaign.js: Result of update:",t),""===t.data.err?(e.Id=t.data.json.campaign.id,d.notify({title:"Update Campaign",text:"Campaign updated successfully.",type:"success"}),console.log("CALLING UPDATE Tracking Numbers"),e.updateCallFlows()):d.notify({title:"Update Campaign",text:t.data.err,type:"error"}),e.savingCampaign=!1})):(console.log("INSIDE saveCampaign IN campaign.js: Creating campaign with:",a),r.createCampaign(a).then(function(t){console.log("INSIDE saveCampaign IN campaign.js: Result of creation:",t),""===t.data.err?(n.Id=t.data.json.campaign.campaign_id,i.search("id",n.Id),e.Id=n.Id,d.notify({title:"Create Campaign",text:"Campaign created successfully.",type:"success"})):d.notify({title:"Create Campaign",text:t.data.err,type:"error"}),e.savingCampaign=!1}))},e.colorPicked="#fa4d4d",e.select2RemoteOptions={placeholder:"Search for a movie",minimumInputLength:3,width:"resolve",ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t,apikey:"8vzys3eka2s9hpvkh7wwzp7e"}},results:function(e,t){var o=10*t<e.total;return{results:e.movies,more:o}}},formatResult:function(e){var t="<table class='movie-result'><tr>";return void 0!==e.posters&&void 0!==e.posters.thumbnail&&(t+="<td class='movie-image'><img src='"+e.posters.thumbnail+"'/></td>"),t+="<td class='movie-info'><div class='movie-title'>"+e.title+"</div>",void 0!==e.critics_consensus?t+="<div class='movie-synopsis'>"+e.critics_consensus+"</div>":void 0!==e.synopsis&&(t+="<div class='movie-synopsis'>"+e.synopsis+"</div>"),t+="</td></tr></table>"},formatSelection:function(e){return e.title},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}},e.select2={multiple:!0,allowClear:!0},e.multiSelect1=[],e.multiSelect2=[],e.toggleCallFlow=function(){e.cfactive?e.originalcfactive=!1:e.originalcfactive=!0},e.activeToggle=function(){e.campActive?(e.dateTime.startDate.minDate=moment.tz(c.timezone),e.dateTime.startDate.date=moment.tz(c.timezone),e.dateIsNotEditable=!1,e.endDateIsNotEditable=!1,e.dateTime.endDate.minDate=moment.tz(c.timezone),e.dateTime.endDate.date=null,angular.element("#end-date-picker md-input-container").removeClass("md-input-has-value"),e.referralChecked=!1,e.referralNumber=null):(e.ignoreEndDateWatch=!0,e.dateTime.endDate.minDate=moment.tz(c.timezone),console.log("ACTIVE TOGGLE END DATE"),e.dateTime.endDate.date=moment.tz(c.timezone),e.endDateIsNotEditable=!0,e.dateIsNotEditable=!0,e.referralChecked=!1,e.referralNumber=null)},e.$watch("dateTime.startDate.date",function(t,o){e.formSubmit=!1,e.submitted=!1}),e.$watch("dateTime.endDate.date",function(t,o){e.dateTime.endDate.date&&angular.element("#end-date-picker md-input-container").addClass("md-input-has-value"),e.loadingInCampaign||(e.dateTime.endDate.date&&e.referralSubscription?(e.showReferral=!0,moment(e.dateTime.endDate.date).isBefore(moment.tz(c.timezone).format("DD-MMMM-YYYY hh:mm A"))&&!e.ignoreEndDateWatch?e.campActive&&e.toggleReferralContainer():e.toggleReferralContainer(!0)):!e.dateTime.endDate.date&&e.referralSubscription&&(e.showReferral=!1)),e.ignoreEndDateWatch&&(e.ignoreEndDateWatch=!1),e.formSubmit=!1,e.submitted=!1,e.dateTime.endDate.date?e.endDateIsNotEditable2=!1:e.endDateIsNotEditable2=!0}),e.dateTime.dateOptions={formatYear:"yy",startingDay:1},e.dateTime.format="dd-MMMM-yyyy",e.dateTime.timeStepH=1,e.dateTime.timeStepM=30,e.dateTime.timeOptions={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.dateTime.today=function(e){new Date},e.dateTime.clear=function(e){null},e.dateTime.toggleMinDate=function(e){e=e?null:new Date},e.dateTime.toggleMeridian=function(e){e=!e},e.dateTime.open=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0}}]).controller("BlacklistController",["$scope","$http","$location","OldCampaignWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route",function(e,t,o,a,i,r,n,s,l,c){"use strict";void 0!==s.protect_caller_id&&!0!==s.protect_caller_id&&"true"!==s.protect_caller_id||(location.href="#/access-denied"),a.getBlackList(s.currentOUId).then(function(t){if(console.log(t),"error"!=t.data.result){var o=[];angular.forEach(t.data.json,function(e){o.push(e.number)}),e.search={number:o.join(",")}}}),e.option={words:["1234567890"],color:"yellow"},e.highlightString=function(){$("#txtNumber").highlightTextarea("destroy");var t=[e.search.text];$("#txtNumber").highlightTextarea({words:t})},e.validateBlaclistNumbers=function(){var t,o=e.search.number;""!==o&&void 0!==o&&(t=o.split(","));var a=!1,i=[];if(angular.isArray(t)&&(t.forEach(function(e){((e=e.trim()).length<10||isNaN(e)||e.length>10)&&i.push(e)}),i.length)){a=!0;var r="is invalid Phone Number.";i.length>1&&(r="are invalid Phone Number."),l.notify({title:"Blacklist Phone Number",text:"'"+i.join(", ")+"' "+r,type:"error"})}return a},e.saveBlacklist=function(){var t=e.search.number;t=t.replace(/ /g,"");var o={blacklist:{org_unit_id:s.currentOUId,numbers:t}};e.validateBlaclistNumbers()||a.saveBlackList(o).then(function(t){console.log(t),"error"!=t.data.result&&(a.getBlackList(s.currentOUId).then(function(t){if("error"!=t.data.result){var o=[];angular.forEach(t.data.json,function(e){o.push(e.number)}),e.search={number:o.join(",")}}}),l.notify({title:"Blacklist Phone Number",text:"Successfully Saved BlackList",type:"success"}))})}}]).controller("DNIModelController",["$scope","$http","$uibModalInstance","$location","OldCampaignWebService","OrgUnitWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route","DNIWebService","canModify","callingController",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g){"use strict";e.dni={},e.canModify=m,e.callingController=g,"campaign"===g?p.getDniCustomParameters(c.currentOUId).then(function(t){if(e.dni.dni_org_unit_id=null,t.data.json[0].custom_params)e.dni.custom_params=t.data.json[0].custom_params,e.dni.dniOuId=t.data.json[0].dni_org_unit[0].org_unit_id,e.dni.dni_org_unit_id=t.data.json[0].dni_org_unit[0].dni_org_unit_id;else{var o={dniOrgUnit:{org_unit_id:c.currentOUId}};p.createDniOUData(o).then(function(t){e.dni.dni_org_unit_id=t.data.json.insertId})}}):r.getDefaultCustomParams(c.currentOUId).then(function(t){t.data.json[0].custom_params&&(e.dni.custom_params=t.data.json[0].custom_params)}),e.cancel=function(){o.dismiss("cancel")},e.saveParams=function(){var t=e.dni.custom_params,a={dniOrgUnit:{custom_params:t=void 0==t?"":(t=(t=(t=t.replace(/\s/g,"")).split(",")).filter(function(e){return""!==e})).join(","),org_unit_id:c.currentOUId}};"campaign"===g?p.updateDniOUData(a).then(function(o){e.dni.custom_params=t,d.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"})}):r.createDefaultCustomParams(a).then(function(o){e.dni.custom_params=t,d.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"})}),o.close()}}]).controller("BlacklistModalController",["$scope","$http","$uibModalInstance","$location","OldCampaignWebService","SelectedCampaign","PhoneList","$window","$rootScope","pinesNotifications","$route",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";i.getBlackList(l.currentOUId).then(function(t){console.log(t),"error"!=t.data.result&&(e.search={number:t.data.json})}),e.option={words:["1234567890"],color:"yellow"},e.highlightString=function(){$("#txtNumber").highlightTextarea("destroy");var t=[e.search.text];$("#txtNumber").highlightTextarea({words:t})},e.cancel=function(){o.dismiss("cancel")},e.validateModalBlaclistNumbers=function(){var t,o=e.search.number;""!==o&&void 0!==o&&(t=o.split(","));var a=!1,i=[];if(angular.isArray(t)&&(t.forEach(function(e){(e.length<10||isNaN(e)||e.length>10)&&i.push(e)}),i.length)){a=!0;var r="is invalid Phone Number.";i.length>1&&(r="are invalid Phone Number."),c.notify({title:"Blacklist Phone Number",text:"'"+i.join(", ")+"' "+r,type:"error"})}return a},e.saveBlacklist=function(){var t=e.search.number,a={blacklist:{org_unit_id:l.currentOUId,numbers:t}};e.validateModalBlaclistNumbers()||i.saveBlackList(a).then(function(e){console.log(e),"error"!=e.data.result&&(c.notify({title:"Blacklist Phone Number",text:"Successfully Saved BlackList",type:"success"}),o.close())})}}]).controller("OldPhoneNumbersEditableController",["$scope","UserWebService","TagWebService","$filter","$http","PhoneList","OldCampaignWebService","WebhookService","$location","$route","SelectedCampaign","$rootScope","pinesNotifications","locationWebService","$window","VoicePromptService","WhisperMessageService","$uibModal","$timeout","DNIWebService","$compile","$bootbox","DateTimeTimeZoned","$q","OrgUnitWebService",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b,w,y,S,C,A,T){"use strict";e.showSpamButton=!1,e.userAccess&&e.userAccess.spamguard&&(e.showSpambutton=!0),e.browserAgentName="",e.showCallFlow=!1,e.showCallActions=!1,e.showMultiPass=!1,e.selectedCallFlow={},e.addCallAction={},e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.remainingText={},e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.customsourcesArray={CS1:[],CS2:[],CS3:[],CS4:[],CS5:[]},e.selectedCallFlow.spamActive=!1,e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.TTSIVRSelected=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],e.voicetextIVRChanged=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e.hasValidTTSVoiceURL=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e.hasValidVoiceURL=!1,e.hadValidWhisperURL=!1,e.qCallFlow="",e.multiSelectedChannels=[],e.formSubmit=!1,e.formSubmit1=!1,e.selectedCallFlow={rinterval:72},e.callActionWebhookOptions=[],e.callActionTaggingOptions=[],e.locations=m.getLocations(),e.IsVisible=!1,e.customSourceType="",e.customSourceRow="",e.customSourceFrom="",e.selectedCallFlow.webhook="",e.isNumberPool=!1,e.ShowHide=function(){e.IsVisible=!e.IsVisible},e.disableNumberPool=function(){e.selectedCallFlow.quantity=e.selectedCallFlow.numberPool,e.selectedCallFlow.quantity>1&&(p.notify({title:"Number pool",text:"To make changes to number pool, please contact Customer Support at 855-889-3939 or email at support@convirza.com",type:"error"}),e.selectedCallFlow.numberPool=e.selectedCallFlow.quantity=1)};var D=m.getLocations();e.locations=D,e.showAddloc=!0,e.callbackid=-1,e.campaignBuilderHeader=["Tracking Number","Name","Ad Source","Call Value","Repeat Interval (hours)","Status"],e.multipleNumbersHeader=["Tracking Number","Name","Ad Source","Custom Source 1","Custom Source 2","Custom Source 3","Custom Source 4","Custom Source 5","Call Value","Repeat Interval (hours)","Ring to","Record Call"],e.actionHeader=["Actions"],e.customTaggingOptions=[],e.callActionTaggingOptions=[],$(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},2e3)}),$(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},5e3)}),e.multipleCallsStickyHeader=function(){setTimeout(function(){$(window).trigger("resize")},200)},e.sizeOf=function(e){return Object.keys(e).length},e.tagAdded=function(t,o){var a=1;if(void 0!==e.addCallAction.email[t]&&e.addCallAction.email[t].length>1){var i=e.addCallAction.email[t].indexOf(o)-1;a=e.addCallAction.email[t][i].id+1}o.id=a},e.emailText="",e.countElement=function(t,o){var a=[],i=e.addCallAction.email[t];if(void 0!==i){for(var r=0;r<i.length;r++)a.push(i[r].text);e.emailText=a.join(","),e.emailText=e.emailText.replace(/,/g,"").replace(/ /g,""),e.addCallAction.remainingText[t]=1024-e.emailText.length+" characters are remaining",e.addCallAction.callActionFormSubmitted[t]=!1}},s.webhookList(u.currentOUId).then(function(t){e.webhook=[],t.data.json.length>0&&(e.webhook=t.data.json)}),console.log("textcount called"),T.getcustomsource(e.currentOUId).then(function(t){var o=t.data.json;_.each(o,function(t){void 0===e.customsourcesArray[t.custom_source_type]&&(e.customsourcesArray[t.custom_source_type]=[]),e.customsourcesArray[t.custom_source_type].push({id:t.custom_source_id,name:t.custom_source_name})})}),e.selectCustomOptions=function(t,o,a){return{formatNoMatches:function(i){e.customSourceType=o,e.customSourceRow=t,e.customSourceFrom=a;var r="";return""!==i.trim()?(r='<a ng-class="{disabled:disableAddCustom}" ng-click="addCustomSource(term)">Add Custom Source :"'+i.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsCustomeSource=i})):r="Can not add empty!",r},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.toLowerCase().trim()==t[r].text.toLowerCase().trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-class="{disabled:disableAddCustom}" ng-click="addCustomSource(term);">Add Custom Source:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsCustomeSource=a.term}),console.log("textcount called")}return t},simple_tags:!0,allowClear:!0}},e.select2Options=function(t){return{formatNoMatches:function(o){e.actionId=t;var a="";return""!==o?(a='<a ng-click="addTag(term)">Add tag:"'+o.trim()+'"</a>',e.$$phase||e.$apply(function(){e.noResultsTag=o})):a="",a},sortResults:function(t,o,a){var i=!1;if(a.term=a.term.trim(),a.term.length>0){for(var r in t)if(a.term.trim()==t[r].text.trim()){i=!0;break}i||$(".select2-results").prepend('<li class="select2-no-results"><a ng-href="#" ng-click="addTag(term);">Add tag:"'+a.term+'"</a></li>'),e.$$phase||e.$apply(function(){e.noResultsTag=a.term})}return t},simple_tags:!0,allowClear:!0}},e.addCustomSource=function(t){var o="CS"+e.customSourceType;if(e.disableAddCustom=!0,_.where(e.customsourcesArray[o],{custom_source_name:this.noResultsCustomeSource.trim()}).length>0)return p.notify({title:"Update Custom Source",text:"This Custom Source already exists",type:"error"}),e.disableAddCustom=!1,!1;var a={customSource:{custom_source_name:e.noResultsCustomeSource,org_unit_id:u.currentOUId,custom_source_type:o}};if(e.noResultsCustomeSource.length>50)return p.notify({title:"Custom Source",text:"Not allowed more than 50 characters",type:"error"}),e.disableAddCustom=!1,!1;$(".select2-drop").hide(),T.customSource(a).then(function(t){e.customTaggingOptionsWatch=!0,""===t.data.err&&(p.notify({title:"Create Custom Source",text:"Successfully added the custom source",type:"success"}),e.disableAddCustom=!1,e.customsourcesArray[o].push({id:t.data.json.custom_source_id,name:e.noResultsCustomeSource.trim()}),e.customTaggingOptions.push({custom_source_id:t.data.json.custom_source_id,custom_source_name:e.noResultsCustomeSource.trim(),org_unit_id:u.currentOUId}))})},e.addTag=function(t){if(_.where(e.callActionTaggingOptions,{tag_name:this.noResultsTag.trim()}).length>0)return p.notify({title:"Update Tags",text:"This Tag already exists",type:"error"}),!1;var o={tag:{tag_name:e.noResultsTag.trim(),org_unit_id:u.currentOUId}};$(".select2-drop").hide(),n.createTag(o).then(function(t){e.callActionTaggingOptionsWatch=!0,""===t.data.err&&(p.notify({title:"Create Tags",text:"Successfully added the tag",type:"success"}),e.callActionTaggingOptions.push({tag_id:t.data.json.tag_id,tag_name:e.noResultsTag.trim(),org_unit_id:u.currentOUId}))})},e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&b(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.$watch("addCallAction.email",function(t,o){for(var a in e.addCallAction.email)if(e.addCallAction.email.hasOwnProperty(a)){for(var i=0,r=e.addCallAction.email[a],n=0;n<r.length;n++){i+=r[n].text.replace(/,/g,"").replace(/ /g,"").length}e.addCallAction.remainingText[a]=1024-i+" characters are remaining"}},!0),e.$watch("noResultsTag",function(t,o){t&&t!==o&&b(function(){var t=$(".select2-no-results");y(t.contents())(e)})},!0),e.$watch("noResultsCustomeSource",function(t,o){t&&t!==o&&b(function(){var t=$(".select2-no-results");y(t.contents())(e)})},!0),e.$watch("callActionTaggingOptions",function(t,o){e.callActionTaggingOptionsWatch&&b(function(){angular.isUndefined(e.addCallAction.tagList[parseInt(e.actionId)])?(e.addCallAction.tagList[parseInt(e.actionId)]=[],e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide()):(e.addCallAction.tagList[parseInt(e.actionId)].push(e.callActionTaggingOptions[e.callActionTaggingOptions.length-1].tag_id.toString()),e.addCallAction.callActionFormSubmitted[parseInt(e.actionId)]=!1,$(".select2-drop").hide())})},!0),e.$watch("customTaggingOptions",function(t,o,a){e.customTaggingOptionsWatch&&b(function(){if(1===e.customSourceRow&&"single"===e.customSourceFrom)1===e.customSourceType?e.selectedCallFlow.customSourceList_1=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():2===e.customSourceType?e.selectedCallFlow.customSourceList_2=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():3===e.customSourceType?e.selectedCallFlow.customSourceList_3=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():4===e.customSourceType?e.selectedCallFlow.customSourceList_4=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():5===e.customSourceType&&(e.selectedCallFlow.customSourceList_5=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString());else if("multiple"===e.customSourceFrom)for(var t=1;t<=e.selectedCallFlow.count;t++)e.customSourceRow===t&&(1===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_1=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():2===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_2=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():3===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_3=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():4===e.customSourceType?e.MultCallFlowList[e.customSourceRow-1].customSourceList_4=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString():5===e.customSourceType&&(e.MultCallFlowList[e.customSourceRow-1].customSourceList_5=e.customTaggingOptions[e.customTaggingOptions.length-1].custom_source_id.toString()));$(".select2-drop").hide()})},!0),i.get("assets/demo/old_call_actions.json").then(function(t){e.names=t.data}),e.addLocationVisible=function(){e.showAddloc=!1},e.chkSpclChar=function(e,t,o){var a=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;a.test(e)?(p.notify({title:t,text:"Special characters are not allowed",type:"error"}),o(e.replace(a,""))):o(e)},e.voiceTextChange=function(){e.promptAudio=void 0,void 0===e.selectedCallFlow.voicePromptTTSText||0===e.selectedCallFlow.voicePromptTTSText.length?(e.hasValidVoiceURL=!1,e.TTSSelected=!0):e.chkSpclChar(e.selectedCallFlow.voicePromptTTSText,"Voice Prompt",function(t){e.selectedCallFlow.voicePromptTTSText=t,e.hasValidVoiceURL=!0,e.TTSSelected=!0})},e.whisperTextChange=function(){console.log("canModify",e.canModify),console.log("$scope.hasValidWhisperURL",e.hasValidWhisperURL),e.whisperAudio=void 0,void 0===e.selectedCallFlow.whisperTTSText||0===e.selectedCallFlow.whisperTTSText.length?(e.hasValidWhisperURL=!1,e.TTSWhisperSelected=!0):e.chkSpclChar(e.selectedCallFlow.whisperTTSText,"Whisper Message",function(t){e.selectedCallFlow.whisperTTSText=t,e.hasValidWhisperURL=!0,e.TTSWhisperSelected=!0})},e.voiceTextIVRChange=function(t){e.ivrAudio=void 0,void 0===e.ivrActions[t].voicepromptTTSText||0===e.ivrActions[t].voicepromptTTSText.length?(e.hasValidTTSVoiceURL[t]=!1,e.TTSIVRSelected[t]=!0):e.chkSpclChar(e.ivrActions[t].voicepromptTTSText,"Voice Prompt",function(o){e.ivrActions[t].voicepromptTTSText=o,e.hasValidTTSVoiceURL[t]=!0,e.TTSIVRSelected[t]=!0})},e.audioIsPlaying=function(t){return"whisper"!=t&&void 0!==e.whisperAudio&&!e.whisperAudio.paused&&!e.whisperAudio.ended||("prompt"!=t&&void 0!==e.promptAudio&&!e.promptAudio.paused&&!e.promptAudio.ended||"ivr"!=t&&void 0!==e.ivrAudio&&!e.ivrAudio.paused&&!e.ivrAudio.ended)};var I=function(){void 0!==e.whisperAudio&&(e.whisperAudio.pause(),e.whisperAudio=void 0),void 0!==e.promptAudio&&(e.promptAudio.pause(),e.promptAudio=void 0),void 0!==e.ivrAudio&&(e.ivrAudio.pause(),e.ivrAudio=void 0)};function N(e,t){var o;return _.each(e,function(e,a){e===t&&(o=a)}),o}function k(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function R(t){if(delete e.ruleDropDown[t.toString()],delete e.addCallAction.callActionFormSubmitted[t.toString()],$.each(e.addCallAction,function(e,o){angular.isUndefined(o)||k(o[t.toString()])||"string"==typeof o||delete o[t.toString()]}),"IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)0===e.callActions.length&&(e.callActions=[],e.callActions.push({id:1}),e.addCallAction.actionOptions[1]="action0",e.addCallAction.email[1]=[],e.addCallAction.callActionFormSubmitted[1]=!1,e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(0===e.callActions.length){e.callActions=[],e.callActions.push({id:1}),e.addCallAction.actionOptions[1]="action0",e.addCallAction.email[1]=[],e.addCallAction.callActionFormSubmitted[1]=!1;var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}e.audioIsDownloading=function(){return void 0!==e.whisperAudio&&void 0!==e.onTTS_WH_Request||(void 0!==e.promptAudio&&void 0!==e.onTTS_VP_Request||void 0!==e.ivrAudio&&void 0!==e.onTTS_IVR_Request)},e.addLocation=function(){e.inserted={id:e.locations.length+1,name:"",status:null,group:null},e.locations.push(e.inserted)},e.showVoiceModal=function(t){I(),v.open({templateUrl:"assets/partials/assignPrompt.html",controller:"oldVoiceModal",size:t,backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<u.prompts.length;t++)!0===u.prompts[t].selectedprompt&&(e.selectedCallFlow.voicePromptText=u.prompts[t].name,e.selectedCallFlow.voicePromptFileName=u.prompts[t].filename,e.selectedCallFlow.voicePromptId=u.prompts[t].id,e.selectedCallFlow.voiceURL=u.prompts[t].url,e.selectedCallFlow.hasValidVoiceURL=!0,e.selectedCallFlow.TTSSelected=!0,e.selectedCallFlow.promptAudio=void 0);e.prompts=u.prompts,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.totPercent=0,e.numPer=0,e.percentageCount=function(t){for(var o=0,a=0;a<=t;a++){if(""===e.percentageRingtoNum[a].percentage||void 0===e.percentageRingtoNum[a].percentage||isNaN(e.percentageRingtoNum[a].percentage))return;o+=e.percentageRingtoNum[a].percentage}e.totPercent=o,e.totPercent>100?p.notify({title:"Percentage Call route",text:"Percentage is greater than 100 ",type:"error"}):100-o>0?t<9&&(""===e.percentageRingtoNum[t+1].ringtonum||angular.isUndefined(e.percentageRingtoNum[t+1].ringtonum))&&(e.percentageRingtoNum[t+1].percentage=100-o,e.numPer=t+1):(setTimeout(function(){for(var o=t+1;o<10;o++)e.percentageRingtoNum[o].percentage=""},100),(""===e.percentageRingtoNum[t+1].ringtonum||angular.isUndefined(e.percentageRingtoNum[t+1].ringtonum))&&(setTimeout(function(){for(var o=t+1;o<10;o++)e.percentageRingtoNum[o].ringtonum=""},100),e.numPer=t))},e.removePercentNumber=function(t){e.percentageRingtoNum[t].ringtonum="",e.percentageRingtoNum[t].percentage="",e.percentageRingtoNum.splice(t,1),e.percentageRingtoNum.push({id:9,percentage:"",ringtonum:"",readonly:!1}),setTimeout(function(){e.numPer=e.numPer-1},100)},e.showWhisperModal=function(t){I(),v.open({templateUrl:"assets/partials/assignWhisper.html",controller:"oldWhisperModal",size:t,backdrop:"static",keyboard:!1}).result.then(function(){for(var t=0;t<u.whispers.length;t++)!0===u.whispers[t].selectedwhisper&&(e.selectedCallFlow.whisperText=u.whispers[t].name,e.selectedCallFlow.whisperFileName=u.whispers[t].filename,e.selectedCallFlow.whisperId=u.whispers[t].id,e.selectedCallFlow.whisperURL=u.whispers[t].url,e.selectedCallFlow.whisperAudio=void 0,e.selectedCallFlow.hasValidWhisperURL=!0,e.selectedCallFlow.TTSWhisperSelected=!0);e.whispers=u.whispers,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.showIVRVoiceModal=function(t,o){I(),v.open({templateUrl:"assets/partials/assignPrompt.html",controller:"oldVoiceModal",size:t}).result.then(function(){for(var t=0;t<f.prompts.length;t++)!0===f.prompts[t].selectedprompt&&(e.ivrActions[o].voicepromptText=f.prompts[t].name,e.ivrActions[o].voicepromptFileName=f.prompts[t].filename,e.ivrActions[o].voicepromptURL=f.prompts[t].url,e.ivrActions[o].voicepromptId=f.prompts[t].id,e.ivrActions[o].ivrAudio=void 0);console.log(f.prompts),e.prompts=f.prompts,e.TTSIVRSelected[o]=!1,e.hasValidTTSVoiceURL[o]=!0,e.ivrActions[o].voicepromptTTSText=""},function(){console.log("Modal dismissed at: "+new Date)})},e.saveLocation=function(e,t){console.log("SAVING")},e.removeLocation=function(t){e.locations.splice(t,1)},e.savedlocations=[],e.savedlocations.push({id:"0",location:"Create Location",address:"1664 S. Dixie Dr.",city:"Saint George",state:"UT",zip:"84770",phone:"6809909123",action:"Delete"}),e.savedlocations.push({id:"1",location:"LogMyCalls",address:"1664 S. Dixie Dr.",city:"Saint George",state:"UT",zip:"84770",phone:"6809909123",action:"Delete"}),e.savedlocations.push({id:"2",location:"Blue Moon Inn",address:"25 Willow Ln.",city:"Port Costa",state:"CA",zip:"94569",phone:"9259465638",action:"Delete"}),e.savedlocations.push({id:"3",location:"Walnut Creek branch",address:"2705 Main St.",city:"Walnut Creek",state:"CA",zip:"94598",phone:"9255126685",action:"Delete"}),e.savedlocations.push({id:"4",location:"Ocean Gate Shop",address:"321 Mall Dr.",city:"St. George",state:"UT",zip:"84790",phone:"4356746700",action:"Delete"}),e.savedlocations.push({id:"5",location:"South Kings branch",address:"3110 S. Kings Hwy",city:"Nob Hill",state:"CA",zip:"94518",phone:"9255126225",action:"Delete"}),e.getLocation=function(t){if(e.rc=[],t){if(t.length>2){var o=[],i=t.split(/,|-/);return n.getGeoCity(i[0]).then(function(i){return"error"!=i.data.result?(angular.forEach(i.data.json.json,function(t){o.push(t.npa+"-"+t.city+","+t.state);var a=t.npa+"-"+t.city+","+t.state;e.rc.push({address:a,rc:t.rc,state:t.state}),t.city,t.state}),o=_.uniq(o),e.rc=_.uniq(e.rc),a("filter")(o,t)):o})}return""}},e.getNum=function(e){console.log(e)},e.showSubmit=function(){setTimeout(function(){e.submitted1=!1},100)},e.showSaveButton=function(){setTimeout(function(){e.formSubmit1=!1},100)},e.onReservedNumberFocus=function(){n.getReservedNumbers().then(function(t){"error"!=t.data.result&&(e.resNumList=t.data.json)})},e.onFocus=function(t){if(t){e.numList=[];var o=t.split(","),a=o[0].split("-"),i=a.shift(),r=a.join("-"),s=o.pop();""!=r&&""!=i?("TOLLFREE"===r&&(s="XX"),""!=s?(n.getPhoneNumbers(r,s,i).then(function(o){"error"!=o.data.result?(e.numList=o.data.json,e.numList instanceof Array||(e.numList=[]),"TOLLFREE"!==r&&(e.numList.push({number:"more",number_id:0}),e.removeNo=o.data.json.length-1,_.forEach(e.numList,function(o){"more"===o.number&&e.setNewNumber(o,t)}))):e.numList=[]}),!0===e.showMultiPass&&console.log(e.selectedCallFlow.count)):e.numList=[]):e.numList=[]}else e.numList=[]},e.lostFocus=function(t){t||(e.numList=[],e.selectedCallFlow.num="")},e.setNewNumber=function(t,o){var a,i=[],r="",s=0;if(e.LoadTrackingNumber=!0,$("#LoadTrackingNumber").show(),console.log("$scope.LoadTrackingNumber ****",e.LoadTrackingNumber),t&&"more"===t.number&&""!==o)if(e.numList.pop(),$.each(e.rc,function(e,t){t.address===o&&-1===i.indexOf(t.rc)&&void 0!==t.rc&&(i.push(t.rc.trim()),r=t.state.trim())}),i.length>0){a=i.length;for(var l=0;l<i.length&&0==s;l++)null===i[l]&&""===i[l]||n.getThirdPartyNumbers(r,i[l]).then(function(t){if(a-=1,"error"!==t.data.result)if("fail"!==t.data.json[0]){s=1,parseInt(e.removeNo)>0&&t.data.json.splice(0,parseInt(e.removeNo)),angular.forEach(t.data.json,function(t){e.numList.push(t)});for(var o=[],i=[],r=0;r<e.numList.length;r++)"inventory"==e.numList[r].source&&o.push(e.numList[r].number),"shoutpoint"==e.numList[r].source&&i.push(e.numList[r].number);var n=[];if(o.length>0){o.sort(function(e,t){return e-t});for(r=0;r<o.length;r++)for(var l=0;l<e.numList.length;l++)o[r]==e.numList[l].number&&"inventory"==e.numList[l].source&&n.push(e.numList[l])}if(i.length>0){i.sort(function(e,t){return e-t});for(r=0;r<i.length;r++)for(l=0;l<e.numList.length;l++)i[r]==e.numList[l].number&&"shoutpoint"==e.numList[l].source&&n.push(e.numList[l])}e.numList=n,e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()}else e.numList.push({number:"Numbers not available",number_id:"",pretty_number:"Numbers not available",source:"",vendor_id:""}),console.log("No data found"),e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide();else{for(o=[],r=0;r<e.numList.length;r++)"inventory"==e.numList[r].source&&o.push(e.numList[r].number);n=[];if(o.length>0){o.sort(function(e,t){return e-t});for(r=0;r<o.length;r++)for(l=0;l<e.numList.length;l++)o[r]==e.numList[l].number&&"inventory"==e.numList[l].source&&n.push(e.numList[l])}e.numList=n,e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()}e.numList.length>25&&(e.numList=e.numList.slice(0,24)),0==e.numList.length&&0===a&&e.numList.push({number:"Numbers not available",number_id:"",pretty_number:"Numbers not available",source:"",vendor_id:""})})}else e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide();else e.LoadTrackingNumber=!1,$("#LoadTrackingNumber").hide()},e.updateqCall=function(){e.qcf=this.qcf},e.$watch("selectedCallFlow.routetype",function(t,o){t!==o&&void 0!==o?"ivr"===e.basicRoute&&"ivr"===t?(e.selectedCallFlow.voicePromptTTSText=e.oldVoicePromptTTSText,e.selectedCallFlow.voicePrompt1=e.oldVoicePrompt1,e.selectedCallFlow.voicePromptFileName=e.oldVoicePromptFileName,""===e.oldVoicePromptText&&void 0===e.oldVoicePromptText||"hh"===e.oldVoicePromptText||(e.hasValidVoiceURL=e.oldHasValidVoiceURL,e.selectedCallFlow.voicePromptText=e.oldVoicePromptText,e.TTSSelected=!1)):"ivr"===t&&"ivr"!==e.basicRoute?(e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText,e.TTSSelected=!0,e.selectedCallFlow.voicePrompt1=!0,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptTTSText=""):"ivr"===o&&(""!==e.oldVoicePromptTTSText?(e.TTSSelected=!0,e.selectedCallFlow.voicePromptTTSText=e.oldVoicePromptTTSText,e.selectedCallFlow.voicePromptText="",e.hasValidVoiceURL=e.oldHasValidVoiceURL,e.selectedCallFlow.voicePromptFileName=e.oldVoicePromptFileName,e.selectedCallFlow.voicePrompt1=e.oldVoicePrompt1):(e.TTSSelected=!1,e.selectedCallFlow.voicePromptTTSText=e.oldVoicePromptTTSText,e.selectedCallFlow.voicePromptText=e.oldVoicePromptText,e.hasValidVoiceURL=e.oldHasValidVoiceURL,e.selectedCallFlow.voicePromptFileName=e.oldVoicePromptFileName,e.selectedCallFlow.voicePrompt1=e.oldVoicePrompt1)):""!==e.selectedCallFlow.voicePromptTTSText&&void 0!==e.selectedCallFlow.voicePromptTTSText||"hh"!==e.selectedCallFlow.voicePromptText?(e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText):"ivr"===t&&void 0===o?(e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText,e.TTSSelected=!0,e.selectedCallFlow.voicePrompt1=!0,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptTTSText=""):(e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText)}),u.$on("loadCallFlowReceiver",function(t,o){e.loadCallFlow(o)}),e.hideDniOptions=function(e,t){return"singleNumber"===t||"reservedNumber"===t?"session"===e:"session"!==e},e.loadCallFlow=function(t){var o;if(console.log("passedPnumber",t),e.referrerClassCombinations=[],e.showReferrerTextBox=!1,e.showWebHookTextBox=!1,e.oldVoicePromptTTSText="",e.oldVoicePrompt1=!1,void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,void 0!==e.ivrAudio&&e.ivrAudio.pause(),e.ivrAudio=void 0,void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,e.changeReferrer=function(){"new"===e.selectedCallFlow.referrer?(e.showReferrerTextBox=!0,e.selectedCallFlow.referrer=""):""!==e.selectedCallFlow.referrer&&void 0!==e.selectedCallFlow.referrer||(e.showReferrerTextBox=!1,e.selectedCallFlow.referrer="")},e.singlecallForm.$setPristine(),e.showCallFlow=!0,e.showMultiPass=!1,e.numList=[],e.bCreateAnother=!1,e.percentageRingtoNum=[],e.qCallFlowList=[{name:"Forward to phone number",id:1,value:"qSimple",action:"qSimple",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""},{name:"Forward to nearest location",id:2,value:"qGeo",action:"qGeo",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""},{name:"Hang up",id:8,value:"qHangup",action:"qHangup",whisper:!1,webhook:!1,ringtonum:"",voicepromptText:"",voicepromptURL:"",voicepromptId:"",voiceprompt:""}],n.getChannels().then(function(o){"error"!=o.data.result&&(o.data.json=o.data.json.filter(function(e){return"API"!==e.category}),e.channels=o.data.json,angular.forEach(o.data.json,function(o){o.category=o.category.trim(),o.sub_category=o.category+":"+o.sub_category,t&&t.channelId==o.channel_id&&(e.selectedCallFlow.channel=o)}))}),t&&(e.provisionedrouteId=t.id,o=t.id,e.addCallAction.provisioned_route_id&&t.id!==e.addCallAction.provisioned_route_id&&(e.showCallActions=!1)),w.getDniSettings(u.currentOUId).then(function(t){if(t.data.json[0].dni_org_unit.length>0)$.each(t.data.json[0].dni_settings,function(t,o){var i=o.referrer;o.referrer_type&&(i+="|"+o.referrer_type);o.number&&(o.number.slice(0,3),o.number.slice(3,6),o.number.slice(6,10));a("filter")(e.dniReferrer,i,!0).length<1&&e.dniReferrer.push({value:i,text:o.referrer})});else{var o={dniOrgUnit:{org_unit_id:u.currentOUId}};w.createDniOUData(o).then(function(e){})}}),t&&w.getDniSettings(u.currentOUId,o).then(function(t){t.data.json[0].dni_settings.length>0&&(e.selectedCallFlow.showDNI=!0,$.each(t.data.json[0].dni_settings,function(t,o){var a=o.referrer;o.referrer_type&&(a+="|"+o.referrer_type),e.selectedCallFlow.dni_setting_id=o.dni_setting_id,e.selectedCallFlow.destination_url=o.destination_url,e.selectedCallFlow.referrer=a,e.selectedCallFlow.dniType=o.dni_type,e.selectedCallFlow.dni_element=o.dni_element,e.selectedCallFlow.dni_ttl=o.dni_ttl}))}),t)e.numList.push({id:t.id,number:t.phone,pretty_number:t.phonep,numberid:t.phoneid,vendor_id:t.vendor_id}),e.oldQuantity=t.quantity,e.selectedCallFlow.num=e.numList[0],e.isNew=!1,e.selectedCallFlow=t,e.selectedCallFlow.numberPool=t.quantity,e.pool_state=t.state,e.rate_center=t.rate_center,e.pool_id=t.pooId,t.phone?e.selectedCallFlow.callflowOption="singleNumber":e.selectedCallFlow.callflowOption="numberPool",e.selectedCallFlow.showWebhook=!1,t.webhook_id&&(e.selectedCallFlow.showWebhook=!0,e.selectedCallFlow.webhook=t.webhook_id),e.selectedCallFlowEdit=!0,"Active"==t.status2?e.cfactive=!0:e.cfactive=!1,n.getprovRouteCallFlow(t.id).then(function(t){var o;if(console.log("get callflow",t.data.json),u.whispers=JSON.parse(g.sessionStorage.whispers),u.prompts=JSON.parse(g.sessionStorage.prompts),"error"!=t.data.result&&(1===t.data.json.call_flow.spam_active||!0===t.data.json.call_flow.spam_active?e.selectedCallFlow.spamActive=!0:e.selectedCallFlow.spamActive=!1,e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.callFlowId=t.data.json.call_flow.id,e.selectedCallFlow.ringtoNum=t.data.json.call_flow.default_ringto,e.selectedCallFlow.org_unit_id=t.data.json.call_flow.org_unit_id,t.data.json.custom_sources&&void 0!==t.data.json.custom_sources))for(i=0;i<t.data.json.custom_sources.length;i++)"CS1"===t.data.json.custom_sources[i].custom_source_type?e.selectedCallFlow.customSourceList_1=t.data.json.custom_sources[i].custom_source_id:"CS2"===t.data.json.custom_sources[i].custom_source_type?e.selectedCallFlow.customSourceList_2=t.data.json.custom_sources[i].custom_source_id:"CS3"===t.data.json.custom_sources[i].custom_source_type?e.selectedCallFlow.customSourceList_3=t.data.json.custom_sources[i].custom_source_id:"CS4"===t.data.json.custom_sources[i].custom_source_type?e.selectedCallFlow.customSourceList_4=t.data.json.custom_sources[i].custom_source_id:"CS5"===t.data.json.custom_sources[i].custom_source_type&&(e.selectedCallFlow.customSourceList_5=t.data.json.custom_sources[i].custom_source_id);if(void 0!=t.data.json.call_flow.webhook_id&&""!=t.data.json.call_flow.webhook_id&&(e.selectedCallFlow.showWebhook=!0,e.selectedCallFlow.webhook=t.data.json.call_flow.webhook_id),console.log("result.data.json.call_flow.whisper_enabled",e.whispers),1===t.data.json.call_flow.whisper_enabled||!0===t.data.json.call_flow.whisper_enabled)if(e.selectedCallFlow.whisperPrompt1=!0,"file"==t.data.json.call_flow.whisper_type){if(void 0!==u.whispers&&null!==u.whispers)for(o=0;o<u.whispers.length;o++)t.data.json.call_flow.whisper_message.split("/").length>0&&(t.data.json.call_flow.whisper_message=t.data.json.call_flow.whisper_message.split("/")[t.data.json.call_flow.whisper_message.split("/").length-1]),t.data.json.call_flow.whisper_message===u.whispers[o].filename&&(e.selectedCallFlow.whisperText=u.whispers[o].name,e.selectedCallFlow.whisperURL=u.whispers[o].url,e.selectedCallFlow.whisperId=u.whispers[o].id,e.selectedCallFlow.whisperFileName=u.whispers[o].filename,e.TTSWhisperSelected=!1,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperTTSText="")}else e.selectedCallFlow.whisperTTSText=t.data.json.call_flow.whisper_message,e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!0,e.selectedCallFlow.whisperText="hh";else e.selectedCallFlow.whisperPrompt1=!1;if(1===t.data.json.call_flow.message_enabled||!0===t.data.json.call_flow.message_enabled)if(e.selectedCallFlow.voicePrompt1=!0,"file"==t.data.json.call_flow.message_type){if(void 0!==u.prompts&&null!==u.prompts)for(o=0;o<u.prompts.length;o++)t.data.json.call_flow.message.split("/").length>0&&(t.data.json.call_flow.message=t.data.json.call_flow.message.split("/")[t.data.json.call_flow.message.split("/").length-1]),t.data.json.call_flow.message===u.prompts[o].filename&&(e.selectedCallFlow.voicePromptText=u.prompts[o].name,e.selectedCallFlow.voiceURL=u.prompts[o].url,e.selectedCallFlow.voicePromptId=u.prompts[o].id,e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptFileName=u.prompts[o].filename,e.selectedCallFlow.voicePromptTTSText="",e.oldVoicePromptFileName=e.selectedCallFlow.voicePromptFileName,e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText)}else e.selectedCallFlow.voicePromptTTSText=t.data.json.call_flow.message,e.TTSSelected=!0,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptText="hh";else e.selectedCallFlow.voicePrompt1=!1;if(1===t.data.json.call_flow.record_call||!0===t.data.json.call_flow.record_call?(e.selectedCallFlow.playDisclaimer=t.data.json.call_flow.play_disclaimer,e.selectedCallFlow.recordCall=!0):e.selectedCallFlow.recordCall=!1,"PercentageBasedRoute"!=t.data.json.call_flow.routable_type){e.percentageRingtoNum=[];for(var a=1;a<11;a++)e.percentageRingtoNum.push({id:a,percentage:"",ringtonum:"",readonly:!1})}switch(e.basicRoute=t.data.json.call_flow.routable_type,t.data.json.call_flow.routable_type){case"SimpleRoute":"hangup"===t.data.json.call_flow.default_ringto?e.selectedCallFlow.routetype="hangup":e.selectedCallFlow.routetype="simple";break;case"GeoRoute":e.selectedCallFlow.routetype="geo",e.selectedCallFlow.routeBy=t.data.json.geo_route[0].strategy,e.selectedCallFlow.geoRouteId=t.data.json.geo_route[0].id,e.selectedCallFlow.ringtoNum=t.data.json.geo_route[0].default_ringto,e.selectedCallFlow.geoList=parseInt(t.data.json.geo_route[0].location_id),"Npa"!==t.data.json.geo_route[0].strategy&&"Zipcode"!==t.data.json.geo_route[0].strategy||(e.selectedCallFlow.radius=parseFloat(t.data.json.geo_route[0].radius));break;case"PercentageBasedRoute":e.selectedCallFlow.routetype="PercentageBasedRoute";var i,r=0;for(i=0;i<t.data.json.ringto_percentage.length;i++)e.percentageRingtoNum.push({id:i,percentage:t.data.json.ringto_percentage[i].percentage,ringtonum:t.data.json.ringto_percentage[i].ringToNum,readonly:!1}),r+=t.data.json.ringto_percentage[i].percentage;for(e.totPercent=r,e.numPer=t.data.json.ringto_percentage.length-1,i=t.data.json.ringto_percentage.length;i<10;i++)e.percentageRingtoNum.push({id:i,percentage:"",ringtonum:"",readonly:!1});break;case"IvrRoute2":e.basicRoute="ivr",e.selectedCallFlow.routetype="ivr",e.ivrActions=[];var n=0;t.data.json.ivrs&&(t.data.json.ivrs.sort(function(e,t){return e.value-t.value}),t.data.json.ivrs.forEach(function(o){var a,i,r,s,l,c,d,u,p,m,g,f,h,v,_=!1;if(o.name&&(v=o.name),t.data.json.call_flow.default_ringto&&(h=t.data.json.call_flow.default_ringto),1!==o.record_enabled&&!0!==o.record_enabled||(f=o.play_disclaimer,_=!0),"hangup"===o.target_did?a="qHangup":"geo"==o.ivr_option_type?(a="qGeo",u=o.geo_route[0].strategy,p=o.geo_route[0].id,h=o.target_did,g=parseInt(o.geo_route[0].location_id),"Npa"!==o.geo_route[0].strategy&&"Zipcode"!==o.geo_route[0].strategy||(m=parseFloat(o.geo_route[0].radius))):(a="qSimple",h=o.target_did),o.message&&o.message.length>1)if(i=!0,"file"==o.message_type)for(var b=0;b<e.prompts.length;b++)o.message.indexOf(e.prompts[b].filename)>-1&&(r=e.prompts[b].name,s=e.prompts[b].url,c=e.prompts[b].id,l=e.prompts[b].filename,e.TTSIVRSelected[n]=!1,e.hasValidTTSVoiceURL[n]=!0,d="");else d=o.message,e.TTSIVRSelected[n]=!0,e.hasValidTTSVoiceURL[n]=!1,r="",s="",l="",c="";var w=e.ivrActions.length+1;9===e.ivrActions.length&&(w=0),e.ivrActions.push({id:w,action:a,whisper:!1,webhook:!1,value:a,name:"Forward to phone number",ringtonum:o.target_did,ringtoname:v,voicepromptText:r,voicepromptURL:s,voicepromptTTSText:d,voicepromptId:c,voicepromptFileName:l,voiceprompt:i,routeBy:u,geoRouteId:p,radius:m,geoList:g,playDisclaimer:f,recordCall:_,ringtoNum:h}),n++}))}});else{e.basicRoute="newRoute",e.isNew=!0,e.selectedCallFlow={rinterval:72,callflowOption:"singleNumber"},e.selectedCallFlow.recordCall=!0,e.selectedCallFlow.spamActive=!1,e.showSpambutton&&(e.selectedCallFlow.spamActive=!0),e.selectedCallFlow.showDNI=!1,e.selectedCallFlow.showWebhook=!1,e.selectedCallFlow.playDisclaimer="before",e.TTSSelected=!0,e.TTSWhisperSelected=!0,e.hasValidVoiceURL=!0,e.hasValidWhisperURL=!0,e.selectedCallFlow.address=null,e.selectedCallFlow.voicePromptText="hh",e.selectedCallFlow.whisperText="hh",e.addresses=[],e.selectedCallFlow.geoRouteId=null,e.cfactive=!0,e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.campActive||(e.cfactive=!1),e.callActions=[],e.ivrActions=[],e.ivrActions=[{id:1,action:"",value:"",voiceprompt:!1,whisper:!1,webhook:!1,recordCall:!0,playDisclaimer:"before",name:"Forward to phone number",voicepromptURL:"",voicepromptId:"",ringtonum:""}],e.percentageRingtoNum=[],e.numPer=0;for(var i=1;i<11;i++)e.percentageRingtoNum.push({id:i,percentage:"",ringtonum:"",readonly:!1});n.getDefaultData(e.currentOUId).then(function(t){!function(t){if(e.populatedDniType="",u.prompts,u.whispers,t.data.json.callFlowData.dniSettingData.length>0&&void 0!==e.userAccess.dni&&e.userAccess.dni>4){e.selectedCallFlow.showDNI=!0;var o=(r=t.data.json.callFlowData.dniSettingData[0]).referrer;r.referrer_type&&(o+="|"+r.referrer_type),a("filter")(e.dniReferrer,o,!0).length<1&&e.dniReferrer.push({value:o,text:r.referrer});var i=r.referrer;r.referrer_type&&(i+="|"+r.referrer_type),e.selectedCallFlow.dni_setting_id=r.dni_setting_id,e.selectedCallFlow.destination_url=r.destination_url,e.selectedCallFlow.referrer=i,e.selectedCallFlow.dniType=r.dni_type,e.populatedDniType=r.dni_type,e.selectedCallFlow.dni_element=r.dni_element,e.selectedCallFlow.dni_ttl=r.ttl,e.selectedCallFlow.showDNI=r.share_with_subgroup}if(t.data.json.callFlowData.customSourceData.length>0){var r=t.data.json.callFlowData.customSourceData,n={CS1:"customSourceList_1",CS2:"customSourceList_2",CS3:"customSourceList_3",CS4:"customSourceList_4",CS5:"customSourceList_5"};_.each(r,function(t){e.selectedCallFlow[n[t.custom_source_type]]=t.custom_source_id})}if(t.data.json.callFlowData.callFlowData.length>0){var s=(r=t.data.json.callFlowData.callFlowData[0]).play_voice_prompt_first_text;console.log("Voice Prompt: ",s),"file://"==s.substring(0,7)?(e.TTSSelected=!1,e.hasValidVoiceURL=!0,e.selectedCallFlow.voicePromptText=r.prompt_message_name,e.selectedCallFlow.voicePromptFileName=s.replace("file://",""),e.selectedCallFlow.voiceURL=r.voice_prompt_url,e.selectedCallFlow.voicePromptId=r.voice_prompt_id,e.hasValidVoiceURL=!0,console.log(e.prompts)):(e.TTSSelected=!0,e.selectedCallFlow.voicePromptTTSText=s,e.selectedCallFlow.voicePromptFileName=s,console.log("Voice Prompt: ",e.selectedCallFlow.voicePromptTTSText));var l=r.play_whisper_message_text;"file://"==l.substring(0,7)?(e.TTSWhisperSelected=!1,e.selectedCallFlow.whisperText=r.whisper_message_name,e.selectedCallFlow.whisperFileName=l.replace("file://",""),e.selectedCallFlow.whisperURL=r.whisper_message_url,e.selectedCallFlow.whisperId=r.whisper_id,e.hasValidWhisperURL=!0):(e.TTSWhisperSelected=!0,e.selectedCallFlow.whisperTTSText=l,e.selectedCallFlow.whisperFileName=l),e.selectedCallFlow.routetype="simple",e.selectedCallFlow.recordCall=r.record_call,e.selectedCallFlow.ringtoNum=r.ring_to_number,e.selectedCallFlow.voicePrompt1=r.play_voice_prompt_first,e.selectedCallFlow.whisperPrompt1=r.play_whisper_message,e.selectedCallFlow.rinterval=r.repeat_interval_call,e.selectedCallFlow.playDisclaimer=r.play_disclaimer,e.oldVoicePromptFileName=e.selectedCallFlow.voicePromptFileName,e.oldVoicePromptTTSText=e.selectedCallFlow.voicePromptTTSText,e.oldVoicePrompt1=e.selectedCallFlow.voicePrompt1,e.oldHasValidVoiceURL=e.hasValidVoiceURL,e.oldVoicePromptText=e.selectedCallFlow.voicePromptText}t.data.json.featureData.defaultData.length>0&&(r=t.data.json.featureData.defaultData[0],e.selectedCallFlow.spamActive=r.spam_guard_status)}(t)})}c.current.params.id&&setTimeout(function(){$("html, body").animate({scrollTop:$("#callFlow").offset().top-50},1e3)},100),e.originalcfactive=e.cfactive},e.enableSave=function(t){"tag_call"===e.addCallAction.actionOptions[t]&&(e.callActionLoaded||(e.addCallAction.callActionFormSubmitted[t]=!1),e.callActionLoaded=!1)},e.loadCallActionsTemplate=function(t){e.callActions=[];var o={},a=1,i="";if(t.data.json.forEach(function(t){if(e.addCallAction.rule[t.action_order]={},e.ruleDropDown[t.action_order]={},"IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype){var r=Object.assign({},e.names.fields);t.rules.forEach(function(o,a){i="duration"==N(r,o.data_field)?"="==o.operator?"=":"!="==o.operator?"!=":N(e.names.Ct_operators_based_on_fields,o.operator):N(e.names.Ct_operators_based_on_fields,o.operator),"NONE"==o.join_type&&(o.join_type=""),"contains"!==o.operator&&"does not contain"!==o.operator&&"begins with"!==o.operator&&"ends with"!==o.operator||(i=o.operator),e.addCallAction.rule[t.action_order][a]={},e.ruleDropDown[t.action_order][a]={},e.addCallAction.rule[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][a].fields=Object.keys(r),e.ruleDropDown[t.action_order][a].operators=e.names.operators[N(r,o.data_field)],e.ruleDropDown[t.action_order][a].enum=e.names.enum[N(r,o.data_field)],e.ruleDropDown[t.action_order][a].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(a)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][a].fields=N(r,o.data_field),e.addCallAction.rule[t.action_order][a].operators=i,e.addCallAction.rule[t.action_order][a].enum=o.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][a].join_type=o.join_type,e.addCallAction.rule[t.action_order][parseInt(a)+1].join_type=""})}else{var n=Object.assign({},e.names.fields);delete n["Ring to Phone Number"],t.rules.forEach(function(o,a){i="duration"==N(r,o.data_field)?"="==o.operator?"=":"!="==o.operator?"!=":N(e.names.Ct_operators_based_on_fields,o.operator):N(e.names.Ct_operators_based_on_fields,o.operator),"NONE"==o.join_type&&(o.join_type=""),"contains"!==o.operator&&"does not contain"!==o.operator&&"begins with"!==o.operator&&"ends with"!==o.operator||(i=o.operator),e.addCallAction.rule[t.action_order][a]={},e.ruleDropDown[t.action_order][a]={},e.addCallAction.rule[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][parseInt(a)+1]={},e.ruleDropDown[t.action_order][a].fields=Object.keys(n),e.ruleDropDown[t.action_order][a].operators=e.names.operators[N(n,o.data_field)],e.ruleDropDown[t.action_order][a].enum=e.names.enum[N(n,o.data_field)],e.ruleDropDown[t.action_order][a].join_type=["AND","OR"],e.ruleDropDown[t.action_order][parseInt(a)+1].join_type=["AND","OR"],e.addCallAction.rule[t.action_order][a].fields=N(n,o.data_field),e.addCallAction.rule[t.action_order][a].operators=i,e.addCallAction.rule[t.action_order][a].enum=o.comparator.replace(/%/g,""),e.addCallAction.rule[t.action_order][a].join_type=o.join_type,e.addCallAction.rule[t.action_order][parseInt(a)+1].join_type=""})}switch(o={id:t.action_order},t.action){case"email_alert":for(var s=[],l=t.action_target.split(","),c=0;c<l.length;c++){var d={id:a,text:l[c]};s.push(d),a++}var u=t.action_target.replace(/,/g,"");u=u.replace(/ /g,""),e.addCallAction.remainingText[t.action_order]=1024-u.length+" characters are remaining",e.addCallAction.email[t.action_order]=s;break;case"sms_alert":e.addCallAction.phone[t.action_order]=t.action_target;break;case"tag_call":var p=[];t.action_target=t.action_target.split(","),angular.forEach(t.action_target,function(e,t){var o=e.trim();p.push(o)}),e.addCallAction.tagList[t.action_order]=p;break;case"post_event":e.addCallAction.postEvent[t.action_order]=t.action_target;break;case"webhook":e.addCallAction.webhook[t.action_order]=t.action_target;break;case"post_detail":e.addCallAction.sendCallDetails[t.action_order]=t.action_target;break;case"callback":e.addCallAction.callbackFlag[t.action_order]=t.action_target}e.addCallAction.action_id[t.action_order]=t.action_id,e.addCallAction.actionOptions[t.action_order]=t.action,"doubleclick"===t.action&&!1===e.dcSetting&&(e.addCallAction.actionOptions[t.action_order]=""),e.addCallAction.callActionFormSubmitted[t.action_order]=!0,e.callActions.push(o)}),"IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)k(e.addCallAction.actionOptions)&&(e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.remainingText[0]="1024 characters are remaining",e.addCallAction.email[1]=[],e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(k(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1;var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(r)}},e.addCallAction.remainingText[0]="1024 characters are remaining",e.addCallAction.email[1]=[],e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}},n.getWebhooks().then(function(t){if(null==t.data.err||""==t.data.err){for(var o=[],a=0;a<t.data.json.length;a++)"active"===t.data.json[a].webhook_status&&o.push(t.data.json[a]);e.callActionWebhookOptions=o}}),o.getTags().then(function(t){console.log("tags:",t),""===t.data.err&&(e.callActionTaggingOptionsWatch=!1,e.callActionTaggingOptions=t.data.json)}),e.gaSetting=!0,n.getAnalytics().then(function(t){""===t.data.err&&t.data.json.length>0&&(t.data.json[0].all_routes||"inactive"===t.data.json[0].analytic_status)&&(e.gaSetting=!1)}),e.dcSetting=!1,n.callActionDC(u.currentOUId).then(function(t){"success"===t.data.result&&t.data.json.dc_enabled&&(console.log("Setting dcSetting to true"),e.doubleclick_id=t.data.json.doubleclick_id,e.dcSetting=!0)}),e.loadCallActions=function(t){e.addNewStep=!0,void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.showCallActions=!0;e.callActions=[],e.callActions.push({id:1}),e.addCallAction={},e.addCallAction.cfname=t.name,e.addCallAction.routetype=t.routetype,e.addCallAction.rule={},e.addCallAction.action_id={},e.addCallAction.actionOptions={},e.addCallAction.email={},e.addCallAction.phone={},e.addCallAction.tagList={},e.addCallAction.postEvent={},e.addCallAction.webhook={},e.addCallAction.sendCallDetails={},e.addCallAction.callbackFlag={},e.addCallAction.callActionFormSubmitted={},e.addCallAction.remainingText={},e.selectedCallFlow.customSourceList_1="",e.selectedCallFlow.customSourceList_2="",e.selectedCallFlow.customSourceList_3="",e.selectedCallFlow.customSourceList_4="",e.selectedCallFlow.customSourceList_5="",e.ruleDropDown={},e.addCallAction.provisioned_route_id=t.id,e.addCallAction.phoneid=t.phoneid,e.callActionLoaded=!1,n.getcallActions(t.id).then(function(t){if(e.callActionLoaded=!0,"error"!=t.data.result&&t.data.json.length&&t.data.json[0].rules.length>0?e.loadCallActionsTemplate(t):"error"!=t.data.result&&0===t.data.json.length&&T.getCallActions(e.currentOUId).then(function(t){"error"!=t.data.result&&t.data.json.length&&t.data.json[0].rules.length>0&&e.loadCallActionsTemplate(t)}),"IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)k(e.addCallAction.actionOptions)&&(e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.addCallAction.remainingText[1]="1024 characters are remaining",e.ruleDropDown[1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}});else if(k(e.addCallAction.actionOptions)){e.addCallAction.actionOptions[1]="action0",e.addCallAction.callActionFormSubmitted[1]=!1,e.addCallAction.remainingText[1]="1024 characters are remaining";var o=Object.assign({},e.names.fields);delete o["Ring to Phone Number"],e.ruleDropDown[1]={0:{fields:Object.keys(o)}},e.addCallAction.rule[1]={0:{fields:"",operators:"",enum:"",join_type:""}}}}),e.callFlowId&&t.id!==e.provisionedrouteId&&(e.showCallFlow=!1),setTimeout(function(){$("html, body").animate({scrollTop:$("#callActions").offset().top-50},1e3)},100)},e.loadMultiPass=function(){e.showMultiPass=!0,e.showCallFlow=!1,e.selectedCallFlow=[],e.selectedCallFlow.address=null,e.MultCallFlowList=[],b(function(){e.numList=[]},1e3),e.selectedCallFlow.count=0,n.getChannels().then(function(t){"error"!=t.data.result&&(e.channels=t.data.json,angular.forEach(t.data.json,function(e){e.category=e.category.trim(),e.sub_category=e.category+":"+e.sub_category}))}),setTimeout(function(){$("html, body").animate({scrollTop:$("#multiPass").offset().top-50},1e3)},100)},e.addNewCallAction=function(t){if("IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype){o={id:(t=parseInt(t))+1},e.callActions.push(o),e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.addCallAction.actionOptions[t+1]="action0",e.ruleDropDown[t+1]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}else{var o;o={id:(t=parseInt(t))+1},e.callActions.push(o),e.addCallAction.remainingText[t+1]="1024 characters are remaining",e.addCallAction.actionOptions[t+1]="action0";var a=Object.assign({},e.names.fields);delete a["Ring to Phone Number"],e.ruleDropDown[t+1]={0:{fields:Object.keys(a)}},e.addCallAction.email[t+1]=[],e.addCallAction.rule[t+1]={0:{fields:"",operators:"",enum:"",join_type:""}}}},e.addAction=function(){var t,o;e.ivrActions.length>=10?p.notify({title:"IVR Tracking Numbers",text:"only 10 actions are allowed",type:"error"}):(t={id:o=9===e.ivrActions.length?0:e.ivrActions.length+1,action:"",value:"",voiceprompt:!1,whisper:!1,webhook:!1,recordCall:!0,playDisclaimer:"before",voicepromptURL:"",voicepromptId:"",name:"Forward to phone number",ringtonum:""},e.ivrActions.push(t),e.TTSIVRSelected[o-1]=!0)},e.removeIvrAction=function(t){var o=!0;$.each(e.ivrActions,function(a,i){o&&i.id==t&&(e.ivrActions.splice(a,1),e.TTSIVRSelected[a]=e.TTSIVRSelected[a+1],o=!1)}),$.each(e.ivrActions,function(o,a){a.id>t&&0!==t&&(e.ivrActions[o].id=a.id-1,e.TTSIVRSelected[o]=e.TTSIVRSelected[o+1]),0===a.id&&(e.ivrActions[o].id=o+1)})},e.removeCallAction=function(t){var o=!0;$.each(e.callActions,function(a,i){o&&i.id===t&&(angular.isUndefined(e.addCallAction.action_id[t])?(e.callActions.splice(a,1),R(i.id),o=!1):S.confirm("Are you sure you want to delete this Call Action?",function(r){r&&n.removecallActions(e.addCallAction.action_id[t]).then(function(t){"error"!==t.data.result?(p.notify({title:"Call Action",text:"Call Action deleted successfully",type:"success"}),e.callActions.splice(a,1),R(i.id),o=!1):p.notify({title:"Call Action",text:"Error in Deleting in Call Action",type:"success"})})}))})},e.addMultCalls=function(){e.isEditable=!0,e.MultCallFlowList=[];if(console.log("add mult numbers clicked:"+e.selectedCallFlow.count),/\d{3}-[a-z]/i.test(e.selectedCallFlow.address))if(e.selectedCallFlow.count>100)p.notify({title:"Multiple Tracking Numbers",text:"You can add 100 Tracking Numbers at once.",type:"error"});else if(e.numList)if(e.selectedCallFlow.count>=e.numList.length){var t=[],o="",a=0;if(e.numList.pop(),$.each(e.rc,function(a,i){i.address===e.selectedCallFlow.address&&-1===t.indexOf(i.rc)&&void 0!==i.rc&&(t.push(i.rc.trim()),o=i.state.trim())}),t.length>0)for(var i=0;i<t.length&&0==a;i++)if(null!==t[i]||""!==t[i]){var r=A.defer();return n.getThirdPartyNumbers(o,t[i]).then(function(t){console.log(t),"error"!==t.data.result&&"fail"!==t.data.json[0]?(a=1,angular.forEach(t.data.json,function(t){e.numList.push(t)}),n.getDefaultData(e.currentOUId).then(function(t){if(e.selectedCallFlow.count<=e.numList.length){for(var o=0;o<e.selectedCallFlow.count;o++){var a={number:e.numList[o].number,source:e.numList[o].source,pretty_number:e.numList[o].pretty_number,numberid:e.numList[o].number_id,vendor_id:e.numList[o].vendor_id,name:"",value:"",channel:"",repeatint:72,ringto:"",recordcall:"yes",customTaggingOptions:e.customTaggingOptions,selectCustomOptions:e.selectCustomOptions};if(t.data.json.callFlowData.callFlowData.length>0){var i=t.data.json.callFlowData.callFlowData[0];a.repeatint=i.repeat_interval_call,a.ringto=i.ring_to_number,a.recordcall=!0===i.record_call?"yes":"no"}e.MultCallFlowList.push(a)}r.resolve()}else p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"})})):p.notify({title:"Multiple Tracking Number",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"})}),r.promise}}else{if(!(e.selectedCallFlow.count<=e.numList.length))return void p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});n.getDefaultData(e.currentOUId).then(function(t){for(var o=0;o<e.selectedCallFlow.count;o++){var a={number:e.numList[o].number,source:e.numList[o].source,pretty_number:e.numList[o].pretty_number,numberid:e.numList[o].number_id,vendor_id:e.numList[o].vendor_id,name:"",value:"",channel:"",repeatint:72,ringto:"",recordcall:"yes",customTaggingOptions:e.customTaggingOptions,selectCustomOptions:e.selectCustomOptions};if(t.data.json.callFlowData.callFlowData.length>0){var i=t.data.json.callFlowData.callFlowData[0];a.repeatint=i.repeat_interval_call,a.ringto=i.ring_to_number,a.recordcall=!0===i.record_call?"yes":"no"}e.MultCallFlowList.push(a)}})}else p.notify({title:"Multiple Tracking Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else p.notify({title:"Multiple Tracking Numbers",text:"invalid location",type:"error"})},e.recordoptions=[{id:1,text:"yes"},{id:2,text:"no"}],e.showRecordOptions=function(t){if(t.recordcall&&e.recordoptions.length){var o=a("filter")(e.recordoptions,{text:t.recordcall});return o.length?o[0].text:"yes"}return t.recordcall||"yes"},e.showRemoveRule=function(e){var t=0;return $.each(e,function(e,o){k(o)||(t+=1)}),t>1},e.showNumber=function(e){return 1===e?"First":2===e?"Second":3===e?"Third":4===e?"Fourth":5===e?"Fifth":6===e?"Sixth":7===e?"Seventh":8===e?"Eighth":9===e?"Ninth":10===e?"Tenth":""},e.selectedCallFlow.voicePrompt1=!0,e.selectedCallFlow.voicePromptTTSText="",e.TTSSelected=!0,e.ivrActions=[{id:1,action:"",value:"",voiceprompt:!1,recordCall:!0,playDisclaimer:"before",whisper:!1,webhook:!1,voicepromptURL:"",name:"Forward to phone number",ringtonum:""}],e.channels=[{value:1,text:"Online: Paid Search"},{value:2,text:"Online: Organic Search"},{value:3,text:"Online: Display"},{value:4,text:"Online: Email"},{value:5,text:"Offline: Direct Mail"},{value:6,text:"Offline: Magazine"},{value:7,text:"Mobile: Paid Search"},{value:8,text:"Mobile: Organic Search"}],e.groups=[{id:1,text:"active"},{id:2,text:"inactive"}],n.getVoicePrompts(u.currentOUId).then(function(t){if("error"!=t.data.result&&(e.prompts=t.data.json,e.prompts))for(var o=0;o<e.prompts.length;o++)e.prompts[o].selectedprompt=!1}),e.georoutelocations=[],n.getWhispers(u.currentOUId).then(function(t){if("error"!=t.data.result&&(e.whispers=t.data.json,e.whispers))for(var o=0;o<e.whispers.length;o++)e.whispers[o].selectedwhisper=!1}),e.getGeoLocationList=function(){n.getGeoLocations().then(function(t){if("error"!=t.data.result){var o=t.data.json.locations;e.georoutelocations=[],o.forEach(function(t){t.count>0&&e.georoutelocations.push({id:t.id,name:t.name,routes:t.routes})})}})},o.getTags().then(function(t){if(""===t.data.err){for(var o=0;o<t.data.json.length;o++)"callback"===t.data.json[o].tag_name&&(e.callbackid=t.data.json[o].tag_id);if(e.callbackid<0){var a={tag:{tag_name:"callback",org_unit_id:u.currentOUId}};n.createTag(a).then(function(e){console.log(e)})}}});$("#filecontrol");function F(e){return!!/^[0-9]+$/.test(e)}e.$on("$destroy",function(){void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause()}),e.removeSelectedVoiceAudio=function(){void 0!==e.promptAudio&&e.promptAudio.pause(),e.promptAudio=void 0,e.selectedCallFlow.voiceURL=void 0,e.selectedCallFlow.voicePromptTTSText="",e.TTSSelected=!0,e.hasValidVoiceURL=!1},e.removeSelectedIVRVoiceAudio=function(t){void 0!==e.ivrActions[t].ivrAudio&&e.ivrActions[t].ivrAudio.pause(),e.ivrActions[t].ivrAudio=void 0,e.ivrActions[t].voicepromptURL=void 0,e.ivrActions[t].voicepromptTTSText="",e.TTSIVRSelected[t]=!0,e.hasValidTTSVoiceURL[t]=!1},e.playVoiceAudio=function(t){console.log("url is: %s",t),console.log("voicePromptTTSText is: %s",e.selectedCallFlow.voicePromptTTSText),void 0===e.promptAudio||e.promptAudio.paused?void 0!==e.promptAudio&&e.promptAudio.paused?e.promptAudio.play():void 0!==e.selectedCallFlow.voicePromptTTSText&&e.selectedCallFlow.voicePromptTTSText.length>0?(e.promptAudio=new Audio,e.onTTS_VP_Request=!0,n.getTTS(e.selectedCallFlow.voicePromptTTSText).then(function(t){if(t.data){var o="data:audio/mp3;base64,"+t.data.json;e.promptAudio.src=o,e.promptAudio.paused?e.promptAudio.play():e.promptAudio.pause()}e.onTTS_VP_Request=void 0})):(e.promptAudio=new Audio(t),e.promptAudio.play()):e.promptAudio.pause()},e.playWhisperAudio=function(t){console.log("DD1 playWhisperAudio"),void 0===e.whisperAudio||e.whisperAudio.paused?void 0!==e.whisperAudio&&e.whisperAudio.paused?e.whisperAudio.play():void 0!==e.selectedCallFlow.whisperTTSText&&e.selectedCallFlow.whisperTTSText.length>0?(e.whisperAudio=new Audio,e.onTTS_WH_Request=!0,n.getTTS(e.selectedCallFlow.whisperTTSText).then(function(t){if(t.data){var o="data:audio/mp3;base64,"+t.data.json;e.whisperAudio.src=o,e.whisperAudio.play()}e.onTTS_WH_Request=void 0})):(e.whisperAudio=new Audio(t),e.whisperAudio.play()):e.whisperAudio.pause()},e.playTTSVoiceAudio=function(t){void 0===e.ivrActions[t].ivrAudio||e.ivrActions[t].ivrAudio.paused?void 0!==e.ivrActions[t].ivrAudio&&e.ivrActions[t].ivrAudio.paused?e.ivrActions[t].ivrAudio.play():e.ivrActions[t].voicepromptTTSText.length>0?(e.ivrActions[t].ivrAudio=new Audio,e.onTTS_IVR_Request=!0,n.getTTS(e.ivrActions[t].voicepromptTTSText).then(function(o){if(o.data.json){var a="data:audio/mp3;base64,"+o.data.json;e.ivrActions[t].ivrAudio.src=a,e.ivrActions[t].ivrAudio.paused?e.ivrActions[t].ivrAudio.play():e.ivrActions[t].ivrAudio.pause()}e.onTTS_IVR_Request=void 0})):(e.ivrActions[t].ivrAudio=new Audio(e.ivrActions[t].voicepromptURL),e.ivrActions[t].ivrAudio.play()):e.ivrActions[t].ivrAudio.pause()},e.removeSelectedWhisperAudio=function(){void 0!==e.whisperAudio&&e.whisperAudio.pause(),e.whisperAudio=void 0,e.selectedCallFlow.whisperURL=void 0,e.selectedCallFlow.whisperTTSText="",e.TTSWhisperSelected=!0,e.hasValidWhisperURL=!1},e.showChannel=function(t){var o=[];return t&&(o=a("filter")(e.channels,{channel_id:t})),o.length?o[0].sub_category:"--Select--"},e.saveUser=function(e,t){angular.extend(e,{id:t})},e.removeNumber=function(t){void 0!==e.promptAudio&&e.promptAudio.pause(),void 0!==e.ivrAudio&&e.ivrAudio.pause(),void 0!==e.whisperAudio&&e.whisperAudio.pause();var o;o={provisioned_route:{ids:[t.id]}},S.confirm("Are you sure you want to delete this Tracking Number?",function(e){e&&n.removeCallFlow(o).then(function(e){""===e.data.err?(p.notify({title:"Remove Tracking Number",text:"Tracking Number removed successfully.",type:"success"}),c.reload()):p.notify({title:"Remove Tracking Number",text:e.data.err.data,type:"error"})})})},e.arrRequired=[],e.validateData=function(e,t){if(!e)return"   "},e.isCampaignInReferralStage=!1,e.proceedToSaveTable=function(t){if(e.isCampaignInReferralStage=!1,!0!==e.campActive&&void 0!==e.dateTime.endDate.date&&e.showReferral&&e.referralChecked){var o=e.referralNumber.replace(/\D/g,"");moment(e.dateTime.endDate.date).isBefore(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))&&10===o.length&&(e.isCampaignInReferralStage=!0)}e.date_changed=!1,!0!==e.campActive&&!1===e.isCampaignInReferralStage?S.confirm("Activating Tracking Number will also activate campaign, do you want to continue?",function(o){o?(moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A"))&&(e.dateTime.startDate.date=moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A")),e.dateTime.endDate.date=null,e.date_changed=!0,e.campActive=!0,e.saveTable(t)):(e.showSubmit(),e.showSaveButton())}):e.saveTable(t)},e.saveTable=function(o){if(o.$invalid)return setTimeout(function(){o.$show()},50),!1;var a,i=[],r=[],s=!0!==e.campActive?"inactive":"active",m=!0!==e.campActive?"inactive":"active";!0===e.isCampaignInReferralStage&&(s="referral");for(var g=e.MultCallFlowList.length;g--;){var f,h=[{custom_source_id:e.MultCallFlowList[g].customSourceList_1,custom_source_type:"CS1"},{custom_source_id:e.MultCallFlowList[g].customSourceList_2,custom_source_type:"CS2"},{custom_source_id:e.MultCallFlowList[g].customSourceList_3,custom_source_type:"CS3"},{custom_source_id:e.MultCallFlowList[g].customSourceList_4,custom_source_type:"CS4"},{custom_source_id:e.MultCallFlowList[g].customSourceList_5,custom_source_type:"CS5"}];r.push(e.MultCallFlowList[g].name),e.MultCallFlowList[g].ringto=t.unMaskData(e.MultCallFlowList[g].ringto),console.log(e.MultCallFlowList[g]),f="yes"===e.MultCallFlowList[g].recordcall?"":"2015-02-24 00:00:00",a={provisioned_route:{route_type:"simple",name:e.MultCallFlowList[g].name,org_unit_id:u.currentOUId,repeat_interval:e.MultCallFlowList[g].repeatint,call_value:e.MultCallFlowList[g].value},call_flow:{tracking_number:e.MultCallFlowList[g].number,organizational_unit_id:u.currentOUId,ringto:e.MultCallFlowList[g].ringto,route_type:"simple",play_disclaimer:"before",record_until:f,whisper_enabled:"0",whisper_type:"text",whisper_message:" ",message_enabled:"0",message_type:"text",message:" ",status:s,customSourceList:h},channel:{id:e.MultCallFlowList[g].channel}},"inventory"===e.MultCallFlowList[g].source?a.phone_number={id:e.MultCallFlowList[g].numberid,vendor_id:e.MultCallFlowList[g].vendor_id,source:e.MultCallFlowList[g].source,number_ou_id:void 0==e.MultCallFlowList[g].number_ou_id?u.currentOUId:e.MultCallFlowList[g].number_ou_id}:a.phone_number={number:e.MultCallFlowList[g].numberid,vendor_id:e.MultCallFlowList[g].vendor_id,source:e.MultCallFlowList[g].source,number_ou_id:void 0==e.MultCallFlowList[g].number_ou_id?u.currentOUId:e.MultCallFlowList[g].number_ou_id},i.push(a)}var v=r;if(_.uniq(r).length!==v.length)return p.notify({title:"Multiple Tracking Numbers",text:"Duplicate Tracking Number names are not allowed to save.",type:"error"}),setTimeout(function(){o.$show()},50),!1;if(p.notify({title:"Save Tracking Number",text:"Saving....",type:"success"}),e.Id)a={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:m,timezone:u.timezone},call_flows:i},console.log(a),n.createCallFlow(a).then(function(t){""===t.data.err?(p.notify({title:"Multiple Tracking Numbers",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})});else{var b={campaign:{name:e.name,org_unit_id:u.currentOUId,external_id:e.campExtId?e.campExtId:"",start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,status:e.campaignStatus,timezone:u.timezone},call_flows:i};console.log(JSON.stringify(b)),n.createCampaign(b).then(function(t){e.formSubmit=!1,console.log(t),""===t.data.err?(p.notify({title:"Create Campaign",text:"Campaign created successfully.",type:"success"}),d.Id=t.data.json.campaign.campaign_id,l.search("id",d.Id),e.Id=t.data.json.campaign.campaign_id,c.reload()):p.notify({title:"Create Campaign",text:t.data.err,type:"error"})})}},e.loadNextValue=function(t,o,a,i){if("IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)"fields"==o?e.ruleDropDown[a][i][o]=Object.keys(e.names.fields):"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum="")),"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="");else{var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],"fields"==o?e.ruleDropDown[a][i][o]=Object.keys(r):"join_type"!==o&&(e.ruleDropDown[a][i][o]=e.names[o][e.addCallAction.rule[a][i][t]],"operators"===o&&(e.addCallAction.rule[a][i].operators="",delete e.ruleDropDown[a][i].enum,e.addCallAction.rule[a][i].enum="")),"join_type"==o&&angular.isUndefined(e.ruleDropDown[a][parseInt(i)+1])&&angular.isUndefined(e.addCallAction.rule[a][parseInt(i)+1])&&(e.ruleDropDown[a][parseInt(i)+1]={},e.ruleDropDown[a][parseInt(i)+1].join_type=["AND","OR"],e.addCallAction.rule[a][parseInt(i)+1]={},e.addCallAction.rule[a][parseInt(i)+1].join_type="")}},e.removeRule=function(t,o){var a,i=Object.keys(e.addCallAction.rule[o]).map(function(e){return e});a=i.indexOf(t)===i.length-1,e.addCallAction.callActionFormSubmitted[o]=!1,delete e.ruleDropDown[o][t],delete e.addCallAction.rule[o][t];var r=Object.keys(e.ruleDropDown[o]).map(function(e){return e}),n=Object.keys(e.ruleDropDown[o][r[0]]).map(function(e){return e});if("IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)"join_type"===n[0]&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields&&(e.ruleDropDown[o]={0:{fields:Object.keys(e.names.fields)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}));else if("join_type"===n[0]&&(e.addCallAction.rule[o][r[0]].join_type="",delete e.ruleDropDown[o][r[0]].join_type,void 0===e.ruleDropDown[o][r[0]].fields)){var s=Object.assign({},e.names.fields);delete s["Ring to Phone Number"],e.ruleDropDown[o]={0:{fields:Object.keys(s)}},e.addCallAction.rule[o]={0:{fields:"",operators:"",enum:"",join_type:""}}}a&&(e.addCallAction.rule[o][t]={},e.ruleDropDown[o][t]={},e.addCallAction.rule[o][t].join_type="",e.ruleDropDown[o][t].join_type=["AND","OR"])},e.getTagClass=function(e){console.log(e)},e.saveCallAction=function(t,o){e.disableSaveButton=!0;var a=[],i=[],r=[],s={};e.invalidNumber=!1;var l=!1;t=parseInt(t);if(_.each(e.callActions,function(o){e.errorEmail="";var n,c=1,d=1;switch(e.invalidNumber=!1,e.invalidEmailIds=[],e.errors={},t=o.id,e.errors[t]={},e.addCallAction.actionOptions[t]){case"email_alert":var u=[];void 0===(s=e.addCallAction.email[t])&&(s=[]);for(var m=0;m<s.length;m++){angular.isUndefined(s[m].text)||!s[m].text.length||/^[_a-zA-Z0-9]*['a-zA-Z0-9]*[-a-zA-Z0-9]*[\.a-zA-Z0-9]*@[a-zA-Z0-9-]+(\.a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})*(\.[a-zA-Z]{2,4})/.test(s[m].text.trim())||(i.push(s[m].text),e.invalidEmailIds.push(s[m].text)),u.push(s[m].text.trim())}var g=_.uniq(u).join(",");(g=g.replace(/,/g,"")).length>1024&&(e.errorEmail="No of characters should not be greater than 1024"),s=_.uniq(u),e.addCallAction.email[t]=[];var f=Math.floor(1e3+9e3*Math.random());for(m=0;m<s.length;m++){var h={id:m+1+f,text:s[m]};e.addCallAction.email[t].push(h)}e.addCallAction.remainingText[t]=1024-g.length+" characters are remaining";break;case"sms_alert":var v=angular.copy(e.addCallAction.phone[t]);if(v)10!=v.replace(/[()_\-\s]/gi,"").length&&(e.invalidNumber=!0,i.push("Phone Number"));s=e.addCallAction.phone[t];break;case"tag_call":s=e.addCallAction.tagList[t];break;case"post_event":s=e.addCallAction.postEvent[t];break;case"webhook":s=e.addCallAction.webhook[t];break;case"post_detail":s=e.addCallAction.sendCallDetails[t];break;case"callback":s=e.callbackid.toString();break;case"doubleclick":s=void 0!==e.doubleclick_id?e.doubleclick_id:null;break;case"analytic":s=null}if(angular.isArray(s)&&(s=s.join(", ")),k(e.addCallAction.rule[t])&&1===d&&(r.push("Rule"),d+=1),_.each(e.addCallAction.rule[t],function(o,a){(!k(o)&&void 0!==o.fields||!k(o)&&!k(o.join_type))&&((k(o.fields)||k(o.enum)||k(o.operators))&&(k(o.enum)&&(e.errors[t][a]=!0),1===d&&(r.push("Rule"),d+=1)),k(o.enum)||"referring source"!=o.fields||"contains"!=o.operators&&"does not contain"!=o.operators||(o.enum.startsWith("*.")||o.enum.endsWith(".*"))&&(1===c&&(i.push("WildCard only Support With is/is not for referring source."),c+=1),e.errors[t][a]=!0),k(o.enum)||("duration"==o.fields&&!F(o.enum)||"caller id"==o.fields&&(!F(o.enum)||o.enum.length>10))&&(1===c&&(i.push("Rule Value"),c+=1),e.errors[t][a]=!0))}),angular.isArray(s)?k(s)&&r.push("Action"):""!==s&&void 0!==s||r.push("Action"),"action0"==e.addCallAction.actionOptions[t]&&r.push("Action Target"),r.length||i.length||e.errorEmail.length)return l=!0,r.length&&(n="field is required.",r.length>1&&(n="fields are required."),p.notify({title:"Call Action",text:"'"+r.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1),e.errorEmail.length>0&&(p.notify({title:"Call Action",text:e.errorEmail,type:"error"}),e.disableSaveButton=!1),e.invalidEmailIds.length>0?(n="Invalid email address entered. Please fix highlighted errors and re-save",p.notify({title:"Call Action",text:"'"+e.invalidEmailIds.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1):i.length&&(n="field is invalid.",i.length>1&&(n="fields are invalid."),p.notify({title:"Call Action",text:"'"+i.join(", ")+"' "+n,type:"error"}),e.disableSaveButton=!1),$(".invalidList").css({"background-color":"red",border:"1px solid red"}),i=[],r=[],!1;var b={provisioned_route_id:e.addCallAction.provisioned_route_id,action_id:e.addCallAction.action_id[t],action_order:t,rules:function(t){var o=[],a="";for(var i in t){if("contains"===t[i].operators||"does not contain"===t[i].operators||"begins with"===t[i].operators||"ends with"===t[i].operators?t[i].operators:e.names.Ct_operators[t[i].operators],a="NONE",t[i].join_type.length&&(a=t[i].join_type),"IVR"==e.addCallAction.routetype||"ivr"==e.addCallAction.routetype)t[i].fields&&o.push({data_field:e.names.fields[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a});else{var r=Object.assign({},e.names.fields);delete r["Ring to Phone Number"],t[i].fields&&o.push({data_field:r[t[i].fields],operator:e.names.Ct_operators[t[i].operators],comparator:t[i].enum,join_type:a})}}return o}(e.addCallAction.rule[t]),action:e.addCallAction.actionOptions[t],action_target:s};a.push(b)}),l)return!1;n.saveBulkCallActions(a).then(function(o){e.addNewStep=!0,"success"===o.data.result?(p.notify({title:"Save Call Action",text:"Successfully saved Call Actions",type:"success"}),e.disableSaveButton=!1,e.addCallAction.action_id[t]=o.data.json.insertId,c.reload()):(p.notify({title:"Save Call Action",text:o.data.err.data,type:"error"}),e.disableSaveButton=!1)})},e.setCreateAnother=function(){e.bCreateAnother=!0},e.getCallFlowList=function(t){n.getCampaign(t).then(function(t){if(t)if("error"!==t.data.result){e.phoneNumbers=[],e.isNew=!0;var o=t.data.json.campaigns[0];e.selectedCallFlow.name="",e.selectedCallFlow.num="",e.bCreateAnother=!1,e.selectedCallFlow.id&&(e.selectedCallFlow.id=null),"numberPool"===e.selectedCallFlow.callflowOption&&(e.selectedCallFlow.numberPool=""),o.provisioned_routes.forEach(function(t){if(t.phone_numbers.length>0){var o="",a="",i="",r=t.status.charAt(0).toUpperCase();t.status=r+t.status.substr(1),t.channels[0]&&(o=t.channels[0].category,a=t.channels[0].sub_category,i=t.channels[0].id),t.phone_numbers[0].number,angular.isUndefined(t.pool)?e.phoneNumbers.push({id:t.id,phoneid:t.phone_numbers[0].id,phone:t.phone_numbers[0].number,phonep:t.phone_numbers[0].pretty_number,name:t.name,channels:o+":"+a,channelId:i,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY")}):e.phoneNumbers.push({id:t.id,phonep:t.name,pooId:t.pool[0].pool_id,quantity:t.pool[0].quantity,state:t.pool[0].state,rate_center:t.pool[0].rate_center,name:t.name,channels:o+":"+a,channelId:i,status:t.status,value:t.call_value,rinterval:t.repeat_interval,status2:t.status,group:4,groupName:"admin",vendor_id:t.phone_numbers[0].vendor_id,end_date:moment.utc(t.referral_end_date).format("MM/DD/YYYY")})}}),e.singlecallForm.$setPristine(),e.showSubmit(),console.log("LOADED IN PHONE NUMBERS",e.phoneNumbers)}else"error"===t.data.result&&console.log("ERROR getCampaign CWS")}),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)},e.proceedToCallFlowUpdate=function(){e.date_changed=!1,!0===e.cfactive&&!0!==e.campActive?S.confirm("Activating Tracking Number will also activate campaign, do you want to continue?",function(t){t?(moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A"))&&(e.dateTime.startDate.date=moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A")),e.dateTime.endDate.date=null,e.date_changed=!0,e.saveCallFlow()):(e.showSubmit(),e.showSaveButton())}):e.isNewCamp||!0===e.cfactive?e.saveCallFlow():1==e.originalcfactive?S.confirm("Are you sure you want to deactivate this Tracking Number?",function(t){t?(moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A"))&&(e.dateTime.startDate.date=moment.tz(u.timezone).format("DD-MM-YYYY hh:mm A")),e.dateTime.endDate.date=null,e.date_changed=!0,e.saveCallFlow()):(e.showSubmit(),e.showSaveButton())}):e.saveCallFlow()},e.checkLDM=function(t){var o={trackingNumber:"",ringToNumbers:[]};switch(e.isNew?"reservedNumber"===e.selectedCallFlow.callflowOption?o.trackingNumber=e.selectedCallFlow.num.number.toString():o.trackingNumber=e.selectedCallFlow.address.substring(0,3):o.trackingNumber=e.selectedCallFlow.phonep.replace(/[^0-9]+/g,"").toString(),e.selectedCallFlow.routetype){case"PercentageBasedRoute":_.pluck(e.percentageRingtoNum,"ringtonum").forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))});break;case"outbound":break;case"voicemail":case"hangup":return void t(!0);case"schedule":for(var a=0;a<e.scheduleInfo.length;a++){var i=[];(i=_.map(e.scheduleInfo[a].overflowNumbers,"overflowNumber")).push(e.scheduleInfo[a].ringTo),i.push(e.selectedCallFlow.ringtoNum),(i=_.compact(i)).forEach(function(e){o.ringToNumbers.push(e.replace(/[^0-9]+/g,"").substring(0,3))})}break;case"ivr":var r=_.sortBy(e.ivrActions,"action_order");if(_.filter(r,function(e){return"qHangup"===e.action}).length===r.length)return void t(!0);_.each(r,function(e){e.ringtoNum&&o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.length>0&&_.each(e,function(e){e.ringtoNum&&o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e&&e.length>0&&_.each(e,function(e){o.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3))})})});break;default:o.ringToNumbers=[e.selectedCallFlow.ringtoNum.replace(/[^0-9]+/g,"")]}n.checkLDM(o).then(function(e){if(e.data.isLDM){var o="The "+e.data.numberType+" you have selected belongs to "+e.data.rateCenter+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes. Click OK to continue.";S.confirm(o,function(e){t(e)})}else t(!0)})},e.saveCallFlow=function(){if(e.singlecallForm.$invalid)return e.showSubmit(),void e.showSaveButton();var o,a,i,r=null,s=null,l=null,d="",m="",f=null,h="",v="",b=[],w="",y=[],S=[],C={},A=[],T={},D="";if("undefined"==this.selectedCallFlow.value&&(this.selectedCallFlow.value=null),"undefined"==this.selectedCallFlow.rinterval&&(this.selectedCallFlow.rinterval=null),e.selectedCallFlow.ringtoNum=t.unMaskData(e.selectedCallFlow.ringtoNum),e.flowname=this.selectedCallFlow.name,e.category=this.selectedCallFlow.channel.category,e.sub_category=this.selectedCallFlow.channel.sub_category,e.callFlowvalue=this.selectedCallFlow.value,e.callFlowrinterval=this.selectedCallFlow.rinterval,e.browserAgentName=g.navigator.userAgent,e.browserAgentName.indexOf("firefox")>-1&&(D=moment(e.dateTime.startDate.date).isBefore(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))),e.browserAgentName.indexOf("chrome")>-1&&(D=moment(e.dateTime.startDate.date).isAfter(moment.tz(u.timezone).format("DD-MMMM-YYYY hh:mm A"))),a=!0!==e.campActive?"inactive":"active",e.callFlowstatus=!0!==e.cfactive?"inactive":"active","inactive"===a&&void 0!==e.dateTime.endDate.date&&e.showReferral&&e.referralChecked){console.log("In referral condition **************");var I=e.referralNumber.replace(/\D/g,"");console.log(I.length),moment(e.dateTime.endDate.date).isBefore(moment.tz(u.timezone).format("DD MMMM YYYY hh:mm A"))&&10===I.length&&(e.callFlowstatus="referral")}if(null!==e.dateTime.startDate.date&&D&&1==e.cfactive)return e.showSaveButton(),void p.notify({title:"Save Tracking Number",text:"Cannot activate Tracking Number, Campaign is set to future date.",type:"error"});!0===e.selectedCallFlow.recordCall?i="":(i="2015-02-24 00:00:00",e.selectedCallFlow.playDisclaimer="never"),!0===e.selectedCallFlow.voicePrompt1?(f="1",e.TTSSelected?(h="text",v=e.selectedCallFlow.voicePromptTTSText):(h="file",v=e.selectedCallFlow.voicePromptFileName,A.push(e.selectedCallFlow.voicePromptId))):f="0",!0===e.selectedCallFlow.whisperPrompt1?(l="1",e.TTSWhisperSelected?(d="text",m=e.selectedCallFlow.whisperTTSText):(d="file",m=e.selectedCallFlow.whisperFileName,A.push(e.selectedCallFlow.whisperId))):l="0";var N,k=[{custom_source_id:e.selectedCallFlow.customSourceList_1,custom_source_type:"CS1"},{custom_source_id:e.selectedCallFlow.customSourceList_2,custom_source_type:"CS2"},{custom_source_id:e.selectedCallFlow.customSourceList_3,custom_source_type:"CS3"},{custom_source_id:e.selectedCallFlow.customSourceList_4,custom_source_type:"CS4"},{custom_source_id:e.selectedCallFlow.customSourceList_5,custom_source_type:"CS5"}],R=[],F=[],x={},L={};switch(e.selectedCallFlow.routetype){case"geo":if(N=e.selectedCallFlow.routetype,s=e.selectedCallFlow.routeBy,F.push(e.selectedCallFlow.geoList),f="0","numberPool"!==e.selectedCallFlow.callflowOption&&t.unMaskData(e.selectedCallFlow.ringtoNum)===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number))return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),void e.showSaveButton();v="",h="",L={location_ids:F},x={strategy:s};var O={};if(O=_.find(e.georoutelocations,function(t){return parseInt(e.selectedCallFlow.geoList)===t.id})){for(var U=0;U<O.routes.length;U++)if("numberPool"!==e.selectedCallFlow.callflowOption&&O.routes[U].target===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number))return p.notify({title:"Tracking Number Details Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),void e.showSaveButton();O={}}if("Claimed"!=s&&(r=e.selectedCallFlow.radius,x.radius=r),e.selectedCallFlow.geoRouteId){var P=[];P.push(e.selectedCallFlow.geoRouteId),x.id=P}break;case"ivr":e.selectedCallFlow.playDisclaimer="never";var M,j=0,V=0,E=[],Y=!1;if(e.ivrActions.forEach(function(o){var a;V+=1;var i=null,n=0,l=[],c="",d=0;if(o.recordCall&&"qHangup"!==o.action&&(d=1,c=o.playDisclaimer),a="qHangup"===o.action?"hangup":t.unMaskData(o.ringtoNum),"numberPool"!==e.selectedCallFlow.callflowOption&&a===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number)&&E.push(a),_.isEmpty(E)||(p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSaveButton(),Y=!0),"qGeo"===o.action){a="",a=t.unMaskData(o.ringtoNum),!0,s=o.routeBy,l.push(o.geoList),L={location_ids:l},x={strategy:s};var m={};if(m=_.find(e.georoutelocations,function(e){return parseInt(o.geoList)===e.id})){for(var g=0;g<m.routes.length;g++)if("numberPool"!==e.selectedCallFlow.callflowOption&&m.routes[g].target===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number))return p.notify({title:"Tracking Number Details Form",text:"Location Ring to phone number cannot be same as tracking number.",type:"error"}),e.showSaveButton(),void(Y=!0);m={}}if("Claimed"!=s&&(r=o.radius,x.radius=r),o.geoRouteId&&e.selectedCallFlow.id){var f=[];f.push(o.geoRouteId),x.id=f}}o.voiceprompt&&(n=1,e.TTSIVRSelected[j]?(M="text",i=o.voicepromptTTSText):(M="file",i=o.voicepromptFileName,A.push(o.voicepromptId))),"qGeo"===o.action?R.push({ivr:{value:o.id,route_type:"geo",name:o.ringtoname,ouid:u.currentOUId,play_disclaimer:c,record_enabled:d,message_enabled:n,message_type:M,message:i,webhook_enabled:e.selectedCallFlow.showWebhook?1:0,action_order:V,default_ringto:a},geo_route:x,geo_options:L}):R.push({ivr:{value:o.id,target_did:a,name:o.ringtoname,ouid:u.currentOUId,play_disclaimer:c,record_enabled:d,message_enabled:n,message_type:M,message:i,webhook_enabled:e.selectedCallFlow.showWebhook?1:0,action_order:V}}),j++}),console.log("ivrActions",e.ivrActions),N=e.selectedCallFlow.routetype,Y)return;break;case"hangup":console.log("hangup selected"),N="simple",e.selectedCallFlow.ringtoNum="hangup";break;case"simple":if(console.log("simple selected"),"numberPool"!==e.selectedCallFlow.callflowOption&&t.unMaskData(e.selectedCallFlow.ringtoNum)===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number))return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),void e.showSaveButton();N=e.selectedCallFlow.routetype;break;case"PercentageBasedRoute":for(var z=[],B=0,q=0;q<e.percentageRingtoNum.length;q++)if(console.log(e.percentageRingtoNum[q].percentage),e.percentageRingtoNum[q].percentage&&(B+=parseInt(e.percentageRingtoNum[q].percentage),z.push({ringto:t.unMaskData(e.percentageRingtoNum[q].ringtonum),percentage:parseInt(e.percentageRingtoNum[q].percentage),activateVoicemail:!1,simultaneousRings:!1,route_order:1})),"numberPool"!==e.selectedCallFlow.callflowOption&&t.unMaskData(e.percentageRingtoNum[q].ringtonum)===(e.selectedCallFlow.phone||e.selectedCallFlow.num.number))return p.notify({title:"Tracking Number Details Form",text:"Ring to phone number cannot be same as tracking number.",type:"error"}),void e.showSaveButton();if(B>100)return e.showSaveButton(),void p.notify({title:"Percentage Call route",text:"Percentage is greater than 100 ",type:"error"});if(B<100)return e.showSaveButton(),void p.notify({title:"Percentage Call route",text:"Percentage is less than 100 ",type:"error"});e.selectedCallFlow.ringtoNum="",N=e.selectedCallFlow.routetype}var W={};if(e.selectedCallFlow.showDNI){console.log("showDNI is set");var G=e.selectedCallFlow.referrer.split("|"),H=G[0];e.selectedCallFlow.referrer_type=G[1],e.selectedCallFlow.referrer_type||(e.selectedCallFlow.referrer_type=null),W={provisioned_route_id:e.selectedCallFlow.id,org_unit_id:u.currentOUId,dni_setting_id:e.selectedCallFlow.dni_setting_id,destination_url:e.selectedCallFlow.destination_url,dni_type:e.selectedCallFlow.dniType,dni_element:e.selectedCallFlow.dni_element,referrer:H,referrer_type:e.selectedCallFlow.referrer_type,dni_ttl:e.selectedCallFlow.dni_ttl};var J=n.validateDniData(W,e.showReferrerTextBox);if(J.length)return e.showSaveButton(),void p.notify({title:"Save Tracking Number",text:"'"+_.uniq(J).join(","),type:"error"})}e.checkLDM(function(t){if(t){if(p.notify({title:"Save Tracking Number",text:"Saving....",type:"success"}),e.Id){var r={},s=[];if(e.selectedCallFlow.id)if("numberPool"!==e.selectedCallFlow.callflowOption){console.log("Not number pool");if(_.each(e.numList,function(t){t.id===e.selectedCallFlow.phoneid&&t.source}),s.push({provisioned_route:{route_type:N,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:e.selectedCallFlow.org_unit_id,id:e.selectedCallFlow.id},call_flow:{id:e.callFlowId,provisioned_route_id:e.selectedCallFlow.id,tracking_number:e.selectedCallFlow.phone,organizational_unit_id:e.selectedCallFlow.org_unit_id,ringto:e.selectedCallFlow.ringtoNum,route_type:N,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:l,whisper_type:d,whisper_message:m,message_enabled:f,message_type:h,message:v,record_until:i,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:k,spam_active:e.selectedCallFlow.spamActive},phone_number:{id:e.selectedCallFlow.phoneid,vendor_id:e.selectedCallFlow.vendor_id,source:"inventory"},channel:{id:e.selectedCallFlow.channel.channel_id}}),"ivr"===e.selectedCallFlow.routetype){var g=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];s[0].ivrs=g,s[0].multiIvrs=R}"PercentageBasedRoute"===e.selectedCallFlow.routetype&&(s[0].ringto_percentage=z),"geo"===e.selectedCallFlow.routetype&&(s[0].geo_route=x,s[0].geo_options=L),e.selectedCallFlow.showDNI&&(s[0].dni_setting=W),r={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:a,timezone:u.timezone},call_flows:s},n.saveCallFlow(r).then(function(t){e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,console.log("Error Response Save Tracking Number:",JSON.stringify(t.data.err)),""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.name="",e.isNew=!0,e.selectedCallFlow.callflowOption="singleNumber"):c.reload()):p.notify({title:"Updated Tracking Number",text:t.data.err,type:"error"})})}else{var A=e.selectedCallFlow.numberPool-e.oldQuantity;if(console.log(e.selectedCallFlow.id),s.push({number_pool:{id:e.pool_id,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:N,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:e.selectedCallFlow.org_unit_id,id:e.selectedCallFlow.id},call_flow:{id:e.callFlowId,provisioned_route_id:e.selectedCallFlow.id,tracking_number:"",organizational_unit_id:e.selectedCallFlow.org_unit_id,ringto:e.selectedCallFlow.ringtoNum,route_type:N,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:l,whisper_type:d,whisper_message:m,message_enabled:f,message_type:h,message:v,record_until:i,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:k,spam_active:e.selectedCallFlow.spamActive},channel:{id:e.selectedCallFlow.channel.channel_id}}),"ivr"===e.selectedCallFlow.routetype){g=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];s[0].ivrs=g,s[0].multiIvrs=R}if(z&&(s[0].ringto_percentage=z),"geo"===e.selectedCallFlow.routetype&&(s[0].geo_route=x,s[0].geo_options=L),e.selectedCallFlow.showDNI&&(s[0].dni_setting=W),r={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:a,timezone:u.timezone},call_flows:s},e.selectedCallFlow.numberPool-e.oldQuantity>0)if(e.selectedCallFlow.rate_center.length<=0)n.getPhoneNumbers("TOLLFREE","XX","888").then(function(t){if("error"!=t.data.result)if(S.push(t.data.json),0===S.length||S[0].length<e.selectedCallFlow.numberPool-e.oldQuantity)e.formSubmit1=!1,p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{S=S[0].slice(0,e.selectedCallFlow.numberPool-e.oldQuantity);for(var o=0;o<S.length;o++){var a={};a.number=S[o].number,a.last_used=null,a.vendor_id=S[o].vendor_id,b.push(a)}T={type:"add",quantity:e.selectedCallFlow.numberPool-e.oldQuantity,newNumbers:b,name:e.selectedCallFlow.name,pool_src:"inventory",dni_setting:e.selectedCallFlow.showDNI?W:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},n.updateNumberPool(T,e.pool_id).then(function(t){n.saveCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.selectedCallFlow.name="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}});else for(var D=0,I=0;I<e.rate_center.length;I++)null===e.rate_center[I]&&""===e.rate_center[I]||n.getThirdPartyNumbers(e.pool_state,e.rate_center[I]).then(function(t){if("error"!==t.data.result&&"fail"!==t.data.json[0]&&S.push(t.data.json),D++,console.log(D),e.rate_center.length===D)if(I++,0===S.length||S[0].length<A)e.formSubmit1=!1,p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{S=S[0].slice(0,e.selectedCallFlow.numberPool-e.oldQuantity),console.log("numbers",S),b=[];for(var o=0;o<S.length;o++){var a={};a.number=S[o].number,a.last_used=null,a.vendor_id=S[o].vendor_id,b.push(a)}T={type:"add",quantity:e.selectedCallFlow.numberPool-e.oldQuantity,newNumbers:b,name:e.selectedCallFlow.name,pool_src:"vendor",dni_setting:e.selectedCallFlow.showDNI?W:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},n.updateNumberPool(T,e.pool_id).then(function(t){t.data.err?(e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"})):n.saveCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.selectedCallFlow.name="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}});else if(e.selectedCallFlow.numberPool-e.oldQuantity<0){var F="";F=e.selectedCallFlow.rate_center.length<=0?"inventory":"vendor",T={type:"delete",quantity:e.oldQuantity-e.selectedCallFlow.numberPool,name:e.selectedCallFlow.name,newNumbers:[],pool_src:F},n.updateNumberPool(T,e.pool_id).then(function(t){t.data.err?(e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"})):n.saveCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})})}else n.saveCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Updated Tracking Number",text:"Tracking Number updated successfully.",type:"success"}),e.bCreateAnother?(e.getCallFlowList(e.Id),e.onFocus(e.selectedCallFlow.address),e.selectedCallFlow.name="",e.selectedCallFlow.callflowOption="numberPool",e.isNew=!0):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}else if(s=[],"numberPool"!==e.selectedCallFlow.callflowOption){if(s.push({provisioned_route:{route_type:N,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId},call_flow:{tracking_number:e.selectedCallFlow.num.number,organizational_unit_id:u.currentOUId,ringto:e.selectedCallFlow.ringtoNum,route_type:N,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:l,whisper_type:d,whisper_message:m,message_enabled:f,message_type:h,message:v,record_until:i,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:k,spam_active:e.selectedCallFlow.spamActive},channel:{id:e.selectedCallFlow.channel.channel_id}}),console.log("scope.selectedCallFlow.num.vendor_id : "+e.selectedCallFlow.num.vendor_id,"source:",e.selectedCallFlow.num.source),"inventory"===e.selectedCallFlow.num.source?s[0].phone_number={id:e.selectedCallFlow.num.number_id,vendor_id:e.selectedCallFlow.num.vendor_id,source:void 0==e.selectedCallFlow.num.number_ou_id?"special_inventory":e.selectedCallFlow.num.source,number_ou_id:void 0==e.selectedCallFlow.num.number_ou_id?u.currentOUId:e.selectedCallFlow.num.number_ou_id}:s[0].phone_number={number:e.selectedCallFlow.num.number_id,vendor_id:e.selectedCallFlow.num.vendor_id,source:e.selectedCallFlow.num.source,number_ou_id:void 0==e.selectedCallFlow.num.number_ou_id?u.currentOUId:e.selectedCallFlow.num.number_ou_id},"ivr"===e.selectedCallFlow.routetype){g=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}];s[0].ivrs=g,s[0].multiIvrs=R}"PercentageBasedRoute"===e.selectedCallFlow.routetype&&(s[0].ringto_percentage=z),"geo"===e.selectedCallFlow.routetype&&(s[0].geo_route=x,s[0].geo_options=L),e.selectedCallFlow.showDNI&&(s[0].dni_setting=W),r={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:a,timezone:u.timezone},call_flows:s},console.log(r),n.createCallFlow(r).then(function(t){e.showSaveButton(),e.showSubmit(),""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}else{if(null===e.selectedCallFlow.address||""===e.selectedCallFlow.address)return e.showSaveButton(),void p.notify({title:"Save Tracking Number",text:"Address field is required",type:"error"});if(console.log("selectedCallFlow.address",e.selectedCallFlow.address),e.selectedCallFlow.address.indexOf("TOLLFREE")>0){var O=e.selectedCallFlow.address.split(/,|-/);O.length>2&&("TOLLFREE"===O[1]&&(O[2]="XX"),""!=O[1]&&""!=O[2]&&""!=O[0]&&n.getPhoneNumbers(O[1],O[2],O[0]).then(function(t){if("error"!=t.data.result)if(S.push(t.data.json),0===S.length||S[0].length<e.selectedCallFlow.numberPool)e.formSubmit1=!1,p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{S=S[0].slice(0,e.selectedCallFlow.numberPool);for(var g=0;g<S.length;g++){var _={};_.number=S[g].number,_.last_used=null,_.vendor_id=S[g].vendor_id,b.push(_)}C={phone_number:b,keep_alive_minutes:null,organizational_unit_id:u.currentOUId,pool_id:null,provisioned_route_id:null,name:e.selectedCallFlow.name,state:w,rate_center:U,pool_src:"inventory",dni_setting:e.selectedCallFlow.showDNI?W:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},n.createNumberPool(C).then(function(t){if(t.data.err)e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"});else{if(!0,o=t.data.json[0].pool_id,s.push({number_pool:{id:o,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:N,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId},call_flow:{tracking_number:"",organizational_unit_id:u.currentOUId,ringto:e.selectedCallFlow.ringtoNum,route_type:N,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:l,whisper_type:d,whisper_message:m,message_enabled:f,message_type:h,message:v,record_until:i,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:k,spam_active:e.selectedCallFlow.spamActive},channel:{id:e.selectedCallFlow.channel.channel_id}}),"ivr"===e.selectedCallFlow.routetype){s[0].ivrs=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}],s[0].multiIvrs=R}z&&(s[0].ringto_percentage=z),"geo"===e.selectedCallFlow.routetype&&(s[0].geo_route=x,s[0].geo_options=L),e.selectedCallFlow.showDNI&&(s[0].dni_setting=W),r={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:a,timezone:u.timezone},call_flows:s},console.log(r),n.createCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}})}}))}else{$.each(e.rc,function(t,o){o.address===e.selectedCallFlow.address&&-1===y.indexOf(o.rc)&&(y.push(o.rc.trim()),w=o.state.trim())});var U=[];for(q=0;q<y.length;q++)null===y[q]&&""===y[q]||n.getThirdPartyNumbers(w,y[q]).then(function(t){if("error"!==t.data.result&&"fail"!==t.data.json[0]&&S.push(t.data.json),U.push(y.shift()),0==y.length)if(0===S.length||S[0].length<e.selectedCallFlow.numberPool)e.formSubmit1=!1,p.notify({title:"Pool Numbers",text:"Not enough numbers in the inventory. Please contact customer support or the account manager to get the numbers.",type:"error"});else{S=S[0].slice(0,e.selectedCallFlow.numberPool);for(var g=0;g<S.length;g++){var _={};_.number=S[g].number,_.last_used=null,_.vendor_id=S[g].vendor_id,b.push(_)}C={phone_number:b,keep_alive_minutes:null,organizational_unit_id:u.currentOUId,pool_id:null,provisioned_route_id:null,name:e.selectedCallFlow.name,state:w,rate_center:U,pool_src:"vendor",dni_setting:e.selectedCallFlow.showDNI?W:"",webhook:e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:""},n.createNumberPool(C).then(function(t){if(t.data.err)e.showSaveButton(),e.showSubmit(),e.formSubmit1=!1,p.notify({title:"Create Tracking Number",text:t.data.err,type:"error"});else{if(!0,o=t.data.json[0].pool_id,s.push({number_pool:{id:o,number_quantity:e.selectedCallFlow.numberPool},provisioned_route:{route_type:N,name:e.selectedCallFlow.name,repeat_interval:e.selectedCallFlow.rinterval,call_value:e.selectedCallFlow.value,org_unit_id:u.currentOUId},call_flow:{tracking_number:"",organizational_unit_id:u.currentOUId,ringto:e.selectedCallFlow.ringtoNum,route_type:N,status:e.callFlowstatus,play_disclaimer:e.selectedCallFlow.playDisclaimer,whisper_enabled:l,whisper_type:d,whisper_message:m,message_enabled:f,message_type:h,message:v,record_until:i,number_quantity:e.selectedCallFlow.numberPool,webhook_id:!0===e.selectedCallFlow.showWebhook?e.selectedCallFlow.webhook:null,customSourceList:k,spam_active:e.selectedCallFlow.spamActive},channel:{id:e.selectedCallFlow.channel.channel_id}}),"ivr"===e.selectedCallFlow.routetype){s[0].ivrs=[{ivr:{value:1,target_did:"1111111111",name:"Destincation",ouid:8,play_disclaimer:"after",record_enabled:1,message_enabled:1,message_type:"file",message:"3IvolFCP_1548758869863",webhook_enabled:0}}],s[0].multiIvrs=R}z&&(s[0].ringto_percentage=z),"geo"===e.selectedCallFlow.routetype&&(s[0].geo_route=x,s[0].geo_options=L),e.selectedCallFlow.showDNI&&(s[0].dni_setting=W),r={campaign:{id:e.Id,start_date:e.dateTime.startDate.date,end_date:e.dateTime.endDate.date,date_changed:e.date_changed,campaign_status:a,timezone:u.timezone},call_flows:s},console.log(r),n.createCallFlow(r).then(function(t){e.formSubmit1=!1,""===t.data.err?(p.notify({title:"Create Tracking Number",text:"Tracking Number created successfully.",type:"success"}),e.selectedCallFlow.name="",e.bCreateAnother?(e.getCallFlowList(e.Id),e.selectedCallFlow.address="",e.onFocus(e.selectedCallFlow.address)):c.reload()):p.notify({title:"Save Tracking Number",text:t.data.err,type:"error"})})}})}})}}}}else e.showSubmit(),e.formSubmit1=!1})},e.dni_settings=[],e.dniReferrer=[{value:"new",text:"Add New"},{value:"*.*|null",text:"Any"},{value:"*.bing.com|null",text:"Bing"},{value:"*.google.*|paid",text:"Google (Paid)"},{value:"*.google.*|organic",text:"Google (Organic)"},{value:"*.yahoo.com|paid",text:"Yahoo (Paid)"},{value:"*.yahoo.com|organic",text:"Yahoo (Organic)"}],e.dniOuId=null,e.showTtl=[],e.dni_type=[{id:"url",text:"URL"},{id:"source",text:"Source"},{id:"session",text:"Session"}]}]),angular.module("users-builder",["ngJsTree","ngResource","disableAll","angularUtils.directives.dirPagination","ui.bootstrap","api-param","xeditable","theme.form-directives"]).directive("treeView",["$compile",function(e){return{restrict:"E",scope:{localNodes:"=model",localClick:"&click",reloadOn:"="},link:function(t,o,a,i){var r=angular.isUndefined(a.maxlevels)?10:a.maxlevels,n=!angular.isUndefined(a.checkbox);t.showItems=[],t.$watch("reloadOn",function(e,o){t.showChild={},t.showHide=function(e){var o=document.getElementById(e),a=angular.element(o).attr("class");angular.element(o).attr("class","show"===a?"hide":"show");var i="show"==a;t.showChild[e]=i}}),t.checkIfChildren=function(e){if(!angular.isUndefined(e.children))return n=!0,!0},t.showIcon=function(e){if(!angular.isUndefined(e.children))return!0},t.checkChange=function(e){var t=document.getElementById(e.id),o=angular.element(t).attr("class");angular.element(t).attr("class","false"===o?"true":"false"),e.children&&function e(t){for(var o in t.children)t.children[o].checked=t.checked,t.children[o].children&&e(t.children[o])}(e)};try{var s='<ul class="tree-view-wrapper" style = "height: 300px ;color: #4697ce; font-family: Maven Pro,Segoe UI,Droid Sans,Tahoma,Arial,sans-serif; font-weight: bold; font-size :13px; border: 1px solid #a9a9a9; overflow-y : auto; padding: 0px;">';s+=function e(t,o,a){var i="";return i+='<li ng-repeat="n in '+t+' track by $index" >',i+='<span ng-show=showIcon(n) class="show-hide" style = "padding : 4px;" ng-click=showHide(n.name)><i ng-class="showChild[n.name] ? \'fa fa-plus-square\' : \'fa fa-minus-square\'"></i></span>',i+="<span ng-show=!showIcon(n)></span>",n&&(i+='<input class="tree-checkbox" ng-disabled="{{n.isDisabled}}" class="true-false" type=checkbox ng-model=n.checked ng-change=checkChange(n) ng-click = "localClick({node:n})">'),i+='<label id="{{n.id}}" class="{{n.checked}}" style = "margin : 0px;">{{n.tName}}</label>',i+=o<a?'<ul id="{{n.name}}" class="show" ng-if=checkIfChildren(n) style = "list-style: none;padding-left : 20px;">'+e("n.children",o+1,a)+"</ul></li>":"</li>"}("localNodes",1,r),s+="</ul>",o.html(s),e(o.contents())(t)}catch(a){o.html("<b>ERROR!!!</b> - "+a),e(o.contents())(t)}}}}]).directive("reportList",["$compile",function(e){return{restrict:"E",scope:{reportNodes:"=reportmodel",reportClick:"&report"},link:function(t,o,a,i){var r=angular.isUndefined(a.maxlevels)?10:a.maxlevels,n=!angular.isUndefined(a.checkbox);t.checkReport=function(e){var t=document.getElementById(e),o=angular.element(t).attr("class");angular.element(t).attr("class","false"===o?"true":"false")};try{var s='<ul class="tree-view-wrapper" style = "height: 300px ; font-family: Maven Pro,Segoe UI,Droid Sans,Tahoma,Arial,sans-serif; font-weight: bold; font-size :13px; border: 1px solid #a9a9a9; overflow-y : auto; padding: 0px;">';s+=function e(t,o,a){var i="";return i+='<li ng-repeat="r in '+t+' track by $index" >',n&&(i+='<input class="tree-checkbox" class="true-false" type=checkbox ng-model=r.report_checked ng-change=checkReport(r.report_id) ng-click = "reportClick({node:r})">'),i+='<label id="{{r.report_id}}" class="{{r.repotr_checked}}" style = "margin : 0px;">{{r.report_name}}</label>',i+=o<a?'<ul id="{{r.report_name}}" style = "padding-left : 20px;">'+e("r.children",o+1,a)+"</ul></li>":"</li>"}("reportNodes",1,r),s+="</ul>",o.html(s),e(o.contents())(t)}catch(a){o.html("<b>ERROR!!!</b> - "+a),e(o.contents())(t)}}}}]).factory("UserWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getRoles:function(){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/role",r.headerConfig())},getUsers:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/user?user_status=deleted&ct_user_ou_id="+e,r.headerConfig())},checkPassword:function(e){var t={method:"POST",url:r.baseURL()+"/oauth/token",headers:{"content-type":"application/json"},data:e};return o(t)},getUser:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/user/"+e,r.headerConfig())},createUser:function(e){return o.post(r.baseURL()+"/v1/user",e,r.headerConfig())},updateUser:function(e){return $.each([{value:"America/Halifax",text:"Atlantic (AT)"},{value:"America/New_York",text:"Eastern (ET)"},{value:"America/Chicago",text:"Central (CT)"},{value:"America/Denver",text:"Mountain (MT)"},{value:"America/Phoenix",text:"Arizona (MT)"},{value:"America/Los_Angeles",text:"Pacific (PT)"}],function(t,o){o.value==e.timezone&&(e.timezone=$scope.timeZones[t])}),o.put(r.baseURL()+"/v1/user",e,r.headerConfig())},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},addUserToCampaigns:function(e){return o.put(r.baseURL()+"/v1/user/add_user_to_camapains",e,r.headerConfig())},getAllGroups:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/userpermissions/oulist/ouid/"+e+"/topid/"+i.billingId+"/userOULevel/"+i.userOULevel+"/currentOULevel/"+i.currentOULevel,r.headerConfig())},getAllGroupsByUserID:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/userpermissions/userid/"+e,r.headerConfig())},moveUser:function(e){return o.post(r.baseURL()+"/v1/userpermissions/moveuser",e,r.headerConfig())},getGroupByUserId:function(e,t,a){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/userpermissions/userOulist/topouid/"+e+"/ouid/"+t+"/uid/"+a,r.headerConfig())},getAllReports:function(e){return o.defaults.useXDomain=!0,o.get(r.baseURL()+"/v1/userpermissions/reportslist/ouid/"+e,r.headerConfig())},saveUserPermissions:function(e){return o.post(r.baseURL()+"/v1/userpermissions",e,r.headerConfig())},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t}};return n}]).factory("SelectedUser",function(){"use strict";var e={Id:""};return{getId:function(){return e.Id},setId:function(t){e.Id=t}}}).run(["editableOptions",function(e){e.theme="bs3"}]).controller("UsersTableController",["$q","$scope","$resource","$filter","UserWebService","OrgUnitWebService","SelectedUser","$uibModal","$location","$routeParams","$rootScope","$timeout","$interval","$bootbox","pinesNotifications","paginationService",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f){"use strict";t.isScoreCallAccess=!1,t.userAccess&&t.userAccess.manualscorecard&&(t.isScoreCallAccess=!0);var h=d.currentOUId,v=d.billingId;d.highestOUName;t.isReadonly=!1,t.addUserInProcess=!1,t.currentPage=1,t.pageSize=100,t.locNewRow=0,t.subgroups=[],t.userAccess&&t.userAccess.user<7&&(t.isReadonly=!0),t.users=[],t.realUsers=[],t.arrRequired=[],t.arrInvalid=[],t.specificErrors=[],t.score_subscription=!1,t.update=0,t.actionHeader=["Actions"],t.groupUserTruncHeaders=[],t.groupUserHeaders=["First Name","Last Name","Email","External Id","Agent Ring-to","Agent ID","Role","Status"],t.isShowChangePwd=!1,t.isAdmin=!1,t.currentDateTime=new Date,1===parseInt(d.roleId)&&(t.isShowChangePwd=!0,t.isAdmin=!0),t.isDeleteClicked=!1,t.score_calls=!0,t.access_audio=!1,t.selectAddUser=[],t.selectRemoveUser=[],t.usersReports=[],t.groupList=[],t.modelView=!1,t.fetchingUserPermissions=!1;var b,w=[];d.groupInfo=[];var y=[],S=[];t.isUserPanelOpen=!0,t.savingUserPermissions=!1,t.nest=function(e){for(var t=[],o=0;o<e.length;o++){var a=e[o].parent;if(a)for(var i=0;i<e.length;i++)e[i].id===a&&(e[i].children=e[i].children||[],e[i].children.push(e[o]));else t.push(e[o])}return t},i.getAllReports(h).then(function(e){"success"==e.data.result&&(w=e.data.json)}),i.getAllGroups(h).then(function(e){"success"==e.data.result&&(d.groupInfo=e.data.json)}),t.getUser=function(e,o){t.scoreCallPermission=3===o||8===o,t.update=1,b=e;parseInt(o);t.groupList=[],t.accessReportData=[];var a=angular.copy(d.groupInfo),r=angular.copy(w);t.fetchingUserPermissions=!0,i.getGroupByUserId(v,h,b).then(function(e){if(console.log("Just got group list"),"success"==e.data.result){if(t.score_calls=1!==o?0!==e.data.json.length&&e.data.json.score_call:0===e.data.json.length||e.data.json.score_call,t.isScoreCallAccess||(t.score_calls=!1),t.access_audio=0===e.data.json.length||e.data.json.access_audio,t.ct_user_ou_id=e.data.json.ct_user_ou_id,t.groupsList=e.data.json.group_list,S=0===e.data.json.length?[]:e.data.json.reports_list,void 0===d.userAccess.ca){var a=[];r=angular.copy(w);var i=_.pluck(r,"report_id");_.map(i,function(e){var t=_.find(r,{report_id:parseInt(e)}),o=[];void 0!==t&&"1128"!=t.report_id&&"1135"!=t.report_id&&(o.push({report_id:t.report_id,report_name:t.report_name,report_checked:!1}),a=_.union(a,o))}),r=a,r=_.uniq(r,function(e){return e.report_id})}var n=[];_.map(S,function(e){var t=_.find(r,{report_id:parseInt(e)}),o=[];void 0!==t&&(o.push({report_id:t.report_id,report_name:t.report_name,report_checked:!0}),n=_.union(n,o))}),t.accessReportData=[],n=_.union(n,r),r=n,r=_.uniq(r,function(e){return e.report_id}),r=_.sortBy(r,"report_name"),t.accessReportData=r,t.fetchingUserPermissions=!1}}),t.selectChange=function(e,o,a,i,r){var n=t.groupsList;switch(i&&r>1&&null!==e&&(n[e].selected=!0,r>2&&null!==o&&(n[e].ous[o].selected=!0)),r){case 1:angular.forEach(n[e].ous,function(e){e.hidden||e.disabled||(e.selected=i)});break;case 2:void 0!==n[e].ous[o].ous&&null!==n[e].ous[o].ous&&angular.forEach(n[e].ous[o].ous,function(e){e.hidden||e.disabled||(e.selected=i)})}},t.addSelectedGroup=function(e){if(!0===e.checked){if(e.children){var o=_.pluck(e.children,"id");y=_.union(y,o),_.each(e.children,function(e){if(e.children){var t=_.pluck(e.children,"id");y=_.union(y,t)}})}else u(function(){t.update=0;var o=_.find(a,{id:parseInt(e.parent)});o.checked=!0,y.push(parseInt(o.id));var i=_.find(a,{id:parseInt(o.parent)});i.checked=!0,y.push(parseInt(i.id)),t.$apply()},100);y.push(parseInt(e.id))}else{if(e.children){var i=_.pluck(e.children,"id");_.each(i,function(e){y=_.without(y,e)}),_.each(e.children,function(e){if(e.children){var t=_.pluck(e.children,"id");_.each(t,function(e){y=_.without(y,e)})}})}y=_.without(y,parseInt(e.id))}},t.addSelectedReport=function(e){!0===e.report_checked?S.push(parseInt(e.report_id)):S=_.without(S,parseInt(e.report_id))},t.cancle=function(){t.groupList=[],t.accessReportData=[],t.usersReports=[],S=[],y=[],t.score_call=!0,t.access_audio=!0,t.accessAudioValue=!1,u(function(){t.update=0,t.$apply()},100)},t.disableScoreCallButton=function(){t.accessAudioValue=!1,t.access_audio||(t.accessAudioValue=!0,t.score_calls=!1)},t.saveUserPermissions=function(){t.savingUserPermissions=!0,y=t.groupsList,S=_.uniq(S),u(function(){t.update=0,t.$apply()},100);var e={user_id:b,ou_list:y,report_list:S,score_call:t.score_calls,access_audio:t.access_audio};i.saveUserPermissions(e).then(function(e){"success"===e.data.result?(t.groupList=[],S=[],y=[],t.score_call=!0,t.access_audio=!0,g.notify({title:"Users",text:e.data.json,type:"success"})):g.notify({title:"Users",text:e.data.err,type:"error"}),t.savingUserPermissions=!1})}};var C=function(e,t){return{passed:e,msg:t}},A={};A.length=function(e){return C(10!==e.length,"Phone Number must be 10 digit number")},A.repetitive=function(e){return console.log(_.uniq(e.split(""))),C(1===_.uniq(e.split("")).length&&"0"===_.uniq(e.split(""))[0],"Phone number can't be a repeating number")},A.movie=function(e){return C("555"===e.substring(3,6),"Phone Number with 555 is reserved for movies")},A.tollFree=function(e){return C("800"===e.substring(0,3),"Phone Number can't be a toll free number")},A.startWithZero=function(e){return C("0"===e[0],"Phone Number can't be a start with zero")},c.add||i.getUsers(h).then(function(e){"success"==e.data.status?($.each(e.data.json,function(e,o){t.users.push({id:o.ct_user_id,fname:o.first_name,lname:o.last_name,email:o.username,user_ext_id:o.user_ext_id,phonenumber:o.primary_phone,role:o.role_id,group:o.ct_user_ou_id,status:o.user_status,agent_ring_to:o.agent_ring_to,agent_code:o.agent_code,list_ids:o.list_ids,role_name:o.role_name,org_phone_no:o.phone_number,org_unit_name:o.org_unit_name,org_unit_ext_id:o.org_unit_ext_id,assigned_calls:o.assigned_calls}),t.realUsers.push({id:o.ct_user_id,fname:o.first_name,lname:o.last_name,email:o.username,user_ext_id:o.user_ext_id,phonenumber:o.primary_phone,role:o.role_id,group:o.ct_user_ou_id,status:o.user_status,agent_ring_to:o.agent_ring_to,agent_code:o.agent_code})}),t.totalUsersRows=t.users.length,$(".userProgressLoader").hide(),$("#userProgressLoader").css("opacity","1"),$(".table>tbody>tr>td").css("border-top","1px solid #e9ecf0")):t.error=e}),i.getRoles().success(function(e){t.roles=e.json;for(var o=0;o<t.roles.length;o++)8===t.roles[o].id&&t.userAccess&&(void 0===t.userAccess.manualscorecard||t.userAccess.manualscorecard<4)&&t.roles.splice(_.findLastIndex(t.roles,{id:8}),1);t.roles.unshift({text:"--Select--",id:0})}).error(function(e){console.log(e),console.log("error in getting roles in user.js")}),t.statuses=[],t.statuses1=[{id:1,text:"Active"}],t.statuses2=[{id:1,text:"Active"},{id:2,text:"Inactive"}],t.campaigns=[{value:!0,text:"Yes"},{value:!1,text:"No"}],t.showRoles=function(e){if(t.roles&&e.role){if(t.roles.length){var o=a("filter")(t.roles,{id:e.role});return o.length?o[0].text:"Not set"}return e.role||"Not set"}},t.showStatuses=function(e){if(void 0===e.id?t.statuses=t.statuses1:t.statuses=t.statuses2,e.status&&t.statuses.length){var o=e.status.charAt(0).toUpperCase();e.status=o+e.status.substr(1);var i=a("filter")(t.statuses,{text:e.status});return i.length?i[0].text:"Not set"}return e.status||"Not set"},t.cancelAdd=function(e,o,a){if(o){var i=t.realUsers[e];t.users[e]=i,a.$cancel(),t.locNewRow=0}else{var r=f.getCurrentPage("pg-users");r>1&&(e=100*(r-1)+e),t.users.splice(e,1),t.locNewRow=0}},t.showCampaigns=function(e){var o=[];return e.add_to_campaigns&&(o=a("filter")(t.campaigns,{value:e.add_to_campaigns})),o.length?o[0].text:"No"},t.validateData=function(e,o,a){var r,n,s=/^[a-zA-Z0-9_ -]+$/;if(!e&&"Agent ring-to"!=o&&"Agent ID"!=o&&(t.arrInvalid.push(o),"Role"!=o))return"   ";if("Status"===o&&void 0===a&&"Inactive"===e)return t.arrInvalid.push(o+" (can't have Inactive new user)"),"";if("Email"==o&&!/^[-._a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,9})$/.test(e))return t.arrInvalid.push(o),"   ";if(e&&(r=i.unMaskData(e.toString())),"Agent ring-to"==o&&r&&!/^[0-9]{10}$/.test(r))return t.arrInvalid.push(o),"   ";if("Agent ID"==o&&e&&!/^[0-9]{1,9}$/.test(e))return i.notify({title:"Users Details",text:"Agent ID should be up to 9 digit",type:"error"}),"   ";if("First Name"==o&&!s.test(e))return t.arrInvalid.push(o),"   ";if("Last Name"==o&&!s.test(e))return t.arrInvalid.push(o),"   ";if("Role"==o){if(t.arrRequired.length){n="field is required.",t.arrRequired.length>1&&(n="fields are required."),t.isRequestSent=!1,i.notify({title:"Users Details",text:"'"+t.arrRequired.join(", ")+"' "+n,type:"error"});var l=t.arrRequired.indexOf("Role");return t.arrInvalid=[],t.arrRequired=[],t.specificErrors=[],l>-1?"   ":""}if(t.arrInvalid.length){if(n="field is invalid.",t.arrInvalid.length>1&&(n="fields are invalid."),t.arrInvalid.indexOf("Phone")>-1){var c=t.arrInvalid.indexOf("Phone");t.arrInvalid.splice(c,1)}return t.arrInvalid.length&&i.notify({title:"Users Details",text:"'"+t.arrInvalid.join(", ")+"' "+n,type:"error"}),t.isRequestSent=!1,t.specificErrors.length&&i.notify({title:"Users Details",text:"'"+t.specificErrors.join(", ")+"'",type:"error"}),t.arrRequired=[],t.arrInvalid=[],t.specificErrors=[],""}}},t.validatePhoneData=function(e,o){if(i.unMaskData(e)){var a=i.unMaskData(e),r=[];if(_.each(A,function(e){var t=e(a);t.passed&&r.push(t.msg)}),t.specificErrors=t.specificErrors.concat(r),t.specificErrors.length>0)return t.arrInvalid.push("Phone"),"   "}},t.isRequestSent=!1,t.showModal=function(e,t){s.open({templateUrl:"assets/partials/changePassword.html",controller:"changePasswordModal",size:e,backdrop:"static",keyboard:!1}).data=t},t.moveUser=function(e){i.getAllGroupsByUserID(d.userId).then(function(t){if(null==t.data.err&&t.data.json.length>0){t.data.json=t.data.json.filter(function(t){return t.org_unit_id!==e.group});var o=s.open({templateUrl:"assets/partials/moveUser.html",controller:"moveUserController",size:"lg",backdrop:"static",keyboard:!1}),a={userData:e,groupsList:t.data.json};o.data=a}else i.notify({title:"Move User",text:"Please Provide Vaild User Id",type:"error"})})},t.saveUser=function(e,o,a){var r={user:{ct_user_ou_id:d.currentOUId,role_id:e.role,user_status:e.status,first_name:e.fname,last_name:e.lname,username:e.email,user_ext_id:e.user_ext_id,primary_phone:i.unMaskData(e.phone),agent_code:e.agentcode,agent_ring_to:i.unMaskData(e.agentringto)}};if(o){r.user.ct_user_id=o,t.isReadonly=!0;var n=_.findLastIndex(t.realUsers,{id:o});if("Inactive"===e.status&&"active"===t.realUsers[n].status&&parseInt(t.users[n].assigned_calls)>0){var s="This user is assigned to call/calls. ";s+="Are you sure you want to proceed? Type 'yes' to proceed?",m.prompt(s,function(o){"yes"==(o=null===o?"":o).toLowerCase()?i.updateUser(r).then(function(o){if(t.isReadonly=!1,t.isRequestSent=!1,t.realUsers[n].status=e.status.toLowerCase(),t.addUserInProcess=!1,"success"===o.data.status){_.find(t.users,function(e){return e.email===r.user.username});var i="User "+e.fname+" "+e.lname+" successfully updated.";g.notify({title:"Users",text:i,type:"success"})}else t.error=o,g.notify({title:"Users",text:o.data.err,type:"error"}),setTimeout(function(){a.$show()},100)}):g.notify({title:"Update User",text:"User didn't respond 'yes', so no User was updated.",type:"info"})})}else i.updateUser(r).then(function(o){if(t.isReadonly=!1,t.isRequestSent=!1,t.addUserInProcess=!1,t.realUsers[n].status=e.status.toLowerCase(),"success"===o.data.status){_.find(t.users,function(e){return e.email===r.user.username});var i="User "+e.fname+" "+e.lname+" successfully updated.";g.notify({title:"Users",text:i,type:"success"})}else t.error=o,g.notify({title:"Users",text:o.data.err,type:"error"}),setTimeout(function(){a.$show()},100)})}else r.user.timezone=d.timezone,r.user.domain=location.host,t.isReadonly=!0,i.createUser(r).then(function(o){if(t.isRequestSent=!1,t.addUserInProcess=!1,t.isReadonly=!1,"success"===o.data.result){var i=_.find(t.users,function(e){return e.email===r.user.username});i.id=o.data.json.insertId,i.list_ids=o.data.json.list_ids;var n="User "+e.fname+" "+e.lname+" successfully created.";t.realUsers.push({id:i.id,fname:r.user.first_name,lname:r.user.last_name,email:r.user.username,user_ext_id:r.user.user_ext_id,phonenumber:r.user.primary_phone,role:r.user.role_id,group:r.user.ct_user_ou_id,status:r.user.user_status,agent_ring_to:r.user.agent_ring_to,agent_code:r.user.agent_code}),g.notify({title:"Users",text:n,type:"success"}),t.totalUsersRows=t.realUsers.length}else t.error=o,g.notify({title:"Users",text:JSON.stringify(o.data.err),type:"error"}),setTimeout(function(){a.$show()},100)})},t.removeUser=function(e){var o=_.findIndex(t.users,function(t){return t.id===e});if(angular.isDefined(e)){var a={user:{ct_user_ou_id:d.currentOUId,ct_user_id:e,user_status:"deleted",username:t.users[o].email}};if(parseInt(e)!==parseInt(d.userId)){var r="";(r+=""!==t.users[o].list_ids?"This user is assigned to distribution list. ":"").length>0&&parseInt(t.users[o].assigned_calls)>0?r="This user is assigned to distribution list and call/calls. ":0===r.length&&parseInt(t.users[o].assigned_calls)>0&&(r="This user is assigned to call/calls. "),r+="Deleting this User will also delete all scheduled Reports by this user. Are you sure you want to proceed? Type 'yes' to proceed?",m.prompt(r,function(e){"yes"==(e=null===e?"":e).toLowerCase()?"yes"===e.toLowerCase()&&(t.isDeleteClicked=!1,i.updateUser(a).then(function(e){"success"===e.data.status?(g.notify({title:"Delete User",text:[t.users[o].fname,t.users[o].lname,"has been removed."].join(" "),type:"success"}),t.users.splice(o,1),t.totalUsersRows=t.users.length):(g.notify({title:"Delete User",text:JSON.stringify(e.data.err),type:"error"}),t.error=e),t.isDeleteClicked=!0})):g.notify({title:"Delete User",text:"User didn't respond 'yes', so no User was deleted.",type:"info"})})}else g.notify({title:"Delete User",text:"Cannot delete logged in user.",type:"error"})}else g.notify({title:"Delete User",text:"User was saved incorrectly and therefore can't be deleted.",type:"error"})},t.addUser=function(){var e;if((t.addUserInProcess=!0,t.users.length)&&(!(e=t.locNewRow>0?t.users[t.locNewRow]:t.users[t.users.length-1]).email||!e.fname))return void g.notify({title:"Users",text:"Save currently added user before adding another.",type:"info"});if(t.inserted={name:"",status:"Active",add_to_campaigns:!0,group:null,role:0},t.users.length>99){var o=f.getCurrentPage("pg-users");t.locNewRow=100*o-1,t.users.length<=t.locNewRow&&(t.locNewRow=t.users.length),t.users.splice(t.locNewRow,0,t.inserted)}else t.users.push(t.inserted)},t.cancelClicked=function(e){if("development"===d.env&&console.log("in user table controller, user row form cancel button clicked"),!angular.isDefined(t.users[e].id))return t.users.splice(e,1),void("development"===d.env&&console.log("user row deleted because it hasn't been saved to the database yet"));!0===confirm("Do you really want to canel (it would delete the row from the table) ?")&&t.users.splice(e,1)},r.getChildrenOUs(d.currentOUId).success(function(e){for(var o in e.json)t.subgroups.push(e.json[o])}).error(function(e){console.log("err fetching children"),console.log(e)}),t.getUserCSVData=function(o){var a,i=e.defer();if(t.userHeaderNames=["Account Name","Account OUID","Group Name","Group OUID","Group External ID","Group Phone","User First Name","User Last Name","User Email","User Role","User ID","User (Agent) ID","User Phone"],a=function(e){var t=[];return _.each(e,function(e){t.push({"Account Name":d.highestOUName,"Account OUID":d.billingId,"Group Name":e.org_unit_name,"Group OUID":e.ct_user_ou_id,"Group External ID":e.org_unit_ext_id,"Group Phone":e.org_phone_no,"User First Name":e.fname,"User Last Name":e.lname,"User Email":e.email,"User Role":e.role_name,"User ID":e.id,"User (Agent) ID":e.agent_code,"User Phone":e.phonenumber})}),t}(t.users),i.resolve(a),d.isSafari){var r=d.currentOUName+"Users csv";"tsv"===o&&(r=d.currentOUName+"Users tsv"),i.resolve(JSONToCSVConvertor(a,r,!0,o))}if(!d.isSafari)return i.promise},$(window).scroll(function(){window.pageYOffset>2e3&&$(window).trigger("resize")}),$(window).scroll(function(){window.pageYOffset;$("button").css({height:"34px"})}),angular.element(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},2500)}),angular.element(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},5e3)})}]).filter("tel",function(){return function(e){if(!e)return"";var t,o,a,i=e.toString().trim().replace(/^\+/,"");if(i.match(/[^0-9]/))return e;switch(i.length){case 10:t=1,o=i.slice(0,3),a=i.slice(3);break;case 11:t=i[0],o=i.slice(1,4),a=i.slice(4);break;case 12:t=i.slice(0,3),o=i.slice(3,5),a=i.slice(5);break;default:return e}return 1==t&&(t=""),(t+" ("+o+") "+(a=a.slice(0,3)+"-"+a.slice(3))).trim()}}).controller("UserFormController",["$scope","$http","$location","UserWebService","SelectedUser",function(e,t,o,a,i){"use strict";e.switchStatus=1,e.switchStatus2=1,e.switchStatus3=1,e.switchStatus4=1,e.switchStatus5=1,e.switchStatus6=1,e.Id=i.Id,""!==e.Id&&a.getUser(e.Id).then(function(t){"error"!==t.data.status&&(e.name=t.data.json[0].name,e.campId=t.data.json[0].user_id)}),e.name="New User",e.campId="",e.createUser=function(){var t={};e.Id?(t={users:{id:e.Id,name:e.name,ouid:"1",user_id:e.campId}},a.updateUser(t).then(function(t){"error"!=t.data.status?o.path("/setup-users"):e.error="Invalid email or password"})):(t={users:{name:e.name,ouid:"1",user_id:e.campId}},a.createUser(t).then(function(t){"error"!=t.data.status?o.path("/setup-users"):e.error="Invalid email or password"}))},e.getLocation=function(e){return t.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:e,sensor:!1}}).then(function(e){var t=[];return angular.forEach(e.data.results,function(e){t.push(e.formatted_address)}),t})},e.colorPicked="#fa4d4d",e.select2RemoteOptions={placeholder:"Search for a movie",minimumInputLength:3,width:"resolve",ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t,apikey:"8vzys3eka2s9hpvkh7wwzp7e"}},results:function(e,t){var o=10*t<e.total;return{results:e.movies,more:o}}},formatResult:function(e){var t="<table class='movie-result'><tr>";return void 0!==e.posters&&void 0!==e.posters.thumbnail&&(t+="<td class='movie-image'><img src='"+e.posters.thumbnail+"'/></td>"),t+="<td class='movie-info'><div class='movie-title'>"+e.title+"</div>",void 0!==e.critics_consensus?t+="<div class='movie-synopsis'>"+e.critics_consensus+"</div>":void 0!==e.synopsis&&(t+="<div class='movie-synopsis'>"+e.synopsis+"</div>"),t+="</td></tr></table>"},formatSelection:function(e){return e.title},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}},e.tagList=["tag1","tag2"],e.select2TaggingOptions={multiple:!0,simple_tags:!0,tags:["tag1","tag2","tag3","tag4"]},e.multiSelect1=[],e.multiSelect2=[]}]).controller("UserProfileController",["$scope","$filter","UserWebService","SelectedUser","$location","$routeParams","$rootScope","pinesNotifications","$window","AdminSession","$route","$cookies",function(e,t,o,a,i,r,n,s,l,c,d,u){e.formSubmit=!1,e.currentUsername=null,e.changePassword=!1,e.timeZones=[{value:"America/Halifax",text:"Atlantic (AT)"},{value:"America/New_York",text:"Eastern (ET)"},{value:"America/Chicago",text:"Central (CT)"},{value:"America/Denver",text:"Mountain (MT)"},{value:"America/Phoenix",text:"Arizona (MT)"},{value:"America/Los_Angeles",text:"Pacific (PT)"}],e.getUserData=function(){e.isConvirzaAdmin=c.isAdmin(),o.getUser(n.userId).then(function(t){"error"!==t.data.status&&(e.user=t.data.json[0],$.each(e.timeZones,function(o,a){a.value==t.data.json[0].timezone&&(e.user.timezone=e.timeZones[o])}),-1===e.timeZones.indexOf(e.user.timezone)&&(e.user.timezone={value:"America/New_York",text:"Eastern"}),e.currentUsername=t.data.json[0].username)})},e.getUserData(),e.cancelUser=function(){e.getUserData()},e.updateUser=function(){if(e.userForm.$valid){e.formSubmit=!0,null===e.user.primary_phone?e.user.primary_phone="":e.user.primary_phone=e.user.primary_phone.replace(/\D/g,""),console.log("CREATEING SAVEDATA",e.user);var t={user:{ct_user_id:e.user.ct_user_id,first_name:e.user.first_name,last_name:e.user.last_name,username:e.user.username,primary_phone:e.user.primary_phone,user_ext_id:e.user.user_ext_id,timezone:e.user.timezone.value,ct_user_ou_id:e.user.ct_user_ou_id}};n.timezone=l.sessionStorage.timezone=e.user.timezone.value,n.userEmail=l.sessionStorage.userEmail=e.user.username,o.updateUser(t).then(function(o){"success"==o.data.status?(s.notify({title:"User Profile",text:"User Profile updated successfully.",type:"success"}),e.currentUsername=t.user.username,n.fullName=t.user.first_name+" "+t.user.last_name,e.formSubmit=!1,e.submitted=!1,n.timezone=e.user.timezone.value,n.uservoiceSSO=l.sessionStorage.uservoiceSSO=o.data.uservoiceSSO,n.feedbackURL=l.sessionStorage.feedbackURL="https://convirza.uservoice.com?sso="+o.data.uservoiceSSO,n.supportURL=l.sessionStorage.supportURL="https://knowledgebase.convirza.com",window.UserVoice.setSSO(n.uservoiceSSO)):(s.notify({title:"User Profile",text:"User Profile update failed.",type:"error"}),e.formSubmit=!1)})}},e.updatePassword=function(){if(e.passwordForm.$valid){var t={user:{ct_user_id:e.user.ct_user_id,password:e.newPassword,username:e.currentUsername}};if(e.newPassword!=e.confirmPassword)s.notify({title:"Update Password",text:"New Passwords do not match.",type:"error"});else if(e.newPassword.length<5||e.confirmPassword.length<5)s.notify({title:"Update Password",text:"New Password must be at least 5 characters.",type:"error"});else{u.get("name");var a={grant_type:"password",username:e.currentUsername,password:e.oldPassword,client_id:u.get("client_id"),client_secret:u.get("client_secret")};o.checkPassword(a).then(function(a){"success"==a.data.status?o.updateUser(t).then(function(t){"success"==t.data.status?(s.notify({title:"Change Password",text:"Password updated successfully.",type:"success"}),e.changePassword=!1,e.oldPassword=e.newPassword=e.confirmPassword=!1,d.reload()):s.notify({title:"Change Password",text:"Password update failed.",type:"error"})}):s.notify({title:"Change Password",text:"Old password incorrect. Please check and try again.",type:"error"})}).catch(function(t){t.data.error_description&&"Invalid resource owner credentials"==t.data.error_description&&(e.error="Old password incorrect. Please check and try again."),s.notify({title:"Change Password",text:e.error,type:"error"})})}}},e.cancelPassword=function(){e.changePassword=!1,e.oldPassword=null,e.newPassword=null,e.confirmPassword=null}}]).controller("changePasswordModal",["$scope","$rootScope","$uibModalInstance","pinesNotifications","UserWebService","$bootbox",function(e,t,o,a,i,r){e.userDataUpdate=o.data,e.newPassword="",e.changePassword=function(){var r={user:{ct_user_id:e.userDataUpdate.id,password:e.newPassword,username:e.userDataUpdate.email,role_id:t.roleId}};i.updateUser(r).then(function(t){"success"==t.data.status?(a.notify({title:"Change Password",text:"Password updated successfully.",type:"success"}),e.changePassword=!1,e.oldPassword=e.newPassword=e.confirmPassword=!1):a.notify({title:"Change Password",text:"Password update failed.",type:"error"})}),o.close()},e.cancel=function(){o.close()}}]).controller("moveUserController",["$scope","$rootScope","$uibModalInstance","pinesNotifications","UserWebService","$route",function(e,t,o,a,i,r){e.userData=o.data.userData,e.groupsList=o.data.groupsList,e.moveUserToSelectedGroup=function(){var t={org_unit_id:parseInt(e.selectedGroup),ct_user_id:e.userData.id};i.moveUser(t).then(function(e){"success"==e.data.result?(a.notify({title:"Move User",text:"User moved successfully.",type:"success"}),r.reload()):a.notify({title:"Move User",text:"Failed to move User",type:"error"})}),o.close()},e.cancel=function(){o.close()}}]),angular.module("dni",["theme.form-directives"]).factory("DNIWebService",["$q","$http","$window","$rootScope",function(e,t,o,a){"use strict";var i={getDniCustomParameters:function(e,i,r){var n={headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t.defaults.useXDomain=!0,t.get(a.url+":"+a.port+"/v1/defgroupsetting/CallFlow/customParams/populate/"+e,n)},getshareDni:function(e){var i={headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t.defaults.useXDomain=!0,t.get(a.url+":"+a.port+"/v1/defgroupsetting/feature/shareDni/"+e,i)},getDniCode:function(e,i,r){var n={headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t.defaults.useXDomain=!0,t.get(a.url+":"+a.port+"/v1/dniSetting/code/"+e,n)},getDniSettings:function(e,i,r){var n={headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t.defaults.useXDomain=!0,t.get(a.url+":"+a.port+"/v1/dniSetting/"+e+"/"+i+"/"+r,n)},updateDniOUData:function(e){var i={method:"PUT",url:a.url+":"+a.port+"/v1/dniOrgUnit",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return t(i)},createDniOUData:function(e){var i={method:"POST",url:a.url+":"+a.port+"/v1/dniOrgUnit",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return t(i)},removeDNI:function(e){var i={method:"DELETE",url:a.url+":"+a.port+"/v1/dniSetting/"+e,headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t(i)},updateDniSetting:function(e){var i={method:"PUT",url:a.url+":"+a.port+"/v1/dniSetting",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return t(i)},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},getDniByID:function(e){var i={headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token}};return t.defaults.useXDomain=!0,t.get(a.url+":"+a.port+"/v1/dniSetting/dniset/"+e,i)}};return i}]).controller("DNIController",["$scope","DNIWebService","$rootScope","$routeParams","pinesNotifications","OrgUnitLocal","$location","$filter","$uibModal","$q","$bootbox","OrgUnitWebService",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.dni_settings=[],e.isLoadingApi=!0,e.dni_settings_show_referrer={},e.arrRequired=[],e.arrInvalid=[],e.arrInvalidMessage=[],e.temp_dni_type="",e.dni_type={},e.original_dni_referrers=[],e.dniHeaders=["Host Domain","Referring Website","DNI Type","Class","Campaign","Tracking Number"],e.ttlHeader=["TTL"],e.actionHeader=["Actions"],o.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.GroupXYZ="Group XYZ";var p={};e.validateDniData=function(o,a,i,r){var n=!1;void 0===o&&"Referring Website"==a&&(o=e.dni_settings[r].referrer);var s,l,c=new RegExp(/^[a-z0-9\*]+([\-\.]{1}[a-z0-9\*]+)*\.[a-z\*]{1,5}(:[0-9]{1,5})?(\/.*)?$/i),d=new RegExp(/^([a-z0-9]+|\*)([\-\.]{1}[a-z0-9]+)*\.([a-z]{1,5}|\*)(:[0-9]{1,5})?(\/.*)?$/i);if(""!==o&&void 0!==o||("TTL"!=a?e.arrRequired.push(a):"TTL"==a&&"session"==e.temp_dni_type&&(e.arrRequired.push(a),n=!0)),"Host Domain"==a&&o){if(!c.test(o))return e.arrInvalid.push(a),e.arrInvalidMessage.push("Wrong domain format for Host Domain."),"  ";if(o.indexOf("*")>-1&&("*"!=o.charAt(0)||"."!=o.charAt(1)))return e.arrInvalid.push(a),e.arrInvalidMessage.push("When using a wildcard at the beginning of a Host Domain, *.domain format is required. Example: *.logmycalls.com"),"  ";p.destination_url=o}if("Referring Website"==a&&o&&i){if(p.referrer=o+"|null",!d.test(o))return e.arrInvalid.push(a),e.arrInvalidMessage.push("Wrong domain format for Referring Website."),"  ";var u=o.split(".");if(2==u.length&&"*"==u[0]&&"*"!=u[1])return e.arrInvalid.push(a),e.arrInvalidMessage.push("Wrong domain format for Referring Website."),"  "}else"Referring Website"==a&&o&&(p.referrer=o);if("DNI Type"==a&&o&&i&&(e.temp_dni_type=o),"Class"==a&&o&&i){if("lmc_track"==o&&("session"==e.temp_dni_type||"source"==e.temp_dni_type))return e.arrInvalid.push(a),e.arrInvalidMessage.push("The HTML Class ID 'lmc_track' is only allowed for URL-based DNI."),"  ";if("lmc_track"!=o&&"url"==e.temp_dni_type)return e.arrInvalid.push(a),e.arrInvalidMessage.push("The HTML Class ID 'lmc_track' is required for URL-based DNI."),"  ";if(o.indexOf(" ")>-1)return e.arrInvalid.push(a),e.arrInvalidMessage.push("The HTML ID Class must not contain spaces."),"  ";p.element=o}if("TTL"==a){if(0===o&&(e.arrInvalid.push(a),e.arrInvalidMessage.push("Invalid TTL value.")),e.arrRequired.length)return s="field is required.",e.arrRequired.length>1&&(s="fields are required."),t.notify({title:"DNI",text:"'"+e.arrRequired.join(", ")+"' "+s,type:"error"}),e.arrInvalid=[],e.arrRequired=[],n?"   ":"";if(e.arrInvalid.length>0)return console.log(e.arrInvalidMessage),t.notify({title:"DNI",text:"'"+(l=e.arrInvalidMessage,l.sort().filter(function(e,t,o){return!t||e!==o[t-1]})).join(","),type:"error"}),e.arrRequired=[],e.arrInvalid=[],e.arrInvalidMessage=[],""}},e.getCode=function(e){l.open({templateUrl:"assets/partials/dniInstructions.html",controller:"DNIModalController",size:e})},e.changeReferrer=function(t,o,a){"new"==t?(e.oldReferrer=e.dni_settings[a].referrer,e.dni_settings_show_referrer[o]=!0,angular.element("#reffererText"+a)[0].value=""):!0!==e.dni_settings_show_referrer[o]||""!==t&&void 0!==t&&e.oldReferrer!==t||(e.dni_settings_show_referrer[o]=!1),e.dni_settings[a].referrer=t,e.newReferer=t},e.updateReferrer=function(t,o,a){e.dni_settings[a].referrer=t},e.editDni=function(t,o,a){e.original_dni_referrers[t]=e.dni_settings[o].referrer,a.$show()},e.referrer=[{value:"new",text:"Add New"},{value:"*.*|null",text:"Any"},{value:"*.bing.com|null",text:"Bing"},{value:"*.google.*|paid",text:"Google (Paid)"},{value:"*.google.*|organic",text:"Google (Organic)"},{value:"*.yahoo.com|paid",text:"Yahoo (Paid)"},{value:"*.yahoo.com|organic",text:"Yahoo (Organic)"}],e.dniOuId=null,e.showTtl=[],t.getshareDni(o.currentOUId).then(function(t){"success"===t.data.status&&(e.disable_share_dni=t.data.json.disable_share_dni,e.share_group_name=t.data.json.share_group_name)}),e.loadDNIData=function(){t.getDniSettings(o.currentOUId,void 0,o.userAccess.dni).then(function(t){e.isLoadingApi=!1,t.data.json[0].dni_org_unit.length>0&&(e.custom_params=t.data.json[0].dni_org_unit[0].custom_params,e.dniOuId=t.data.json[0].dni_org_unit[0].org_unit_id,$.each(t.data.json[0].dni_settings,function(t,o){var a=o.referrer,i=!1;"referral"==o.provisioned_route_status&&(i=!0),o.referrer_type&&(a+="|"+o.referrer_type);var r=o.number?"("+o.number.slice(0,3)+") "+o.number.slice(3,6)+"-"+o.number.slice(6,10):"";e.dni_settings.push({dni_setting_id:o.dni_setting_id,destination_url:o.destination_url,referrer:a,referrer_text:a,dni_type:o.dni_type,dni_element:o.dni_element,campaign_name:o.campaign_name,provisioned_route_name:o.provisioned_route_name,number:r,dni_ttl:parseInt(o.dni_ttl),provisioned_route_id:parseInt(o.provisioned_route_id),is_referral:i}),"session"==o.dni_type?(e.dni_type[t]=[{id:"session",text:"Session"}],e.showTtl[t]=!0,e.dni_settings[t].number=o.number):(e.dni_type[t]=[{id:"url",text:"URL"},{id:"source",text:"Source"}],e.showTtl[t]=!1),s("filter")(e.referrer,a,!0).length<1&&e.referrer.push({value:a,text:o.referrer})}))})},e.loadDNIData(),e.showReferrer=function(t,o){if(t.referrer&&e.referrer.length){var a=s("filter")(e.referrer,{value:t.referrer});return a.length?a[0].text:"Not set"}return void 0===t.referrer&&(t.referrer=e.newReferer),t.referrer||"Not set"},e.showDniType=function(t,o){if(t.dni_type&&e.dni_type[o].length){var a=s("filter")(e.dni_type[o],{id:t.dni_type});return a.length?a[0].text:"Not set"}return t.dni_type||"Not set"},e.cancelEdit=function(t,o,a){e.dni_settings_show_referrer[t]=!1,e.dni_settings[o].referrer=e.original_dni_referrers[t],a.$cancel()},e.saveParams=function(){var a=e.custom_params,r={dniOrgUnit:{custom_params:a=(a=(a=(a=a.replace(/\s/g,"")).split(",")).filter(function(e){return""!==e})).join(",")}};e.dniOuId?(r.dniOrgUnit.org_unit_id=e.dniOuId,t.updateDniOUData(r).then(function(t){e.custom_params=a,i.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"})})):(r.dniOrgUnit.org_unit_id=o.currentOUId,t.createDniOUData(r).then(function(t){i.notify({title:"Saved Custom URL Parameters",text:"Custom URL parameters have been saved. ",type:"success"}),e.custom_params=a}))},e.saveDNISettings=function(o,a,r,n,l){var c=o.referrer.split("|");o.referrer=c[0],o.referrer_type=c[1],o.referrer_type||(o.referrer_type=null);var d=o.referrer+"|"+o.referrer_type,u={dniSetting:{dni_setting_id:a,provisioned_route_id:r,destination_url:o.destination_url,dni_type:o.dni_type,dni_element:o.dni_element,referrer:o.referrer,referrer_type:o.referrer_type,dni_ttl:o.dni_ttl,org_unit_id:e.dniOuId}};t.updateDniSetting(u).then(function(t){s("filter")(e.referrer,d,!0).length<1&&(e.dni_settings_show_referrer[a]=!1,e.referrer.push({value:d,text:o.referrer})),e.dni_settings[n].referrer=d,"error"==t.data.status?(i.notify({title:"Failed Saving DNI Settings",text:t.data.err,type:"error"}),l.$show()):(i.notify({title:"Saved DNI Settings",text:"DNI settings have been saved. ",type:"success"}),e.dni_settings_show_referrer[a]=!1)})},e.removeDNI=function(o,a){d.confirm("Are you sure you want to delete this DNI Setting?",function(r){r&&t.removeDNI(a).then(function(t){i.notify({title:"Deleted Dni Setting",text:"DNI setting deleted.Successfully",type:"success"}),e.dni_settings.splice(o,1)})})},e.headerNames={destination_url:"Host Domain",referrer:"Referring Website",dni_type:"DNI Type",dni_element:"Class",campaign_name:"Campaign",call_flow:"Tracking Number",dni_ttl:"TTL"},e.csvHeaderNames=[e.headerNames.destination_url,e.headerNames.referrer,e.headerNames.dni_type,e.headerNames.dni_element,e.headerNames.campaign_name,e.headerNames.call_flow,e.headerNames.dni_ttl],e.getCSVData=function(t){console.log(e.dni_settings);var a,i=e.headerNames,r=_.map(e.dni_settings,function(e){return(a={})[i.destination_url]=e.destination_url,a[i.referrer]=e.referrer,a[i.dni_type]=e.dni_type,a[i.dni_element]=e.dni_element,a[i.campaign_name]=e.campaign_name,a[i.call_flow]=e.provisioned_route_name+" | "+e.number,isNaN(e.dni_ttl)?a[i.dni_ttl]="n/a":a[i.dni_ttl]=e.dni_ttl,a});if(!o.isSafari)return r;var n="csv_dni";"tsv"===t&&(n="tsv_dni"),JSONToCSVConvertor(r,n,!0,t)},e.exportPDF=function(){var e=new jsPDF("p","pt","a4");e.addHTML($("#pdfExportGroup"),function(){e.output("datauristring")}),setTimeout(function(){e.save("DNI - "+moment().format("MMMM Do YYYY")+".pdf")},2e3)}}]).controller("DNIModalController",["$scope","DNIWebService","$rootScope","$routeParams","pinesNotifications","OrgUnitLocal","$location","$filter","$uibModalInstance",function(e,t,o,a,i,r,n,s,l,c){e.ok=function(){l.close()},e.cancel=function(){l.dismiss("cancel")},e.dniHost=o.dniHost,t.getDniCode(o.currentOUId).then(function(t){null!==t.data.json.dni_code&&(e.dni_code=t.data.json.dni_code)})}]),angular.module("georoute-builder",["angularFileUpload","ngSanitize","ngCsv","theme.form-directives"]).factory("GeoRouteWebService",["$q","$timeout","$http","$window","$rootScope","$upload","ApiParam",function(e,t,o,a,i,r,n){"use strict";var s={getLocations:function(){console.log(a.sessionStorage.token);var e={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/location/ouid/"+i.currentOUId+"/"+encodeURIComponent(i.timezone),e)},getLocationRoutes:function(e,t){console.log(a.sessionStorage.token);var r={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/location/"+e+"?page="+t,r)},saveLocation:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/location",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},updateLocation:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/location",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},deleteLocation:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/location/delete",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},deleteLocationById:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/location/delete_location/"+e,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(t)},updateLocationRoute:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/locationroute",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},createLocationRoute:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/locationroute",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},uploadCSVFile:function(e,t){var o,n=e[0].name;if(i.percentage=0,e&&e.length)for(var s=0;s<e.length;s++){var l=e[s];o=r.upload({url:i.url+":"+i.port+"/v1/locationroute/import",headers:{Authorization:"bearer "+a.sessionStorage.token},fields:{org_unit_id:i.currentOUId,name:n,location_id:t},file:l}).progress(function(e){console.log(i),i.percentage=parseInt(100*e.loaded/e.total),console.log("percent: "+parseInt(100*e.loaded/e.total))})}return o},saveLocationIVR:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/location/ivr",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},getLocationIvrRoutes:function(e){var t={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/location/ivr/"+e,t)},deleteLocationIVR:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/location/ivr/"+e,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(t)},checkLDM:function(e){var t={method:"POST",url:n.baseURL()+"/v1/ldm",headers:n.headerConfig().headers,data:e};return o(t)}};return s}]).filter("tel",function(){return function(e){if(!e)return"";var t,o,a,i=e.toString().trim().replace(/^\+/,"");if(i.match(/[^0-9]/))return e;switch(i.length){case 10:t=1,o=i.slice(0,3),a=i.slice(3);break;case 11:t=i[0],o=i.slice(1,4),a=i.slice(4);break;case 12:t=i.slice(0,3),o=i.slice(3,5),a=i.slice(5);break;default:return e}return 1==t&&(t=""),(t+" ("+o+") "+(a=a.slice(0,3)+"-"+a.slice(3))).trim()}}).run(["editableOptions",function(e){e.theme="bs3"}]).controller("GeoRouteTableController",["$uibModal","$scope","$http","$filter","GeoRouteWebService","$location","$routeParams","$rootScope","$q","UserWebService","progressLoader","pinesNotifications","$bootbox","$route",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m){"use strict";!0===s.is_migrated||"true"===s.is_migrated?t.ivrButton=!0:t.ivrButton=!1,t.canModify=!0,t.fileIsUploading=!1,t.georoutelocations=[],t.dupSubmit=!1,t.dupGeoLocation=!1,t.disError=!1,t.isSaved=!1,t.disGeoError=!1,t.arrInvalid=[],t.arrRequired=[],t.isEdit=!1,t.disEdit=!1,t.disEditLocation=!1,t.disableAddIvrBtn=!1,t.disableDelLocation=!1,t.isLoadingApi=!0,t.geoRouteHeaders=["Name","Location","Created","Modified"],t.locationHeaders=["Location","Address","City","State/Province","Zip/Postal Code","Phone","Claimed States/Provinces","Claimed Zip/Postal Code"],t.actionHeader=["Action"];var g=[],f="";if(t.triggerBoth=!1,!1===s.is_migrated||"false"===s.is_migrated){var h=r.url().split("?");"/set-legacy-location"==r.path()?location.href="#/set-location?"+h[1]:(r.path("/set-legacy-location"),void 0!=s.editClickId&&r.search("id",s.editClickId))}o.get("assets/demo/states_province.json").then(function(e){g=_.pluck(e.data,"abbr")}),i.getLocations().then(function(e){"error"!=e.data.result&&(e.data.json.locations.forEach(function(e){t.georoutelocations.push({id:e.id,name:e.name,num_loc:e.count,created:null!==e.created?moment(e.created).format("YYYY-MM-DD h:mm:ss a"):"",modified:null!==e.modified?moment(e.modified).format("YYYY-MM-DD h:mm:ss a"):""})}),t.isLoadingApi=!1,t.canModify=!1,t.totalDataRows=t.georoutelocations.length)}),t.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},50)},$(window).scroll(function(){window.pageYOffset>500&&$(window).trigger("resize")}),t.selectedGeoRouteList=null,t.enableSave=function(){t.disError=!1,t.isSaved=!1},t.enableGeoSave=function(){t.disGeoError=!1},t.saveGeoList=function(e,o){t.fileSelected=function(){return!!t.files},t.disEdit=!0;var a={location:{org_unit_id:s.currentOUId,name:e.name}};o?(a={location:{id:o,name:e.name}},i.updateLocation(a).then(function(a){""===a.data.err?(angular.extend(e,{id:o}),t.dupGeoLocation=!1,i.notify({title:"Geo Location List",text:"Successfully updated location.",type:"success"}),t.georoutelocations=[],i.getLocations().then(function(e){"error"!=e.data.result&&e.data.json.locations.forEach(function(e){t.georoutelocations.push({id:e.id,name:e.name,num_loc:e.count,created:null!==e.created?moment(e.created).format("YYYY-MM-DD h:mm:ss a"):"",modified:null!==e.modified?moment(e.modified).format("YYYY-MM-DD h:mm:ss a"):""})})}),t.disEdit=!1):(i.notify({title:"Geo Location List",text:a.data.err,type:"error"}),t.disEdit=!1)})):(console.log(a),i.saveLocation(a).then(function(o){"success"===o.data.status?(t.totalDataRows++,angular.extend(e,{id:o.data.json.insertId}),t.dupGeoLocation=!1,i.notify({title:"Create Location",text:"Successfully added location.",type:"success"}),t.georoutelocations=[],i.getLocations().then(function(e){"error"!=e.data.result&&e.data.json.locations.forEach(function(e){t.georoutelocations.push({id:e.id,name:e.name,num_loc:e.count,created:null!==e.created?moment(e.created).format("YYYY-MM-DD h:mm:ss a"):"",modified:null!==e.modified?moment(e.modified).format("YYYY-MM-DD h:mm:ss a"):""})})}),t.disEdit=!1):(t.disEdit=!1,i.notify({title:"Geo Location List",text:o.data.err,type:"error"}))}))},t.cancelUploading=function(){t.files=""},t.removeGeoList=function(e,o){var a=[];a.push(o);var r={location:{ids:a}};p.confirm("Are you sure you want to delete this list?",function(o){o&&i.deleteLocation(r).then(function(o){console.log(o),t.isEdit=!1,"success"===o.data.status?(t.totalDataRows--,t.georoutelocations.splice(e,1),i.notify({title:"Geo Location List",text:"Successfully deleted the list",type:"success"})):(i.notify({title:"Geo Location List",text:o.data.err,type:"error"}),t.error=o)})})},t.cancelGeoAdd=function(e,o,a){o?a.$cancel():t.georoutelocations.splice(e,1),t.dupGeoLocation=!1},t.addGeoList=function(){if(t.totalDataRows++,t.georoutelocations.length>0&&!t.georoutelocations[t.georoutelocations.length-1].name)return i.notify({title:"Add GeoRoute",text:"You must save the current Georoute List before adding another.",type:"warning"}),void(t.dupGeoLocation=!0);t.inserted={name:""},t.georoutelocations.push(t.inserted)},t.ok=function(){t.isEdit=!1},t.pageChanged=function(e){t.currentPage=e,v(f,t.currentPage)},t.editGeoLocations=function(e,o){t.geoIndex=e,t.geoid=o,t.isEdit=!0,t.dupSubmit=!1,t.selectedGeoRouteList=o,f=o,t.locations=[],t.files="",t.currentPage=1,v(o,t.currentPage),t.headerName=t.georoutelocations[e].name,t.currentLocationid=t.georoutelocations[e].id,t.locations.length<1&&(t.inserted={id:"",location:"",address:"",city:"",state:"",zip:"",phone:"",claimed:""})};var v=function(e,o){t.isLoadingApi=!0,i.getLocationRoutes(e,o).then(function(e){if("error"!=e.data.result){t.locations=[];var o=e.data.json.locations[0].routes;t.totalDataRows=e.data.json.totalRows,o.forEach(function(e){t.locations.push({id:e.id,location_ivr_route_id:e.location_ivr_route_id,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:e.target,claimed:e.claimed_zip,clamiedStates:e.clamied_states,ivr_status:"old"})})}t.isLoadingApi=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#locationeditor").offset().top-50},1e3)},100)})};t.removeNewLocation=function(e){var o=t.locations[t.locations.length-1],a=t.locations.length-1;o.address&&o.city&&o.state&&o.zip||t.cancellocationAdd(a,null,e)},t.addLocation=function(){var e;if((t.search=void 0,t.locations.length>0)&&!((e=t.locations[t.locations.length-1]).address&&e.city&&e.state&&e.zip))return i.notify({title:"Add Location",text:"You must save the current location before adding another.",type:"warning"}),void(t.dupSubmit=!0);t.inserted={location:"",address:"",city:"",state:"",zip:"",phone:"",claimed:"",clamiedStates:""},t.locations.push(t.inserted)},t.locIVROptions=function(o,a,i){e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/location-ivr-model.html",controller:"LocationIvrModelController",scope:t,backdrop:"static",keyboard:!1,size:"xlg",resolve:{locId:function(){return o},locName:function(){return i},locIvrRouteId:function(){return a},geoid:function(){return t.geoid}}})},t.getLocationRoutesOnReq=function(e){i.getLocationRoutes(e,t.currentPage).then(function(e){"error"!=e.data.status&&(t.locations=[],e.data.json.locations[0].routes.forEach(function(e){t.locations.push({id:e.id,location_ivr_route_id:e.location_ivr_route_id,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:e.target,clamiedStates:e.clamied_states,claimed:e.claimed_zip})}))})};t.saveLocation=function(e,o,a,r){i.checkLDM({trackingNumber:"",ringToNumbers:[i.unMaskData(e.phone)]}).then(function(i){if(i.data.isLDM){var n="The ring to number you have selected belongs to "+i.data.rateCenter+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes. Click OK to continue.";p.confirm(n,function(i){!0===i&&t.saveLocation_(e,o,a,r)})}else t.saveLocation_(e,o,a,r)})},t.saveLocation_=function(e,o,a,r){t.isSaved=!0,t.dupSubmit=!0;var n=i.unMaskData(e.phone);if(","==e.clamiedStates[e.clamiedStates.length-1]&&(e.clamiedStates=e.clamiedStates.substr(0,e.clamiedStates.length-1)),function(e){var t=!0;if(""!==(e=void 0===e?"":e)){for(var o=e.replace(/\s/g,"").split(","),a=o.length-1;a>=0;a--)/(^[A-Za-z]+$)/.test(o[a])||(a=0,t=!1),o[a]&&2!==o[a].length&&(a=0,t=!1);if(t){var r=[];if(_.each(o,function(e){_.contains(g,e.toUpperCase())||r.push(e)}),r.length>0){var n=1==r.length?' in "Claimed States/Provinces" is invalid':' in "Claimed States/Provinces" are invalid';return i.notify({title:"Location Editor",text:r.toString()+n,type:"error"}),!1}return!0}return i.notify({title:"Location Editor",text:"Please enter Claimed State/Province in 2 letter abbreviated form",type:"error"}),t}return t}(e.clamiedStates)){var s=e.claimed.split(","),l=!1;t.claimedInvalid=[],console.log(s),""!==e.claimed&&_.each(s,function(e){console.log(e),/^[0-9][0-9][0-9][0-9][0-9]$/.test(e)||t.claimedInvalid.push(e)});for(var c=0;c<s.length;c++){var d=s[c],u=s;u.splice(c,1);for(var p=0;p<u.length;p++)u[p]==d&&(l=!0)}if(t.claimedInvalid.length>0)return setTimeout(function(){r.$show()},100),void i.notify({title:"Geo route",text:"Entered Claimed ZipCode is invalid.",type:"error"});if(l)return setTimeout(function(){r.$show()},100),void i.notify({title:"Geo route",text:"Please enter unique Claimed Zip",type:"error"});if(e.state&&!_.contains(g,e.state.toUpperCase()))return i.notify({title:"Location Editor",text:e.state+' in "State/Province" is invalid',type:"error"}),void setTimeout(function(){r.$show()},100);t.disEditLocation=!0,t.disableAddIvrBtn=!0,t.disableDelLocation=!0,void 0===e.clamiedStates&&(e.clamiedStates="");var m=e.clamiedStates.replace(/\s+/g,"");if(m=(m=(m=m.split(",")).map(function(e){return e.toUpperCase()})).filter(function(e,t,o){return t===o.indexOf(e)}),o){var f={location_route:{id:o,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:n,location_ivr_route_id:a,claimed_states:m.toString(),claimed_zip:e.claimed,location_id:t.currentLocationid}};console.log(JSON.stringify(f)),i.updateLocationRoute(f).then(function(e){t.disEditLocation=!1,t.disableAddIvrBtn=!1,t.disableDelLocation=!1,"success"===e.data.status?("added",o&&"updated",i.notify({title:"Geo Location",text:"Successfully updated the location",type:"success"}),t.dupSubmit=!1,t.getLocationRoutesOnReq(t.geoid),t.isSaved=!1):(setTimeout(function(){r.$show()},100),i.notify({title:"Geo Location",text:_.isObject(e.data.err)?e.data.err[0].location_route[0].errors[0]:e.data.err,type:"error"}),t.error=e)})}else{var h={location_route:{location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:n,claimed_states:m.toString(),claimed_zip:e.claimed,location_id:t.currentLocationid}};console.log(JSON.stringify(h)),i.createLocationRoute(h).then(function(e){t.disEditLocation=!1,t.disableAddIvrBtn=!1,t.disableDelLocation=!1,"success"===e.data.status?(i.notify({title:"Geo Location",text:"Successfully created location",type:"success"}),t.dupSubmit=!1,t.georoutelocations=[],i.getLocations().then(function(e){"error"!=e.data.result&&e.data.json.locations.forEach(function(e){t.georoutelocations.push({id:e.id,name:e.name,num_loc:e.count,created:null!==e.created?moment(e.created).format("YYYY-MM-DD h:mm:ss a"):"",modified:null!==e.modified?moment(e.modified).format("YYYY-MM-DD h:mm:ss a"):""})})}),i.getLocationRoutes(t.currentLocationid,t.currentPage).then(function(e){if("error"!=e.data.status){var o=e.data.json.locations[0].routes;t.locations=[],o.forEach(function(e){t.locations.push({id:e.id,location_ivr_route_id:e.location_ivr_route_id,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:e.target,claimed:e.claimed_zip,clamiedStates:e.claimed_states}),t.isSaved=!1})}}),t.getLocationRoutesOnReq(t.geoid)):(setTimeout(function(){r.$show()},100),i.notify({title:"Geo Location",text:_.isObject(e.data.err)?e.data.err[0].location_route[0].errors[0]:e.data.err,type:"error"}))})}}else setTimeout(function(){r.$show()},1e3)},t.cancellocationAdd=function(e,o,a){o?a.$cancel():t.locations.splice(e,1),t.dupSubmit=!1,t.$dismiss()},t.removeLocation=function(e,o){o&&p.confirm("Are you sure you want to delete this location?",function(a){a&&i.deleteLocationById(o).then(function(o){"success"===o.data.status?(t.georoutelocations=[],i.getLocations().then(function(e){"error"!=e.data.result&&e.data.json.locations.forEach(function(e){t.georoutelocations.push({id:e.id,name:e.name,num_loc:e.count,created:e.created,modified:e.modified})})}),i.notify({title:"Location Editor",text:"Location Deleted successfully.",type:"success"}),t.locations.splice(e,1)):i.notify({title:"Location Editor",text:o.data.err,type:"error"})})})},t.validateData=function(e,o){var a;if(!e){if(t.arrRequired.push(o),"Geolocation"===o)return i.notify({title:"Geo Route",text:"Name field is required.",type:"error"}),t.disGeoError=!0," ";if("Phone"!==o)return"  "}if("State"===o){if(e.length<2)return t.arrInvalid.push("State")," ";if(!/(^[A-Za-z]+$)/.test(e))return t.arrInvalid.push(o)," "}if("Zip"===o){if(!/^[a-z0-9 ]+$/i.test(e))return t.arrInvalid.push("Zip"),"  ";if(1===_.uniq(e.split("")).length&&"0"===_.uniq(e.split(""))[0])return t.arrInvalid.push("Zip"),"  "}if("Phone"===o){var r;if(t.arrRequired.length)return a="field is required.",t.arrRequired.length>1&&(a="fields are required."),i.notify({title:"Location Editor",text:"'"+t.arrRequired.join(", ")+"' "+a,type:"error"}),t.disError=!0,r=t.arrRequired.indexOf("Phone"),t.arrInvalid=[],t.arrRequired=[],r>0?"   ":"";var n=i.unMaskData(e);if(n.length<10)t.arrInvalid.push("Phone");else{_.each({Alaska:["907","250"]},function(e,t){e.indexOf(n.substring(0,3))>-1&&i.notify({title:"Location Editor",text:"You are using "+t+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes.",type:"info"})})}if(t.arrInvalid.length)return a="field is invalid.",t.arrInvalid.length>1&&(a="fields are invalid."),i.notify({title:"Location Editor",text:"'"+t.arrInvalid.join(", ")+"' "+a,type:"error"}),t.disError=!0,r=t.arrInvalid.indexOf("Phone"),t.arrRequired=[],t.arrInvalid=[],r>-1?"   ":"";t.dupSubmit=!1,t.dupGeoLocation=!1}},t.validateClaimedZip=function(e){var t=[];if(e){var o=e.split(",");if(_.each(o,function(e,o){(e.length<5||isNaN(e)||e.length>5)&&t.push(e)}),t.length>0){var a="is invalid Zip/Postal Code.";return t.length>1&&(a="are invalid Zip/Postal Code."),i.notify({title:"Geo Location",text:"'"+t.join(", ")+"' "+a,type:"error"})," "}}},t.getHeader=function(){return["Location (Required)","Address (Required)","City (Required)","State/Province (Required)","Zip/Postal Code (Required)","10-Digit Phone (Required)","Claimed States/Province (Optional)","Claimed Zip (Optional)"]},t.getExportHeader=function(){return["Location (Required)","Address (Required)","City (Required)","State/Province (Required)","Zip/Postal Code (Required)","10-Digit Phone (Required)","Claimed States/Province (Optional)","Claimed Zip (Optional)"]},t.downloadTemplate=function(){console.log("inside downloadTemplate");return[{a:"your address location",b:"address",c:"city",d:"state",e:"zip",f:"##########",g:"[##,##,##,##,##]",h:"[#####,#####]"},{a:"your address location",b:"address",c:"city",d:"state",e:"zip",f:"##########",g:"[##,##,##,##,##]",h:"[#####,#####]"}]},t.downloadGeoData=function(){t.triggerBoth||u.notify({title:"Export Users",text:"Download is in process, it will be completed in few minutes",type:"info"}),t.triggerBoth=!1;d.start(),t.usersReportFileName=t.headerName+".csv";var e=[],o=l.defer(),a=[];if(i.getLocationRoutes(f,0).then(function(i){if("error"!=i.data.result){var r=i.data.json.locations[0].routes;t.totalDataRows=i.data.json.totalRows,r.forEach(function(e){a.push({id:e.id,location_ivr_route_id:e.location_ivr_route_id,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:e.target,claimed:e.claimed_zip,clamiedStates:e.clamied_states,ivr_status:"old"})})}for(var n=0;n<a.length;n++)a[n].location&&void 0!==a[n].location&&""!==a[n].location&&null!==a[n].location&&e.push({a:a[n].location,b:a[n].address,c:a[n].city,d:a[n].state,e:a[n].zip,f:a[n].phone,g:"["+a[n].clamiedStates+"]",h:"["+a[n].claimed+"]"});if(d.set(50),o.resolve(e),!s.isSafari)return d.end(),o.promise;o.resolve(JSONToCSVConvertor(e,t.headerName,!0,"csv"))}),!s.isSafari)return d.end(),o.promise},t.uploadFile=function(e){var o,a;console.log(e);var r=e[0].name.substring(e[0].name.lastIndexOf(".")+1);console.log(r),"CSV"===r.toUpperCase()?(t.fileIsUploading=!0,i.uploadCSVFile(e,t.currentLocationid).then(function(e){if(t.fileIsUploading=!1,"error"!=e.data.status)m.reload(),i.notify({title:"Geo Location",text:"Locations uploaded successfully",type:"success"});else{if(Array.isArray(e.data.err))if(e.data.err[0].other_params)o=e.data.err[0].other_params,a=o[0].errors;else if(void 0!==e.data.err[0][0].location_route){o=e.data.err[0][0].location_route,a="";for(var r=0;r<o.length;r++)angular.isUndefined(o[r].missing_params)?angular.isUndefined(o[r].errors)||(a=a+","+o[r].errors.join(",")):a=o[r].missing_params.join(",")+" is required"}else a=e.data.err[0];else a=e.data.err.err?e.data.err.err:e.data.err;t.files="",setTimeout(function(){i.notify({title:"Geo Location",text:"Error in uploading file: "+a,type:"error"})},1e3),t.error="Invalid email or password"}})):(i.notify({title:"Geo Location",text:"File extension must be a CSV extension",type:"error"}),t.error="Invalid email or password")}}]).controller("LocationIvrModelController",["$uibModal","$scope","$window","$filter","GeoRouteWebService","$location","$routeParams","$rootScope","UserWebService","pinesNotifications","$bootbox","$route","locId","locIvrRouteId","locName","geoid","CampaignWebService","VoicePromptService","WhisperMessageService",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h,v,b){"use strict";void 0===t.userAccess.voicemail||t.userAccess.voicemail<4?t.voicemailComponent=!1:t.voicemailComponent=!0,t.selectedCallFlow={},t.cAction={},t.ivrActions=[],t.locName=g,t.locIvrRouteId=m,t.canModify=!1,t.TTSIVRSelected=!0,t.selectedCallFlow.activateVoiceMail=!1;t.overflow="3",t.defaultsRings=3,t.selectedCallFlow.Overflow="3",t.hasValidTTSVoiceURL=!1;t.multlevelivr={ivr:{}},void 0!==t.promptAudio&&t.promptAudio.pause(),void 0!==t.ivrAudio&&t.ivrAudio.pause(),void 0!==t.ivrAudio1&&t.ivrAudio1.pause(),void 0!==t.whisperAudio&&t.whisperAudio.pause(),void 0!==t.greetingAudio&&t.greetingAudio.pause(),void 0!==t.calloutcomeAudio&&t.calloutcomeAudio.pause(),void 0!==t.agentidAudio&&t.agentidAudio.pause(),void 0!==t.saleAudio&&t.saleAudio.pause(),void 0!==t.leadAudio&&t.leadAudio.pause(),t.disablePlayBtn=function(e){var t=$(".playpadding").not(this),o=e.currentTarget,a=o.children[0];a.classList.add("fa-pause");var i=setInterval(function(){a.classList.contains("fa-pause")?(t.each(function(e,t){!1===t.disabled&&t.classList.add("customDisabled")}),o.classList.remove("customDisabled")):(t.removeClass("customDisabled"),clearInterval(i))},100)},t.pauseCurrentPlayingAudio=function(){s.$emit("stopIvrAudios",{})},s.$on("stopIvrAudios",function(){t.ivrAudio&&t.ivrAudio.pause(),t.ivrAudio1&&t.ivrAudio1.pause(),t.whisperAudio&&t.whisperAudio.pause()}),t.ivrActions=[{id:1,action_order:1,voicepromptText:"",voicepromptFileName:"",voicepromptURL:"",voicepromptId:"",TTSIVRSelected:!0,hasValidTTSVoiceURL:"",voicepromptTTSText:"",action:"simple",message_type:"",message:"",ringtoNum:"",recordCall:!1,playDisclaimer:"before",overflowNumbers:[{overflowNumber:"",rings:t.overflow,overflow_order:1}],openOverflowBox:!1,isSimultaneousRing:!1,geoRoute:{routeBy:"",geoList:"",radius:""},back_press:"",whisperPrompt:!1,TTSWhisperSelected:!0,whisperTTSText:"",hasValidWhisperURL:"",whisperURL:""}],t.prompts=s.prompts,t.whispers=s.whispers,t.getLocIvr=function(){t.isLoadingApi=!0,t.canModify=!1,i.getLocationIvrRoutes(m).then(function(e){if("error"!=e.data.status){var o=e.data.json[0].voice_prompt_message;if("file://"==o.substring(0,7)){var a="";if(o=o.substring(o.lastIndexOf("/")+1,o.lastIndexOf(".")),t.prompts)for(var i=0;i<t.prompts.length;i++){var r=t.prompts[i].filename.toString();o===r&&(a=t.prompts[i])}t.selectedCallFlow.selectedprompt=a,t.selectedCallFlow.voicepromptURL=a.url,t.selectedCallFlow.voicepromptId=a.id,t.selectedCallFlow.voicepromptText=a.name,t.selectedCallFlow.voicepromptFileName=a.filename,t.TTSIVRSelected=!1,t.hasValidTTSVoiceURL=!0}else t.TTSIVRSelected=!0,t.selectedCallFlow.voicepromptTTSText=o.substring(o.lastIndexOf("/")+1,o.length),t.hasValidTTSVoiceURL=!0;var n=[];_.each(e.data.json,function(e){var o="file",a="file",s=e.message,l=e.whisper_message,c=e.whisper_enabled,d=!1,u=[],p=!1,m={},g=!1,f="",h="",v="",b="",w=!0,y="",S="",C="",A="",T="",D="",I=!1,N=!1;if(e.message&&"file"!=e.message.substring(0,4)&&(o="text"),e.whisper_message&&"file"!=e.whisper_message.substring(0,4)&&(a="text"),"file"==o){if(s=s.substring(s.lastIndexOf("/")+1,s.length),t.prompts)for(i=0;i<t.prompts.length;i++)(r=t.prompts[i].filename+".wav")==s&&(m=t.prompts[i]),f=m.url,v=m.id,b=m.name,y=m.filename,g=!1,w=!0}else g=!0,h=s="blank://"==s?"":s.substring(6,s.length),w=!1;if(c)if("file"==a){if(l=l.substring(l.lastIndexOf("/")+1,l.length),t.whispers)for(i=0;i<t.whispers.length;i++)(r=t.whispers[i].filename+".wav")==l&&(C=(S=t.whispers[i]).name,T=S.url,S.id,D=S.filename,I=!1,N=!0)}else I=!0,A=l=l.substring(6,l.length),N=!1;else I=!0;_.each(e.overflowNumbers,function(e){var t={overflowNumber:e.target_did,rings:e.ring_delay/6,overflow_order:e.overflow_order};"Simultaneous"===e.hunt_type&&(d=!0),u.push(t)}),u.length?p=!0:u=[{overflowNumber:"",rings:3,overflow_order:1}],"hangup"===e.target_did&&(e.ivr_option_type="hangup");var k={action:e.ivr_option_type,action_order:e.action_order,activateVoiceMail:e.vm_enabled,destination:e.destination,id:e.location_ivr_option_id,level:e.level,parentid:e.parentid,previousmenu:e.back_press,message:s,keypress:e.key_press,message_type:o,ringtoNum:e.target_did,overflowNumbers:u,openOverflowBox:p,isSimultaneousRing:d,back_press:e.back_press,voicepromptURL:f,voicepromptId:v,voicepromptText:b,recordCall:e.record_enabled,playDisclaimer:e.play_disclaimer,voicepromptTTSText:h,TTSIVRSelected:g,hasValidTTSVoiceURL:w,voicepromptFileName:y,whisperPrompt:c,TTSWhisperSelected:I,whisperTTSText:A,hasValidWhisperURL:N,whisperText:C,whisperURL:T,whisperFileName:D};n.push(k)}),t.ivrActions=function(e){for(var t,o,a=[],i={},r=0,n=e.length;r<n;r++)t=e[r],i[t.id]=t,i[t.id].ivrActions=[];for(var s in i)i.hasOwnProperty(s)&&((o=i[s]).parentid?i[o.parentid].ivrActions.push(o):a.push(o));return a}(n),t.ivrActions=_.sortBy(t.ivrActions,"action_order"),t.selectedCallFlow.routetype="ivr",t.isLoadingApi=!1}else c.notify({title:"Location IVR",text:e.data.err,type:"error"}),t.isLoadingApi=!1})},m&&t.getLocIvr(),t.chkSpclChar=function(e,t,o){var a=/[!@#$%^&*()_+\-=\[\]{};':"\\|<>\/?]/;a.test(e)?(c.notify({title:t,text:"Special characters are not allowed",type:"error"}),o(e.replace(a,""))):o(e)},t.voiceTextIVRChange=function(){void 0!==t.ivrAudio1&&t.ivrAudio1.pause(),t.ivrAudio1=void 0,void 0===t.selectedCallFlow.voicepromptTTSText||0===t.selectedCallFlow.voicepromptTTSText.length?(console.log(t.selectedCallFlow.voicepromptTTSText,"voicepromptTTSText"),t.hasValidTTSVoiceURL=!1,t.TTSIVRSelected=!0):t.chkSpclChar(t.selectedCallFlow.voicepromptTTSText,"Voice Prompt",function(e){t.selectedCallFlow.voicepromptTTSText=e,t.hasValidTTSVoiceURL=!0,t.TTSIVRSelected=!0})},t.showIVRVoiceModal=function(o){t.disableBtn=!0,w(),e.open({templateUrl:"assets/partials/assignPrompt.html",controller:"voiceModal",size:o}).result.then(function(){for(var e=0;e<v.prompts.length;e++)!0===v.prompts[e].selectedprompt&&(t.selectedCallFlow.voicepromptText=v.prompts[e].name,t.selectedCallFlow.voicepromptFileName=v.prompts[e].filename,t.selectedCallFlow.voicepromptURL=v.prompts[e].url,t.selectedCallFlow.voicepromptId=v.prompts[e].id);t.prompts=s.prompts,t.TTSIVRSelected=!1,t.hasValidTTSVoiceURL=!0,t.selectedCallFlow.voicepromptTTSText="",t.disableBtn=!1},function(){console.log("Modal dismissed at: "+new Date),t.disableBtn=!1})};var w=function(){void 0!==t.whisperAudio&&(t.whisperAudio.pause(),t.whisperAudio=void 0),void 0!==t.promptAudio&&(t.promptAudio.pause(),t.promptAudio=void 0),void 0!==t.ivrAudio&&(t.ivrAudio.pause(),t.ivrAudio=void 0),void 0!==t.ivrAudio1&&(t.ivrAudio1.pause(),t.ivrAudio1=void 0),void 0!==t.greetingAudio&&(t.greetingAudio.pause(),t.greetingAudio=void 0),void 0!==t.calloutcomeAudio&&(t.calloutcomeAudio.pause(),t.calloutcomeAudio=void 0),void 0!==t.agentidAudio&&(t.agentidAudio.pause(),t.agentidAudio=void 0),void 0!==t.saleAudio&&(t.saleAudio.pause(),t.saleAudio=void 0),void 0!==t.leadAudio&&(t.leadAudio.pause(),t.leadAudio=void 0)};t.audioIsPlaying=function(e){return"whisper"!=e&&void 0!==t.whisperAudio&&!t.whisperAudio.paused&&!t.whisperAudio.ended||("prompt"!=e&&void 0!==t.promptAudio&&!t.promptAudio.paused&&!t.promptAudio.ended||("ivr"!=e&&void 0!==t.ivrAudio&&!t.ivrAudio.paused&&!t.ivrAudio.ended||("greeting"!=e&&void 0!==t.greetingAudio&&!t.greetingAudio.paused&&!t.greetingAudio.ended||("calloutcome"!=e&&void 0!==t.outComePromtAudio&&!t.outComePromtAudio.paused&&!t.outComePromtAudio.ended||("agentid"!=e&&void 0!==t.AgentIDVoicePromptAudio&&!t.AgentIDVoicePromptAudio.paused&&!t.AgentIDVoicePromptAudio.ended||"sale"!=e&&void 0!==t.salesAmountVoiceAudio&&!t.salesAmountVoiceAudio.paused&&!t.salesAmountVoiceAudio.ended)))))},t.removeSelectedIVRVoiceAudio=function(){void 0!==t.ivrAudio1&&t.ivrAudio1.pause(),t.ivrAudio1=void 0,t.selectedCallFlow.voicepromptURL=void 0,t.selectedCallFlow.voicepromptTTSText="",t.TTSIVRSelected=!0,t.hasValidTTSVoiceURL=!1},t.playTTSVoiceAudio=function(e){void 0===t.selectedCallFlow.voicepromptTTSText&&(t.selectedCallFlow.voicepromptTTSText=""),void 0===t.ivrAudio1||t.ivrAudio1.paused?void 0!==t.ivrAudio1&&t.ivrAudio1.paused?t.ivrAudio1.play():t.selectedCallFlow.voicepromptTTSText.length>0?(t.ivrAudio1=new Audio,t.onTTS_IVR_Request=!0,h.getTTS(t.selectedCallFlow.voicepromptTTSText).then(function(e){if(e.data.json.length>1){var o="data:audio/mp3;base64,"+e.data.json;t.ivrAudio1.src=o,t.ivrAudio1.paused?t.ivrAudio1.play():t.ivrAudio1.pause()}t.onTTS_IVR_Request=void 0})):(t.ivrAudio1=new Audio(t.selectedCallFlow.voicepromptURL),t.ivrAudio1.play()):t.ivrAudio1.pause()},t.playTtsVoiceAudio=function(e){void 0===t.ivrAudio||t.ivrAudio.paused?void 0!==t.ivrAudio&&t.ivrAudio.paused?t.ivrAudio.play():e.voicepromptTTSText.length>0?(t.ivrAudio=new Audio,t.onTTS_IVR_Request=!0,h.getTTS(e.voicepromptTTSText).then(function(e){if(e.data.json.length>1){var o="data:audio/mp3;base64,"+e.data.json;t.ivrAudio.src=o,t.ivrAudio.paused?t.ivrAudio.play():t.ivrAudio.pause()}t.onTTS_IVR_Request=void 0})):(t.ivrAudio=new Audio(e.voicepromptURL),t.ivrAudio.play()):t.ivrAudio.pause()},t.audioIsDownloading=function(){return void 0!==t.whisperAudio&&void 0!==t.onTTS_WH_Request||(void 0!==t.promptAudio&&void 0!==t.onTTS_VP_Request||(void 0!==t.ivrAudio&&void 0!==t.onTTS_IVR_Request||(void 0!==t.greetingAudio&&void 0!==t.onTTS_WH_Request||(void 0!==t.calloutcomeAudio&&void 0!==t.onTTS_VP_Request||(void 0!==t.agentidAudio&&void 0!==t.onTTS_IVR_Request||(void 0!==t.saleAudio&&void 0!==t.onTTS_VP_Request||void 0!==t.leadAudio&&void 0!==t.onTTS_IVR_Request))))))},t.keycheck=!1;var y=function(e,o){for(var a=[],i=e.length-1;i>=0;i--)if(""!==e[i].keypress&&void 0!==e[i].keypress&&null!==e[i].keypress||a.push("Keypress"),""!==e[i].destination&&void 0!==e[i].destination&&null!==e[i].destination||a.push("Destination"),""!==e[i].voicepromptTTSText&&void 0!==e[i].voicepromptTTSText||""!==e[i].voicepromptURL&&void 0!==e[i].voicepromptURL||"interactiveVoice"!==e[i].action||a.push("Voice Prompt"),1===o||""!==e[i].previousmenu&&void 0!==e[i].previousmenu&&null!==e[i].previousmenu||a.push("Go Back to the previous menu"),"interactiveVoice"!==e[i].action)e[i].recordCall&&("true"!==e[i].playDisclaimer&&void 0!==e[i].playDisclaimer&&null!==e[i].playDisclaimer||a.push("Play call recording disclaimer")),e[i].whisperPrompt&&(void 0!==e[i].whisperTTSText&&""!==e[i].whisperTTSText&&null!==e[i].whisperTTSText||""!==e[i].whisperURL&&null!==e[i].whisperURL||a.push("Play whisper message before connecting")),"simple"===e[i].action&&(void 0!==e[i].ringtoNum&&""!==e[i].ringtoNum&&10===e[i].ringtoNum.replace(/[^0-9]+/g,"").length||a.push("Ring to Phone Number"));else{var r=o+1;y(e[i].ivrActions,r)}for(var n=0;n<e.length;n++)e[n].keypress===e[n].previousmenu&&(2==o&&c.notify({title:"2nd Level IVR",text:"keypress and backpress value should not be same",type:"error"}),3==o&&c.notify({title:"3rd Level IVR",text:"keypress and backpress value should not be same",type:"error"}),t.keycheck=!0);a.length>0&&(i=0,S(a,o))};var S=function(e,o){var a=function(e){var t={},o=[];for(var a in e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t)t[a]>=2&&o.push(a);return o}(e);if(e.length>0){var i=1===e.length&&0===a.length?" field is required.":" fields are required.";e=_.uniq(e),t.IVRInvalidFields.push(e);var r=1==o?"1st":2===o?"2nd":"3rd";c.notify({title:r+" level IVR Form",text:e.toString()+i,type:"error"})}};t.saveLocIVR=function(){t.IVRInvalidFields=[];var e=!1;if(t.pauseCurrentPlayingAudio(),y(t.ivrActions,1),!(t.IVRInvalidFields.length>0))if(t.keycheck)t.keycheck=!1;else{if(t.selectedCallFlow.voicepromptTTSText||t.selectedCallFlow.voicepromptURL){t.isLoadingApi=!0;var o={};t.TTSIVRSelected?(o.message_type="text",o.message=t.selectedCallFlow.voicepromptTTSText):(o.message_type="file",o.message=t.selectedCallFlow.voicepromptFileName),t.keypressDuplicateL1=[],t.keypressDuplicateL2=[],t.keypressDuplicateL3=[];var a=!1;if(_.each(t.ivrActions,function(e){t.keypressDuplicateL1.push(e.keypress),_.each(e.ivrActions,function(e){""!==e.keypress&&t.keypressDuplicateL2.push(e.keypress),_.each(e.ivrActions,function(e){""!==e.keypress&&t.keypressDuplicateL3.push(e.keypress)})}),t.keypressL2=_.uniq(t.keypressDuplicateL2),t.keypressL3=_.uniq(t.keypressDuplicateL3),t.keypressL2.length===t.keypressDuplicateL2.length&&t.keypressL3.length===t.keypressDuplicateL3.length||(a=!0),t.keypressDuplicateL2=[],t.keypressDuplicateL3=[],t.keypressL2=[],t.keypressL3=[]}),t.keypressL1=_.uniq(t.keypressDuplicateL1),t.keypressL1.length!==t.keypressDuplicateL1.length&&(a=!0),a)c.notify({title:"Multilevel IVR Form",text:"Duplicate Key Press Numbers are not allowed",type:"error"});else if(_.each(t.ivrActions,function(o){t.duplicateRingToOverflowL1=[],t.overflowNumberDuplicateL1=[],_.forEach(o.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=l.unMaskData(e.overflowNumber);a===l.unMaskData(o.ringtoNum)&&t.duplicateRingToOverflowL1.push(a),t.overflowNumberDuplicateL1.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),t.overflowNumberDuplicateL1.length!=_.uniq(t.overflowNumberDuplicateL1,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(c.notify({title:"1st level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),e=!0),_.isEmpty(t.duplicateRingToOverflowL1)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(c.notify({title:"1st level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),e=!0),_.each(o.ivrActions,function(o){t.overflowNumberDuplicateL2=[],t.duplicateRingToOverflowL2=[],_.forEach(o.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=l.unMaskData(e.overflowNumber);a===l.unMaskData(o.ringtoNum)&&t.duplicateRingToOverflowL2.push(a),t.overflowNumberDuplicateL2.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),t.overflowNumberDuplicateL2.length!=_.uniq(t.overflowNumberDuplicateL2,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(c.notify({title:"2nd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),e=!0),_.isEmpty(t.duplicateRingToOverflowL2)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(c.notify({title:"2nd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),e=!0),_.each(o.ivrActions,function(o){t.overflowNumberDuplicateL3=[],t.duplicateRingToOverflowL3=[],_.forEach(o.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var a=l.unMaskData(e.overflowNumber);a===l.unMaskData(o.ringtoNum)&&t.duplicateRingToOverflowL3.push(a),t.overflowNumberDuplicateL3.push({unmaskNumber:a,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),t.overflowNumberDuplicateL3.length!=_.uniq(t.overflowNumberDuplicateL3,"unmaskNumber").length&&!0===o.isSimultaneousRing&&"interactiveVoice"!==o.action&&(c.notify({title:"3rd level IVR Form",text:"Duplicate Overflow Numbers are not allowed in simultaneous",type:"error"}),e=!0),_.isEmpty(t.duplicateRingToOverflowL3)||!0!==o.isSimultaneousRing||"interactiveVoice"===o.action||(c.notify({title:"3rd level IVR Form",text:"Overflow Number can not be same as Ring to Phone Number in simultaneous",type:"error"}),e=!0)})})}),!e){o.ivrActions=C(t.ivrActions);var r={};r.location_id=p,r.ivrs=o,r.sendingRouteType="ivr",r.location={org_unit_id:s.currentOUId,name:g};var n=_.sortBy(t.ivrActions,"action_order"),u={trackingNumber:"",ringToNumbers:[]};_.each(n,function(e){e.ringtoNum&&u.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){u.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),e.ivrActions.length>0&&_.each(e.ivrActions,function(e){e.ringtoNum&&u.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){u.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))}),e.ivrActions&&e.ivrActions.length>0&&_.each(e.ivrActions,function(e){u.ringToNumbers.push(e.ringtoNum.replace(/[^0-9]+/g,"").substring(0,3)),e.overflowNumbers&&e.overflowNumbers.forEach(function(e){u.ringToNumbers.push(e.overflowNumber.replace(/[^0-9]+/g,"").substring(0,3))})})})}),i.checkLDM(u).then(function(e){if(e.data.isLDM){var o="The ring to number you have selected belongs to "+e.data.rateCenter+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes. Click OK to continue.";d.confirm(o,function(e){!0===e&&i.saveLocationIVR(r).then(function(e){"error"!=e.data.status?(c.notify({title:"Location IVR",text:"Location IVR saved successfully",type:"success"}),t.isLoadingApi=!1,t.getLocationRoutesOnReq(f),t.$dismiss()):c.notify({title:"Location IVR",text:e.data.err,type:"error"})})})}else i.saveLocationIVR(r).then(function(e){"error"!=e.data.status?(c.notify({title:"Location IVR",text:"Location IVR saved successfully",type:"success"}),t.isLoadingApi=!1,t.getLocationRoutesOnReq(f),t.$dismiss()):c.notify({title:"Location IVR",text:e.data.err,type:"error"})})})}}else c.notify({title:"Location IVR",text:"'Play a voice prompt first' field is required",type:"error"})}};var C=function(e){var t=[];return _.each(e,function(e){!0===e.TTSIVRSelected?(e.message_type="text",e.message=e.voicepromptTTSText):(e.message_type="file",e.message=e.voicepromptFileName),!0===e.TTSWhisperSelected?(e.whisper_message_type="text",e.whisper_message=e.whisperTTSText):(e.whisper_message_type="file",e.whisper_message=e.whisperFileName);var o={action:e.action,activateVoiceMail:e.activateVoiceMail,destination:e.destination,id:e.id,ouid:s.currentOUId,level:e.level,back_press:e.previousmenu,keypress:e.keypress,message:e.message,message_type:e.message_type,action_order:e.action_order,record_enabled:e.recordCall,play_disclaimer:e.playDisclaimer};if("simple"==e.action?(o.whisper_message=e.whisper_message,o.whisper_message_type=e.whisper_message_type,angular.isDefined(e.whisperPrompt)?o.whisper_enabled=e.whisperPrompt:o.whisper_enabled=!1):(o.whisper_message="",o.whisper_message_type="text",o.whisper_enabled=!1),"interactiveVoice"==e.action){var a=C(e.ivrActions);o.ivrActions=a}else if("simple"==e.action){var i=function(e){var t=[];return _.forEach(e.overflowNumbers,function(e){if(""!==e.overflowNumber&&void 0!==e.overflowNumber){var o=l.unMaskData(e.overflowNumber);(!o||o.length<10)&&(isOverflowNumbersValid=!0),t.push({unmaskNumber:o,overflowNumber:e.overflowNumber,rings:e.rings,overflow_order:e.overflow_order})}}),e.overflowNumbers=t,{openOverflowBox:e.openOverflowBox,overflowNumbers:e.overflowNumbers,ringtoNum:l.unMaskData(e.ringtoNum),isSimultaneousRing:e.isSimultaneousRing}}(e);o.ringToData=i}else if("hangup"==e.action){var r={ringtoNum:"hangup"};o.ringToData=r}t.push(o)}),t};t.removeIvr=function(){t.pauseCurrentPlayingAudio();d.confirm("Are you sure, you want to remove this IVR configuration?",function(e){e&&(i.deleteLocationIVR(m).then(function(e){"error"!=e.data.status?(c.notify({title:"Location IVR",text:"Location IVR removed successfully",type:"success"}),t.getLocationRoutesOnReq(f),t.$close()):c.notify({title:"Location IVR",text:e.data.err,type:"error"})}),t.getLocationRoutesOnReq(f))})},t.cancel=function(){if(t.pauseCurrentPlayingAudio(),t.locationIvrForm.$dirty){d.confirm("You are leaving the IVR creation page. If you continue you will lose any IVR configuration settings that have been set. Press 'Ok' to continue and discard all IVR settings, or press 'Cancel' to continue editing IVR settings.",function(e){e&&t.$dismiss()})}else t.$dismiss()}}]),angular.module("old-georoute-builder",["angularFileUpload","ngSanitize","ngCsv"]).factory("OldGeoRouteWebService",["$q","$timeout","$http","$window","$rootScope","$upload","ApiParam",function(e,t,o,a,i,r,n){"use strict";var s={getLocations:function(){var e={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/location/ouid/"+i.currentOUId+"/"+encodeURIComponent(i.timezone),e)},getLocationRoutes:function(e,t){console.log(a.sessionStorage.token);var r={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/location/"+e+"?page="+t,r)},saveLocation:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/location",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},updateLocation:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/location",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},deleteLocation:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/location/delete",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},deleteLocationById:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/location/delete_location/"+e,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(t)},updateLocationRoute:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/locationroute",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},createLocationRoute:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/locationroute",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},uploadCSVFile:function(e,t){var o,n=e[0].name;if(i.percentage=0,e&&e.length)for(var s=0;s<e.length;s++){var l=e[s];o=r.upload({url:i.url+":"+i.port+"/v1/locationroute/import",headers:{Authorization:"bearer "+a.sessionStorage.token},fields:{org_unit_id:i.currentOUId,name:n,location_id:t},file:l}).progress(function(e){i.percentage=parseInt(100*e.loaded/e.total)})}return o},checkLDM:function(e){var t={method:"POST",url:n.baseURL()+"/v1/ldm",headers:n.headerConfig().headers,data:e};return o(t)}};return s}]).filter("tel",function(){return function(e){if(!e)return"";var t,o,a,i=e.toString().trim().replace(/^\+/,"");if(i.match(/[^0-9]/))return e;switch(i.length){case 10:t=1,o=i.slice(0,3),a=i.slice(3);break;case 11:t=i[0],o=i.slice(1,4),a=i.slice(4);break;case 12:t=i.slice(0,3),o=i.slice(3,5),a=i.slice(5);break;default:return e}return 1==t&&(t=""),(t+" ("+o+") "+(a=a.slice(0,3)+"-"+a.slice(3))).trim()}}).run(["editableOptions",function(e){e.theme="bs3"}]).controller("OldGeoRouteTableController",["$scope","$filter","OldGeoRouteWebService","$location","$routeParams","$rootScope","$q","UserWebService","progressLoader","pinesNotifications","$bootbox","$route",function(e,t,o,a,i,r,n,s,l,c,d,u){"use strict";e.fileIsUploading=!1,e.georoutelocations=[],e.dupSubmit=!1,e.dupGeoLocation=!1,e.disError=!1,e.disGeoError=!1,e.arrInvalid=[],e.arrRequired=[],e.isEdit=!1,e.disEdit=!1,e.disEditLocation=!1,e.geoRouteHeaders=["Name","Location","Created","Modified"],e.locationHeaders=["Location","Address","City","State/Province","Zip/Postal Code","Phone","Claimed Zip/Postal Code"],e.actionHeader=["Action"];var p="";if(e.triggerBoth=!1,e.isLoadingApi=!0,!0===r.is_migrated||"true"===r.is_migrated){var m=a.url().split("?");"/set-location"==a.path()?location.href="#/set-legacy-location?"+m[1]:a.path("/set-location")}o.getLocations().then(function(t){"error"!=t.data.result&&(t.data.json.locations.forEach(function(t){e.georoutelocations.push({id:t.id,name:t.name,num_loc:t.count,created:moment(t.created).format("YYYY-MM-DD h:mm:ss a"),modified:null!==t.modified?moment(t.modified).format("YYYY-MM-DD h:mm:ss a"):""})}),e.isLoadingApi=!1,e.canModify=!1,e.totalDataRows=e.georoutelocations.length)}),e.resizeWindow=function(){setTimeout(function(){$(window).trigger("resize")},50)},$(window).scroll(function(){window.pageYOffset>500&&$(window).trigger("resize")}),e.selectedGeoRouteList=null,e.enableSave=function(){e.disError=!1},e.enableGeoSave=function(){e.disGeoError=!1},e.pageChanged=function(t){e.currentPage=t,g(p,e.currentPage)},e.saveGeoList=function(t,a){e.fileSelected=function(){return!!e.files},e.disEdit=!0;var i={location:{org_unit_id:r.currentOUId,name:t.name}};a?(i={location:{id:a,name:t.name}},o.updateLocation(i).then(function(i){""===i.data.err?(angular.extend(t,{id:a}),e.dupGeoLocation=!1,o.notify({title:"Geo Location List",text:"Successfully updated location.",type:"success"}),e.georoutelocations=[],o.getLocations().then(function(t){"error"!=t.data.result&&t.data.json.locations.forEach(function(t){e.georoutelocations.push({id:t.id,name:t.name,num_loc:t.count,created:t.created,modified:t.modified})})}),e.disEdit=!1):(o.notify({title:"Geo Location List",text:i.data.err,type:"error"}),e.disEdit=!1)})):o.saveLocation(i).then(function(a){"success"===a.data.status?(e.totalDataRows++,angular.extend(t,{id:a.data.json.insertId}),e.dupGeoLocation=!1,o.notify({title:"Create Location",text:"Successfully added location.",type:"success"}),e.georoutelocations=[],o.getLocations().then(function(t){"error"!=t.data.result&&t.data.json.locations.forEach(function(t){e.georoutelocations.push({id:t.id,name:t.name,num_loc:t.count,created:t.created,modified:t.modified})})}),e.disEdit=!1):(e.disEdit=!1,o.notify({title:"Geo Location List",text:a.data.err,type:"error"}))})},e.cancelUploading=function(){e.files=""},e.removeGeoList=function(t,a){var i=[];i.push(a);var r={location:{ids:i}};d.confirm("Are you sure you want to delete this list?",function(a){a&&o.deleteLocation(r).then(function(a){e.isEdit=!1,"success"===a.data.status?(e.totalDataRows--,e.georoutelocations.splice(t,1),o.notify({title:"Geo Location List",text:"Successfully deleted the list",type:"success"})):(o.notify({title:"Geo Location List",text:a.data.err,type:"error"}),e.error=a)})})},e.cancelGeoAdd=function(t,o,a){o?(a.$cancel(),e.dupGeoLocation=!1):(e.totalDataRows--,e.georoutelocations.splice(t,1))},e.addGeoList=function(){if(e.georoutelocations.length>0&&(e.totalDataRows++,!e.georoutelocations[e.georoutelocations.length-1].name))return o.notify({title:"Add GeoRoute",text:"You must save the current Georoute List before adding another.",type:"warning"}),void(e.dupGeoLocation=!0);e.inserted={name:""},e.georoutelocations.push(e.inserted)},e.ok=function(){e.isEdit=!1},e.pageChanged=function(t){e.currentPage=t,g(p,e.currentPage)},e.editGeoLocations=function(t,o){e.isEdit=!0,e.dupSubmit=!1,e.selectedGeoRouteList=o,e.locations=[],e.files="",e.geoIndex=t,e.geoid=o,e.currentPage=1,p=o,g(o,e.currentPage),e.headerName=e.georoutelocations[t].name,e.currentLocationid=e.georoutelocations[t].id,e.locations.length<1&&(e.inserted={id:"",location:"",address:"",city:"",state:"",zip:"",phone:"",claimed:""})};var g=function(t,a){e.isLoadingApi=!0,o.getLocationRoutes(t,a).then(function(t){if("error"!=t.data.result){e.locations=[];var o=t.data.json.locations[0].routes;e.totalDataRows=t.data.json.totalRows,o.forEach(function(t){e.locations.push({id:t.id,location:t.location,address:t.address,city:t.city,state:t.state,zip:t.zip,phone:t.target,claimed:t.claimed_zip})})}e.isLoadingApi=!1,setTimeout(function(){$("html, body").animate({scrollTop:$("#locationeditor").offset().top-50},1e3)},100)})};e.removeNewLocation=function(t){var o=e.locations[e.locations.length-1],a=e.locations.length-1;o.address&&o.city&&o.state&&o.zip||e.cancellocationAdd(a,null,t)},e.addLocation=function(){var t;if((e.search=void 0,e.locations.length>0)&&!((t=e.locations[e.locations.length-1]).address&&t.city&&t.state&&t.zip))return o.notify({title:"Add Location",text:"You must save the current location before adding another.",type:"warning"}),void(e.dupSubmit=!0);e.inserted={location:"",address:"",city:"",state:"",zip:"",phone:"",claimed:""},e.locations.push(e.inserted)},e.saveLocation=function(t,a,i){o.checkLDM({trackingNumber:"",ringToNumbers:[o.unMaskData(t.phone)]}).then(function(o){if(o.data.isLDM){var r="The ring to number you have selected belongs to "+o.data.rateCenter+" rate center. If a call is answered on this number, the minutes would be charged as long distance minutes. Click OK to continue.";d.confirm(r,function(o){!0===o&&e.saveLocation_(t,a,i)})}else e.saveLocation_(t,a,i)})},e.saveLocation_=function(t,a,i){var r=o.unMaskData(t.phone);if(e.disEditLocation=!0,a){var n={location_route:{id:a,location:t.location,address:t.address,city:t.city,state:t.state,zip:t.zip,phone:r,claimed_zip:t.claimed,location_id:e.currentLocationid}};o.updateLocationRoute(n).then(function(t){e.disEditLocation=!1,"success"===t.data.status?("added",a&&"updated",o.notify({title:"Geo Location",text:"Successfully updated the location",type:"success"})):(setTimeout(function(){i.$show()},100),o.notify({title:"Geo Location",text:_.isObject(t.data.err)?t.data.err[0].location_route[0].errors[0]:t.data.err,type:"error"}),e.error=t)})}else{var s={location_route:{location:t.location,address:t.address,city:t.city,state:t.state,zip:t.zip,phone:r,claimed_zip:t.claimed,location_id:e.currentLocationid}};o.createLocationRoute(s).then(function(t){e.disEditLocation=!1,"success"===t.data.status?(o.notify({title:"Geo Location",text:"Successfully created location",type:"success"}),e.georoutelocations=[],o.getLocations().then(function(t){"error"!=t.data.result&&t.data.json.locations.forEach(function(t){e.georoutelocations.push({id:t.id,name:t.name,num_loc:t.count,created:t.created,modified:t.modified})})}),o.getLocationRoutes(e.currentLocationid).then(function(t){if("error"!=t.data.status){var o=t.data.json.locations[0].routes;e.locations=[],o.forEach(function(t){e.locations.push({id:t.id,location:t.location,address:t.address,city:t.city,state:t.state,zip:t.zip,phone:t.target,claimed:t.claimed_zip})})}})):(setTimeout(function(){i.$show()},100),o.notify({title:"Geo Location",text:_.isObject(t.data.err)?t.data.err[0].location_route[0].errors[0]:t.data.err,type:"error"}))})}},e.cancellocationAdd=function(t,o,a){o?a.$cancel():e.locations.splice(t,1),e.dupSubmit=!1},e.removeLocation=function(t,a){a&&d.confirm("Are you sure you want to delete this location?",function(i){i&&o.deleteLocationById(a).then(function(a){"success"===a.data.status?(o.notify({title:"Location Editor",text:"Location Deleted successfully.",type:"success"}),e.locations.splice(t,1)):o.notify({title:"Location Editor",text:a.data.err,type:"error"})})})},e.validateData=function(t,a){var i;if(!t){if(e.arrRequired.push(a),"Geolocation"===a)return o.notify({title:"Geo Route",text:"Name field is required.",type:"error"}),e.disGeoError=!0," ";if("Phone"!==a)return"  "}if("State"===a){if(t.length<2)return e.arrInvalid.push("State")," ";if(!/(^[A-Za-z]+$)/.test(t))return e.arrInvalid.push(a)," "}if("Zip"===a){if(!/^[a-z0-9 ]+$/i.test(t))return e.arrInvalid.push("Zip"),"  ";if(1===_.uniq(t.split("")).length&&"0"===_.uniq(t.split(""))[0])return e.arrInvalid.push("Zip"),"  "}if("Phone"===a){var r;if(e.arrRequired.length)return i="field is required.",e.arrRequired.length>1&&(i="fields are required."),o.notify({title:"Location Editor",text:"'"+e.arrRequired.join(", ")+"' "+i,type:"error"}),e.disError=!0,r=e.arrRequired.indexOf("Phone"),e.arrInvalid=[],e.arrRequired=[],r>0?"   ":"";if(o.unMaskData(t).length<10&&e.arrInvalid.push("Phone"),e.arrInvalid.length)return i="field is invalid.",e.arrInvalid.length>1&&(i="fields are invalid."),o.notify({title:"Location Editor",text:"'"+e.arrInvalid.join(", ")+"' "+i,type:"error"}),e.disError=!0,r=e.arrInvalid.indexOf("Phone"),e.arrRequired=[],e.arrInvalid=[],r>-1?"   ":"";e.dupSubmit=!1,e.dupGeoLocation=!1}},e.validateClaimedZip=function(e){var t=[];if(e){var a=e.split(",");if(_.each(a,function(e,o){(e.length<5||isNaN(e)||e.length>5)&&t.push(e)}),t.length>0){var i="is invalid Zip/Postal Code.";return t.length>1&&(i="are invalid Zip/Postal Code."),o.notify({title:"Geo Location",text:"'"+t.join(", ")+"' "+i,type:"error"})," "}}},e.getHeader=function(){return["Location (Required)","Address (Required)","City (Required)","State/Province (Required)","Zip/Postal Code (Required)","10-Digit Phone (Required)","Claimed Zip (Optional)"]},e.getExportHeader=function(){return["Location","Address","City","State/Province","Zip/Postal Code","Phone","Claimed Zip Codes"]},e.downloadTemplate=function(){return[{a:"your address location",b:"address",c:"city",d:"state",e:"zip",f:"##########",g:"[#####,#####]"},{a:"your address location",b:"address",c:"city",d:"state",e:"zip",f:"##########",g:"[#####,#####]"}]},e.downloadGeoData=function(){e.triggerBoth||c.notify({title:"Export Users",text:"Download is in process, it will be completed in few minutes",type:"info"}),e.triggerBoth=!1;l.start(),e.usersReportFileName=e.headerName+".csv";var t=[],a=n.defer(),i=[];return o.getLocationRoutes(p,0).then(function(o){if("error"!=o.data.result){var n=o.data.json.locations[0].routes;e.totalDataRows=o.data.json.totalRows,n.forEach(function(e){i.push({id:e.id,location_ivr_route_id:e.location_ivr_route_id,location:e.location,address:e.address,city:e.city,state:e.state,zip:e.zip,phone:e.target,claimed:e.claimed_zip,clamiedStates:e.clamied_states,ivr_status:"old"})})}for(var s=0;s<i.length;s++)t.push({a:i[s].location,b:i[s].address,c:i[s].city,d:i[s].state,e:i[s].zip,f:i[s].phone,g:"["+i[s].claimed+"]"});if(l.set(50),a.resolve(t),!r.isSafari)return l.end(),a.promise;a.resolve(JSONToCSVConvertor(t,e.headerName,!0,"csv"))}),r.isSafari?t:(l.end(),a.promise)},e.uploadFile=function(t){var a,i;"CSV"===t[0].name.substring(t[0].name.lastIndexOf(".")+1).toUpperCase()?(e.fileIsUploading=!0,o.uploadCSVFile(t,e.currentLocationid).then(function(t){if(e.fileIsUploading=!1,"error"!=t.data.status)u.reload(),o.notify({title:"Geo Location",text:"Locations uploaded successfully",type:"success"});else{if(Array.isArray(t.data.err))if(t.data.err[0].other_params)a=t.data.err[0].other_params,i=a[0].errors;else if(void 0!==t.data.err[0][0].location_route){a=t.data.err[0][0].location_route,i="";for(var r=0;r<a.length;r++)angular.isUndefined(a[r].missing_params)?angular.isUndefined(a[r].errors)||(i=i+","+a[r].errors.join(",")):i=a[r].missing_params.join(",")+" is required"}else i=t.data.err[0];else i=t.data.err.err[0];e.files="",o.notify({title:"Geo Location",text:"Error in uploading file: "+i,type:"error"}),e.error="Invalid email or password"}})):(o.notify({title:"Geo Location",text:"File extension must be a CSV extension",type:"error"}),e.error="Invalid email or password")}}]),angular.module("tag-builder",["angularFileUpload","theme.services","api-param","xeditable","theme.form-directives"]).factory("TagWebService",["$q","$timeout","$http","$window","$rootScope","$upload","pinesNotifications","ApiParam",function(e,t,o,a,i,r,n,s){"use strict";var l={getTags:function(){o.defaults.useXDomain=!0;var e=s.baseURL()+"/v1/tag/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.campaign;return o.get(e,s.headerConfig())},createTag:function(e){return o.post(s.baseURL()+"/v1/tag",e,s.headerConfig())},deleteTag:function(e){return o.put(s.baseURL()+"/v1/tag/delete",e,s.headerConfig())},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t}};return l}]).run(["editableOptions",function(e){e.theme="bs3"}]).factory("CustomSourceWebService",["$q","$timeout","$http","$window","$rootScope","$upload","pinesNotifications","ApiParam",function(e,t,o,a,i,r,n,s){"use strict";var l={getCustomSources:function(){o.defaults.useXDomain=!0;var e=s.baseURL()+"/v1/customSource/ouid/"+i.currentOUId+"/userAccess/"+i.userAccess.campaign+"/isFromCustomSources/"+!0;return o.get(e,s.headerConfig())},createCustomSource:function(e){return o.post(s.baseURL()+"/v1/customSource",e,s.headerConfig())},deleteCustomSource:function(e){return o.put(s.baseURL()+"/v1/customSource/delete",e,s.headerConfig())},unMaskData:function(e){if(e)return e.replace(/[^0-9]+/g,"")},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t}};return l}]).controller("TagController",["$scope","$filter","TagWebService","$location","$routeParams","$rootScope","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){"use strict";e.isLoadingApi=!0,e.userAccess.campaign>=6&&(e.canModify=!1),e.OU_Name=r.currentOUName,e.OUtags=[],e.selected=0,e.selTags=[],e.ALLOUtags=[],e.NonOUtags=[],e.isClicked=!1,o.getTags().then(function(t){if(console.log(t),""===t.data.err){for(var o=0;o<t.data.json.length;o++)t.data.json[o].editable?e.OUtags.push({id:t.data.json[o].tag_id,name:t.data.json[o].tag_name,OU:t.data.json[o].org_unit_id,selected:!1,systemTag:"callback"===t.data.json[o].tag_name}):e.NonOUtags.push({id:t.data.json[o].tag_id,name:t.data.json[o].tag_name,OU:t.data.json[o].org_unit_id,selected:!1,systemTag:"callback"===t.data.json[o].tag_name});e.totalOUtagsRows=e.OUtags.length,e.totalNonOUtagsRows=e.NonOUtags.length,e.isLoadingApi=!1,e.canModify=!0}else n.notify({title:"Create tag",text:t.data.err,type:"error"})}),e.ischecked=function(t,o){if(console.log(o.selected),o.selected)e.selected++,e.selTags.push(o.id);else{var a=e.selTags.indexOf(o.id);a>-1&&(e.selTags.splice(a,1),e.selected--)}},e.deleteSelectedTags=function(){var t="Are you sure you want to delete this Tag?";e.selTags.length>1&&(t="Are you sure you want to delete these Tags?"),e.selected>0&&s.confirm(t,function(t){t&&(e.deltag={tag:{id:e.selTags}},o.deleteTag(e.deltag).then(function(t){if("error"!==t.data.result){e.deltag.tag.id.forEach(function(t){for(var o=0;o<e.OUtags.length;o++)e.OUtags[o].id===t&&(e.OUtags.splice(o,1),e.selected--)});var o="Tag deleted successfully";e.selTags.length>1&&(o="Tags deleted successfully"),n.notify({title:"Tag",text:o,type:"success"}),e.deltag=[],e.selTags=[]}else n.notify({title:"Tag",text:"Error in deleting Tag"+t.data.err,type:"error"})}))})},e.clearSelectedTags=function(){for(var t=0;t<e.OUtags.length;t++)e.OUtags[t].selected&&(e.OUtags[t].selected=!1,e.selected--);e.selTags=[],console.log("delete")},e.addTag=function(){e.isClicked=!0;var t={tag:{tag_name:e.tagText,org_unit_id:r.currentOUId}};o.createTag(t).then(function(t){if(console.log(t),e.isClicked=!1,""===t.data.err)return e.OUtags.push({id:t.data.json.tag_id,name:e.tagText,selected:!1}),e.tagText="",void n.notify({title:"Create Tag",text:"Successfully created tag",type:"success"});n.notify({title:"Create tag",text:t.data.err,type:"error"})})}}]).controller("CustomSourceController",["$scope","$filter","CustomSourceWebService","$location","$routeParams","$rootScope","pinesNotifications","$bootbox",function(e,t,o,a,i,r,n,s){"use strict";e.userAccess.campaign>=6&&(e.canModify=!0),e.OU_Name=r.currentOUName,e.OUcustomSources=[],e.selected=0,e.selCustomSources=[],e.ALLOUCustomSources=[],e.NonOUCustomSources=[],e.isClicked=!1,e.isAssociated=0,o.getCustomSources().then(function(t){if(console.log(t),""===t.data.err)for(var o=0;o<t.data.json.length;o++)t.data.json[o].editable?e.OUcustomSources.push({id:t.data.json[o].custom_source_id,name:t.data.json[o].custom_source_name,OU:t.data.json[o].org_unit_id,isAssociated:t.data.json[o].isAssociated,selected:!1,systemTag:"callback"===t.data.json[o].custom_source_name}):e.NonOUCustomSources.push({id:t.data.json[o].custom_source_id,name:t.data.json[o].custom_source_name,OU:t.data.json[o].org_unit_id,isAssociated:t.data.json[o].isAssociated,selected:!1,systemTag:"callback"===t.data.json[o].custom_source_name});else n.notify({title:"Create Custom Source",text:t.data.err,type:"error"})}),e.ischecked=function(t,o){if(console.log(o.selected),o.selected)e.selected++,e.selCustomSources.push(o.id),o.isAssociated&&e.isAssociated++;else{var a=e.selCustomSources.indexOf(o.id);a>-1&&(e.selCustomSources.splice(a,1),e.selected--),o.isAssociated&&e.isAssociated--}},e.deleteSelectedCustomSources=function(){var t="Are you sure you want to delete this Custom Source?";e.selCustomSources.length>1&&(t="Are you sure you want to delete these Custom Sources?"),e.isAssociated>0&&e.selCustomSources.length>1&&(t="Some of the custom sources are associated with callflows, Are you sure you want to delete this Custom Sources?"),1==e.isAssociated&&1==e.selCustomSources.length&&(t="Some of the custom sources are associated with callflows, Are you sure you want to delete these Custom Source?"),e.selected>0&&s.confirm(t,function(t){t&&(e.delcustomSource={customSource:{id:e.selCustomSources}},o.deleteCustomSource(e.delcustomSource).then(function(t){if("error"!==t.data.result){e.delcustomSource.customSource.id.forEach(function(t){for(var o=0;o<e.OUcustomSources.length;o++)e.OUcustomSources[o].id===t&&(e.OUcustomSources.splice(o,1),e.selected--)});var o="successfully deleted the custom source";e.selCustomSources.length>1&&(o="successfully deleted the custom sources"),n.notify({title:"Custom Source",text:o,type:"success"}),e.delcustomSource=[],e.selCustomSources=[]}else n.notify({title:"Custom Source",text:"Error in deleting Custom Source"+t.data.err,type:"error"})}))})},e.clearSelectedCustomSources=function(){for(var t=0;t<e.OUcustomSources.length;t++)e.OUcustomSources[t].selected&&(e.OUcustomSources[t].selected=!1,e.selected--);e.selCustomSources=[],console.log("delete")},e.addCustomSource=function(){e.isClicked=!0;var t={customSource:{custom_source_name:e.customSourceText,org_unit_id:r.currentOUId}};o.createCustomSource(t).then(function(t){if(e.isClicked=!1,console.log(t),""===t.data.err)return e.OUcustomSources.push({id:t.data.json.custom_source_id,name:e.customSourceText,selected:!1}),e.customSourceText="",void n.notify({title:"Create Custom Source",text:"Successfully created custom source",type:"success"});n.notify({title:"Create Custom Source",text:t.data.err,type:"error"})})}}]),angular.module("activitystream-builder",["api-param"]).factory("ActivityStreamWebService",["ApiParam","$q","$timeout","$http",function(e,t,o,a){"use strict";var i={notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},stream:function(t){var o={method:"POST",url:e.baseURL()+"/v1/logactivity/stream",headers:e.headerConfig().headers,data:t};return a(o)},userList:function(t){var o={method:"GET",url:e.baseURL()+"/v1/orgunit/userList/"+t,headers:e.headerConfig().headers};return a(o)}};return i}]).controller("ActivityStreamController",["$scope","$filter","TagWebService","$location","$routeParams","$rootScope","ActivityStreamWebService","pinesNotifications",function(e,t,o,a,i,r,n,s){"use strict";e.drp_options={ranges:{Today:[moment(),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(7,"days"),moment().subtract(1,"days").endOf("day")],"Last 30 Days":[moment().subtract(30,"days"),moment().subtract(1,"days").endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment().subtract(7,"days"),endDate:moment().subtract(1,"days").endOf("day")},e.drp_start=moment().subtract("days",10).format("MMMM D, YYYY"),e.drp_end=moment().format("MMMM D, YYYY"),e.logs=[],e.user_list=[],e.log_name="",e.ct_user_id="",e.view=!1,e.isReqSent=!1;var l=0,c="";e.preview=!!a.search().preview&&a.search().preview,a.search().preview&&$("#wrap").append('<div id="previewBlock">&nbsp;</div>'),e.log_list=[{log:"log_billing",text:"Billing"},{log:"log_call_action",text:"Call Actions"},{log:"log_call_flow",text:"Tracking Number"},{log:"log_campaign",text:"Campaign"},{log:"log_integration",text:"Integrations"},{log:"log_ivr",text:"IVR Routes"},{log:"log_tag",text:"Tags"},{log:"log_user",text:"User/Group"},{log:"log_webhook",text:"Webhooks"},{log:"log_distribution_list",text:"Distribution List"},{log:"log_schedule",text:"Scheduler"}];var d={log_billing:"fa fa-money",log_call_action:"fa fa-bolt",log_call_flow:"fa fa-phone",log_campaign:"fa fa-gear",log_integration:"fa-cloud",log_ivr:"fa fa-wrench",log_tag:"fa fa-tags",log_user:"fa fa-user",log_webhook:"fa fa-info",log_distribution_list:"fa fa-info",log_schedule:"fa fa-info"},u={insert:"added",delete:"removed",update:"modified",login:"login for",logout:"logout for"},p={log_billing:"activity-indigo",log_call_action:"activity-midnightblue",log_call_flow:"activity-green",log_campaign:"activity-success",log_integration:"activity-magenta",log_ivr:"activity-green",log_user:"activity-primary",log_tag:"activity-sky",log_webhook:"activity-orange",log_distribution_list:"activity-orange",log_schedule:"activity-brown"};e.getLogs=function(t){if(e.isReqSent=!0,"end"===l)return e.loading=!1,void s.notify({title:"No more log records",text:"There are no more records in the system to retrieve for display",type:"info"});var o={org_unit_id:r.currentOUId,start_date:e.drp_start+" 00:00:00",end_date:e.drp_end+" 23:59:59",timezone:r.timezone,limit:t,last_date:c,offset:l*t};e.log_name&&(o.log=e.log_name),e.ct_user_id&&(o.ct_user_id=e.ct_user_id),n.stream(o).then(function(t){e.isReqSent=!1,"error"!==t.data.result?t.data.json.length?($.each(t.data.json,function(t,o){o.log_date=moment(o.timezone,"YYYY-MM-DD hh:mm:ss A").format("dddd, MMMM DD, YYYY h:mm:ss A"),o.iconcss=d[o.log_name]?d[o.log_name]:d.user,o.divcss=p[o.log_name]?p[o.log_name]:p.user,o.action=u[o.log_data.action],"log_tag"==o.log_name&&null===o.ct_user_id&&o.log_data.fields.data.call_id?o.username="Call Action (null)":o.username=o.first_name+" "+o.last_name+" ("+o.username+")",_.each(e.log_list,function(e){e.log===o.log_name&&(o.log_name=e.text)}),e.logs.push(o),e.loading=!1}),e.logs.length>0&&(c=e.logs[e.logs.length-1].timezone,c=new Date(c).getTime()),l++):(e.loading=!1,l="end"):(l="end",s.notify({title:"Log Retrieval Failure",text:"An error occurred. "+t.data.error,type:"error"}))})},e.changeDateRange=function(){l=0,e.logs=[],e.getLogs(25)},e.setUser=function(t){t=parseInt(t),e.ct_user_id=t,l=0,e.logs=[],e.getLogs(25),e.view=!!t||!!e.log_name,_.each(e.user_list,function(o){o.ct_user_id===t&&(console.log("matched user",o.name),e.user=o.name)})},e.setLog=function(t){e.log_name=t,l=0,e.logs=[],e.getLogs(25),e.view=!!t||!!e.ct_user_id,_.each(e.log_list,function(o){o.log===t&&(e.section=o.text)})},e.moreLogs=function(){e.loading=!0,!1===e.isReqSent&&e.getLogs(25)}}]),angular.module("webhook",["api-param","theme.form-directives"]).factory("WebhookService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getJsonConfig:function(){return{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},list:function(e){return o.get(r.baseURL()+"/v1/webhook/list/"+e,r.headerConfig())},getDataAppendInfo:function(e){var t={method:"GET",url:i.url+":"+i.port+"/v1/billing/"+e,headers:this.getJsonConfig()};return o(t)},webhookList:function(e){return o.get(r.baseURL()+"/v1/webhook/webhooklist/"+e,r.headerConfig())},addHook:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/webhook",headers:this.getJsonConfig(),data:e};return o(t)},upHook:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/webhook",headers:this.getJsonConfig(),data:e};return o(t)},getWebhook:function(e){var t={method:"GET",url:i.url+":"+i.port+"/v1/webhook/"+e+"/ouid/"+i.currentOUId,headers:this.getJsonConfig()};return o(t)},addMap:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/webhook/map",headers:this.getJsonConfig(),data:e};return o(t)},updateMap:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/webhook/map",headers:this.getJsonConfig(),data:e};return o(t)},dropMap:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/webhook/map/"+e,headers:this.getJsonConfig()};return o(t)},dropWebhook:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/webhook/"+e,headers:this.getJsonConfig()};return o(t)},testWebHook:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/webhook/test",headers:this.getJsonConfig(),data:e};return o(t)},webhookRoute:function(e){var t={method:"GET",url:i.url+":"+i.port+"/v1/webhook/route/"+e,headers:this.getJsonConfig()};return o(t)}};return n}]).controller("WebhookController",["$scope","$filter","TagWebService","$location","$window","$routeParams","$rootScope","WebhookService","$bootbox","pinesNotifications","$route",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";n.isSafari=i.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),n.userAccess.webhook?(e.headerNames={name:"Name",related_call_flows:"Related Tracking Numbers",status:"Status",actions:"Actions"},e.isLoadingApi=!0,s.list(n.currentOUId).then(function(t){"error"!==t.data.result&&(e.wbhooks=[],_.each(t.data.json,function(t){var o=[];t.post_webhooks&&o.push(t.post_webhooks),t.pre_webhooks&&o.push(t.pre_webhooks),t.provisioned_route_name=_.uniq(o).join(", "),e.wbhooks.push(t)}),e.hooks=e.wbhooks,e.isLoadingApi=!1)}),e.editWebhook=function(e){i.location.href=document.location.protocol+"//"+document.location.host+"/#/set-webhook-builder?webhook_id="+e},e.deleteWebhook=function(e){var t="";t=e.provisioned_route_name?"This webhook is associated with ("+e.provisioned_route_name+") Tracking Number.  Are you sure you want to delete?":"Are you sure you want to delete this webhook?",l.confirm(t,function(t){t&&s.dropWebhook(e.webhook_id).then(function(e){"success"===e.data.result?(d.reload(),c.notify({title:"Webhook",text:"Webhook deleted successfully",type:"success"})):c.notify({title:"Webhook",text:"Failed while deleting your webhook. "+e.data.err,type:"error"})})})},e.csvHeaderNames=[e.headerNames.name,e.headerNames.related_call_flows,e.headerNames.status],e.getCSVData=function(t){var o,a=e.headerNames,i=_.map(e.hooks,function(e){return(o={})[a.name]=e.webhook_name,o[a.related_call_flows]=e.provisioned_route_name,o[a.status]=e.webhook_status,o});if(!n.isSafari)return i;var r="csv_webhooks";"tsv"===t&&(r="tsv_webhooks"),JSONToCSVConvertor(i,r,!0,t)},e.exportPDF=function(){var e=new jsPDF("p","pt","a4");e.addHTML($("#pdfExportGroup"),function(){e.output("datauristring")}),setTimeout(function(){e.save("webhooks - "+moment().format("MMMM Do YYYY")+".pdf")},2e3)}):location.href="#/access-denied"}]).controller("WebhookBuilderController",["$scope","$filter","TagWebService","$location","$window","$routeParams","$rootScope","WebhookService","pinesNotifications","$bootbox","$route",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";e.webhook_id=a.search().webhook_id,e.static_success=!1,e.static_fail=!1,e.static=[],e.routes=[],e.dupSubmit=!1,e.disError=!1,e.disEdit=!1,e.data_append=!1,n.userAccess.webhook?(s.getDataAppendInfo(i.sessionStorage.billingId).then(function(t){"error"!==t.data.result&&t.data.json.length>0&&(e.append_active=t.data.json[0].data_append)}),e.webhook_id?s.getWebhook(e.webhook_id).success(function(t){if("error"===t.result)return s.notify({title:"Webhook",text:"Unauthorised Access to the Webhook",type:"error"}),void(location.href="#/set-webhook");var o=!1;"active"===t.json[0].webhook_status&&(o=!0),e.isNewWebhook=!1,e.webhook=t.json[0],e.routes=e.webhook.routes,e.static=e.webhook.static,e.webhook_name=e.webhook.webhook_name,e.webhook_desc=e.webhook.webhook_desc,e.target_url=e.webhook.target_url,e.http_method=e.webhook.http_method,e.response_format=e.webhook.response_format,e.webhook_id=e.webhook.webhook_id,e.webhook_status=o,e.include_score=e.webhook.include_score,e.include_dni=e.webhook.include_dni,e.data_append=e.webhook.include_data_append}):(e.isNewWebhook=!0,e.webhook_status=!0),e.arrRequired=[],e.validateStaticData=function(t,o){var a;if(!t&&(e.arrRequired.push(o),"Static Value"!=o))return"   ";if("Static Value"==o&&e.arrRequired.length){a="field is required.",e.arrRequired.length>1&&(a="fields are required."),e.disError=!0,s.notify({title:"Static Parameter",text:"'"+e.arrRequired.join(", ")+"' "+a,type:"error"});var i=e.arrRequired.indexOf("Static Value");return e.arrInvalid=[],e.arrRequired=[],i>-1?"   ":""}},e.setWebhook=function(){var t={org_unit_id:n.currentOUId,webhook_name:e.webhook_name,webhook_desc:e.webhook_desc,target_url:e.target_url,http_method:e.http_method,response_format:e.response_format,webhook_status:e.webhook_status?"active":"inactive",include_dni:e.include_dni?"true":"false",include_score:e.include_score?"true":"false",include_data_append:e.data_append?"true":"false"};e.webhook_id?(t.webhook_id=e.webhook_id,t.webhook_updated="CURRENT_TIMESTAMP()",s.upHook(t).then(function(t){e.formSubmit=!1,"success"===t.data.result?l.notify({title:"Webhook Details",text:"Successfully updated your webhook",type:"success"}):l.notify({title:"Webhook Details",text:"Failed while updating your webhook. "+t.data.err,type:"error"})})):s.addHook(t).then(function(t){if(e.formSubmit=!1,"success"===t.data.result)return l.notify({title:"Webhook Details",text:"Successfully created your webhook",type:"success"}),e.webhook_id=t.data.json.insertId,void a.search("webhook_id",e.webhook_id);l.notify({title:"Webhook Details",text:"Failed while creating your webhook. "+t.data.err,type:"danger"})})},e.setStatic=function(t,o){if(e.disEdit=!0,e.webhook_id){var a={field_name:t.field_name,field_value:t.field_value,webhook_id:e.webhook_id,map_order:e.static.length};o?(a.webhook_map_id=o,s.updateMap(a).then(function(t){e.disEdit=!1,"success"===t.data.result?(e.dupSubmit=!1,l.notify({title:"Webhook Details",text:"Static Parameter updated successfully",type:"success"})):(l.notify({title:"Webhook Details",text:"Error in updating Static Parameter"+t.data.err,type:"error"}),e.error=t)})):s.addMap(a).then(function(t){e.disEdit=!1,"success"===t.data.result?(l.notify({title:"Webhook Details",text:"Static Parameter created successfully",type:"success"}),d.reload()):(l.notify({title:"Webhook Details",text:"Error in creating Static Parameter"+t.data.err,type:"error"}),e.error=t)})}else alert("You need to create a webhook first")},e.removeStatic=function(t,o){c.confirm("Are you sure you want to delete this Static Parameter?",function(t){t&&s.dropMap(o).then(function(t){if("success"===t.data.result)for(var a in l.notify({title:"Webhook Details",text:"Static Parameter deleted successfully",type:"success"}),e.static)e.static[a].webhook_map_id==o&&e.static.splice(a,1);else l.notify({title:"Webhook Details",text:"Error in deleting Static Parameter"+t.data.err,type:"error"})})})},e.addStatic=function(){var t;if(e.static.length>0&&(!(t=e.static[e.static.length-1]).field_name||!t.field_value))return l.notify({title:"Add Location",text:"Save currently added static parameter before adding another.",type:"warning"}),void(e.dupSubmit=!0);e.inserted={field_name:"",field_value:""},e.static.push(e.inserted)},e.enableSave=function(){e.disError=!1},e.cancelStatic=function(t,o,a){o?a.$cancel():e.static.splice(t,1),e.dupSubmit=!1},$(".alert").alert(),e.testWebhook=function(){if(e.target_url){console.log(e.static.length);for(var t=[],o=0;o<e.static.length;o++)t.push({fieldname:e.static[o].field_name,fieldvalue:e.static[o].field_value});e.static[0];var a=e.target_url.split("/"),i=a[2],r=[];for(o=3;o<a.length;o++)r.push(a[o]);r=r.join("/");var n={url:e.target_url,method:e.http_method,format:e.response_format,host:i,path:r,param:t};s.testWebHook(n).then(function(t){200===t.status&&"error"!==t.data.result?e.static_success=!0:e.static_fail=!0})}else l.notify({title:"Test Webhook",text:"End Point URL is required",type:"error"})},e.closeFail=function(){e.static_fail=!1},e.closeSuccess=function(){e.static_success=!1},e.validateData=function(t,o){var a=/^[a-zA-Z0-9_ -]+$/;switch(o){case"Webhook Name":a.test(t)||e.arrInvalid.push(o);break;case"Trigger Point":""===t&&e.arrInvalid.push(o);break;case"End Point URL":a.test(t)||e.arrInvalid.push(o);break;case"Method":case"Format":""===t&&e.arrInvalid.push(o)}if(e.arrInvalid.length){var i="field"+(e.arrInvalid.length>1?"s":"")+" is invalid.";return s.notify({title:"Webhook Details",text:"'"+e.arrInvalid.join(", ")+"' "+i,type:"error"}),e.arrRequired=[],e.arrInvalid=[],""}}):location.href="#/access-denied"}]),angular.module("caller_privacy",["api-param","theme.navigation-controller"]).factory("callerPrivacyService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={getJsonConfig:function(){return{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},access:function(e){return o.get(r.baseURL()+"/v1/callerprivacy/"+e,r.headerConfig())},setSettings:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/callerprivacy",headers:this.getJsonConfig(),data:e};return o(t)},setDownloadAudioSetting:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/callerprivacy/download-audio",headers:this.getJsonConfig(),data:e};return o(t)},setProtection:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/callerprivacy/protection",headers:this.getJsonConfig(),data:e};return o(t)}};return n}]).controller("callerPrivacyController",["$scope","$filter","$location","$routeParams","$rootScope","callerPrivacyService","pinesNotifications","$bootbox","$route","menuBarService","$window",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";i.highestOUId===i.billingId&&void 0!==i.userAccess.hipaa&&1===parseInt(i.roleId)&&7===parseInt(i.userAccess.hipaa)||(location.href="#/access-denied"),e.userAccess&&e.userAccess.downloadaudio&&(e.downloadAudioToggle=!0),e.callerName=!1,e.address=!1,e.city=!1,e.lineType=!1,e.state=!1,e.odnActive=!1,e.companyName=!1,e.isDataAppend=!1,r.access(i.currentOUId).then(function(t){if("success"===t.data.result){var o=t.data.json[0];e.callerName=o.is_caller_name,e.address=o.is_address,e.city=o.is_city,e.lineType=o.is_line_type,e.state=o.is_state,e.zip=o.is_zip,e.odnActive=o.protect_caller_id,e.companyName=o.is_company_name,e.isDataAppend=o.data_append,e.allowDownloadAudio=o.download_audio_enabled}else n.notify({title:"Caller Privacy Setting",text:"Error fetching settings"+t.data.err,type:"error"})}),e.activeToggle=function(){e.cpSttings={},e.cpSttings.is_caller_name=e.callerName,e.cpSttings.is_address=e.address,e.cpSttings.is_city=e.city,e.cpSttings.is_line_type=e.lineType,e.cpSttings.is_state=e.state,e.cpSttings.is_zip=e.zip,e.cpSttings.is_company_name=e.companyName,e.cpSttings.org_unit_id=i.currentOUId,r.setSettings(e.cpSttings).then(function(e){"success"===e.data.result?n.notify({title:"Caller Privacy Setting",text:"Settings updated successfully",type:"success"}):n.notify({title:"Caller Privacy Setting",text:"Error updating settings : "+e.data.err,type:"error"})})},e.setProtection=function(){e.cpSttings={},e.cpSttings.protect_caller_id=e.odnActive,e.cpSttings.org_unit_id=i.currentOUId,r.setProtection(e.cpSttings).then(function(e){"success"===e.data.result?n.notify({title:"Caller Privacy Setting",text:"Settings updated successfully",type:"success"}):n.notify({title:"Caller Privacy Setting",text:"Error updating settings : "+e.data.err,type:"error"}),i.protect_caller_id=d.sessionStorage.protect_caller_id=e.data.json.protect_caller_id;var t=c.getMenuBar();_.each(t,function(o,a){"Settings"===o.label&&_.each(t[a].children,function(o,i){if("Customization"===o.label){var r=_.findLastIndex(t[a].children[i].children,{label:"Blacklist"});e.data.json.protect_caller_id?r>-1&&t[a].children[i].children.splice(r,1):-1===r&&t[a].children[i].children.push({label:"Blacklist",url:"#/set-blacklist"})}t[a].children[i].children=_.sortBy(t[a].children[i].children,function(e){return e.label})})}),c.setMenuBar(t)})},e.setDownloadAudioSetting=function(){e.daSettings={},e.daSettings.is_caller_name=e.callerName,e.daSettings.is_address=e.address,e.daSettings.is_city=e.city,e.daSettings.is_line_type=e.lineType,e.daSettings.is_state=e.state,e.daSettings.is_zip=e.zip,e.daSettings.is_company_name=e.companyName,e.daSettings.download_audio_enabled=e.allowDownloadAudio,e.daSettings.org_unit_id=i.currentOUId,r.setDownloadAudioSetting(e.daSettings).then(function(t){"success"===t.data.result?n.notify({title:"Download Audio Setting",text:"Settings updated successfully",type:"success"}):n.notify({title:"Download Audio Setting",text:"Error updating settings : "+t.data.err,type:"error"}),i.download_audio_enabled=d.localStorage.download_audio_enabled=e.allowDownloadAudio;var o=c.getMenuBar(),a=_.findIndex(o,{label:"Legacy Reports"});if(1==e.allowDownloadAudio)-1==a&&(o.splice(2,0,{label:"Legacy Reports",iconClasses:"fa fa-bar-chart-o",children:[{label:"Call Details",url:"#/calls-details?report=call_detail"},{label:"Group Activity",url:"#/activity-group?report=group_activity"},{label:"Tracking Number Settings",url:"#/settings-call-flow?report=callflow_setting"}]}),_.each(o,function(e,t){"Settings"===e.label&&o[t].children.splice(1,0,{label:"Legacy Scheduled Reports",url:"#/set-scheduled"})}));else if(-1!==a){o.splice(a,1);var r=-1;_.each(o,function(e,t){"Settings"===e.label&&(_.each(o[t].children,function(e,t){"Legacy Scheduled Reports"===e.label&&(r=t)}),-1!==r&&o[t].children.splice(r,1))})}c.setMenuBar(o)})}}]),angular.module("dataappend",[]).factory("DataAppendService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";var r={getJsonConfig:function(){return{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}},notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},getDataAppendInfo:function(e){var t={method:"GET",url:i.url+":"+i.port+"/v1/billing/"+e,headers:this.getJsonConfig()};return o(t)},addDataAppendInfo:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/billing",headers:this.getJsonConfig(),data:e};return o(t)},updateDataAppendInfo:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/billing/",headers:this.getJsonConfig(),data:e};return o(t)}};return r}]).controller("DataAppendController",["$scope","$filter","$location","$window","$routeParams","$rootScope","DataAppendService","$bootbox","pinesNotifications","$route",function(e,t,o,a,i,r,n,s,l,c){"use strict";e.isNew=!0,(a.sessionStorage.currentOUId!==a.sessionStorage.billingId||e.userAccess.orgunit<6)&&(location.href="#/access-denied"),e.setAppendAct=function(){var t={};!0===e.append_active?(console.log("action was true"),!0===e.isNew?(console.log("new so POST"),t={billing:{org_unit_id:r.currentOUId,data_append:!0}},n.addDataAppendInfo(t).then(function(t){return"error"!==t.data.result?(e.isNew=!1,void l.notify({title:"Data Append",text:"Data Append successfully Enabled",type:"success"})):void l.notify({title:"Data Append",text:"There was an error Enabling Data Append",type:"error"})})):(console.log("existing so PUT"),t={billing:{org_unit_id:r.currentOUId,data_append:!0}},n.updateDataAppendInfo(t).then(function(e){return"error"!==e.data.result?void l.notify({title:"Data Append",text:"Data Append successfully Enabled",type:"success"}):void l.notify({title:"Data Append",text:"There was an error Enabling Data Append",type:"error"})}))):(console.log("action was false"),!0===e.isNew?(console.log("new so POST"),t={billing:{org_unit_id:r.currentOUId,data_append:!1}},n.addDataAppendInfo(t).then(function(t){return"error"!==t.data.result?(e.isNew=!1,void l.notify({title:"Data Append",text:"Data Append successfully Disabled",type:"success"})):void l.notify({title:"Data Append",text:"There was an error Disabling Data Append",type:"error"})})):(console.log("existing so PUT"),t={billing:{org_unit_id:r.currentOUId,data_append:!1}},n.updateDataAppendInfo(t).then(function(e){return"error"!==e.data.result?void l.notify({title:"Data Append",text:"Data Append successfully Disabled",type:"success"}):void l.notify({title:"Data Append",text:"There was an error Disabling Data Append",type:"error"})})))},n.getDataAppendInfo(a.sessionStorage.billingId).then(function(t){"error"!==t.data.result&&(t.data.json.length>0?(e.isNew=!1,e.append_active=t.data.json[0].data_append):e.isNew=!0)})}]),angular.module("theme.form-uploads",["flow"]).config(["flowFactoryProvider",function(e){"use strict";e.defaults={target:"",permanentErrors:[500,501],maxChunkRetries:1,chunkRetryInterval:5e3,simultaneousUploads:1},e.on("catchAll",function(e){console.log("catchAll",arguments)})}]),angular.module("distributionList",["isteven-multi-select"]).controller("distributionListController",["$scope","$rootScope","$uibModal","$routeParams","pinesNotifications","OrgUnitLocal","$location","$filter","distributionListWebservices","$bootbox","$q","$timeout",function(e,t,o,a,i,r,n,s,l,c,d,u){function p(e){var t=[];return _.each(e,function(e){t.push({Name:e.list_name,Usage:e.report_name})}),t}e.campaignAndAssignedUsers=[],e.selectList=[],e.recipientList=[],e.listData={},e.isLoadingApi=!0,e.roleId=t.roleId,e.userId=parseInt(t.userId),e.isAdmin=1===parseInt(e.roleId),e.isDataLoaded=!0,e.setDistHeaders=["Name","Usage"],e.setDistBuildHeaders=["Name","Frequency","Format"],e.actionHeader=["Actions"],t.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.openDistributionListModal=function(t,a){e.isModelOpened=!0;var i=o.open({templateUrl:"assets/partials/addDistList.html",controller:"distributionListModalController",size:t,backdrop:"static",resolve:{listIdAndData:function(){return void 0===a&&(e.listData={}),[a,e.listData]}}});i.opened.then(function(){e.isModelOpened=!1}),i.result.then(function(t){l.getDistributionList().then(function(t){e.distributionList=t.data.json})})},l.getDistributionList().then(function(t){"error"===t.data.status?i.notify({title:"Error in getting distribution list",text:t.err,type:"error"}):(e.distributionList=t.data.json,e.isLoadingApi=!1,e.totalDataRows=e.distributionList.length)}),e.deleteDistributionList=function(t,o){var a="";""!==t.report_name&&(a="This distribution list is associated with schedule report,"),a+=" Are you sure you want to delete this Distribution List?",c.confirm(a,function(a){a&&l.removeDistributionList(t.list_id).then(function(t){"success"===t.data.status?(e.distributionList.splice(o,1),i.notify({title:"Distribution List",text:"Successfully deleted the distribution list",type:"success"})):i.notify({title:"Distribution List",text:t.data.err,type:"error"})})})},e.editDistributionList=function(t,o){e.isModelOpened=!0,l.getDistributionListData(o).then(function(a){if("error"===a.data.status)i.notify({title:"Error in getting distribution list data",text:a.err,type:"error"}),e.listData={};else{e.listData=a.data.json;var r=[];_.each(e.listData.recipientlist,function(e){"campaign"===e.recipientType&&r.push(e.recipientTypeValue)}),r.length>0?l.campaignUsers(r).then(function(a){"success"===a.data.status&&(e.listData.selectedCampaignUsers=a.data.json,e.openDistributionListModal(t,o))}):e.openDistributionListModal(t,o)}})},e.getCSVData=function(o){var a;e.headerNames=["Name","Usage"];var i=d.defer();if(a=p(e.distributionList),i.resolve(a),t.isSafari){var r="csv_distribution_list";"tsv"===o&&(r="tsv_distribution_list"),i.resolve(JSONToCSVConvertor(a,r,!0,o))}if(!t.isSafari)return i.promise},e.getExcelData=function(){var t;e.headerNames=["Name","Usage"];var o=d.defer();return t=p(e.distributionList),alasql('SELECT * INTO XLSX("xls_distribution_list.xlsx",{sheetid:"Sheet name",headers:true}) FROM ?',[t]),o.resolve(t),o.promise}}]).controller("distributionListModalController",["$scope","$rootScope","$uibModalInstance","$routeParams","pinesNotifications","OrgUnitLocal","$location","$filter","listIdAndData","distributionListWebservices",function(e,t,o,a,i,r,n,s,l,c,d){var u,p,m,g,f;e.distributionListHeadingText="Create a Distribution List",e.campaignAndAssignedUsers=l[1],e.listData={},e.distributionActive=!1,e.campaignUsers=[],void 0!==l[0]&&(e.distributionListHeadingText="Edit a Distribution List",u=l[1],e.listData.from_label=u.listData.from_label,e.listData.list_name=u.listData.list_name,e.listData.additionalEmails=u.additionalEmails,void 0!==l[1].selectedCampaignUsers&&(e.campaignUsers=(p=l[1].selectedCampaignUsers,m=[],g="",f=[],void 0!==p&&_.each(p,function(e){var t=e.usersid.split(","),o=_.indexOf(t,"user-"+e.owner_id),a={id:e.campaignid,users:"",user_ids:(""!==e.usersid?e.usersid+(-1!==o&&""!==e.usersid?",":""):"")+(-1===o?"user-"+e.owner_id:"")};""!==e.usersname&&(f=e.usersname.split(",")),-1===o&&f.push(e.ownername),g=f.map(function(e){return"<div>"+e+"</div>"}).join(""),a.users=g,m.push(a)}),m))),e.dropdownListData=function(e,t){console.log("LIST DATA IN DL DROPDOWN",t);var o=[],a=[],i=[];void 0!==t[0]&&(_.each(t[1].recipientlist,function(e){"campaign"===e.recipientType?o.push(e.recipientTypeValue):a.push(e.recipientTypeValue)}),_.each(t[1].selectedCampaignUsers,function(e){_.each(e.usersid.split(","),function(e){i.push(parseInt(e.replace("user-","")))})}));var r=[{name:"<strong>Campaign Users</strong>",msGroup:!0}];return void 0!==e&&void 0!==e.campList&&_.each(e.campList,function(e){var t={icon:"",name:e.campaign_name,type:e.type,ticked:-1!==o.indexOf(e.id),id:e.id,isCampaign:!0,class:""};e.campaign_name&&""!==e.campaign_name.trim()&&r.push(t)}),r.push({msGroup:!1}),r.push({name:"<strong>Users</strong>",msGroup:!0}),void 0!==e&&void 0!==e.userList&&_.each(e.userList,function(e){var t={icon:"",name:e.user_name+" - "+e.email,type:e.type,ticked:-1!==a.indexOf(e.id),id:e.id,isCampaign:!1,class:-1===i.indexOf(e.id)?"":"focused"};e.user_name&&""!==e.user_name.trim()&&r.push(t)}),r.push({msGroup:!1}),r}(e.campaignAndAssignedUsers,l),e.saveDistributionList=function(){e.distributionActive=!0;var a={distributionlist:{org_unit_id:t.currentOUId,list_name:e.listData.list_name,from_label:"",recipientlist:[],additionalemails:e.listData.additionalEmails}};if(void 0===e.listData.additionalEmails||""===e.listData.additionalEmails)return e.distributionActive=!1,void i.notify({title:"Distribution List",text:"Please enter Emails.",type:"error"});_.each(e.distributionMultiselect,function(e){a.distributionlist.recipientlist.push({recipientType:e.type,recipientTypeValue:e.id.toString()})}),void 0!==l[0]?(a.distributionlist.list_id=l[0],c.updateDistributionList(a).then(function(t){"error"===t.data.status?(e.distributionActive=!1,i.notify({title:"Distribution List",text:"Error in updating distribution list data",type:"error"})):(e.distributionActive=!1,i.notify({title:"Distribution List",text:"Distribution List is updated Successfully",type:"success"}),o.close())})):c.addDistributionList(a).then(function(t){"error"===t.data.status?(e.distributionActive=!1,i.notify({title:"Distribution List",text:"Error in saving distribution list data",type:"error"})):(e.distributionActive=!1,i.notify({title:"Distribution List",text:"Distribution List is saved Successfully",type:"success"}),o.close())})},e.cancel=function(){o.dismiss("cancel")}}]),function(){function e(t,o,a){return e.getDistributionList=function(){return o.get(a.baseURL()+"/v1/distributionlist/list/"+t.currentOUId,a.headerConfig())},e.getDistributionListData=function(e){return o.get(a.baseURL()+"/v1/distributionlist/listData/"+e,a.headerConfig())},e.addDistributionList=function(e){var t={method:"POST",url:a.baseURL()+"/v1/distributionlist",headers:a.headerConfig().headers,data:e};return o(t)},e.updateDistributionList=function(e){var t={method:"PUT",url:a.baseURL()+"/v1/distributionlist",headers:a.headerConfig().headers,data:e};return o(t)},e.removeDistributionList=function(e){return o.delete(a.baseURL()+"/v1/distributionlist/"+e,a.headerConfig())},e.getcampaignAndAssignedUser=function(){return o.get(a.baseURL()+"/v1/distributionlist/campaignAndAssignedUser/"+t.currentOUId,a.headerConfig())},e.selectList=function(){return o.get(a.baseURL()+"/v1/distributionlist/selectlist",a.headerConfig())},e.getAssignedUserOfCampaign=function(e){return o.get(a.baseURL()+"/v1/distributionlist/assignedUsers/"+e,a.headerConfig())},e.getSelectedUserOfCampaign=function(e){var t={method:"POST",url:a.baseURL()+"/v1/distributionlist/selectedUsers",headers:a.headerConfig().headers,data:e};return o(t)},e.campaignUsers=function(e){return o.get(a.baseURL()+"/v1/distributionlist/campaignUsers?ouid="+t.currentOUId+"&campaignId="+e,a.headerConfig())},e}angular.module("distribution_list_webservices",["api-param"]).factory("distributionListWebservices",e),e.$inject=["$rootScope","$http","ApiParam"]}(),angular.module("doubleclick",["disableAll"]).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}).factory("DoubleClickService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";var r={notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},getProfile:function(e){var t={method:"GET",url:i.url+":"+i.port+"/v1/doubleclick/"+e,headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(t)},varList:function(){var e={method:"GET",url:i.url+":"+i.port+"/v1/doubleclick/list",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o(e)},save:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/doubleclick",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},update:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/doubleclick",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},saveMap:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/doubleclick/map",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},updateMap:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/doubleclick/map",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},deleteMap:function(e){var t={method:"DELETE",url:i.url+":"+i.port+"/v1/doubleclick/map",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)}};return r}]).controller("DoubleClickController",["$scope","$filter","TagWebService","$location","$bootbox","$window","$routeParams","$rootScope","DoubleClickService","pinesNotifications",function(e,t,o,a,i,r,n,s,l,c){"use strict";e.isLoadingApi=!0,console.log("DOUBLECLICK"),s.userAccess.doubleclick?(e.canAddEdit=!1,1==s.roleId&&(e.canAddEdit=!0),e.threshold_above=!0,e.currency="USD",e.metrics=[],e.master_used=[],e.mapping=[],e.master_metrics=[],e.master_metrics_ui=[],e.master_metrics_mapping=["All Conversion","Appointment Set","Commitment to Buy","Initial Purchase","Payment Language","Request for Info","Reservation Made","Set Phone Appointment"],e.doubleClickHeaders=["Floodlight Variable","Type","DCM Type"],e.actionHeader=["Actions"],e.all_call="true",e.dc_active=!1,e.conversion_type="action",e.currency="USD",e.threshold_above=!0,e.showHide=function(){e.variableSaved=!e.variableSaved},l.getProfile(s.currentOUId).then(function(t){"success"===t.data.result&&0!==t.data.json.length&&(angular.extend(e,t.data.json[0]),e.dc=t.data.json[0],e.all_call=e.dc.all_call?"true":"false")}).finally(function(){l.varList().then(function(t){"success"===t.data.result&&(_.each(t.data.json,function(t){e.master_metrics.push(t),-1!==_.indexOf(e.master_metrics_mapping,t.metric_display)&&e.master_metrics_ui.push(t),e.metrics.push(t)}),void 0!==e.dc&&void 0!==e.dc.indicator_id&&(e.indicator_id=e.master_metrics_ui[_.findLastIndex(e.master_metrics_ui,{indicator_id:e.dc.indicator_id})],console.log(e.indicator_id)),e.mapping.length>0&&_.each(e.mapping,function(t){for(var o in e.metrics)t.map_id===e.metrics[o].map_id&&e.metrics.splice(o,1)})),e.isLoadingApi=!1})}),e.setProfile=function(){var t={org_unit_id:s.currentOUId,conversion_type:e.conversion_type,default_floodlight:e.default_floodlight,currency:e.currency,dc_active:e.dc_active,all_call:e.all_call,metric_threshold:null,indicator_id:null,threshold_above:e.threshold_above,min_call_duration:e.min_call_duration};console.log(null!==e.indicator_id),e.metric_threshold&&null!==e.indicator_id&&(t.metric_threshold=e.metric_threshold),e.indicator_id&&null!==e.indicator_id&&(t.indicator_id=e.indicator_id.indicator_id),e.threshold_above&&null!==e.indicator_id&&(t.threshold_above=e.threshold_above),e.canAddEdit?e.doubleclick_id&&e.canAddEdit?(t.doubleclick_id=e.doubleclick_id,l.update(t).then(function(t){e.formSubmit=!1,"success"===t.data.result?c.notify({title:"DoubleClick Details",text:"Successfully updated your DoubleClick profile",type:"success"}):c.notify({title:"DoubleClick Details",text:"Failed while updating your DoubleClick profile. "+t.data.err,type:"danger"})})):l.save(t).then(function(t){e.formSubmit=!1,"success"===t.data.result?(e.doubleclick_id=t.data.json.insertId,c.notify({title:"DoubleClick Details",text:"Successfully created your DoubleClick profile",type:"success"})):c.notify({title:"DoubleClick Details",text:"Failed while creating your DoubleClick profile. "+t.data.err,type:"danger"})}):c.notify({title:"DoubleClick Details",text:"Permission denied",type:"danger"})},e.upadatealltracking=function(){if(console.log("hello........upadatealltracking",e.all_call),"true"==e.all_call){i.confirm("Changing these settings will remove conditions from all the Call Actions related to Double Click which are applied for individual Tracking Numbers. Are you sure you want to proceed?",function(e){})}},e.saveMap=function(o,a){if(e.canAddEdit){if(a)if(t("filter")(e.mapping,{dc_map_id:a}).length>1)return c.notify({title:"Double Click Message",text:"Cannot insert Duplicate record.",type:"error"}),void e.mapping.pop();if(e.doubleclick_id){var i={map:{floodlight_var:o.floodlight_var,doubleclick_id:e.doubleclick_id,map_id:o.map_id}};e.disabled=!0,a?(i.map.dc_map_id=a,l.updateMap(i).then(function(t){e.disabled=!1,"success"===t.data.result?(e.disableAdd=!1,e.static_success=!0):c.notify({title:"Double Click Message",text:t.data.err,type:"error"})})):l.saveMap(i).then(function(t){if(e.disabled=!1,e.disableAdd=!1,"success"===t.data.result)for(var a in angular.extend(o,{id:t.data.json.insertId}),e.mapping)e.mapping[a].map_id===o.map_id&&(e.mapping[a].dc_map_id=t.data.json.insertId,c.notify({title:"Double Click Message",text:"Floodlight Variables saved successfully",type:"success"}));else e.disableAdd=!1,e.disabled=!1,c.notify({title:"Double Click Message",text:t.data.err,type:"error"}),e.mapping.pop()})}else alert("You need to create and save your DoubleClick profile first")}else c.notify({title:"DoubleClick Details",text:"Permission denied",type:"danger"})},e.removeMap=function(t,o,a,r){console.log("vars",o,a,r);var n={map:{dc_map_id:o,doubleclick_id:a}};i.confirm("Are you sure you want to delete this Floodlight Variable?",function(t){t&&l.deleteMap(n).then(function(t){if("success"===t.data.result){for(var a in c.notify({title:"Double Click Message",text:"Floodlight Variables deleted successfully",type:"success"}),e.master_metrics)e.master_metrics[a].map_id==o&&e.metrics.push({map_id:r,map_type:e.master_metrics[a].map_type,metric_display:e.master_metrics[a].metric_display});for(a in e.mapping)e.mapping[a].map_id===r&&e.mapping[a].dc_map_id===o&&e.mapping.splice(a,1);e.metrics=[],_.each(e.master_metrics,function(t){e.metrics.push(t)}),e.mapping.length>0&&_.each(e.mapping,function(t){for(var o in e.metrics)t.map_id===e.metrics[o].map_id&&e.metrics.splice(o,1)})}else c.notify({title:"Double Click Message",text:t.data.err,type:"error"})})})},e.cancelAdd=function(t,o,a){e.disableAdd=!1,t?o.$cancel():e.mapping.splice(a,1)},e.addMapping=function(){var t=e.mapping[e.mapping.length-1];if(t&&!t.dc_map_id&&!t.map_id)return e.error="Save currently added floodlight variable before adding another.",void(e.static_fail=!0);e.doubleclick_id?(e.mapping.length>0&&_.each(e.mapping,function(t){for(var o in e.metrics)t.map_id===e.metrics[o].map_id&&e.metrics.splice(o,1)}),e.inserted={dc_map_id:"",map_id:"",map_type:"",metric_display:"",floodlight_var:""},e.mapping.push(e.inserted),e.disableAdd=!0):alert("You must first save your DoubleClick profile before adding variables")},e.removeMetric=function(t){for(var o in e.master_metrics)e.master_metrics[o].map_id===t.map_id&&e.metrics.push({map_id:t.map_id,map_type:t.map_type,metric_display:e.master_metrics[o].metric_display});for(o in e.mapping)e.mapping[o].map_id===t.map_id&&e.mapping.splice(o,1)},e.showMetrics=function(o){if(e.master_metrics&&o.map_id&&o.map_type){if(e.master_metrics.length){var a=t("filter")(e.master_metrics,{map_id:o.map_id});return a.length?a[0].metric_display:"Not set"}return o.map_type||"Not mapped"}},e.setRow=function(t,o){for(var a in e.variableSaved=!0,t.map_id=o,e.master_metrics)e.master_metrics[a].map_id===o&&(t.map_type=e.master_metrics[a].map_type,t.metric_display=e.master_metrics[a].metric_display)},e.closeFail=function(){e.static_fail=!1},e.closeSuccess=function(){e.static_success=!1},$(document).ready(function(){setTimeout(function(){$(window).trigger("resize")},3e3)})):location.href="#/access-denied"}]),angular.module("googleanalytics",["toggle-switch","theme.form-directives"]).factory("GoogleAnalyticsService",["$q","$timeout","$http","$window","$rootScope","$upload",function(e,t,o,a,i,r){"use strict";var n={notify:function(e){PNotify.removeAll();var t=new PNotify(e);return t.notify=t.update,t},createAnalytics:function(e){var t={method:"POST",url:i.url+":"+i.port+"/v1/analytic",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},updateAnalytics:function(e){var t={method:"PUT",url:i.url+":"+i.port+"/v1/analytic",headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token},data:e};return o(t)},getAnalytics:function(){var e={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/analytic/ouid/"+i.currentOUId+"/includeParentAnalytics/"+!1,e)}};return n}]).controller("GoogleAnalyticsController",["$scope","$http","$filter","$location","$window","$routeParams","$rootScope","GoogleAnalyticsService",function(e,t,o,a,i,r,n,s,l){"use strict";if(n.userAccess.googleua){var c;e.isLoadingApi=!0,e.ga={},e.canModify=!0;var d=null;e.id=null,s.getAnalytics().then(function(t){"error"!=t.data.status?(t.data.json.length>0?(e.ga.tracking=t.data.json[0].tracking_id,e.ga.duration=t.data.json[0].duration,e.ga.sendCalls=t.data.json[0].all_calls?"allCalls":"uniqueCalls",e.ga.route=t.data.json[0].all_routes?"allCallFlows":"indCallFlows",t.data.json[0].all_routes||(e.ga.sendCalls="allCalls",e.ga.duration=void 0),e.ga.gaStatus="active"===t.data.json[0].analytic_status,e.id=t.data.json[0].tracking_id):e.ga.sendCalls="allCalls",e.isLoadingApi=!1):s.notify({title:"Google Analytics",text:t.data.err,type:"error"})}),e.saveAnalytics=function(){if(!e.gaForm.$invalid){"allCalls"===e.ga.sendCalls?d=!0:"uniqueCalls"===e.ga.sendCalls&&(d=!1),"allCallFlows"===e.ga.route?c=!0:"indCallFlows"===e.ga.route&&(c=!1,e.ga.duration=0,d=!1);var t=e.ga.gaStatus?"active":"inactive",o={analytic:{org_unit_id:n.currentOUId,duration:e.ga.duration,tracking_id:e.ga.tracking,all_routes:c,all_calls:d,status:t}};e.id?(o.analytic.id=n.currentOUId,s.updateAnalytics(o).then(function(t){if(console.log(t),""===t.data.err)return s.notify({title:"Google Analytics",text:"Successfully updated Google Analytics",type:"success"}),"indCallFlows"===e.ga.route&&(e.ga.duration=void 0),void a.path("/set-ga");s.notify({title:"Google Analytics",text:t.data.err,type:"error"})})):(console.log(o),s.createAnalytics(o).then(function(t){if(console.log(t),""===t.data.err)return s.notify({title:"Google Analytics",text:"Successfully saved Google Analytics",type:"success"}),"indCallFlows"===e.ga.route&&(e.ga.duration=void 0),void a.path("/set-ga");s.notify({title:"Save Google Analytics",text:t.data.err,type:"error"})}))}}}else location.href="#/access-denied"}]),angular.module("theme.ui-tables-basic",[]).factory("getCampaignWebService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";return{getCampaigns:function(){console.log(a.sessionStorage.token);var e={headers:{"content-type":"application/json",Authorization:"bearer "+a.sessionStorage.token}};return o.defaults.useXDomain=!0,o.get(i.url+":"+i.port+"/v1/campaign",e)}}}]).factory("locationWebService",["$q","$timeout","$http","$window","$rootScope",function(e,t,o,a,i){"use strict";var r=[{id:"1",location:"LogMyCalls",address:"1664 S. Dixie Dr.",city:"Saint George",state:"UT",zip:"84770",phone:"6809909123"}];return{getLocations:function(){return r},saveLocations:function(e){r.push(e)}}}]).controller("TablesBasicController",["$scope","$filter","getCampaignWebService","locationWebService","UserWebService",function(e,t,o,a,i){"use strict";o.getCampaigns().then(function(t){if("error"!=t.data.status){console.log(t);for(var o=[],a=0;a<t.data.json.length;a++)o.push([t.data.json[a].id,t.data.json[a].name,"","",t.data.json[a].status,"Edit - Reports - Archive"]);e.data={headings:["Id","Name","Schedule","Call Flows","Status","Actions"],rows:o}}else e.error="Invalid email or password"});var r=a.getLocations();e.locations=r,e.addLocation=function(){e.inserted={},e.locations.push(e.inserted)},e.saveLocation=function(e,t){},e.removeLocation=function(t){e.locations.splice(t,1)}}]),angular.module("scheduled_reports",["scheduled_report_webservices","distribution_list_webservices","static-include","isteven-multi-select","theme.form-directives"]).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}).filter("unit",["$filter",function(e){var t=["Sun","Mon","Tues","Wed","Thu","Fri","Sat"],o=["th","st","nd","rd"];return function(e){if("weekly"===e.freq_unit)return"("+t[e.freq_value]+")";if("monthly"===e.freq_unit){var a=e.freq_value<30?e.freq_value%20:e.freq_value%30,i=a<=3?o[a]:o[0];return"("+e.freq_value+i+")"}return""}}]).controller("ScheduledReportsController",["$scope","$rootScope","$uibModal","ScheduledReportWebService","pinesNotifications","distributionListWebservices","DateRangeFiller","$bootbox","$q","$timeout","$location","ScheldueUrlFormatter","$window","ReportParam","$routeParams","$filter","advFilSrvc",function(e,t,o,a,i,r,n,s,l,c,d,u,p,m,g,f,h){var v="boolean"==typeof p.localStorage.download_audio_enabled?p.localStorage.download_audio_enabled:"true"===p.localStorage.download_audio_enabled.toLowerCase();t.download_audio_enabled!==v&&(t.download_audio_enabled=v,t.$broadcast("download_audio_setting_changed")),e.disableSave=!1,e.IdentifiedAgentData=[];var b=a.getDateRange();if(d.search().schedrptid&&void 0!==b.schedrptid&&d.search().schedrptid.split("-")[1]==b.schedrptid&&void 0!==b.drp_start&&void 0!==b.drp_end?(e.drp_start=moment(b.drp_start).format("MMMM DD, YYYY"),e.drp_end=moment(b.drp_end).format("MMMM DD, YYYY")):d.search().isNew&&p.sessionStorage.report_start_date&&p.sessionStorage.report_end_date?(e.drp_start=moment(p.sessionStorage.report_start_date).format("MMMM DD, YYYY"),e.drp_end=moment(p.sessionStorage.report_end_date).format("MMMM DD, YYYY")):(e.drp_start=moment().subtract(6,"days").format("MMMM DD, YYYY"),e.drp_end=moment().subtract(0,"days").endOf("day").format("MMMM DD, YYYY")),e.preview=!!d.search().preview&&d.search().preview,h.getAllCustomSources(),e.drp_options={ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().subtract(0,"days").endOf("day")],"This Month":[moment().startOf("month").startOf("day"),moment().endOf("month").endOf("day")],"Last Month":[moment().subtract(1,"month").startOf("month").startOf("day"),moment().subtract(1,"month").endOf("month").endOf("day")]},opens:"left",startDate:moment(e.drp_start),endDate:moment(e.drp_end)},e.simpleSearchFilter="",e.filterData={},e.scheduleData={},e.reportData={},e.campaignAndAssignedUsers=["test"],e.reportActive=!0,e.reportStatus="active",e.clickedSaveAsBtn=!1,e.reportName="",e.reportDesc="",e.isNewReport=!1,e.setDistHeaders=["Name","Usage"],e.setDistBuildHeaders=["Name","Frequency","Format"],e.actionHeader=["Actions"],e.showScheduleForm=!1,e.scheduleListData=[],e.isInEditMode=!1,e.whichScheduleReport=d.search().report,e.selectedGroup,e.getSelectedGroup=function(){return void 0!==e.selectedGroup?e.selectedGroup:"Secondary Group"},e.selectedReport,e.getSelectedReport=function(){return void 0!==e.selectedReport?e.selectedReport:"Report Type"},e.uiReportName=[{label:"Call Details",value:"call_detail"},{label:"Group Activity",value:"group_activity"}],(1===parseInt(t.roleId)||parseInt(t.roleId)>=4)&&e.uiReportName.push({label:"Tracking Number Settings",value:"callflow_setting"}),e.reportsWithSecondaryGroups=["group_activity"],e.enableSecondaryGroup=!1,e.setSecondaryGroupOptions=function(t){if(-1!==e.reportsWithSecondaryGroups.indexOf(t)){switch(t){case"group_activity":e.secondaryGroupSelectOptions=[{label:"None",value:"none"},{label:"Tracking Number",value:"call_flow"},{label:"Campaign",value:"campaign"}]}e.filterData.secondary_group="none",e.enableSecondaryGroup=!0}},e.reportSelected=function(t){e.report=t,e.showAdvFilter=!1,h.getAllCustomSources(),e.attachmentList="call_detail"===t?["CSV","HTML"]:["CSV","PDF","HTML"],-1===e.reportsWithSecondaryGroups.indexOf(t)?(e.filterData.secondary_group="",e.enableSecondaryGroup=!1):e.setSecondaryGroupOptions(t),e.secondary="none",e.filterReset(),e.advFilterDefinitions=h.getAdvFilterDefinitions()},e.tags=[],e.scheduleReportViewFile={campaign:"views/acq-call-flows4.html",tracking_number:"views/acq-call-flows4.html",keyword:"views/acq-call-flows4.html",group:"views/acq-call-flows4.html",source:"views/acq-call-flows4.html",calls_detail:"views/calls-details.html",calls_callback:"views/calls-callback.html",group_activity:"views/activity-group.html",callflow_setting:"views/settings-call-flow.html"}[e.whichScheduleReport],d.search().schedrptid){var w=d.search().schedrptid.split("-"),y={type:w[0],id:w[1]},S={};"s"===y.type?S.schedule_id=y.id:S.report_id=y.id,a.getAuthorization(S).then(function(t){var o=!1;console.log("authorization response",t),"success"===t.data.result&&"authorized"===t.data.json&&(o=!0),o?"s"===y.type?a.getScheduleReport(y.id).then(function(t){if("success"===t.data.result){var o=h.sanitizeDbFilterData(t.data.json);e.preloadReportDetails(o)}else t.data.err}):"r"!==y.type||a.getReport(y.id).then(function(t){if("success"===t.data.result){console.log("REPORT INFROMATION FOUND:",t.data.json),e.reportStatus=t.data.json.report.report_status;var o=h.sanitizeDbFilterData(t.data.json);e.preloadReportDetails(o)}else t.data.err}):(i.notify({title:"Report Authorization",text:"User is not authorized to view specified report",type:"error"}),location.href="#/set-scheduled")})}function C(){angular.element("html, body").animate({scrollTop:angular.element("footer").offset().top},500,"easeOutExpo")}e.preloadReportDetails=function(t){console.log("INSIDE preloadReportDetails IN schedulereports.js: Extending into scope:",t),void 0!==t.advFilterDefinitions&&(e.advFilterDefinitions=t.filterRule),void 0!==t.filterData&&(e.filterData=t.filterData),void 0!==t.reportData&&(e.reportData=t.reportData),void 0!==t.scheduleData&&(e.scheduleListData=t.scheduleData),setTimeout(function(){$(window).trigger("resize")},200),_.extend(e,t.vars),void 0!==e.filtertype&&"s"===e.filtertype&&(e.simpleSearchFilter=e.filter),console.log("report data",e.reportData),console.log("filter data",e.filterData),e.showdist=!0,e.isNewReport=!0,e.initializeScheduleDistribution(),e.setSecondaryGroupOptions(e.filterData.report_used),e.filterData.secondary_group=t.vars.secondary,e.changeSecondaryGrouping(e.filterData.secondary_group,!1),console.log("START",t.vars.start_date,"END",t.vars.end_date),e.drp_start=moment(t.vars.start_date).format("MMMM DD, YYYY"),e.drp_end=moment(t.vars.end_date).format("MMMM DD, YYYY"),e.drp_options.startDate=moment(e.drp_start),e.drp_options.endDate=moment(e.drp_end),console.log("DRP_OPTIONS",e.drp_options),h.determineInitializationMethod(e).then(function(t){e.advFilterDefinitions=h.getAdvFilterDefinitions(),e.advFilterDefinitions[0].selected_column&&(e.showAdvFilter=!0)}),e.editReportID=e.reportData.report_id,"call_detail"===e.filterData.report_used&&(e.attachmentList=["CSV","HTML"]),"inactive"===e.reportData.report_status&&(e.reportActive=!1)},e.goBack=function(){var t="";void 0!==e.Id?t="#/set-scheduled":(t={campaign:"#/acq-call-flows4",call_flow:"#/acq-call-flows4",keyword:"#/acq-call-flows4",group:"#/acq-call-flows4",source:"#/acq-call-flows4",calls_detail:"#/calls-details",calls_callback:"#/calls-callback",group_activity:"#/activity-group",callflow_setting:"#/settings-call-flow"}[e.whichScheduleReport],t+="?"+d.url().split("?")[1]),p.location.href=t},e.saveScheduleReport=function(){console.log("@@@@@@@@@ SAVE SCHEDULE REPORT FIRED @@@@@@@@@");var o=e.filterData.report_used,r=[],n=l.defer(),s=!1;void 0!==e.reportData.report_name&&""!==e.reportData.report_name.trim()||r.push("Scheduled Report Name"),void 0!==o&&""!==o.trim()||r.push("Report Type"),r.length>0&&(messageText="field is required.",r.length>1&&(messageText="fields are required."),i.notify({title:"Scheduler form",text:"'"+r.join(", ")+"' "+messageText,type:"error"}),s=!0,n.resolve(!1)),e.disableSaveButton=!0;var c=[];if(e.simpleSearchFilter&&0!==e.simpleSearchFilter.length)console.log("Simple Search Value:",e.simpleSearchFilter),c.push({filter_key:"filter",comparator:"=",filter_value:e.simpleSearchFilter,filter_join:"NONE",filter_type:"basic_filter"});else if(e.advFilterDefinitions&&e.advFilterDefinitions.length>0&&e.advFilterDefinitions[0].selected_column){h.updateGlobalReportScope(e);var u=h.validateFilters();if(!0===u){console.log("@@@@@@@@@ ADVANCED FILTER USED. SAVING DEFINITIONS @@@@@@@@@",c);var p=h.sanitizeFilters();c=c.concat(p)}else i.notify({title:u.title,text:u.text,type:"error"}),s=!0}c.push({filter_key:"timezone",comparator:"=",filter_value:t.timezone,filter_join:"NONE",filter_type:"variable"}),-1!==e.reportsWithSecondaryGroups.indexOf(e.filterData.report_used)&&(console.log("SECONDARY GROUP USED:",e.filterData.secondary_group),c.push({filter_key:"secondary",comparator:"=",filter_value:e.filterData.secondary_group,filter_join:"NONE",filter_type:"variable"}));var m={today:[moment(e.drp_options.ranges.Today[0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges.Today[1]).format("ddd MMM DD YYYY")],yesterday:[moment(e.drp_options.ranges.Yesterday[0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges.Yesterday[1]).format("ddd MMM DD YYYY")],last_7:[moment(e.drp_options.ranges["Last 7 Days"][0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges["Last 7 Days"][1]).format("ddd MMM DD YYYY")],last_30:[moment(e.drp_options.ranges["Last 30 Days"][0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges["Last 30 Days"][1]).format("ddd MMM DD YYYY")],this_month:[moment(e.drp_options.ranges["This Month"][0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges["This Month"][1]).format("ddd MMM DD YYYY")],last_month:[moment(e.drp_options.ranges["Last Month"][0]).format("ddd MMM DD YYYY"),moment(e.drp_options.ranges["Last Month"][1]).format("ddd MMM DD YYYY")],user_selected:[moment(e.drp_start).format("ddd MMM DD YYYY"),moment(e.drp_end).format("ddd MMM DD YYYY")]},g=null,f=null,v=null;m.user_selected[0]===m.today[0]&&m.user_selected[1]===m.today[1]?v="today":m.user_selected[0]===m.yesterday[0]&&m.user_selected[1]===m.yesterday[1]?v="yesterday":m.user_selected[0]===m.last_7[0]&&m.user_selected[1]===m.last_7[1]?v="last_week":m.user_selected[0]===m.last_30[0]&&m.user_selected[1]===m.last_30[1]?v="last_30":m.user_selected[0]===m.this_month[0]&&m.user_selected[1]===m.this_month[1]?v="this_month":m.user_selected[0]===m.last_month[0]&&m.user_selected[1]===m.last_month[1]?v="last_month":(console.log("SETTING CUSTOM RANGE"),g=moment(m.user_selected[0]).format("YYYY-MM-DD"),f=moment(m.user_selected[1]).format("YYYY-MM-DD"),v=null);var _={report:{ct_user_id:t.userId,org_unit_id:t.currentOUId,report_name:e.reportData.report_name,report_desc:e.reportData.report_desc,report_status:!0===e.reportActive?"active":"inactive"},filter:{report_used:e.filterData.report_used,filter_start:g,filter_end:f,filter_range:v},filter_rule:c};return e.editReportID&&(_.report.report_id=e.editReportID),e.filter_id&&(_.filter.filter_id=e.filter_id),console.log("Builder Data",_),_.report.update_scheldule_status=!1,e.editReportID&&e.reportStatus!==(!0===e.reportActive?"active":"inactive")&&(_.report.update_scheldule_status=!0),s?(e.disableSaveButton=!1,n.resolve(!1)):a.createScheduleReport(_).then(function(t){console.log("REPORT DATA SAVED:",t),"success"===t.data.result?(d.search().schedrptid?i.notify({title:"Success",text:"Report successfully updated and saved.",type:"success"}):(e.createdReportID=t.data.json.report.report_id,i.notify({title:"Success",text:"Report successfully created and saved.",type:"success"})),console.log("response",t.data.json.filter.filter_id),e.filter_id=t.data.json.filter.filter_id,e.editReportID=t.data.json.report.report_id,e.reportStatus=!0===e.reportActive?"active":"inactive",e.showdist=!0,e.initializeScheduleDistribution(),e.disableSaveButton=!1,n.resolve(!0)):(e.disableSaveButton=!1,e.filter_id?i.notify({title:"Error",text:"Report unsuccessfully updated.",type:"error"}):i.notify({title:"Error",text:"Report unsuccessfully created.",type:"error"}),n.resolve(!1))}),n.promise},e.editSchedule=function(t){e.isInEditMode=!0;var o={schedule_id:t.schedule_id,report_id:t.report_id,schedule_name:t.schedule_name,schedule_status:t.schedule_status,freq_unit:t.freq_unit,freq_value:t.freq_value,format:t.format.split(","),list_id:t.list_id,message:t.message,from_label:t.from_label,list_name:t.list_name};e.scheduleData=o,e.showScheduleForm=!0,e.showCampaignUsers=!1,e.scheduleFormHeader="Editing Distribution List",C()},e.showSchedule=function(){e.scheduleFormHeader="Adding Distribution List",e.scheduleData={},e.scheduler.$setPristine(),e.showScheduleForm=!0,e.showCampaignUsers=!1,e.isInEditMode=!1,C()},e.cancelSchedule=function(){e.scheduleData={},e.scheduler.$setPristine(),e.showScheduleForm=!1,e.showCampaignUsers=!1,e.isInEditMode=!1,C()},e.deleteSchedule=function(t,o){s.confirm("Are you sure you want to delete this scheduled report?",function(r){r&&a.deleteSchedule(t.schedule_id).then(function(t){"success"===t.data.result?(e.scheduleListData.splice(o,1),i.notify({title:"Schedule Report",text:"Successfully deleted the scheduler",type:"success"})):i.notify({title:"Schedule Report",text:t.data.err,type:"error"})})})},e.frequencyType=["daily","weekly","monthly"],e.frequencyTypeWeekly=["S","M","T","W","T","F","S"],e.clearAll=!1,e.showme=!1,e.frequencyTypeMonthly=[{key:1,value:"1st"},{key:2,value:"2nd"},{key:3,value:"3rd"},{key:4,value:"4th"},{key:5,value:"5th"},{key:6,value:"6th"},{key:7,value:"7th"},{key:8,value:"8th"},{key:9,value:"9th"},{key:10,value:"10th"},{key:11,value:"11th"},{key:12,value:"12th"},{key:13,value:"13th"},{key:14,value:"14th"},{key:15,value:"15th"},{key:16,value:"16th"},{key:17,value:"17th"},{key:18,value:"18th"},{key:19,value:"19th"},{key:20,value:"20th"},{key:21,value:"21st"},{key:22,value:"22nd"},{key:23,value:"23rd"},{key:24,value:"24th"},{key:25,value:"25th"},{key:26,value:"26th"},{key:27,value:"27th"},{key:28,value:"28th"}],e.attachmentList=["CSV","PDF","HTML"],e.saveScheduleData=function(){console.log("@@@@@@@@@ SAVING SCHEDULE DATA @@@@@@@@@"),e.disableSave=!0,console.log("Schedule Data:",e.scheduleData);var t="",o=[];if(void 0!==e.scheduleData.format&&""!==e.scheduleData.format.join()||o.push("Attachment"),"weekly"!==e.scheduleData.freq_unit||void 0!==e.scheduleData.freq_value&&""!==e.scheduleData.freq_value||o.push("Day of the Week"),o.length)return t="field is required.",o.length>1&&(t="fields are required."),i.notify({title:"Scheduler form",text:"'"+o.join(", ")+"' "+t,type:"error"}),e.disableSave=!1,!1;"daily"===e.scheduleData.freq_unit&&(e.scheduleData.freq_value="9"),console.log("$scope.reportStatu"),console.log(e.reportStatus);var r={schedule:{schedule_name:"null",schedule_status:e.reportStatus,freq_unit:e.scheduleData.freq_unit,freq_value:e.scheduleData.freq_value,format:e.scheduleData.format,list_id:e.scheduleData.list_id,message:e.scheduleData.message,from_label:e.scheduleData.from_label}};console.log("FORMATTED SCHEDULE DATA",r),e.createdReportID?r.schedule.report_id=e.createdReportID:r.schedule.report_id=e.reportData.report_id,e.scheduleData.schedule_id&&(r.schedule.schedule_id=e.scheduleData.schedule_id),a.createNewSchedule(r).then(function(t){if("error"===t.data.result)i.notify({title:"Scheduled Report",text:t.data.err,type:"error"});else{i.notify({title:"Scheduled Report",text:"Scheduled report saved Successfully.",type:"success"}),e.showScheduleForm=!1,e.isNewReport=!0;var o=f("filter")(e.distributionListData,{list_id:r.schedule.list_id},!0);if(o.length>0&&(r.schedule.list_name=o[0].list_name),r.schedule.format=e.scheduleData.format.join(),void 0===e.scheduleData.schedule_id||null===e.scheduleData.schedule_id||""===e.scheduleData.schedule_id)r.schedule.schedule_id=t.data.json.schedule.schedule_id,e.scheduleListData.push(r.schedule);else{var a=_.find(e.scheduleListData,function(e){return e.schedule_id==r.schedule.schedule_id});a.list_name=r.schedule.list_name,a.freq_unit=r.schedule.freq_unit,a.freq_value=r.schedule.freq_value,a.format=r.schedule.format,a.list_id=r.schedule.list_id,a.message=r.schedule.message,a.from_label=r.schedule.from_label}e.isInEditMode=!1}e.disableSave=!1})},e.distributionMultiselect=[],e.disableCreateNew=!1,e.initializeScheduleDistribution=function(){r.getDistributionList().then(function(t){e.distributionListData=t.data.json})},e.clearDistributionFormData=function(t){e.clearAll=!0,c(function(){e.scheduleData.listName="",e.scheduleData.additionalEmails="",angular.element("#listName").addClass("ng-pristine"),angular.element("#listName").removeClass("ng-dirty"),angular.element("#additionalEmails").removeClass("ng-dirty"),e.showCampaignUsers=t},0)},e.getUsersAndCampaigns=function(t){var o,a;e.campaignUsers=[],e.campaignAndAssignedUsersList=(a=[{name:"<strong>Campaigns</strong>",msGroup:!0}],void 0!==(o=t)&&void 0!==o.campList&&_.each(o.campList,function(e){var t={icon:"",name:e.campaign_name,type:e.type,ticked:!1,id:e.id,isCampaign:!0,class:""};null!==e.campaign_name&&void 0!==e.campaign_name&&""!==e.campaign_name.trim()&&a.push(t)}),a.push({msGroup:!1}),a.push({name:"<strong>Users</strong>",msGroup:!0}),void 0!==o&&void 0!==o.userList&&_.each(o.userList,function(e){var t={icon:"",name:e.user_name+" - "+e.email,type:e.type,ticked:!1,id:e.id,isCampaign:!1,class:""};null!==e.user_name&&void 0!==e.user_name&&""!==e.user_name.trim()&&a.push(t)}),a.push({msGroup:!1}),a)},e.scheduleData={},e.saveDistributionList=function(o,a){var n=[];if(void 0!==e.scheduleData.listName&&""!==e.scheduleData.listName.trim()||n.push("Distribution List Name"),void 0!==e.scheduleData.from_label&&""!==e.scheduleData.from_label.trim()||n.push("From Label"),n.length>0)return messageText="field is required.",n.length>1&&(messageText="fields are required."),i.notify({title:"Scheduler form",text:"'"+n.join(", ")+"' "+messageText,type:"error"}),!1;var s={distributionlist:{org_unit_id:t.currentOUId,list_name:e.scheduleData.listName,from_label:e.scheduleData.from_label,recipientlist:[],additionalemails:e.scheduleData.additionalEmails}};a.length<=0&&(void 0===e.scheduleData.additionalEmails||""===e.scheduleData.additionalEmails)?i.notify({title:"Distribution List",text:"Please enter Emails.",type:"error"}):(_.each(a,function(e){s.distributionlist.recipientlist.push({recipientType:e.type,recipientTypeValue:e.id.toString()})}),e.clearAll=!0,c(function(){e.clearAll=!1},0),r.addDistributionList(s).then(function(t){if("error"==t.data.status)i.notify({title:"Distribution List",text:t.data.err,type:"error"});else{i.notify({title:"Distribution List",text:"Distribution List is saved Successfully",type:"success"});var a=t.data.json;e.distributionListData.push({list_id:a.list_id,list_name:a.list_name}),!0===o&&(e.scheduleData.list_id=a.list_id),e.clearDistributionFormData(!1)}}))},e.preloading=!1,e.showAdvFilter=!1,e.advancedFilterConfig={maxQuantity:5},e.toggleAdvFilter=function(){console.log(e.filterData.report_used),e.filterData.report_used?e.showAdvFilter=!0:i.notify({title:"Report Details",text:"Please select a report type.",type:"error"})},e.getInitialUrlParams=(console.log("Inside all agents"),void h.determineInitializationMethod(e).then(function(o){console.log("INSIDE getInitialUrlParams IN callsdetails.js: Returned urlParams:",o),e.advFilterDefinitions=h.getAdvFilterDefinitions(),e.advFilterDefinitions.length>0&&void 0!==e.advFilterDefinitions[0].selected_column&&(e.showAdvFilter=!0),e.extendUrlParams(o),a.getAllTopOuUsers(t.currentOUId).then(function(t){if("success"===t.data.status){var o=t.data.json;o.length>0&&(e.IdentifiedAgentData=o)}})})),e.addFilterDefinition=function(){h.addFilterDefinition(!1),e.advFilterDefinitions=h.getAdvFilterDefinitions()},e.updateOperators=function(t,o,a){h.updateOperators(t,o,a),e.advFilterDefinitions=h.getAdvFilterDefinitions()},d.search().schedrptid||h.determineInitializationMethod(e).then(function(t){e.advFilterDefinitions=h.advFilterDefinitions}),e.filterReset=function(){h.resetAdvFilter(),e.advFilterDefinitions=h.getAdvFilterDefinitions(),e.showAdvFilter=!1,e.simpleFilterText="",e.filtertype="s",e.showAdvFilter=!1},e.extendUrlParams=function(t){e.urlParams=t.vars,e.drp_start=moment(e.urlParams.start_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),e.drp_end=moment(e.urlParams.end_date,"YYYY-MM-DD").format("MMMM DD, YYYY"),angular.extend(e,t.vars),delete t.vars,angular.extend(e,t)},e.applyFilterParams=function(){var t=h.applyFilter(e);e.extendUrlParams(t)},e.removeFilterDefinition=function(t){h.removeFilterDefinition(t),e.advFilterDefinitions=h.getAdvFilterDefinitions()},e.validateInput=function(e){h.validateInput(e)},e.previewReport=function(){if(e.filterData.report_used&&e.reportData.report_name)var t=p.open();e.saveScheduleReport().then(function(o){var a={acq_group:"acq-call-flows4",acq_campaign:"acq-call-flows4",acq_callflow:"acq-call-flows4",acq_keyword:"acq-call-flows4",acq_source:"acq-call-flows4",call_detail:"calls-details",call_back:"calls-callback",activity_stream:"activity-stream",group_activity:"activity-group",callflow_setting:"settings-call-flow"}[e.report]+"?report="+e.report+"&filter_id="+e.filter_id+"&preview=true";o&&(t.location.href=p.location.origin+"/#/"+a)})},e.changeSecondaryGrouping=function(t,o){void 0!==t&&(e.secondary=t),o?e.filterReset():(h.setSelectOptions(),h.addFilterDefinition(!0)),e.advFilterDefinitions=h.getAdvFilterDefinitions()}}]).controller("ScheduledReportsTableController",["$scope","ScheduledReportWebService","pinesNotifications","$rootScope","$location","$uibModal","ScheldueUrlFormatter","$window","$q","$bootbox","$filter",function(e,t,o,a,i,r,n,s,l,c,d){var u="boolean"==typeof s.localStorage.download_audio_enabled?s.localStorage.download_audio_enabled:"true"===s.localStorage.download_audio_enabled.toLowerCase();function p(t){var o=[];return _.each(t,function(t){o.push({Name:t.report_name,Report:e.uiReportName[t.report_used],Creator:t.first_name+t.last_name,"Dist List":t.list_name,Freq:d("capitalize")(t.freq_unit)+d("unit")(t),Format:t.format,Status:d("capitalize")(t.report_status)})}),o}a.download_audio_enabled!==u&&(a.download_audio_enabled=u,a.$broadcast("download_audio_setting_changed")),e.currentPage=1,e.isNotLegacy=!1,e.isLoadingApi=!0,!1!==a.download_audio_enabled&&(t.getDataTableInfo().then(function(t){e.scheduleList=t.data.json,console.log("TABLE DATA",e.scheduleList),e.isLoadingApi=!1,e.totalscheduleListRows=e.scheduleList.length}),e.setScheduleHeaders=["Name","Report","Creator","Dist List","Freq","Format","Status"],e.actionHeader=["Actions"],a.isSafari=s.sessionStorage.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),e.uiReportName={acq_campaign:"Acq / Campaign",acq_callflow:"Acq / Callflow",acq_keyword:"Acq / Keyword",acq_group:"Acq / Group",acq_source:"Acq / Source",call_detail:"Call Detail",call_back:"Call Back",group_activity:"Group Activity",callflow_setting:"Callflow Setting"},e.edit=function(o){console.log("INSIDE EDIT");var a="";if(a=void 0!==o.schedule_id&&null!==o.schedule_id?"s-"+o.schedule_id:"r-"+o.report_id,void 0!==o){var i=e.dateRangeConvert(o);t.setDateRange(i)}var r=s.location.protocol+"//"+s.location.hostname+"/#/set-schedule-builder?schedrptid="+a;s.location.href=r},e.dateRangeConvert=function(e){var t={};return t.schedrptid=e.report_id,null!==e.filter_range?(t.range=e.filter_range,"today"===e.filter_range?(t.drp_start=moment().startOf("day"),t.drp_end=moment().startOf("day")):"yesterday"===e.filter_range?(t.drp_start=moment().subtract(1,"days").startOf("day"),t.drp_end=moment().subtract(1,"days").endOf("day")):"last_week"===e.filter_range?(t.drp_start=moment().subtract(6,"days").startOf("day"),t.drp_end=moment().subtract(0,"days").endOf("day")):"last_30"===e.filter_range?(t.drp_start=moment().subtract(29,"days").startOf("day"),t.drp_end=moment().subtract(0,"days").endOf("day")):"this_month"===e.filter_range?(t.drp_start=moment().startOf("month").startOf("day"),t.drp_end=moment().endOf("month").endOf("day")):"last_month"===e.filter_range&&(t.drp_start=moment().subtract(1,"month").startOf("month").startOf("day"),t.drp_end=moment().subtract(1,"month").endOf("month").endOf("day"))):null!==e.filter_start&&null!==e.filter_end?(t.drp_start=moment(e.filter_start),t.drp_end=moment(e.filter_end)):(t.drp_start=moment().subtract(7,"days").startOf("day"),t.drp_end=moment().startOf("day")),t},e.delete=function(a,i){c.confirm("Are you sure you want to delete this scheduled report?",function(i){i&&t.deleteReport(a.report_id).then(function(t){"success"===t.data.result?(e.scheduleList=_.reject(e.scheduleList,function(e){return e.report_id==a.report_id}),o.notify({title:"Schedule Report",text:"Successfully deleted the scheduled report",type:"success"})):o.notify({title:"Schedule Report",text:t.data.err,type:"error"})})})},e.sendNow=function(e){t.sendNow(e).then(function(e){"success"===e.data.result?o.notify({title:"Schedule Report",text:"Your report is being processed.",type:"success"}):o.notify({title:"Schedule Report",text:e.data.err,type:"error"})})},e.getCSVData=function(t){var o;e.headerNames=["Name","Report","Creator","Dist List","Freq","Format","Status"];var i=l.defer();if(o=p(e.scheduleList),i.resolve(o),a.isSafari){var r="csv_schedule_report";"tsv"===t&&(r="tsv_schedule_report"),i.resolve(JSONToCSVConvertor(o,r,!0,t))}if(!a.isSafari)return i.promise},e.getExcelData=function(){var t;e.headerNames=["Name","Report","Creator","Dist List","Freq","Format","Status"];var o=l.defer();return t=p(e.scheduleList),alasql('SELECT * INTO XLSX("xls_schedule_report.xlsx",{sheetid:"Sheet name",headers:true}) FROM ?',[t]),o.resolve(t),o.promise})}]),angular.module("scheduled_plans",["scheduled_report_webservices","distribution_list_webservices","static-include","isteven-multi-select"]).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}).filter("unit",["$filter",function(e){var t=["Sun","Mon","Tues","Wed","Thu","Fri","Sat"],o=["th","st","nd","rd"];return function(e){if("weekly"===e.freq_unit)return"("+t[e.freq_value]+")";if("monthly"===e.freq_unit){var a=e.freq_value<30?e.freq_value%20:e.freq_value%30,i=a<=3?o[a]:o[0];return"("+e.freq_value+i+")"}return""}}]).factory("ScheduledPlanWebService",["$q","$timeout","$http","$window","$rootScope","$upload","pinesNotifications","ApiParam",function(e,t,o,a,i,r,n,s){"use strict";var l={getScheduledplansByUser:function(){o.defaults.useXDomain=!0;var e=s.baseURL()+"/v1/schedule/";return o.get(e,s.headerConfig())},sendScheduledplan:function(e){return o.post(s.baseURL()+"/v1/schedule",e,s.headerConfig())},deleteScheduledplan:function(e){return o.put(s.baseURL()+"/v1/schedule",e,s.headerConfig())}};return l}]).controller("ScheduledPlansController",["$scope","ScheduledPlanWebService","pinesNotifications","$rootScope","$location","$uibModal","$window","$q","$bootbox",function(e,t,o,a,i,r,n,s,l){e.scheduleList=[],e.isLoadingApi=!0,e.SchedusleNotFound=!1,e.isDelete=!1,e.setScheduleHeaders=["Schedule Name","Report Name","Creator","Created Date","Recipients","Frequency","Format","Status"],e.actionHeader=["Actions"],t.getScheduledplansByUser().then(function(t){"success"===t.data.result?(e.scheduleList=t.data.json,e.scheduleList.length>0?e.SchedusleNotFound=!1:e.SchedusleNotFound=!0,e.isLoadingApi=!1):(e.isLoadingApi=!1,e.SchedusleNotFound=!0)}),e.sendNow=function(e){var a={schedulePlanId:e.schedule_id};t.sendScheduledplan(a).then(function(e){""!==e.data.result||o.notify({title:"Schedule Reports",text:"Successfully Schedule Report",type:"success"})})},e.delete=function(a,i){l.confirm("Are you sure you want to delete this scheduled report?",function(i){if(i){e.isDelete=!0;var r={schedulePlanId:a.schedule_id};t.deleteScheduledplan(r).then(function(t){return"success"===t.data.result?(e.scheduleList=_.reject(e.scheduleList,function(e){return e.schedule_id==a.schedule_id}),o.notify({title:"Schedule Reports",text:"Successfully deleted the scheduled report",type:"success"}),void(e.isDelete=!1)):void o.notify({title:"Schedule Report",text:t.data.err,type:"error"})})}})}}]),function(){function e(t,o,a,i){var r={};return e.getDataTableInfo=function(){return a.get(i.baseURL()+"/v1/report/schedule/list/"+t.currentOUId,i.headerConfig())},e.getScheduleReport=function(e){return a.get(i.baseURL()+"/v1/report/schedreport/"+e,i.headerConfig())},e.getAuthorization=function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/report/authorize",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return a(i)},e.getAllTopOuUsers=function(e){return a.defaults.useXDomain=!0,console.log(i.baseURL()),a.get(i.baseURL()+"/v1/user/groups/"+e,i.headerConfig())},e.getReport=function(e){return a.get(i.baseURL()+"/v1/report/report/"+e,i.headerConfig())},e.sendNow=function(e){return a.get(i.baseURL()+"/v1/report/sendNow/"+e,i.headerConfig())},e.filterRulesBasesOnId=function(e){return a.get(i.baseURL()+"/v1/report/filters/"+e,i.headerConfig())},e.deleteReport=function(e){return console.log("DELETEING REPORT",e),a.delete(i.baseURL()+"/v1/report/"+e,i.headerConfig())},e.createScheduleReportFilter=function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/report/filter",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return a(i)},e.createScheduleReport=function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/report",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return a(i)},e.createNewSchedule=function(e){var i={method:"POST",url:t.url+":"+t.port+"/v1/report/schedule",headers:{"content-type":"application/json",Authorization:"bearer "+o.sessionStorage.token},data:e};return a(i)},e.deleteSchedule=function(e){return a.delete(i.baseURL()+"/v1/report/schedule/"+e,i.headerConfig())},e.setDateRange=function(e){o.sessionStorage.dateRange=e.range,o.sessionStorage.startDate=e.drp_start,o.sessionStorage.endDate=e.drp_end,o.sessionStorage.schedrptid=e.schedrptid},e.getDateRange=function(e){return r.range=o.sessionStorage.dateRange,r.drp_start=o.sessionStorage.startDate,r.drp_end=o.sessionStorage.endDate,r.schedrptid=o.sessionStorage.schedrptid,r},e}angular.module("scheduled_report_webservices",["api-param"]).factory("ScheduledReportWebService",e),e.$inject=["$rootScope","$window","$http","ApiParam"]}(),angular.module("callers-blacklist",["ui.select2","toggle-switch","angularUtils.directives.dirPagination","api-param","datetime-timezoned","theme.form-directives"]).factory("BlacklistWebService",["$q","$timeout","$http","$window","$rootScope","ApiParam",function(e,t,o,a,i,r){"use strict";var n={saveBlackList:function(e){var t={method:"POST",url:r.baseURL()+"/v1/blacklist/bulk",headers:r.headerConfig().headers,data:e};return o(t)},removeBlockedCallerId:function(e){var t={method:"DELETE",url:r.baseURL()+"/v1/blacklist/",headers:r.headerConfig().headers,data:e};return o(t)},getGroups:function(e){var t={method:"GET",url:r.baseURL()+"/v1/blacklist/org/"+e,headers:r.headerConfig().headers};return o(t)},getBlackList:function(e,t){var a={method:"GET",url:r.baseURL()+"/v1/blacklist?page="+e+"&search="+t,headers:r.headerConfig().headers};return o(a)}};return n}]).controller("BlacklistController",["$uibModal","$scope","$http","$location","BlacklistWebService","$window","$rootScope","pinesNotifications","$route","$bootbox",function(e,t,o,a,i,r,n,s,l,c){"use strict";function d(){t.isLoadingApi=!0;var e=[];void 0==t.maskedSearchNumber?t.maskedSearchNumber="":t.maskedSearchNumber;i.getBlackList(t.currentPage,t.maskedSearchNumber.replace(/[^a-z\d]+/gi,"")).then(function(e){"error"!=e.data.status?(t.callerIdList=e.data.json.blacklistNumbers,t.totalDataRows=e.data.json.totalRows,0!==t.callerIdList.length?t.noDataVisibility=!1:(t.isCheckAll=!1,t.noDataVisibility=!0),t.search.number="",t.isCheckAll=!1):t.callerIdList=[],t.isLoadingApi=!1});_.each(t.selectedCallers,function(t){e.push(t)})}void 0!==n.protect_caller_id&&!0!==n.protect_caller_id&&"true"!==n.protect_caller_id||(location.href="#/access-denied"),t.search={},t.search.number="",t.callerIdList=[],t.checkAll=!1,t.selectedCallers=[],t.isLoadingApi=!0,t.noDataVisibility=!1,t.maskedSearchNumber="",t.currentPage=1,d(),t.pageChanged=function(e){t.currentPage=e,d()},t.searchBlackListNumber=function(){d()},t.blockedGroupsInfo=function(o){e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"./views/blockedgroupsinfomodel.html",controller:"BlacklistModelController",scope:t,backdrop:"static",keyboard:!1,size:"lg",resolve:{callerId:function(){return o}}})},t.checkAllToggle=function(){t.search.number.length>0?angular.forEach(t.callerIdList,function(e){e.number.indexOf(t.search.number)>-1&&(e.isSelected=t.isCheckAll,t.isCheckAll?t.selectedNumberToggle("add",e):t.isCheckAll||t.selectedNumberToggle("remove",e))}):(t.selectedCallers=[],_.map(t.callerIdList,function(e){e.isSelected=t.isCheckAll,t.isCheckAll?t.selectedNumberToggle("add",e):t.isCheckAll||t.selectedNumberToggle("remove",e)}))},t.selectedNumberToggle=function(e,o){var a=!1;switch(e){case"add":_.map(t.selectedCallers,function(e){e==o.number&&(a=!0)}),a||t.selectedCallers.push(o.number);break;case"remove":t.selectedCallers.splice(t.selectedCallers.indexOf(o.number),1)}},t.ischecked=function(e){t.isCheckAll=!1,t.selectedCount=0,e.isSelected?t.selectedNumberToggle("add",e):e.isSelected||t.selectedNumberToggle("remove",e),_.map(t.callerIdList,function(e){!0===e.isSelected?t.selectedCount++:t.selectedCount--}),t.callerIdList.length==t.selectedCount?t.isCheckAll=!0:t.isCheckAll=!1},t.prettyNumber=function(e){return e.replace(/(\d\d\d)(\d\d\d)(\d\d\d\d)/,"($1) $2-$3")},t.deleteCallerId=function(){if(t.selectedCallers.length>0){var e=[],o=t.selectedCallers;if(angular.isUndefined(t.search.number))_.map(t.selectedCallers,function(t){e.push({id:t})});else if(t.search.number.length>0)for(var a=0;a<o.length;a++)o[a].match(t.search.number)&&e.push({id:o[a]});else _.map(t.selectedCallers,function(t){e.push({id:t})});c.confirm("Are you sure you want to delete selected Caller ID?",function(o){o&&i.removeBlockedCallerId(e).then(function(o){"error"!==o.data.status?(s.notify({title:"Blacklist",text:"Successfully removed Caller ID from BlackList.",type:"success"}),_.each(e,function(e){var o=t.selectedCallers.indexOf(e.id);t.selectedCallers.splice(o,1)}),t.search.number="",t.maskedSearchNumber="",d()):(e=[],s.notify({title:"Blacklist",text:"Please try again.",type:"error"}))})})}else s.notify({title:"Blacklist",text:"Please select any number to delete.",type:"error"})},t.$watch("maskedSearchNumber",function(e,o){!angular.isUndefined(e)&&angular.isUndefined(o)?t.search.number=e.replace(/[^0-9]+/g,""):angular.isUndefined(e)||angular.isUndefined(o)?angular.isUndefined(e)&&!angular.isUndefined(o)?t.search.number="":angular.isUndefined(e)&&angular.isUndefined(o)&&(t.search.number=""):t.search.number=e.replace(/[^0-9]+/g,"")}),t.enableAddNumber=!0,t.$watch("addToBlacklist",function(e,o){angular.isUndefined(e)||(10==e.replace(/[^0-9]+/g,"").length?t.enableAddNumber=!1:t.enableAddNumber=!0)}),t.saveBlacklist=function(){if(t.isLoadingApi=!0,void 0===t.addToBlacklist)s.notify({title:"Blacklist",text:"Please enter a valid phone number.",type:"error"});else if(t.addTempBlacklist=t.addToBlacklist.replace(/[^0-9]+/g,""),10==t.addTempBlacklist.length&&"0"!==t.addTempBlacklist.slice(0,1)){var e;e={caller_id:t.addTempBlacklist,org_unit_id:n.currentOUId},i.saveBlackList(e).then(function(e){"error"!=e.data.status?(d(),t.isLoadingApi=!1,s.notify({title:"Blacklist",text:"Successfully added Caller ID to BlackList.",type:"success"}),t.addNumberBlacklist.$setPristine(),t.addToBlacklist=""):(s.notify({title:"Blacklist",text:e.data.err,type:"error"}),t.isLoadingApi=!1)})}else s.notify({title:"Blacklist",text:"Please enter a valid phone number.",type:"error"}),t.isLoadingApi=!1;t.isCheckAll=!1}}]).controller("BlacklistModelController",["$uibModal","$scope","$http","$location","BlacklistWebService","$window","$rootScope","pinesNotifications","$route","callerId","$bootbox",function(e,t,o,a,i,r,n,s,l,c,d){"use strict";void 0!==n.protect_caller_id&&!0!==n.protect_caller_id&&"true"!==n.protect_caller_id||(location.href="#/access-denied"),t.isLoadingApi=!0;t.callerId=c,i.getGroups(t.callerId).then(function(e){"error"!=e.data.status?(_.uniq(_.pluck(e.data.json,"org_unit_name")),_.uniq(_.pluck(e.data.json,"top_org")),_.uniq(_.pluck(e.data.json,"parent_org")),t.groups=_.pluck(e.data.json,"org_unit_name")):console.log("error occoured while fetching groups info"),t.isLoadingApi=!1})}]);